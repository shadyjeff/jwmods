(self.webpackChunkjwplayer=self.webpackChunkjwplayer||[]).push([[98],{8377:(t,e,i)=>{"use strict";i.d(e,{M:()=>r,_:()=>n});const r=function(t,e){var i=t.kind||"cc";return t.default||t.defaulttrack?"default":t._id||t.file||i+e},n=function(t,e){let i=t.label||t.name||t.language;return i||(i="Unknown CC",1<(e+=1)&&(i+=` [${e}]`)),{label:i,unknownCount:e}}},6103:(t,e,d)=>{"use strict";d.d(e,{VS:()=>s,xl:()=>n});var i=d(7477),c=d(2894),r=d(6886),f=d(7941),g=d(7387),v=d(2957),p=d(4446);const m=t=>{throw new p.rG(null,t)},T=function(t){return t.map(t=>new i.Z(t.begin,t.end,t.text))},n=function(l,h,u){l.xhr=(0,r.h)(l.file,function(r){{var n=r,s=l,a=h,o=u;let t,e,i=n.responseXML?n.responseXML.firstChild:null;if(i)for("xml"===(0,f.r1)(i)&&(i=i.nextSibling);i&&i.nodeType===i.COMMENT_NODE;)i=i.nextSibling;try{if(i&&"tt"===(0,f.r1)(i)){if(!n.responseXML)throw new Error("Empty XML response");t=function(e){e||m(306007);var i=[];let r=e.getElementsByTagName("p"),n=30;const s=e.getElementsByTagName("tt");if(null!=s&&s[0]){const e=parseFloat(s[0].getAttribute("ttp:frameRate")||"");isNaN(e)||(n=e)}r||m(306005),r.length||(r=e.getElementsByTagName("tt:p")).length||(r=e.getElementsByTagName("tts:p"));for(let t=0;t<r.length;t++){var a=r[t],o=a.getElementsByTagName("br");for(let t=0;t<o.length;t++){const r=o[t];null!=r&&r.parentNode&&r.parentNode.replaceChild(e.createTextNode("\r\n"),r)}var l=a.innerHTML||a.textContent||a.text||"",l=(0,v.fy)(l).replace(/>\s+</g,"><").replace(/(<\/?)tts?:/g,"$1").replace(/<br.*?\/>/g,"\r\n");if(l){const e=a.getAttribute("begin")||"",r=a.getAttribute("dur")||"",s=a.getAttribute("end")||"",h={begin:(0,v.m9)(e,n),text:l};s?h.end=(0,v.m9)(s,n):r&&(h.end=(h.begin||0)+(0,v.m9)(r,n)),i.push(h)}}return i.length||m(306005),i}(n.responseXML),e=T(t),delete s.xhr,a(e)}else{const f=n.responseText;0<=f.indexOf("WEBVTT")?d.e(347).then(function(t){return d(2776).default}.bind(null,d)).catch((0,c.Jt)(301131)).then(t=>{t=new t(window);e=[],t.oncue=function(t){e.push(t)},t.onflush=function(){delete s.xhr,a(e)},t.parse(f)}).catch(t=>{delete s.xhr,o((0,p.Mm)(null,p.Y7,t))}):(t=(0,g.Z)(f),e=T(t),delete s.xhr,a(e))}}catch(n){delete s.xhr,o((0,p.Mm)(null,p.Y7,n))}}},(t,e,i,r)=>{u((0,p.l9)(r,p.Y7))})},s=function(t){t&&t.forEach(t=>{var e=t.xhr;e&&(e.onload=null,e.onreadystatechange=null,e.onerror=null,"abort"in e)&&e.abort(),delete t.xhr})}},7387:(t,e,i)=>{"use strict";i.d(e,{Z:()=>function(t){var e=[];let i=(t=(0,s.fy)(t)).split("\r\n\r\n");1===i.length&&(i=t.split("\n\n"));for(let t=0;t<i.length;t++)if("WEBVTT"!==i[t]){const s=r(i[t]);s.text&&e.push(s)}return e}});var s=i(2957);const r=t=>{var e={};let i=t.split("\r\n"),r=1;if(0<(i=1===i.length?t.split("\n"):i)[0].indexOf(" --\x3e ")&&(r=0),i.length>r+1&&i[r+1]){const t=i[r],n=t.indexOf(" --\x3e ");0<n&&(e.begin=(0,s.m9)(t.substr(0,n)),e.end=(0,s.m9)(t.substr(n+5)),e.text=i.slice(r+1).join("\r\n"))}return e}},7477:(m,t,e)=>{"use strict";e.d(t,{Z:()=>r});let i=window.VTTCue;const T=t=>"string"==typeof t&&!!{start:!0,middle:!0,end:!0,left:!0,right:!0}[t.toLowerCase()]&&t.toLowerCase();if(!i){const m="auto";(i=function(t,e,i){var r=this;r.hasBeenReset=!1;let n="",s=!1,a=t,o=e,l=i,h=null,u="",d=!0,c=m,f="start",g=m,v=100,p="middle";Object.defineProperty(r,"id",{enumerable:!0,get:()=>n,set(t){n=""+t}}),Object.defineProperty(r,"pauseOnExit",{enumerable:!0,get:()=>s,set(t){s=Boolean(t)}}),Object.defineProperty(r,"startTime",{enumerable:!0,get:()=>a,set(t){if("number"!=typeof t)throw new TypeError("Start time must be set to a number.");a=t,this.hasBeenReset=!0}}),Object.defineProperty(r,"endTime",{enumerable:!0,get:()=>o,set(t){if("number"!=typeof t)throw new TypeError("End time must be set to a number.");o=t,this.hasBeenReset=!0}}),Object.defineProperty(r,"text",{enumerable:!0,get:()=>l,set(t){l=""+t,this.hasBeenReset=!0}}),Object.defineProperty(r,"region",{enumerable:!0,get:()=>h,set(t){h=t,this.hasBeenReset=!0}}),Object.defineProperty(r,"vertical",{enumerable:!0,get:()=>u,set(t){t="string"==typeof(t=t)&&!!{"":!0,lr:!0,rl:!0}[t.toLowerCase()]&&t.toLowerCase();if(!1===t)throw new SyntaxError("An invalid or illegal string was specified.");u=t,this.hasBeenReset=!0}}),Object.defineProperty(r,"snapToLines",{enumerable:!0,get:()=>d,set(t){d=Boolean(t),this.hasBeenReset=!0}}),Object.defineProperty(r,"line",{enumerable:!0,get:()=>c,set(t){if("number"!=typeof t&&t!==m)throw new SyntaxError("An invalid number or illegal string was specified.");c=t,this.hasBeenReset=!0}}),Object.defineProperty(r,"lineAlign",{enumerable:!0,get:()=>f,set(t){t=T(t);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");f=t,this.hasBeenReset=!0}}),Object.defineProperty(r,"position",{enumerable:!0,get:()=>g,set(t){if(t<0||100<t)throw new Error("Position must be between 0 and 100.");g=t,this.hasBeenReset=!0}}),Object.defineProperty(r,"size",{enumerable:!0,get:()=>v,set(t){if(t<0||100<t)throw new Error("Size must be between 0 and 100.");v=t,this.hasBeenReset=!0}}),Object.defineProperty(r,"align",{enumerable:!0,get:()=>p,set(t){t=T(t);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");p=t,this.hasBeenReset=!0}}),r.displayState=void 0}).prototype.getCueAsHTML=function(){return window.WebVTT.convertCueToDOMTree(window,this.text)}}const r=i},2728:(t,e,i)=>{"use strict";i.d(e,{Z:()=>function(e,t){let i,r=t;return{start(){this.stop(),i=window.setInterval(()=>{var t=e.getBandwidthEstimate();(0,s.qh)(t)&&(r=t,e.trigger(n.qG,{bandwidthEstimate:r}))},1e3)},stop(){clearInterval(i)},getEstimate:()=>r}}});var n=i(1643),s=i(6042)},548:(t,e,i)=>{"use strict";i.d(e,{Zv:()=>r,i0:()=>s,pR:()=>n});const r=1,n=r+1,s=25},4506:(t,e,i)=>{"use strict";i.d(e,{Z:()=>r});const r=t=>({bitrate:t.bitrate,label:t.label,width:t.width,height:t.height})},3328:(t,e,i)=>{"use strict";i.d(e,{Z:()=>o});var r=i(6103),h=i(8377);const n={TIT2:"title",TT2:"title",WXXX:"url",TPE1:"artist",TP1:"artist",TALB:"album",TAL:"album"},u=(t,e)=>{var i=t.length;let r,n,s,a="",o=e||0;for(;o<i;)if(0!==(r=t[o++])&&3!==r)switch(r>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:a+=String.fromCharCode(r);break;case 12:case 13:n=t[o++],a+=String.fromCharCode((31&r)<<6|63&n);break;case 14:n=t[o++],s=t[o++],a+=String.fromCharCode((15&r)<<12|(63&n)<<6|(63&s)<<0)}return a},d=t=>{t=(e=>{let i="0x";for(let t=0;t<e.length;t++)e[t]<16&&(i+="0"),i+=e[t].toString(16);return parseInt(i,16)})(t);return 127&t|(32512&t)>>1|(8323072&t)>>2|(2130706432&t)>>3};var c=i(8348),f=i(1643),s=i(6042);function g(t){const e=t.target,{activeCues:i,cues:r}=e,n=e._id,s=this._cues,a=this._activeCues;if(null!=r&&r.length){const t=s[n];s[n]=Array.prototype.slice.call(r),this.parseNativeID3Cues(r,t)}else delete s[n];if(null!=i&&i.length){const t=a[n],e=a[n]=Array.prototype.slice.call(i);this.triggerActiveCues(e,t)}else delete a[n]}const a=(i,t,r)=>{null!=t&&t.length&&(0,s.S6)(t,function(e){var t=e._id||"";if(r&&(e._id=void 0),!c.Browser.ie&&!c.Browser.safari||!i||!/^(native|subtitle|cc)/.test(t)){if(c.Browser.ie&&"disabled"===e.mode||(e.mode="disabled",e.mode="hidden"),e.cues)for(let t=e.cues.length;t--;)e.removeCue(e.cues[t]);e.embedded||(e.mode="disabled"),e.inuse=!1}})},v=t=>/^native(?:captions|subtitles)/.test(t),p=t=>"captions"===t||"subtitles"===t,m=(e,i,r)=>{if(c.Browser.ie){let t=r;(e||"metadata"===i.kind)&&(t=new window.TextTrackCue(r.startTime,r.endTime,r.text),r.value)&&(t.value=r.value);var n=i,s=t,a=[],o=n.mode,l=(n.mode="hidden",n.cues);if(l)for(let t=l.length-1;0<=t&&l[t].startTime>s.startTime;t--)a.unshift(l[t]),n.removeCue(l[t]);try{n.addCue(s),a.forEach(t=>n.addCue(t))}catch(n){console.error(n)}n.mode=o}else try{i.addCue(r)}catch(e){console.error(e)}},T=(t,e)=>t.startTime===e.startTime&&t.endTime===e.endTime&&t.text===e.text&&t.data===e.data&&JSON.stringify(t.value)===JSON.stringify(e.value),y=t=>{var e=(s=>{const a={};if(!("value"in s)&&"data"in s&&s.data instanceof ArrayBuffer){const a=new Uint8Array(s.data);let e=a.length,t=(s={value:{key:"",data:""}},10);for(;t<14&&t<a.length&&0!==a[t];)s.value.key+=String.fromCharCode(a[t]),t++;let i=19,r=a[i],n=(3!==r&&0!==r||(r=a[++i],e--),0);if(1!==r&&2!==r)for(let t=i+1;t<e;t++)if(0===a[t]){n=t-i;break}var o,l;0<n?(o=u(a.subarray(i,i+=n),0),"PRIV"===s.value.key?("com.apple.streaming.transportStreamTimestamp"===o?(l=1&d(a.subarray(i,i+=4)),l=d(a.subarray(i,i+=4))+(l?4294967296:0),s.value.data=l):s.value.data=u(a,i+1),s.value.info=o):(s.value.info=o,s.value.data=u(a,i+1))):(l=a[i],s.value.data=(1===l||2===l?(t,e)=>{var i=t.length-1;let r="",n=e||0;for(;n<i;)254===t[n]&&255===t[n+1]||(r+=String.fromCharCode((t[n]<<8)+t[n+1])),n+=2;return r}:u)(a,i+1))}if(function(t,e){if(null==t)throw new TypeError("Cannot convert undefined or null to object");return Object.prototype.hasOwnProperty.call(Object(t),e)}(n,s.value.key)&&(a[n[s.value.key]]=s.value.data),s.value.info){let t=a[s.value.key];t!==Object(t)&&(t={},a[s.value.key]=t),t[s.value.info]=s.value.data}else a[s.value.key]=s.value.data;return a})(t);return{metadataType:"id3",metadataTime:t.startTime,metadata:e}},o={_itemTracks:null,_textTracks:null,_currentTextTrackIndex:-1,_tracksById:null,_cuesByTrackId:null,_cachedVTTCues:null,_metaCuesByTextTime:null,_unknownCount:0,_activeCues:null,_cues:null,textTrackChangeHandler:null,addTrackHandler:null,cueChangeHandler:null,renderNatively:!1,_initTextTracks(){this._textTracks=[],this._tracksById={},this._metaCuesByTextTime={},this._cuesByTrackId={},this._cachedVTTCues={},this._cues={},this._activeCues={},this._unknownCount=0},addTracksListener(t,e,i){t&&(this.removeTracksListener(t,e,i),this.instreamMode||(t.addEventListener?t.addEventListener(e,i):t["on"+e]=i))},removeTracksListener(t,e,i){t&&(t.removeEventListener&&i?t.removeEventListener(e,i):t["on"+e]=null)},clearTracks(){(0,r.VS)(this._itemTracks);const e=this["_tracksById"];if(e&&Object.keys(e).forEach(t=>{0===t.indexOf("nativemetadata")&&(t=e[t],this.cueChangeHandler&&t.removeEventListener("cuechange",this.cueChangeHandler),a(this.renderNatively,[t],!0))}),this._itemTracks=null,this._textTracks=null,this._tracksById=null,this._cuesByTrackId=null,this._metaCuesByTextTime=null,this._unknownCount=0,this._currentTextTrackIndex=-1,this._activeCues={},this._cues={},this.renderNatively){const e=this.video.textTracks;this.textTrackChangeHandler&&this.removeTracksListener(e,"change",this.textTrackChangeHandler),a(this.renderNatively,e,!0)}},clearMetaCues(){const{_tracksById:e,_cachedVTTCues:i}=this;e&&i&&Object.keys(e).forEach(t=>{0===t.indexOf("nativemetadata")&&(t=e[t],a(this.renderNatively,[t],!1),t.mode="hidden",t.inuse=!0,t._id)&&(i[t._id]={})})},clearCueData(t){var e=this._cachedVTTCues;null!=e&&e[t]&&(e[t]={},this._tracksById)&&(this._tracksById[t].data=[])},disableTextTrack(){var t,e=this.getCurrentTextTrack();e&&(e.mode="disabled",(t=e._id)&&v(t)||this.renderNatively&&c.OS.iOS)&&(e.mode="hidden")},enableTextTrack(){var t=this.getCurrentTextTrack();t&&(t.mode="showing")},getCurrentTextTrack(){if(this._textTracks)return this._textTracks[this._currentTextTrackIndex]},getSubtitlesTrack(){return this._currentTextTrackIndex},addTextTracks(t){const i=[];return t&&(this._textTracks||this._initTextTracks(),t.forEach(t=>{if(!(t.includedInManifest||t.kind&&!p(t.kind))){const e=this._createTrack(t);this._addTrackToList(e),i.push(e),t.file&&(t.data=[],(0,r.xl)(t,t=>{e.sideloaded=!0,this.addVTTCuesToTrack(e,t)},t=>{this.trigger(f.cM,t)}))}}),null!=this)&&null!=(t=this._textTracks)&&t.length&&this.trigger(f.jt,{tracks:this._textTracks}),i},setTextTracks(i){var t;if(this._currentTextTrackIndex=-1,i){if(this._textTracks){const i=this._tracksById;this._activeCues={},this._cues={},this._unknownCount=0,this._textTracks=this._textTracks.filter(t=>{var e=t._id;return this.renderNatively&&e&&v(e)?(delete i[e],!1):(t.name&&0===t.name.indexOf("Unknown")&&this._unknownCount++,0===e.indexOf("nativemetadata")&&"com.apple.streaming"===t.inBandMetadataTrackDispatchType&&delete i[e],!0)},this)}else this._initTextTracks();if(i.length){let e=0;for(var r=i.length,n=this._tracksById,s=this._cuesByTrackId;e<r;e++){var a,o=i[e];let t=o._id||"";if(!t){if(!1===o.inuse&&p(o.kind)&&this.renderNatively){o._id="native"+o.kind+e;continue}if(p(o.kind)||"metadata"===o.kind){if(t=o._id="native"+o.kind+e,!o.label&&"captions"===o.kind){const i=(0,h._)(o,this._unknownCount);o.name=i.label,this._unknownCount=i.unknownCount}}else t=o._id=(0,h.M)(o,this._textTracks?this._textTracks.length:0);if(n[t])continue;o.inuse=!0}if(o.inuse&&!n[t])if("metadata"===o.kind){o.mode="hidden";const i=this.cueChangeHandler=this.cueChangeHandler||g.bind(this);o.removeEventListener("cuechange",i),o.addEventListener("cuechange",i),n[t]=o}else if(p(o.kind)){const i=o.mode;if(o.mode="hidden",o.cues&&o.cues.length||!o.embedded){if("disabled"===i&&!v(t)||(o.mode=i),s[t]&&!s[t].loaded){for(var l=s[t].cues;a=l.shift();)m(this.renderNatively,o,a);o.mode=i,s[t].loaded=!0}this._addTrackToList(o)}}}}this.renderNatively&&this.addTrackListeners(i),null!=this&&null!=(t=this._textTracks)&&t.length&&this.trigger(f.jt,{tracks:this._textTracks})}},addTrackListeners(t){var e=this.textTrackChangeHandler=this.textTrackChangeHandler||function(){var t=this.video.textTracks,e=(0,s.hX)(t,function(t){return(t.inuse||!t._id)&&p(t.kind)});if(!this._textTracks||function(e){var t=this._textTracks,i=this._tracksById;if(e.length>t.length)return!0;for(let t=0;t<e.length;t++){var r=e[t];if(!r._id||!i[r._id])return!0}return!1}.call(this,e))this.setTextTracks(t);else{let e=-1;for(let t=0;t<this._textTracks.length;t++)if("showing"===this._textTracks[t].mode){e=t;break}e!==this._currentTextTrackIndex&&this.setSubtitlesTrack(e+1)}}.bind(this);this.removeTracksListener(t,"change",e),this.addTracksListener(t,"change",e),(c.Browser.edge&&c.Browser.ie||c.Browser.firefox)&&(e=this.addTrackHandler=this.addTrackHandler||function(t){t=t.track;null!=t&&t._id||this.setTextTracks(this.video.textTracks)}.bind(this),this.removeTracksListener(t,"addtrack",e),this.addTracksListener(t,"addtrack",e))},setupSideloadedTracks(t){var e;this.renderNatively&&((e=(t=t||null)===this._itemTracks)||(0,r.VS)(this._itemTracks),this._itemTracks=t)&&!e&&(this.disableTextTrack(),this._clearSideloadedTextTracks(),this.addTextTracks(t))},setSubtitlesTrack(t){var e;this.renderNatively?this._textTracks&&(0===t&&this._textTracks.forEach(t=>{t.mode=t.embedded?"hidden":"disabled"}),this._currentTextTrackIndex!==t-1)&&(this.disableTextTrack(),this._currentTextTrackIndex=t-1,(e=this.getCurrentTextTrack())&&(e.mode="showing"),this.trigger(f.UF,{currentTrack:this._currentTextTrackIndex+1,tracks:this._textTracks})):this.setCurrentSubtitleTrack&&this.setCurrentSubtitleTrack(t-1)},createCue:(t,e,i)=>new(window.VTTCue||window.TextTrackCue)(t,Math.max(e||0,t+.25),i),addVTTCue(t,e){this._tracksById||this._initTextTracks();var i=t.track||"native"+t.type;let r=this._tracksById[i];var n="captions"===t.type?"Unknown CC":"ID3 Metadata",s=t.cue;if(!r){const e={kind:t.type,_id:i,label:n,default:!1};this.renderNatively||"metadata"===e.kind?((r=this._createTrack(e)).embedded=!0,this.setTextTracks(this.video.textTracks)):r=this.addTextTracks([e])[0]}if(this._cacheVTTCue(r,s,e)){const t=this.renderNatively||"metadata"===r.kind;return t?m(t,r,s):r.data.push(s),s}return null},addVTTCuesToTrack(e,i){if(this.renderNatively){var e=e._id,r=this._tracksById;let t=this._cuesByTrackId;var n,s=r[e];if(s){if(null==(r=t)||null==(r=r[e])||!r.loaded)for(t[e]={cues:i,loaded:!0};n=i.shift();)m(this.renderNatively,s,n)}else(t=t||(this._cuesByTrackId={}))[e]={cues:i,loaded:!1}}},parseNativeID3Cues(n,s){const a=n[n.length-1];if(!s||s.length!==n.length||!a._parsed&&!T(s[s.length-1],a)){var o=[],l=[];let e=-1,i=-1,r;for(let t=0;t<n.length;t++){const a=n[t];if(!a._extended&&Boolean(a.data||a.value)){if(a.startTime!==i||null===a.endTime){r=i,i=a.startTime;const n=o[e],s=(o[++e]=[],l[e]=[],i-r);if(n&&0<s)for(let t=0;t<n.length;t++){const a=n[t];a.endTime=i,a._extended=!0}}o[e].push(a),a._parsed||(l[e].push(a),a.endTime-i<.25&&(a.endTime=i+.25),a._parsed=!0)}}for(let t=0;t<l.length;t++)l[t].length&&l[t].forEach(t=>{t=y(t);this.trigger(f.O1,t)})}},triggerActiveCues(t,i){t=t.filter(e=>{if(null==i||!i.some(t=>T(e,t))){if(e.data)return!0;var t=e.text?(t=>{let e;try{e=JSON.parse(t.text)}catch(t){return null}var i={metadataType:e.metadataType,metadataTime:t.startTime,metadata:e};return e.programDateTime&&(i.programDateTime=e.programDateTime),i})(e):null;if(t)"emsg"===t.metadataType&&(t.metadata=t.metadata||{},t.metadata.messageData=e.value),this.trigger(f.rx,t);else if(e.value)return!0}return!1});t.length&&t.forEach(t=>{t=y(t);this.trigger(f.rx,t)})},ensureMetaTracksActive(){const e=this.video.textTracks,i=e.length;for(let t=0;t<i;t++){const i=e[t];"metadata"===i.kind&&"disabled"===i.mode&&(i.mode="hidden")}},_cacheVTTCue(t,e,i){const r=t.kind,n=t._id,s=this._cachedVTTCues;s[n]||(s[n]={});var a=s[n];let o;switch(r){case"captions":case"subtitles":{o=i||Math.floor(20*e.startTime);const t="_"+(e.line||"auto"),r=Math.floor(20*e.endTime),n=a[o+t]||a[o+1+t]||a[o-1+t];return!(n&&Math.abs(n-r)<=1||(a[o+t]=r,0))}case"metadata":{const t=e.data?new Uint8Array(e.data).join(""):e.text;return!a[o=i||e.startTime+t]&&(a[o]=e.endTime,!0)}default:return!1}},_addTrackToList(t){this._textTracks.push(t),this._tracksById[t._id]=t},_createTrack(t){let e;const i=(0,h._)(t,this._unknownCount),r=i.label;if(this._unknownCount=i.unknownCount,this.renderNatively||"metadata"===t.kind){const i=this.video.textTracks;(e=(e=(0,s._e)(i,{label:r}))||this.video.addTextTrack(t.kind,r,t.language||"")).default=t.default,e.mode="disabled",e.inuse=!0}else(e=t).data=e.data||[];return e._id||(e._id=(0,h.M)(t,this._textTracks?this._textTracks.length:0)),e},_clearSideloadedTextTracks(){if(this._textTracks){var t=this._textTracks.filter(t=>t.embedded||"subs"===t.groupid);this._initTextTracks();const e=this._tracksById;t.forEach(t=>{e[t._id]=t}),this._textTracks=t}}}},9601:(t,e,i)=>{"use strict";i.d(e,{E:()=>a,Z:()=>function(t,e,i){let r=t+1e3,n=s.ul;return 0<e?(403===e&&(n=s.H4),r+=a(e)):"http:"===(""+i).substring(0,5)&&"https:"===document.location.protocol?r+=12:0===e&&(r+=11),{code:r,key:n}}});var s=i(4446);const a=t=>400<=t&&t<600?t:6},5099:(t,e,i)=>{"use strict";i.d(e,{Z:()=>function(s){return new Promise(function(e,i){if(s.paused)return i(a("NotAllowedError",0,"play() failed."));let r;const t=function(t){if(r(),"playing"!==t.type){const e=`The play() request was interrupted by a "${t.type}" event.`;return"error"===t.type?i(a("NotSupportedError",9,e)):i(a("AbortError",20,e))}e()},n=function(){s.addEventListener("playing",t),s.addEventListener("abort",t),s.addEventListener("error",t),s.addEventListener("pause",t)};r=function(){s.removeEventListener("play",n),s.removeEventListener("playing",t),s.removeEventListener("pause",t),s.removeEventListener("abort",t),s.removeEventListener("error",t)},s.addEventListener("play",n)})}});const a=(t,e,i)=>{i=new Error(i);return i.name=t,i.code=e,i}},5256:(t,e,i)=>{"use strict";i.d(e,{_T:()=>s,c3:()=>a,ji:()=>n,s_:()=>o});function r(t,r){return t.some(function(e){let i;for(let t=0;t<r.length&&!(i=e[r[t]]);t++);var t;return!!i&&(t=this[i]||!1,this[i]=!0,t)},{})}const s=t=>Math.floor(t/1e3),n=(t,e,i)=>{return t?((t,e)=>{let i=null;var r;return i=e&&t&&(r=Object.keys(t)).length&&(r=((t,e)=>{let i,r=null,n=1/0;return t.forEach(t=>{(i=Math.abs(parseFloat(t)-e))<n&&(r=t,n=i)}),r})(r,s(e)))?t[r]:i})(e,e=t.bitrate||t.bandwidth)||t.label||((t,e,i)=>{if(!t&&!e)return"";let r="",n="";return e&&(n=s(e)+" kbps",r=n),t&&(r=t+"p",e)&&i&&(r+=` (${n})`),r})(t.height,e,i):""},a=t=>!!Array.isArray(t)&&r(t,["height","bitrate","bandwidth"]),o=t=>!!Array.isArray(t)&&r(t,["label"])},686:(t,e,i)=>{"use strict";i.d(e,{s:()=>n,v:()=>s});const r=t=>void 0===t?120:Math.max(t,0),n=(t,e)=>t!==1/0&&Math.abs(t)>=Math.max(r(e),0),s=(t,e)=>{let i="VOD";return t===1/0?i="LIVE":t<0&&(i=n(t,r(e))?"DVR":"LIVE"),i}},3949:(t,e,i)=>{"use strict";i.d(e,{Z:()=>n});var d=i(8348),c=i(974),r=i(9974);const n={container:null,volume(t){this.video.volume=Math.min(Math.max(0,t/100),1)},mute(t){this.video.muted=Boolean(t),this.video.muted||this.video.removeAttribute("muted")},resize(i,r,n){var s=this["video"],{videoWidth:a,videoHeight:o}=s;if(i&&r&&a&&o){var l={objectFit:"",width:"",height:""},h=i/r,u=a/o;if("uniform"===n&&(u<h?i-i/(h/u):r-r/(u/h))<6&&(l.objectFit="fill",n="exactfit"),d.Browser.ie||d.OS.iOS&&(d.OS.version.major||0)<9||d.Browser.androidNative)if("uniform"!==n){l.objectFit="contain";let t=1,e=1;"none"===n?t=e=u<h?Math.ceil(100*o/r)/100:Math.ceil(100*a/i)/100:"fill"===n?t=e=u<h?h/u:u/h:"exactfit"===n&&(e=u<h?(t=h/u,1):(t=1,u/h)),(0,c.vs)(s,`matrix(${t.toFixed(2)}, 0, 0, ${e.toFixed(2)}, 0, 0)`)}else(l.top=l.left=l.margin="",c.vs)(s,"");(0,c.oB)(s,l)}},getContainer(){return this.container},setContainer(t){this.container=t,this.video.parentNode!==t&&t.appendChild(this.video)},removeFromContainer(){var{container:t,video:e}=this;this.container=null,t&&t===e.parentNode&&t.removeChild(e)},remove(){this.stop(),this.destroy(),this.removeFromContainer()},atEdgeOfLiveStream(){return!!this.isLive()&&(0,r.Z)(this.video.buffered)-this.video.currentTime<=2}}},186:(t,e,i)=>{"use strict";i.d(e,{Z:()=>r});const r={_eventsOn(){},_eventsOff(){},attachMedia(){this._eventsOn()},detachMedia(){return this._eventsOff()}}},8702:(t,e,i)=>{"use strict";i.d(e,{Z:()=>n});var s=i(1643),r=i(1261);const n={canplay(){this.renderNatively&&this.setTextTracks(this.video.textTracks),this.trigger(s.Jl)},play(){this.stallTime=-1,this.video.paused||this.state===s._5||this.state===s.r0||this.setState(s.ik)},loadedmetadata(){var t={metadataType:"media",duration:this.getDuration(),height:this.video.videoHeight,width:this.video.videoWidth,seekRange:this.getSeekRange()},e=this.drmUsed;e&&(t.drm=e),this.trigger(s.rx,t)},timeupdate(){const t=this.video.currentTime,e=this.getCurrentTime(),i=this.getDuration();if(!isNaN(i)){this.seeking||this.video.paused||this.state!==s.nQ&&this.state!==s.ik||this.stallTime===t||(this.stallTime=-1,this.setState(s.r0),this.trigger(s.Gj));var r={position:e,duration:i,currentTime:t,seekRange:this.getSeekRange(),metadata:{currentTime:t}},n=this.getLiveLatency();if(null!==n&&(r.latency=n,this.getTargetLatency)){const t=this.getTargetLatency();null!==t&&(r.targetLatency=t)}(this.state===s.r0||this.seeking&&this.state!==s.bc)&&this.trigger(s.R2,r)}},click(t){this.trigger(s.ot,t)},volumechange(){var t=this.video;this.trigger(s.yH,{volume:Math.round(100*t.volume)}),this.trigger(s.gy,{mute:t.muted})},seeking(){if(this.state===s.ik){var t=this.video.buffered.length?this.video.buffered.start(0):-1;if(this.video.currentTime===t)return}else if(this.state===s.bc)return;this.seeking=!0},seeked(){this.seeking&&(this.seeking=!1,this.trigger(s.aQ))},playing(){-1===this.stallTime&&this.setState(s.r0),this.trigger(s.Gj)},pause(){this.state===s.xQ||this.video.ended||this.video.error||this.video.currentTime!==this.video.duration&&this.setState(s._5)},progress(){var t,e=this.getDuration();e<=0||e===1/0||(t=this.video.buffered)&&0!==t.length&&(t=(0,r.v)(t.end(t.length-1)/e,0,1),this.trigger(s.uT,{bufferPercent:100*t,position:this.getCurrentTime(),duration:e,currentTime:this.video.currentTime,seekRange:this.getSeekRange()}))},ratechange(){this.trigger(s.TJ,{playbackRate:this.video.playbackRate})},ended(){this.state!==s.bc&&this.state!==s.xQ&&this.trigger(s.Ms)}}},9974:(t,e,i)=>{"use strict";i.d(e,{Z:()=>function(t){return t&&t.length?t.end(t.length-1):0}})},9054:(f,t,e)=>{"use strict";e.r(t),e.d(t,{default:()=>g});var b={},L=(e.r(b),e.d(b,{debug:()=>r,error:()=>l,info:()=>a,log:()=>s,warn:()=>o}),e(6042));class k{constructor(t,e,i,r){this.video=t,this.hlsjs=i,this.videoListeners=e,this.hlsjsListeners=r}on(){this.off(),(0,L.S6)(this.videoListeners,(t,e)=>{this.video.addEventListener(e,t,!1)}),(0,L.S6)(this.hlsjsListeners,(t,e)=>{this.hlsjs.on(e,t)})}off(){(0,L.S6)(this.videoListeners,(t,e)=>{this.video.removeEventListener(e,t)}),(0,L.S6)(this.hlsjsListeners,(t,e)=>{this.hlsjs.off(e,t)})}}var n=e(5256),D=e(8348);const R=t=>t.audioGroupIds?t.audioGroupIds[t._urlId||t.urlId]:void 0,A=(t,i)=>{const r=(0,n.c3)(t),e=(0,L.UI)(t,(t,e)=>({label:(0,n.ji)(t,i,r),level_id:t.id,hlsjsIndex:e,bitrate:t.bitrate,height:t.height,width:t.width,audioGroupId:R(t)}));return e.sort((t,e)=>t.height&&e.height&&t.height!==e.height?e.height-t.height:(e.bitrate||0)-(t.bitrate||0)),1<e.length&&e.unshift({label:"Auto",level_id:"auto",hlsjsIndex:-1}),e},_=(e,t)=>Math.max(0,(0,L.cq)(t,(0,L.sE)(t,t=>t.hlsjsIndex===e))),I=(e,i,r,n=e.length)=>{var s,a,t=(()=>{try{return window.devicePixelRatio}catch(t){}return 1})();i*=t,r*=t,D.OS.tizen&&(r=i=1/0);for(let t=0;t<n;t++){const n=e[t];if((n.width>=i||n.height>=r)&&(s=n,!(a=e[t+1])||s.width!==a.width||s.height!==a.height))return t}return n-1};var C=e(4742);const i=t=>C.Z.debug?console[t].bind(console,`[Hls.js ${t}] ->`):()=>{},r=i("debug"),s=i("log"),a=i("info"),o=i("warn"),l=i("error");var w=e(548),O=e(5083);var x=e(9601),P=e(4446);let F;(t=F=F||{})[t.BASE_ERROR=23e4]="BASE_ERROR",t[t.ERROR_LIVE_STREAM_DOWN_OR_ENDED=230001]="ERROR_LIVE_STREAM_DOWN_OR_ENDED",t[t.MANIFEST_ERROR_CONNECTION_LOST=232002]="MANIFEST_ERROR_CONNECTION_LOST",t[t.ERROR_CONNECTION_LOST=230002]="ERROR_CONNECTION_LOST",t[t.MANIFEST_PARSING_ERROR=232600]="MANIFEST_PARSING_ERROR",t[t.LEVEL_EMPTY_ERROR=232631]="LEVEL_EMPTY_ERROR",t[t.MANIFEST_INCOMPATIBLE_CODECS_ERROR=232632]="MANIFEST_INCOMPATIBLE_CODECS_ERROR",t[t.FRAG_PARSING_ERROR=233600]="FRAG_PARSING_ERROR",t[t.FRAG_DECRYPT_ERROR=233650]="FRAG_DECRYPT_ERROR",t[t.BUFFER_STALLED_ERROR=234001]="BUFFER_STALLED_ERROR",t[t.BUFFER_APPEND_ERROR=234002]="BUFFER_APPEND_ERROR",t[t.PROTECTED_CONTENT_ACCESS_ERROR=232403]="PROTECTED_CONTENT_ACCESS_ERROR";const M=t=>{if(t){if(/^frag/.test(t))return 2e3;if(/^(manifest|level|audioTrack)/.test(t))return 1e3;if(/^key/.test(t))return 4e3}return 0};var t=e(328),h=e(3949),u=e(186),d=e(3328);class c extends t.ZP{}Object.assign(c.prototype,h.Z,u.Z,d.Z);const N=c;var W=e(4506),Y=e(3343),q=e(686),U=e(1643),B=e(5004),G=e(8702),X=e(386),z=e(5099),Z=e(2728),j=e(7477),H=e(1384);const K=C.Z.debug?console.warn.bind(console):()=>{},V=(t,e,i)=>{var r=t.sources[0];return(void 0!==r[i]?r:void 0!==t[i]?t:e)[i]};t=e(4560);class g extends function(l){const{MEDIA_ATTACHED:e,MEDIA_DETACHED:i,MANIFEST_PARSED:r,LEVEL_LOADED:n,LEVEL_UPDATED:s,LEVEL_PTS_UPDATED:a,FRAG_CHANGED:o,LEVEL_SWITCHED:h,FRAG_PARSING_METADATA:u,BUFFER_APPENDED:d,BUFFER_CODECS:c,FRAG_BUFFERED:f,INIT_PTS_FOUND:g,NON_NATIVE_TEXT_TRACKS_FOUND:v,CUES_PARSED:p,AUDIO_TRACKS_UPDATED:m,ERROR:T}=l.Events,{MEDIA_ERROR:y,NETWORK_ERROR:E}=l.ErrorTypes,S=function(){const u=l.ErrorTypes["NETWORK_ERROR"],{MANIFEST_PARSING_ERROR:d,LEVEL_EMPTY_ERROR:c,MANIFEST_INCOMPATIBLE_CODECS_ERROR:f,FRAG_PARSING_ERROR:g,FRAG_DECRYPT_ERROR:v,BUFFER_STALLED_ERROR:p,BUFFER_APPEND_ERROR:m,INTERNAL_EXCEPTION:T,MANIFEST_LOAD_ERROR:t,MANIFEST_LOAD_TIMEOUT:e,LEVEL_LOAD_ERROR:i,LEVEL_LOAD_TIMEOUT:r,FRAG_LOAD_ERROR:n,FRAG_LOAD_TIMEOUT:s,BUFFER_SEEK_OVER_HOLE:a,BUFFER_NUDGE_ON_STALL:o}=l.ErrorDetails,y=[t,e,d,f,i,r,n,s],E=[p,a,o],S=[c,i,r];return function(t){var{details:e,response:i,type:r}=t;let n=t.fatal,s=y.indexOf(e)<0;var a=0<=E.indexOf(e);let o=0<=S.indexOf(e),l=P.ul,h=F.BASE_ERROR;switch(e){case d:h=F.MANIFEST_PARSING_ERROR;break;case c:h=F.LEVEL_EMPTY_ERROR;break;case f:l=P.zO,h=F.MANIFEST_INCOMPATIBLE_CODECS_ERROR;break;case g:h=F.FRAG_PARSING_ERROR;break;case v:h=F.FRAG_DECRYPT_ERROR;break;case p:h=F.BUFFER_STALLED_ERROR;break;case m:h=F.BUFFER_APPEND_ERROR;break;case T:h=239e3;break;default:r===u&&(!1===navigator.onLine?(s=!1,n="manifestLoadError"===e,o=!1,h=n?F.MANIFEST_ERROR_CONNECTION_LOST:F.ERROR_CONNECTION_LOST,l=P.MD):/TimeOut$/.test(e)?h=F.BASE_ERROR+1001+M(e):i&&({code:h,key:l}=(0,x.Z)(F.BASE_ERROR,i.code,t.url),h+=M(e)))}return{key:l,code:h,recoverable:s,stalling:a,suppressLevel:o,fatal:n,error:t}}}();return class x extends N{constructor(t,e,i){super(),this.bandwidthMonitor=(0,Z.Z)(this,e.bandwidthEstimate),this.bitrateSelection=e.bitrateSelection,this.bufferStallTimeout=1e3,this.connectionTimeoutDuration=1e4,this.dvrEnd=null,this.dvrPosition=null,this.dvrUpdatedTime=0,this.eventHandler=null,this.hlsjs=null,this.hlsjsConfig=null,this.hlsjsOptions=null,this.jwConfig=e,this.lastPosition=0,this.maxRetries=3,this.playerId=t,this.processPlaylistMetadata=Y.q,this.recoveryInterval=5e3,this.renderNatively=(t=e.renderCaptionsNatively,!(!D.OS.iOS&&!D.Browser.safari)||D.Browser.chrome&&t),this.savedVideoProperties=!1,this.seeking=!1,this.staleManifestDurationMultiplier=3e3,this.state=U.bc,this.supports=x.supports,this.supportsPlaybackRate=!0,this.video=i,this.playerWidth=0,this.playerHeight=0,this.playerStretching=null,this.capLevels=!1,this.levelDuration=0,this.live=!1,this.liveEdgePosition=null,this.liveEdgeUpdated=0,this.staleManifestTimeout=-1,this.connectionTimeout=-1,this.programDateSyncTime=0,this.retryCount=0,this.stallTime=-1,this.jwLevels=[],this.audioTracks=null,this.audioTracksArray=null,this.resetLifecycleVariables()}resetLifecycleVariables(){this.resetRecovery(),this.stopStaleTimeout(),this.stopConnectionTimeout(),this.stallTime=-1,this.streamBitrate=-1,this.videoFound=!1,this.videoHeight=0,this.src=null,this.currentHlsjsLevel=null,this.currentAudioTrackIndex=null,this.currentJwItem=null,this.jwLevels=[],this.audioTracks=null,this.audioTracksArray=null,this.lastRecoveryTime=null,this.lastEndSn=null,this.levelDuration=0,this.live=!1,this.liveEdgePosition=null,this.liveEdgeUpdated=0,this.liveEdgeSn=-1,this.livePaused=!1,this.recoveringMediaError=!1,this.recoveringNetworkError=!1,this.streamType="VOD",this.lastProgramDateTime=0,this.programDateSyncTime=0}resetRecovery(){this.retryCount=0}stopStaleTimeout(){clearTimeout(this.staleManifestTimeout),this.staleManifestTimeout=-1}stopConnectionTimeout(){clearTimeout(this.connectionTimeout),this.connectionTimeout=-1}startConnectionTimeout(){-1===this.connectionTimeout&&(this.connectionTimeout=window.setTimeout(()=>{navigator.onLine?this.hlsjs.startLoad():this.handleError(F.ERROR_CONNECTION_LOST,null,P.MD)},this.connectionTimeoutDuration))}initHlsjs(t){var e=this.jwConfig.hlsjsConfig,e={withCredentials:Boolean(V(t,this.jwConfig,"withCredentials")),aesToken:V(t,this.jwConfig,"aestoken"),renderTextTracksNatively:this.renderNatively,onXhrOpen:t.sources[0].onXhrOpen,liveSyncDuration:V(t,this.jwConfig,"liveSyncDuration"),hlsjsConfig:e};this.setupSideloadedTracks(t.tracks),this.capLevels=!t.stereomode,this.hlsjs&&(0,L.wB)(this.hlsjsOptions)(e)||(this.hlsjsOptions=e,this.restoreVideoProperties(),this.stopStaleTimeout(),this.stopConnectionTimeout(),this.hlsjsConfig=function(t){var i,r,n,{withCredentials:t,aesToken:e,renderTextTracksNatively:s,onXhrOpen:a,liveSyncDuration:o,hlsjsConfig:l}=t,l=(0,L.ei)(l||{},["liveSyncDuration","liveSyncDurationCount","liveMaxLatencyDuration","liveMaxLatencyDurationCount","liveBackBufferLength","backBufferLength","loader","pLoader","fLoader","fragLoadingMaxRetry","fragLoadingRetryDelay","enableWorker","debug"]),s={autoStartLoad:!1,capLevelToPlayerSize:!1,captionsTextTrack1Label:"Unknown CC",captionsTextTrack2Label:"Unknown CC",captionsTextTrack1LanguageCode:"",captionsTextTrack2LanguageCode:"",debug:!!C.Z.debug&&b,fragLoadingMaxRetry:2,fragLoadingRetryDelay:4e3,maxMaxBufferLength:w.i0,renderTextTracksNatively:s,startLevel:-1,testBandwidth:!1},{liveSyncDurationCount:h,liveMaxLatencyDurationCount:u,liveMaxLatencyDuration:d}=l;return void 0!==h||void 0!==u?(l.liveSyncDuration=l.liveMaxLatencyDuration=void 0,l.liveSyncDurationCount=(0,L.xV)(h)?h:1/0,l.liveMaxLatencyDurationCount=(0,L.xV)(u)?u:1/0):void 0===o&&void 0===d||(l.liveSyncDurationCount=l.liveMaxLatencyDurationCount=void 0,s.liveSyncDuration=(0,O.G0)(o),l.liveMaxLatencyDuration=(0,L.xV)(d)?d:1/0),t||e||a?Object.assign({},s,(i=t,r=e,n=a,{xhrSetup(t,e){if(i&&(t.withCredentials=!0),r){const i=0<e.indexOf("?")?"&token=":"?token=";t.open("GET",e+i+r,!0)}"function"==typeof n&&n(t,e)},fetchSetup(t,e){if(r){const i=0<t.url.indexOf("?")?"&token=":"?token=";t.url=t.url+i+r}return i&&(e.credentials="include"),new Request(t.url,e)}}),l):Object.assign({},s,l)}(e),t=Object.assign({},this.hlsjsConfig),e=this.bandwidthMonitor.getEstimate(),(0,L.qh)(e)&&(t.abrEwmaDefaultEstimate=e),t.appendErrorMaxRetry=1,this.hlsjs=new l(t),this.eventHandler=new k(this.video,this.createVideoListeners(),this.hlsjs,this.createHlsjsListeners()))}init(t){this.destroy(),this.initHlsjs(t)}preload(t){"metadata"===t.preload&&(this.maxBufferLength=w.Zv),this.load(t)}load(e){var{hlsjs:i,video:r,src:t}=this;if(i){var n=e.sources[0].file,n=n.url&&"string"==typeof n.url?n.url:n;if(t===n&&this.videoSrc===r.src)this.maxBufferLength=w.i0;else{let t=e.starttime||-1;t<-1&&(t=this.lastPosition),this.initHlsjs(e),this.currentJwItem=e,this.src=n,this.videoHeight=0,this._eventsOn(),i.config.startPosition=t,i.loadSource(n),i.attachMedia(r),this.videoSrc=r.src}}}restartStream(t){var e=Object.assign({},this.currentJwItem);t?e.starttime=t:delete e.starttime,this.src=null,this._clearNonNativeCues(),this.clearMetaCues(),this.clearTracks(),this.init(e),this.load(e),delete e.starttime}play(){return this.livePaused&&(this.livePaused=!1,this.restartStream()),this.video.play()||(0,z.Z)(this.video)}pause(){this.stopConnectionTimeout(),this.live&&"LIVE"===this.streamType&&!this.livePaused&&this.livePause(),this.video.pause()}livePause(){this.hlsjs&&(this.livePaused=!0,this.hlsjs.stopLoad(),this.stopStaleTimeout())}stop(){this.clearTracks(),this.hlsjs&&(this._eventsOff(),this.hlsjs.stopLoad()),this.pause(),this.setState(U.bc)}seek(e){var i=this.getDuration();if(i&&i!==1/0&&!(0,L.i2)(i)){this.stopStaleTimeout(),this.stopConnectionTimeout();let t=0<=e?e:e+this.video.duration;var r=this.getSeekRange(),e=("DVR"===this.streamType&&null!==this.dvrEnd&&(this.dvrPosition=t-this.dvrEnd,e<0)&&(t+=Math.min(12,((0,B.z)()-this.dvrUpdatedTime)/1e3)),this.seeking=!0,this.video.currentTime),e=(this.trigger(U.NZ,{position:this.getCurrentTime(),offset:t,duration:i,currentTime:e,seekRange:r,metadata:{currentTime:e}}),this.video.currentTime=t,this.video.currentTime),i={position:this.getCurrentTime(),duration:i,currentTime:e,seekRange:r,metadata:{currentTime:e}};this.trigger("time",i)}}getCurrentQuality(){let t=0;return t=this.hlsjs&&!this.hlsjs.autoLevelEnabled?_(this.hlsjs.manualLevel,this.jwLevels):t}getQualityLevels(){return(0,L.UI)(this.jwLevels,t=>(0,W.Z)(t))}getCurrentAudioTrack(){return(0,L.hj)(this.currentAudioTrackIndex)?this.currentAudioTrackIndex:-1}getAudioTracks(){return this.audioTracks||[]}getCurrentTime(){return this.live&&"DVR"===this.streamType?(this.dvrPosition||this.updateDvrPosition(this.getSeekRange()),this.dvrPosition):this.video.currentTime}getDuration(){var t,e;return this.live&&this.currentJwItem?(t=this.levelDuration,e=this.currentJwItem.minDvrWindow,(0,q.s)(t,e)?(this.streamType="DVR",-t):(this.streamType="LIVE",1/0)):(this.streamType="VOD",this.video.duration)}getCurrentHlsjsLevel(){let t=0;var e=this["hlsjs"];return t=e?e.streamController.loadedmetadata&&0<e.currentLevel?e.currentLevel:e.firstLevel:t}getName(){return{name:"hlsjs"}}getPlaybackRate(){return this.video.playbackRate}getSeekRange(){var{levelDuration:t,video:e}=this,{seekable:e,duration:i}=e,e=e.length?Math.max(e.end(0),e.end(e.length-1)):i;return(0,L.i2)(i)?{start:0,end:0}:{start:Math.max(0,e-t),end:e}}getBandwidthEstimate(){var t=this["hlsjs"];return t?t.bandwidthEstimate:null}getLiveLatency(){let t=null;var e,i;return this.live&&null!==this.liveEdgePosition&&(i=(0,B.z)(),t=this.liveEdgePosition+(i-this.liveEdgeUpdated)/1e3-this.video.currentTime,e=this.lastProgramDateTime)&&0<(i=i/1e3-(e/1e3+(this.video.currentTime-this.programDateSyncTime))-t)&&i<10&&(t+=i),t}getTargetLatency(){return this.hlsjs&&this.hlsjs.targetLatency||null}setCurrentQuality(i){var t;i<0||(t=(t=>{let e=-1;return e=-1<i&&t[i]?t[i].hlsjsIndex:e})(this.jwLevels),this.hlsjs.nextLevel=t,this.trigger(U.aM,{levels:this.jwLevels,currentQuality:i}),this.bitrateSelection=this.jwLevels[i].bitrate)}setCurrentAudioTrack(e){var i=this.getCurrentHlsjsLevel(),t=this.hlsjs.levels[i],i=_(i,this.jwLevels);if(this.jwLevels&&this.jwLevels[i]&&t&&this.audioTracksArray&&(0,L.dp)(this.audioTracksArray)&&(0,L.hj)(e)){i=this.audioTracks=this.audioTracksArray;if(i&&(0,L.dp)(i)&&i[e]&&this.currentAudioTrackIndex!==e){this.trigger(U.j0,{tracks:i,currentTrack:e});let t=(i=this.audioTracks)[e];null!==this.currentAudioTrackIndex&&t.hlsjsIndex!==this.hlsjs.audioTrack&&(this.trigger(U._B,{tracks:i,currentTrack:e}),t=this.audioTracks[e]),this.currentAudioTrackIndex=e,t.hlsjsIndex!==this.hlsjs.audioTrack&&(this.hlsjs.audioTrack=t.hlsjsIndex)}}}updateAudioTrack(t){if(this.hlsjs&&this.hlsjs.audioTracks.length){let t=this.currentAudioTrackIndex;var e;(0,L.hj)(t)?this.audioTracks&&this.audioTracks[t].hlsjsIndex===this.hlsjs.audioTrack||(this.currentAudioTrackIndex=null):t=this.audioTracksArray?([e=[]]=[this.audioTracksArray],Math.max((0,L.cq)(e,(0,L.sE)(e,t=>t.defaulttrack)),0)):0,this.setCurrentAudioTrack(t)}}updateDvrPosition(t){this.dvrPosition=this.video.currentTime-t.end,this.dvrEnd=t.end,this.dvrUpdatedTime=(0,B.z)()}setCurrentSubtitleTrack(t){this.hlsjs.subtitleTrack=t}setPlaybackRate(t){this.video.playbackRate=this.video.defaultPlaybackRate=t}get maxBufferLength(){return this.hlsjs?this.hlsjs.config.maxMaxBufferLength:NaN}set maxBufferLength(t){this.hlsjs&&(this.hlsjs.config.maxMaxBufferLength=t)}isLive(){return this.live}checkAdaptation(n){var{levels:s,autoLevelEnabled:a}=this.hlsjs,t=s[n];if(t){let{width:e,height:i,bitrate:r}=t;if(e=e||this.video.videoWidth,(i=i||this.video.videoHeight)!==this.videoHeight||r!==this.streamBitrate){const o=_(n,this.jwLevels);let t="api";-1!==this.streamBitrate&&this.streamBitrate||this.videoHeight?a&&(t="auto"):t="initial choice",this.videoHeight=i,this.streamBitrate=r;const l=a?"auto":"manual",h=a&&1<s.length?"auto":this.jwLevels[o].label,u=()=>{this.trigger(U.ug,{reason:t,mode:l,level:{bitrate:r,index:o,label:h,width:e,height:i}})};D.Browser.ie?this.once("time",u,this):u()}}}createVideoListeners(){const i={waiting:()=>{this.startConnectionTimeout(),this.seeking?this.setState(U.ik):this.state===U.r0&&(this.atEdgeOfLiveStream()&&this.setPlaybackRate(1),this.stallTime=this.video.currentTime,this.setState(U.nQ))}};return Object.keys(G.Z).forEach(t=>{const e=G.Z[t];"playing"===t?i[t]=function(){var t=this.getCurrentHlsjsLevel();this.checkAdaptation(t),e.call(this)}.bind(this):"ended"===t?i[t]=function(){this.videoHeight=0,this.streamBitrate=-1,e.call(this)}.bind(this):"error"!==t&&(i[t]=e.bind(this))}),i}createHlsjsListeners(){var t={};return t[e]=()=>{this.recoveringMediaError&&(this.hlsjs.startLoad(),this.recoveringMediaError=!1,this.resetRecovery(),this.stopStaleTimeout(),this.stopConnectionTimeout())},t[i]=()=>{this._clearNonNativeCues()},t[r]=(t,e)=>{var i=e["levels"],r=this.hlsjs,{bitrateSelection:n,jwConfig:s}=this;let a=-1,o=-1;if(this.currentHlsjsLevel=null,this.jwLevels=A(i,s.qualityLabels),this.capLevels&&(this.playerWidth||this.playerHeight)&&this.playerStretching){const t=I(i,this.playerWidth,this.playerHeight,e.firstLevel+1);r.levelController.firstLevel!==t&&(r.firstLevel=t),this.resize(this.playerWidth,this.playerHeight,this.playerStretching)}(0,L.qh)(n)&&(a=((e,i)=>{if(!i)return-1;let r=Number.MAX_VALUE,n=-1;for(let t=0;t<e.length;t++){var s=e[t];if(s.bitrate){s=Math.abs(i-s.bitrate);if(s<=r&&(r=s,n=t),!s)break}}return n})(i,n),o=a),r.startLevel=a,r.nextLevel=o,r.startLoad(r.config.startPosition),this.trigger(U.UZ,{levels:this.jwLevels,currentQuality:_(a,this.jwLevels)})},t[n]=(t,e)=>{var{endSN:e,live:i,targetduration:r}=e.details;this.checkStaleManifest(e,i,r)},t[s]=(t,e)=>{var{live:e,totalduration:i}=e.details,i=(this.live=e,this.levelDuration=i,this.getSeekRange()),r=null!==this.dvrEnd&&1<Math.abs(this.dvrEnd-i.end);"DVR"===this.streamType&&r&&this.updateDvrPosition(i),e&&this.state===U.bc&&this.livePause()},t[a]=(t,e)=>{var{fragments:e,totalduration:i}=e.details;if(this.levelDuration=i,e.length){const t=e[e.length-1];t.sn!==this.liveEdgeSn&&(this.liveEdgeUpdated=(0,B.z)(),this.liveEdgeSn=t.sn,this.liveEdgePosition=t.start+t.duration)}},t[h]=(t,e)=>{e=e.level;e!==this.currentHlsjsLevel?this.setCurrentLevel(e):this.checkAdaptation(e)},t[o]=(t,e)=>{this.lastProgramDateTime=e.frag.programDateTime,this.programDateSyncTime=e.frag.start},t[u]=(t,e)=>{e.samples&&([].some.call(this.video.textTracks,t=>!t.inuse)&&this.setTextTracks(this.video.textTracks),null!=e)&&e.samples&&e.samples.forEach(t=>{this.trigger(U.rx,{metadataType:"dai-hls",metadata:{messageData:t.data,start:t.pts,type:"ID3"}})})},t[d]=()=>{-1!==this.connectionTimeout&&this.stopConnectionTimeout(),this.atEdgeOfLiveStream()||this.stopStaleTimeout(),this.recoveringNetworkError&&(this.resetRecovery(),this.recoveringNetworkError=!1)},t[c]=(t,e)=>{e.audio&&this.videoFound||(e=e.audiovideo||e.video?"video":"audio",this.videoFound=this.videoFound||"video"==e,this.trigger(U.oZ,{mediaType:e}))},t[f]=(t,e)=>{const i=e.frag;(i.tagList||[]).forEach(([t,e])=>this.processPlaylistMetadata(t,e,i))},t[g]=(t,e)=>{var{frag:e,initPTS:i}=e;this.processPlaylistMetadata("DISCONTINUITY",i,e)},this.renderNatively||(t[v]=(t,e)=>{this.addTextTracks(e.tracks)},t[p]=(t,i)=>{var r;if(null!=i&&null!=(r=i.cues)&&r.length){let e=i.cues.length-1;const r=!(i.cues[0]instanceof j.Z);i.cues.forEach(t=>{if(r){const e=t;(t=new j.Z(e.startTime,e.endTime,e.text)).position=e.position}t.align="center",t.line=15-e,this.addVTTCue({type:i.type,cue:t,track:i.track}),e--})}}),t[m]=(t,e)=>{const i=e["audioTracks"],r=this.hlsjs.levels,n=this.getCurrentHlsjsLevel();null!=i&&i.length&&(this.audioTracksArray=(0,L.u4)(i,(t,e,i)=>(t.push({autoselect:e.autoselect,defaulttrack:e.default,groupid:e.groupId,language:e.lang,name:e.name,hlsjsIndex:i}),t),[]),this.jwLevels.forEach(t=>{var e=0<t.hlsjsIndex?r[t.hlsjsIndex]:null;e&&(t.audioGroupId=R(e))}),this.updateAudioTrack(r[n]))},t[T]=(t,e)=>{const i=this.hlsjs,r=S(e),n=e["type"],s=r["key"];let a;if(K(e),"DVR"===this.streamType&&n===E){const t=this.getSeekRange();this.updateDvrPosition(t)}if(232403===r.code&&this.retryCount<this.maxRetries&&/jwpsrv.com\/.*\?token=/.test(e.url)&&(r.suppressLevel=!1,r.recoverable=!0,r.fatal=!0,a=!0,this.maxRetries=1),r.suppressLevel){const t=i.levels,n=e.context||e,a=n["level"],o=t[a];if(o&&Array.isArray(o.url)&&1===o.url.length){if(i.removeLevel(a,0),!i.levels.length)return void this.handleError(r.code,e,s);r.fatal=!1,this.jwLevels=A(i.levels,this.jwConfig.qualityLabels),this.playerWidth&&this.playerHeight&&this.playerStretching&&this.resize(this.playerWidth,this.playerHeight,this.playerStretching),i.loadLevel=0,i.currentLevel=-1,this.trigger(U.UZ,{levels:this.jwLevels,currentQuality:0})}}if(r.fatal){const t=(0,B.z)(),l=r.recoverable&&(n===E||n===y),h=this.retryCount;if(!(l&&h<this.maxRetries))return i.stopLoad(),void this.handleError(r.code,e,s);(!this.lastRecoveryTime||t>=this.lastRecoveryTime+this.recoveryInterval)&&(K("Attempting to recover, retry count:",h),n===E?/^manifest/.test(e.details)||a?(this.recoverManifestError(),this.retryCount=h):i.startLoad():n===y&&("bufferAppendError"===e.details?(K("Encountered a bufferAppendError in hls not attempting to recover media and destroying instance"),i.destroy()):(this.recoveringMediaError=!0,i.recoverMediaError())),this.recoveringNetworkError=!0,this.retryCount+=1,this.lastRecoveryTime=t)}this.trigger(U.cM,new P.rG(null,r.code+1e5,e))},t}resize(t,e,i){if(this.playerWidth=t,this.playerHeight=e,this.playerStretching=i,this.capLevels){const t=this.hlsjs;if(null!=t&&t.levels){const e=t.autoLevelCapping,i=I(t.levels,this.playerWidth,this.playerHeight);i!==e&&(t.autoLevelCapping=i)>e&&-1!==e&&this.state!==U.bc&&this.state!==U.xQ&&t.streamController.nextLevelSwitch()}}super.resize(t,e,i)}recoverManifestError(){var{currentTime:t,paused:e}=this.video;t||!e?(this.restartStream(t),e||this.play().catch(()=>{})):(this.hlsjs.stopLoad(),this.hlsjs.loadSource(this.src))}_eventsOn(){var{bandwidthMonitor:t,eventHandler:e,video:i}=this;e&&e.on(),t.start(),(0,H.Nm)(this,i)}_eventsOff(){var{bandwidthMonitor:t,eventHandler:e,hlsjs:i,video:r}=this;i&&e&&(this.disableTextTrack(),this.lastPosition=this.video.currentTime,i.detachMedia(),e.off()),this.off(null,null,this),t.stop(),this.resetLifecycleVariables(),(0,H.IP)(r)}handleError(t,e,i){this.resetLifecycleVariables(),this.trigger(U.Ew,new P.rG(i,t,e))}destroy(){this.hlsjs&&(this._eventsOff(),this.hlsjs.destroy(),this.hlsjs=null,this.hlsjsOptions=null)}restoreVideoProperties(){this.savedVideoProperties&&(this.volume(this.jwConfig.volume),this.mute(this.jwConfig.mute),this.savedVideoProperties=!1)}checkStaleManifest(t,e,i){i=null!==this.jwConfig.liveTimeout?1e3*this.jwConfig.liveTimeout:this.staleManifestDurationMultiplier*i;e&&this.lastEndSn===t&&0!=i?-1===this.staleManifestTimeout&&(this.staleManifestTimeout=window.setTimeout(()=>{this.checkStreamEnded()},i)):this.stopStaleTimeout(),this.lastEndSn=t,this.live=e}checkStreamEnded(){this.hlsjs&&(this.video.ended||this.atEdgeOfLiveStream())&&(this.hlsjs.stopLoad(),this.handleError(F.ERROR_LIVE_STREAM_DOWN_OR_ENDED,null,P.Sp))}setCurrentLevel(t){this.currentHlsjsLevel=t,this.checkAdaptation(t),this.updateAudioTrack(this.hlsjs.levels[t])}_clearNonNativeCues(){!this.renderNatively&&this._textTracks&&this._textTracks.forEach(t=>{this.clearCueData(t._id)})}static setEdition(t){x.supports=(0,X.Z)(t)}}}(e.n(t)()){getName(){return{name:"hlsjs"}}static getName(){return{name:"hlsjs"}}}},3343:(t,e,i)=>{"use strict";i.d(e,{q:()=>r});var u=i(6042),s=i(1643);const d=(t,e)=>{t=t[e];return(0,u.xV)(t)&&0<=t?t:null},r=function(t,e,i){var r=((i,r,n)=>{let s,a;if(null===(s=(0,u.xV)(n.startPTS)?d(n,"startPTS"):d(n,"start")))return null;switch(i){case"PROGRAM-DATE-TIME":return{metadataType:a="program-date-time",programDateTime:r,start:s,end:s+d(n,"duration")};case"EXT-X-DATERANGE":{const d={},l=r.split(",").map(t=>{var t=t.split("="),e=t[0],t=(t[1]||"").replace(/^"|"$/g,"");return{name:e,value:d[e]=t}}),h=d["START-DATE"];if(!h)return null;var o=d["END-DATE"];let t=s;if((0,u.xV)(n.programDateTime)&&(t+=(new Date(h).getTime()-new Date(n.programDateTime).getTime())/1e3),isNaN(t))return null;let e=parseFloat(d["PLANNED-DURATION"]||d.DURATION)||0;return!e&&o&&(e=(new Date(o).getTime()-new Date(h).getTime())/1e3),{metadataType:a="date-range",tag:i,content:r,attributes:l,start:t,end:t+e,startDate:h,endDate:o,duration:e}}case"EXT-X-CUE-IN":case"EXT-X-CUE-OUT":return{metadataType:a="scte-35",tag:i,content:r,start:s,end:s+(parseFloat(r)||0)};case"DISCONTINUITY":{const u=s+d(n,"duration");let t;return"cc"in n&&(t=n.cc),{metadataType:a="discontinuity",tag:i,discontinuitySequence:t,PTS:r,start:s,end:u}}default:return null}})(t,e,i);if(r&&(0,u.xV)(r.start)){const d=this.createCue(r.start,r.end,JSON.stringify(r)),n=i.sn+`_${t}_`+e;if(this.addVTTCue({type:"metadata",cue:d},n)){const t=r.metadataType;delete r.metadataType,this.trigger(s.O1,{metadataType:t,metadata:r})}}}},4560:function(t,e){var i;"undefined"!=typeof window&&(i=()=>{return i={21:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>r});f.prototype.decrypt=function(t,e){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},e,t)};var a=f,o=(c.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},c),l=i(145),h=((e=d.prototype).uint8ArrayToUint32Array_=function(t){for(var e=new DataView(t),i=new Uint32Array(4),r=0;r<4;r++)i[r]=e.getUint32(4*r);return i},e.initTable=function(){for(var t=this.sBox,e=this.invSBox,i=this.subMix,r=i[0],n=i[1],s=i[2],a=i[3],i=this.invSubMix,o=i[0],l=i[1],h=i[2],u=i[3],d=new Uint32Array(256),c=0,f=0,g=0,g=0;g<256;g++)d[g]=g<128?g<<1:g<<1^283;for(g=0;g<256;g++){var v=f^f<<1^f<<2^f<<3^f<<4,p=(t[c]=v=v>>>8^255&v^99,d[e[v]=c]),m=d[p],T=d[m],y=257*d[v]^16843008*v;r[c]=y<<24|y>>>8,n[c]=y<<16|y>>>16,s[c]=y<<8|y>>>24,a[c]=y,o[v]=(y=16843009*T^65537*m^257*p^16843008*c)<<24|y>>>8,l[v]=y<<16|y>>>16,h[v]=y<<8|y>>>24,u[v]=y,c?(c=p^d[d[d[T^p]]],f^=d[d[f]]):c=f=1}},e.expandKey=function(t){for(var e=this.uint8ArrayToUint32Array_(t),i=!0,r=0;r<e.length&&i;)i=e[r]===this.key[r],r++;if(!i){this.key=e;var n=this.keySize=e.length;if(4!==n&&6!==n&&8!==n)throw new Error("Invalid aes key size="+n);for(var s,a,o,l=this.ksRows=4*(n+6+1),h=this.keySchedule=new Uint32Array(l),u=this.invKeySchedule=new Uint32Array(l),d=this.sBox,c=this.rcon,t=this.invSubMix,f=t[0],g=t[1],v=t[2],p=t[3],m=0;m<l;m++)m<n?a=h[m]=e[m]:(o=a,m%n==0?(o=d[(o=o<<8|o>>>24)>>>24]<<24|d[o>>>16&255]<<16|d[o>>>8&255]<<8|d[255&o],o^=c[m/n|0]<<24):6<n&&m%n==4&&(o=d[o>>>24]<<24|d[o>>>16&255]<<16|d[o>>>8&255]<<8|d[255&o]),h[m]=a=(h[m-n]^o)>>>0);for(s=0;s<l;s++)m=l-s,o=3&s?h[m]:h[m-4],u[s]=s<4||m<=4?o:f[d[o>>>24]]^g[d[o>>>16&255]]^v[d[o>>>8&255]]^p[d[255&o]],u[s]=u[s]>>>0}},e.networkToHostOrderSwap=function(t){return t<<24|(65280&t)<<8|(16711680&t)>>8|t>>>24},e.decrypt=function(t,e,i){for(var r,n,s,a,o,l,h,u,d,c,f,g,v,p,m=this.keySize+6,T=this.invKeySchedule,y=this.invSBox,E=this.invSubMix,S=E[0],b=E[1],L=E[2],k=E[3],E=this.uint8ArrayToUint32Array_(i),D=E[0],R=E[1],A=E[2],_=E[3],I=new Int32Array(t),C=new Int32Array(I.length),w=this.networkToHostOrderSwap;e<I.length;){for(d=w(I[e]),c=w(I[e+1]),f=w(I[e+2]),g=w(I[e+3]),o=d^T[0],l=g^T[1],h=f^T[2],u=c^T[3],v=4,p=1;p<m;p++)r=S[o>>>24]^b[l>>16&255]^L[h>>8&255]^k[255&u]^T[v],n=S[l>>>24]^b[h>>16&255]^L[u>>8&255]^k[255&o]^T[v+1],s=S[h>>>24]^b[u>>16&255]^L[o>>8&255]^k[255&l]^T[v+2],a=S[u>>>24]^b[o>>16&255]^L[l>>8&255]^k[255&h]^T[v+3],o=r,l=n,h=s,u=a,v+=4;r=y[o>>>24]<<24^y[l>>16&255]<<16^y[h>>8&255]<<8^y[255&u]^T[v],n=y[l>>>24]<<24^y[h>>16&255]<<16^y[u>>8&255]<<8^y[255&o]^T[v+1],s=y[h>>>24]<<24^y[u>>16&255]<<16^y[o>>8&255]<<8^y[255&l]^T[v+2],a=y[u>>>24]<<24^y[o>>16&255]<<16^y[l>>8&255]<<8^y[255&h]^T[v+3],C[e]=w(r^D),C[e+1]=w(a^R),C[e+2]=w(s^A),C[e+3]=w(n^_),D=d,R=c,A=f,_=g,e+=4}return C.buffer},d),n=i(93),u=i(63),r=((e=s.prototype).destroy=function(){this.observer=null},e.isSync=function(){return this.config.enableSoftwareAES},e.flush=function(){var t,e,i,r=this.currentResult;if(r)return r=new Uint8Array(r),this.reset(),this.removePKCS7Padding?(i=(e=(t=r).byteLength)&&new DataView(t.buffer).getUint8(e-1))?(0,l.sliceUint8)(t,0,e-i):t:r;this.reset()},e.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},e.decrypt=function(t,e,i,r){var n;this.config.enableSoftwareAES?(this.softwareDecrypt(new Uint8Array(t),e,i),(n=this.flush())&&r(n.buffer)):this.webCryptoDecrypt(new Uint8Array(t),e,i).then(r)},e.softwareDecrypt=function(t,e,i){var r=this.currentIV,n=this.currentResult,s=this.remainderData,s=(this.logOnce("JS AES decrypt"),s&&(t=(0,u.appendUint8Array)(s,t),this.remainderData=null),this.getValidChunk(t));if(!s.length)return null;r&&(i=r);t=this.softwareDecrypter,(t=t||(this.softwareDecrypter=new h)).expandKey(e),r=n;return this.currentResult=t.decrypt(s.buffer,0,i),this.currentIV=(0,l.sliceUint8)(s,-16).buffer,r||null},e.webCryptoDecrypt=function(e,i,r){var n=this,s=this.subtle;return this.key===i&&this.fastAesKey||(this.key=i,this.fastAesKey=new o(s,i)),this.fastAesKey.expandKey().then(function(t){return s?new a(s,r).decrypt(e.buffer,t):Promise.reject(new Error("web crypto not initialized"))}).catch(function(t){return n.onWebCryptoError(t,e,i,r)})},e.onWebCryptoError=function(t,e,i,r){return n.logger.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",t),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(e,i,r)},e.getValidChunk=function(t){var e=t,i=t.length-t.length%16;return i!==t.length&&(e=(0,l.sliceUint8)(t,0,i),this.remainderData=(0,l.sliceUint8)(t,i)),e},e.logOnce=function(t){this.logEnabled&&(n.logger.log("[decrypter.ts]: "+t),this.logEnabled=!1)},s);function s(t,e,i){i=(void 0===i?{}:i).removePKCS7Padding,i=void 0===i||i;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=t,this.config=e,this.removePKCS7Padding=i)try{var r=self.crypto;r&&(this.subtle=r.subtle||r.webkitSubtle)}catch(t){}null===this.subtle&&(this.config.enableSoftwareAES=!0)}function d(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}function c(t,e){this.subtle=void 0,this.key=void 0,this.subtle=t,this.key=e}function f(t,e){this.subtle=void 0,this.aesIV=void 0,this.subtle=t,this.aesIV=e}},181:(t,e,i)=>{"use strict";i.r(e),i.d(e,{canParse:()=>n,decodeFrame:()=>f,getID3Data:()=>r,getID3Frames:()=>c,getTimeStamp:()=>s,isFooter:()=>l,isHeader:()=>o,isTimeStampFrame:()=>a,testables:()=>y,utf8ArrayToStr:()=>T});var u,o=function(t,e){return e+10<=t.length&&73===t[e]&&68===t[e+1]&&51===t[e+2]&&t[e+3]<255&&t[e+4]<255&&t[e+6]<128&&t[e+7]<128&&t[e+8]<128&&t[e+9]<128},l=function(t,e){return e+10<=t.length&&51===t[e]&&68===t[e+1]&&73===t[e+2]&&t[e+3]<255&&t[e+4]<255&&t[e+6]<128&&t[e+7]<128&&t[e+8]<128&&t[e+9]<128},r=function(t,e){for(var i=e,r=0;o(t,e);)r=(r+=10)+h(t,e+6),l(t,e+10)&&(r+=10),e+=r;if(0<r)return t.subarray(i,i+r)},h=function(t,e){var i=(127&t[e])<<21;return(i|=(127&t[e+1])<<14)|(127&t[e+2])<<7|127&t[e+3]},n=function(t,e){return o(t,e)&&h(t,e+6)+10<=t.length-e},s=function(t){for(var e=c(t),i=0;i<e.length;i++){var r=e[i];if(a(r))return m(r)}},a=function(t){return t&&"PRIV"===t.key&&"com.apple.streaming.transportStreamTimestamp"===t.info},d=function(t){var e=String.fromCharCode(t[0],t[1],t[2],t[3]),i=h(t,4);return{type:e,size:i,data:t.subarray(10,10+i)}},c=function(t){for(var e=0,i=[];o(t,e);){for(var r=h(t,e+6),n=(e+=10)+r;e+8<n;){var s=d(t.subarray(e)),a=f(s);a&&i.push(a),e+=s.size+10}l(t,e)&&(e+=10)}return i},f=function(t){return("PRIV"===t.type?g:"W"===t.type[0]?p:v)(t)},g=function(t){var e,i;if(!(t.size<2))return e=T(t.data,!0),i=new Uint8Array(t.data.subarray(e.length+1)),{key:t.type,info:e,data:i.buffer}},v=function(t){var e,i;if(!(t.size<2))return"TXXX"===t.type?(e=1,e+=(i=T(t.data.subarray(1),!0)).length+1,e=T(t.data.subarray(e)),{key:t.type,info:i,data:e}):(i=T(t.data.subarray(1)),{key:t.type,data:i})},p=function(t){var e,i;return"WXXX"===t.type?t.size<2?void 0:(e=1,e+=(i=T(t.data.subarray(1),!0)).length+1,e=T(t.data.subarray(e)),{key:t.type,info:i,data:e}):(i=T(t.data),{key:t.type,data:i})},m=function(t){var e;if(8===t.data.byteLength)return e=1&(t=new Uint8Array(t.data))[3],t=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7],t/=45,e&&(t+=47721858.84),Math.round(t)},T=function(t,e){void 0===e&&(e=!1);var i,r;u=u||void 0===self.TextDecoder?u:new self.TextDecoder("utf-8");if(u)return i=u.decode(t),e?-1!==(r=i.indexOf("\0"))?i.substring(0,r):i:i.replace(/\0/g,"");for(var n,s,a,o=t.length,l="",h=0;h<o;){if(0===(n=t[h++])&&e)return l;if(0!==n&&3!==n)switch(n>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:l+=String.fromCharCode(n);break;case 12:case 13:s=t[h++],l+=String.fromCharCode((31&n)<<6|63&s);break;case 14:s=t[h++],a=t[h++],l+=String.fromCharCode((15&n)<<12|(63&s)<<6|(63&a)<<0)}}return l},y={decodeTextFrame:v}},182:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>function(s){function a(t,e){s.postMessage({event:t,data:e})}var o=new n.EventEmitter;o.on(r.Events.FRAG_DECRYPTED,a),o.on(r.Events.ERROR,a),s.addEventListener("message",function(t){var e=t.data;switch(e.cmd){case"init":var i,r=JSON.parse(e.config);for(i in s.transmuxer=new l.default(o,e.typeSupported,r,e.vendor,e.id),(0,h.enableLogs)(r.debug,e.id),h.logger)!function(e){h.logger[e]=function(t){a("workerLog",{logType:e,message:t})}}(i);a("init",null);break;case"configure":s.transmuxer.configure(e.config);break;case"demux":r=s.transmuxer.push(e.data,e.decryptdata,e.chunkMeta,e.state);(0,l.isPromise)(r)?r.then(function(t){u(s,t)}):u(s,r);break;case"flush":var n=e.chunkMeta,r=s.transmuxer.flush(n);(0,l.isPromise)(r)?r.then(function(t){d(s,t,n)}):d(s,r,n)}})}});var l=i(544),r=i(851),h=i(93),n=i(729);function u(t,e){var i,r,n;return!!((i=e.remuxResult).audio||i.video||i.text||i.id3||i.initSegment)&&(i=[],r=(n=e.remuxResult).audio,n=n.video,r&&s(i,r),n&&s(i,n),t.postMessage({event:"transmuxComplete",data:e},i),!0)}function s(t,e){e.data1&&t.push(e.data1.buffer),e.data2&&t.push(e.data2.buffer)}function d(i,t,e){t.reduce(function(t,e){return u(i,e)||t},!1)||i.postMessage({event:"transmuxComplete",data:t[0]}),i.postMessage({event:"flush",data:e})}},544:(M,t,e)=>{"use strict";e.r(t),e.d(t,{TransmuxConfig:()=>ut,TransmuxState:()=>dt,default:()=>at,isPromise:()=>ht});var _=e(851),I=e(973),r=e(21),d=e(965),u=e(181),c=e(856);function f(t,e){return{type:t=void 0===t?"":t,id:-1,pid:-1,inputTimeScale:e=void 0===e?9e4:e,sequenceNumber:-1,samples:[],dropped:0}}var C=e(63),N=e(145);(t=i.prototype).resetInitSegment=function(t,e,i,r){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},t.resetTimeStamp=function(t){this.initPTS=t,this.resetContiguity()},t.resetContiguity=function(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0},t.canParse=function(t,e){return!1},t.appendFrame=function(t,e,i){},t.demux=function(t,e){this.cachedData&&(t=(0,C.appendUint8Array)(this.cachedData,t),this.cachedData=null);var i,r,n=u.getID3Data(t,0),s=n?n.length:0,a=this._audioTrack,o=this._id3Track,l=n?u.getTimeStamp(n):void 0,h=t.length;for((null===this.basePTS||0===this.frameIndex&&(0,d.isFiniteNumber)(l))&&(this.basePTS=U(l,e,this.initPTS),this.lastPTS=this.basePTS),null===this.lastPTS&&(this.lastPTS=this.basePTS),n&&0<n.length&&o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:c.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});s<h;)this.canParse(t,s)?(r=this.appendFrame(a,t,s))?(this.frameIndex++,this.lastPTS=r.sample.pts,i=s+=r.length):s=h:u.canParse(t,s)?(n=u.getID3Data(t,s),o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:c.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY}),i=s+=n.length):s++,s===h&&i!==h&&(r=(0,N.sliceUint8)(t,i),this.cachedData?this.cachedData=(0,C.appendUint8Array)(this.cachedData,r):this.cachedData=r);return{audioTrack:a,videoTrack:f(),id3Track:o,textTrack:f()}},t.demuxSampleAes=function(t,e,i){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},t.flush=function(t){var e=this.cachedData;return e&&(this.cachedData=null,this.demux(e,0)),{audioTrack:this._audioTrack,videoTrack:f(),id3Track:this._id3Track,textTrack:f()}},t.destroy=function(){};var U=function(t,e,i){return(0,d.isFiniteNumber)(t)?90*t:9e4*e+(i||0)};function i(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}var t=i,w=e(93);function n(t,e){return 255===t[e]&&240==(246&t[e+1])}function l(t,e){return 1&t[e+1]?7:9}function h(t,e){return(3&t[e+3])<<11|t[e+4]<<3|(224&t[e+5])>>>5}function g(t,e){return e+1<t.length&&n(t,e)}function v(t,e,i,r,n){var s,a,o,l,h,u;!t.samplerate&&(e=e,i=i,r=r,n=n,a=navigator.userAgent.toLowerCase(),o=n,l=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],h=1+((192&i[r+2])>>>6),u=(60&i[r+2])>>>2,r=l.length-1<u?void e.trigger(_.Events.ERROR,{type:I.ErrorTypes.MEDIA_ERROR,details:I.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+u}):(e=(1&i[r+2])<<2,e|=(192&i[r+3])>>>6,w.logger.log("manifest codec:"+n+", ADTS type:"+h+", samplingIndex:"+u),i=/firefox/i.test(a)?6<=u?(h=5,s=new Array(4),u-3):(h=2,s=new Array(2),u):-1!==a.indexOf("android")?(h=2,s=new Array(2),u):(h=5,s=new Array(4),n&&(-1!==n.indexOf("mp4a.40.29")||-1!==n.indexOf("mp4a.40.5"))||!n&&6<=u?u-3:((n&&-1!==n.indexOf("mp4a.40.2")&&(6<=u&&1==e||/vivaldi/i.test(a))||!n&&1==e)&&(h=2,s=new Array(2)),u)),s[0]=h<<3,s[0]|=(14&u)>>1,s[1]|=(1&u)<<7,s[1]|=e<<3,5===h&&(s[1]|=(14&i)>>1,s[2]=(1&i)<<7,s[2]|=8,s[3]=0),{config:s,samplerate:l[u],channelCount:e,codec:"mp4a.40."+h,manifestCodec:o}))&&(t.config=r.config,t.samplerate=r.samplerate,t.channelCount=r.channelCount,t.codec=r.codec,t.manifestCodec=r.manifestCodec,w.logger.log("parsed codec:"+t.codec+", rate:"+r.samplerate+", channels:"+r.channelCount))}function B(t){return 9216e4/t}function G(t,i,r,e,n){var s,a,o,e=e+n*B(t.samplerate),n=function(){var t=l(i,r);if(r+t<=i.length){var e=h(i,r)-t;if(0<e)return{headerLength:t,frameLength:e}}}();return n?(a=n.frameLength,a=(n=n.headerLength)+a,(o=Math.max(0,r+a-i.length))?(s=new Uint8Array(a-n)).set(i.subarray(r+n,i.length),0):s=i.subarray(r+n,r+a),n={unit:s,pts:e},o||t.samples.push(n),{sample:n,length:a,missing:o}):(t=i.length-r,(s=new Uint8Array(t)).set(i.subarray(r,i.length),0),{sample:{unit:s,pts:e},length:t,missing:-1})}function j(t,e){return(j=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}a=s=t,(S=o).prototype=Object.create(a.prototype),j(S.prototype.constructor=S,a),(S=o.prototype).resetInitSegment=function(t,e,i,r){s.prototype.resetInitSegment.call(this,t,e,i,r),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:e,duration:r,inputTimeScale:9e4,dropped:0}},o.probe=function(t){if(t)for(var e,i,r,n,s=(u.getID3Data(t,0)||[]).length,a=t.length;s<a;s++)if(n=r=void 0,!g(e=t,i=s)||i+(n=l(e,i))>=e.length?void 0:!((r=h(e,i))<=n)&&((n=i+r)===e.length||g(e,n)))return w.logger.log("ADTS sync word found !"),!0;return!1},S.canParse=function(t,e){return(e=e)+5<(t=t).length&&n(t,e)&&h(t,e)<=t.length-e},S.appendFrame=function(t,e,i){v(t,this.observer,e,i,t.manifestCodec);t=G(t,e,i,this.basePTS,this.frameIndex);if(t&&0===t.missing)return t};var s,a=o;function o(t,e){var i;return(i=s.call(this)||this).observer=void 0,i.config=void 0,i.observer=t,i.config=e,i}var H=/\/emsg[-/]ID3/i;(S=p.prototype).resetTimeStamp=function(){},S.resetInitSegment=function(t,e,i,r){var n,s,a,t=(0,C.parseInitSegment)(t),o=this.videoTrack=f("video",1),l=this.audioTrack=f("audio",1),h=this.txtTrack=f("text",1);this.id3Track=f("id3",1),this.timeOffset=0,t.video&&(n=(a=t.video).id,s=a.timescale,a=a.codec,o.id=n,o.timescale=h.timescale=s,o.codec=a),t.audio&&(s=(n=t.audio).id,a=n.timescale,t=n.codec,l.id=s,l.timescale=a,l.codec=t),h.id=C.RemuxerTrackIdConfig.text,o.sampleDuration=0,o.duration=l.duration=r},S.resetContiguity=function(){},p.probe=function(t){return t=16384<t.length?t.subarray(0,16384):t,0<(0,C.findBox)(t,["moof"]).length},S.demux=function(t,e){this.timeOffset=e;var i=t,r=this.videoTrack,n=this.txtTrack,t=(this.config.progressive?(this.remainderData&&(i=(0,C.appendUint8Array)(this.remainderData,t)),t=(0,C.segmentValidRange)(i),this.remainderData=t.remainder,r.samples=t.valid||new Uint8Array):r.samples=i,this.extractID3Track(r,e));return n.samples=(0,C.parseSamples)(e,r),{videoTrack:r,audioTrack:this.audioTrack,id3Track:t,textTrack:this.txtTrack}},S.flush=function(){var t=this.timeOffset,e=this.videoTrack,i=this.txtTrack,r=(e.samples=this.remainderData||new Uint8Array,this.remainderData=null,this.extractID3Track(e,this.timeOffset));return i.samples=(0,C.parseSamples)(t,e),{videoTrack:e,audioTrack:f(),id3Track:r,textTrack:f()}},S.extractID3Track=function(t,r){var n=this.id3Track;return t.samples.length&&(t=(0,C.findBox)(t.samples,["emsg"]))&&t.forEach(function(t){var e,i,t=(0,C.parseEmsg)(t);H.test(t.schemeIdUri)&&(e=(0,d.isFiniteNumber)(t.presentationTime)?t.presentationTime/t.timeScale:r+t.presentationTimeDelta/t.timeScale,(i=4294967295===t.eventDuration?Number.POSITIVE_INFINITY:t.eventDuration/t.timeScale)<=.001&&(i=Number.POSITIVE_INFINITY),t=t.payload,n.samples.push({data:t,len:t.byteLength,dts:e,pts:e,type:c.MetadataSchema.emsg,duration:i}))}),n},S.demuxSampleAes=function(t,e,i){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},S.destroy=function(){};const K=p;function p(t,e){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=e}var m=null,V=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],W=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],Y=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],q=[0,1,1,4];function X(t,e,i,r,n){if(!(i+24>e.length)){var s=z(e,i);if(s&&i+s.frameLength<=e.length)return r=r+n*(9e4*s.samplesPerFrame/s.sampleRate),n={unit:e.subarray(i,i+s.frameLength),pts:r,dts:r},t.config=[],t.channelCount=s.channelCount,t.samplerate=s.sampleRate,t.samples.push(n),{sample:n,length:s.frameLength,missing:0}}}function z(t,e){var i,r,n,s,a,o=t[e+1]>>3&3,l=t[e+1]>>1&3,h=t[e+2]>>4&15,u=t[e+2]>>2&3;if(1!=o&&0!=h&&15!=h&&3!=u)return a=t[e+2]>>1&1,i=t[e+3]>>6,h=1e3*V[14*(3==o?3-l:3==l?3:4)+h-1],u=W[3*(3==o?0:2==o?1:2)+u],r=3==i?1:2,s=8*(o=Y[o][l])*(n=q[l]),o=Math.floor(o*h/u+a)*n,null===m&&(a=(navigator.userAgent||"").match(/Chrome\/(\d+)/i),m=a?parseInt(a[1]):0),m&&m<=87&&2==l&&224e3<=h&&0==i&&(t[e+3]=128|t[e+3]),{sampleRate:u,channelCount:r,frameLength:o,samplesPerFrame:s}}function T(t,e){return 255===t[e]&&224==(224&t[e+1])&&0!=(6&t[e+1])}function Z(t,e){return e+1<t.length&&T(t,e)}(S=tt.prototype).loadWord=function(){var t=this.data,e=this.bytesAvailable,i=t.byteLength-e,r=new Uint8Array(4),e=Math.min(4,e);if(0===e)throw new Error("no bytes available");r.set(t.subarray(i,i+e)),this.word=new DataView(r.buffer).getUint32(0),this.bitsAvailable=8*e,this.bytesAvailable-=e},S.skipBits=function(t){var e;this.bitsAvailable>t||(t=(t-=this.bitsAvailable)-((e=t>>3)>>3),this.bytesAvailable-=e,this.loadWord()),this.word<<=t,this.bitsAvailable-=t},S.readBits=function(t){var e=Math.min(this.bitsAvailable,t),i=this.word>>>32-e;return 32<t&&w.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=e,0<this.bitsAvailable?this.word<<=e:0<this.bytesAvailable&&this.loadWord(),0<(e=t-e)&&this.bitsAvailable?i<<e|this.readBits(e):i},S.skipLZ=function(){for(var t=0;t<this.bitsAvailable;++t)if(0!=(this.word&2147483648>>>t))return this.word<<=t,this.bitsAvailable-=t,t;return this.loadWord(),t+this.skipLZ()},S.skipUEG=function(){this.skipBits(1+this.skipLZ())},S.skipEG=function(){this.skipBits(1+this.skipLZ())},S.readUEG=function(){var t=this.skipLZ();return this.readBits(t+1)-1},S.readEG=function(){var t=this.readUEG();return 1&t?1+t>>>1:-1*(t>>>1)},S.readBoolean=function(){return 1===this.readBits(1)},S.readUByte=function(){return this.readBits(8)},S.readUShort=function(){return this.readBits(16)},S.readUInt=function(){return this.readBits(32)},S.skipScalingList=function(t){for(var e=8,i=8,r=0;r<t;r++)e=0===(i=0!==i?(e+this.readEG()+256)%256:i)?e:i},S.readSPS=function(){var t,e,i,r=0,n=0,s=0,a=0,o=this.readUByte.bind(this),l=this.readBits.bind(this),h=this.readUEG.bind(this),u=this.readBoolean.bind(this),d=this.skipBits.bind(this),c=this.skipEG.bind(this),f=this.skipUEG.bind(this),g=this.skipScalingList.bind(this),v=(o(),o());if(l(5),d(3),o(),f(),100===v||110===v||122===v||244===v||44===v||83===v||86===v||118===v||128===v){v=h();if(3===v&&d(1),f(),f(),d(1),u())for(e=3!==v?8:12,i=0;i<e;i++)u()&&g(i<6?16:64)}f();v=h();if(0===v)h();else if(1===v)for(d(1),c(),c(),t=h(),i=0;i<t;i++)c();f(),d(1);var v=h(),f=h(),l=l(1),p=(0===l&&d(1),d(1),u()&&(r=h(),n=h(),s=h(),a=h()),[1,1]);if(u()&&u())switch(o()){case 1:p=[1,1];break;case 2:p=[12,11];break;case 3:p=[10,11];break;case 4:p=[16,11];break;case 5:p=[40,33];break;case 6:p=[24,11];break;case 7:p=[20,11];break;case 8:p=[32,11];break;case 9:p=[80,33];break;case 10:p=[18,11];break;case 11:p=[15,11];break;case 12:p=[64,33];break;case 13:p=[160,99];break;case 14:p=[4,3];break;case 15:p=[3,2];break;case 16:p=[2,1];break;case 255:p=[o()<<8|o(),o()<<8|o()]}return{width:Math.ceil(16*(v+1)-2*r-2*n),height:(2-l)*(f+1)*16-(l?2:4)*(s+a),pixelRatio:p}},S.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()};const Q=tt,$=((S=J.prototype).decryptBuffer=function(t,e){this.decrypter.decrypt(t,this.keyData.key.buffer,this.keyData.iv.buffer,e)},S.decryptAacSample=function(e,i,r,n){var t,s,a=e[i].unit;a.length<=16||(t=(t=a.subarray(16,a.length-a.length%16)).buffer.slice(t.byteOffset,t.byteOffset+t.length),(s=this).decryptBuffer(t,function(t){t=new Uint8Array(t);a.set(t,16),n||s.decryptAacSamples(e,i+1,r)}))},S.decryptAacSamples=function(t,e,i){for(;;e++){if(e>=t.length)return void i();if(!(t[e].unit.length<32)){var r=this.decrypter.isSync();if(this.decryptAacSample(t,e,i,r),!r)return}}},S.getAvcEncryptedData=function(t){for(var e=16*Math.floor((t.length-48)/160)+16,i=new Int8Array(e),r=0,n=32;n<t.length-16;n+=160,r+=16)i.set(t.subarray(n,n+16),r);return i},S.getAvcDecryptedUnit=function(t,e){for(var i=new Uint8Array(e),r=0,n=32;n<t.length-16;n+=160,r+=16)t.set(i.subarray(r,r+16),n);return t},S.decryptAvcSample=function(e,i,r,n,s,a){var o=(0,C.discardEPB)(s.data),t=this.getAvcEncryptedData(o),l=this;this.decryptBuffer(t.buffer,function(t){s.data=l.getAvcDecryptedUnit(o,t),a||l.decryptAvcSamples(e,i,r+1,n)})},S.decryptAvcSamples=function(t,e,i,r){if(t instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;e++,i=0){if(e>=t.length)return void r();for(var n=t[e].units;!(i>=n.length);i++){var s=n[i];if(!(s.data.length<=48||1!==s.type&&5!==s.type)){var a=this.decrypter.isSync();if(this.decryptAvcSample(t,e,i,r,s,a),!a)return}}}},J);function J(t,e,i){this.keyData=void 0,this.decrypter=void 0,this.keyData=i,this.decrypter=new r.default(t,e,{removePKCS7Padding:!1})}function tt(t){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=t,this.bytesAvailable=t.byteLength,this.word=0,this.bitsAvailable=0}function et(){return(et=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i,r=arguments[e];for(i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t}).apply(this,arguments)}var O=188;function y(t,e,i,r){return{key:t,frame:!1,pts:e,dts:i,units:[],debug:r,length:0}}function x(t){var e,i,r,n,s=0,a=t.data;if(!t||0===t.size)return null;for(;a[0].length<19&&1<a.length;){var o=new Uint8Array(a[0].length+a[1].length);o.set(a[0]),o.set(a[1],a[0].length),a[0]=o,a.splice(1,1)}if(1!==((e=a[0])[0]<<16)+(e[1]<<8)+e[2])return null;if((i=(e[4]<<8)+e[5])&&i>t.size-6)return null;var l=e[7],h=(192&l&&(r=536870912*(14&e[9])+4194304*(255&e[10])+16384*(254&e[11])+128*(255&e[12])+(254&e[13])/2,64&l?54e5<r-(n=536870912*(14&e[14])+4194304*(255&e[15])+16384*(254&e[16])+128*(255&e[17])+(254&e[18])/2)&&(w.logger.warn(Math.round((r-n)/9e4)+"s delta between PTS and DTS, align them"),r=n):n=r),(l=e[8])+9);if(t.size<=h)return null;t.size-=h;for(var u=new Uint8Array(t.size),d=0,c=a.length;d<c;d++){var f=(e=a[d]).byteLength;if(h){if(f<h){h-=f;continue}e=e.subarray(h),f-=h,h=0}u.set(e,s),s+=f}return i&&(i-=l+3),{data:u,pts:r,dts:n,len:i}}function E(t,e){if(t.units.length&&t.frame){if(void 0===t.pts){var i=e.samples,r=i.length;if(!r)return e.dropped++;i=i[r-1];t.pts=i.pts,t.dts=i.dts}e.samples.push(t)}t.debug.length&&w.logger.log(t.pts+"/"+t.dts+":"+t.debug)}P.probe=function(t){t=P.syncOffset(t);return 0<t&&w.logger.warn("MPEG2-TS detected but first sync word found @ offset "+t),-1!==t},P.syncOffset=function(t){for(var e=Math.min(940,t.length-376)+1,i=0;i<e;){if(71===t[i]&&71===t[i+O])return i;i++}return-1},P.createTrack=function(t,e){return{container:"video"===t||"audio"===t?"video/mp2t":void 0,type:t,id:C.RemuxerTrackIdConfig[t],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===t?e:void 0}},(S=P.prototype).resetInitSegment=function(t,e,i,r){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=P.createTrack("video"),this._audioTrack=P.createTrack("audio",r),this._id3Track=P.createTrack("id3"),this._txtTrack=P.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=e,this.videoCodec=i,this._duration=r},S.resetTimeStamp=function(){},S.resetContiguity=function(){var t=this._audioTrack,e=this._avcTrack,i=this._id3Track;t&&(t.pesData=null),e&&(e.pesData=null),i&&(i.pesData=null),this.aacOverFlow=null,this.avcSample=null,this.remainderData=null},S.demux=function(t,e,i,r){void 0===r&&(r=!1),(i=void 0===i?!1:i)||(this.sampleAes=null);var n,s=this._avcTrack,a=this._audioTrack,o=this._id3Track,l=this._txtTrack,h=s.pid,u=s.pesData,d=a.pid,c=o.pid,f=a.pesData,g=o.pesData,v=null,p=this.pmtParsed,m=this._pmtId,T=t.length;if(this.remainderData&&(T=(t=(0,C.appendUint8Array)(this.remainderData,t)).length,this.remainderData=null),T<O&&!r)return this.remainderData=t,{audioTrack:a,videoTrack:s,id3Track:o,textTrack:l};var y=Math.max(0,P.syncOffset(t));(T-=(T-y)%O)<t.byteLength&&!r&&(this.remainderData=new Uint8Array(t.buffer,T,t.buffer.byteLength-T));for(var E,S=0,b=y;b<T;b+=O)if(71===t[b]){var L=!!(64&t[b+1]),k=((31&t[b+1])<<8)+t[b+2],D=void 0;if(1<(48&t[b+3])>>4){if((D=b+5+t[b+4])===b+O)continue}else D=b+4;switch(k){case h:L&&(u&&(n=x(u))&&this.parseAVCPES(s,l,n,!1),u={data:[],size:0}),u&&(u.data.push(t.subarray(D,b+O)),u.size+=b+O-D);break;case d:if(L){if(f&&(n=x(f)))switch(a.segmentCodec){case"aac":this.parseAACPES(a,n);break;case"mp3":this.parseMPEGPES(a,n)}f={data:[],size:0}}f&&(f.data.push(t.subarray(D,b+O)),f.size+=b+O-D);break;case c:L&&(g&&(n=x(g))&&this.parseID3PES(o,n),g={data:[],size:0}),g&&(g.data.push(t.subarray(D,b+O)),g.size+=b+O-D);break;case 0:L&&(D+=t[D]+1),m=this._pmtId=(31&(R=t)[(E=D)+10])<<8|R[E+11];break;case m:L&&(D+=t[D]+1);var R=function(t,e,i,r){var n={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},s=e+3+((15&t[e+1])<<8|t[e+2])-4;for(e+=12+((15&t[e+10])<<8|t[e+11]);e<s;){var a=(31&t[e+1])<<8|t[e+2];switch(t[e]){case 207:if(!r){w.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:-1===n.audio&&(n.audio=a);break;case 21:-1===n.id3&&(n.id3=a);break;case 219:if(!r){w.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:-1===n.avc&&(n.avc=a);break;case 3:case 4:!0!==i.mpeg&&!0!==i.mp3?w.logger.log("MPEG audio found, not supported in this browser"):-1===n.audio&&(n.audio=a,n.segmentCodec="mp3");break;case 36:w.logger.warn("Unsupported HEVC stream type found")}e+=5+((15&t[e+3])<<8|t[e+4])}return n}(t,D,this.typeSupported,i);0<(h=R.avc)&&(s.pid=h),0<(d=R.audio)&&(a.pid=d,a.segmentCodec=R.segmentCodec),0<(c=R.id3)&&(o.pid=c),null===v||p||(w.logger.log("unknown PID '"+v+"' in TS found"),v=null,b=y-188),p=this.pmtParsed=!0;break;case 17:case 8191:break;default:v=k}}else S++;0<S&&this.observer.emit(_.Events.ERROR,_.Events.ERROR,{type:I.ErrorTypes.MEDIA_ERROR,details:I.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"Found "+S+" TS packet/s that do not start with 0x47"}),s.pesData=u,a.pesData=f,o.pesData=g;var A={audioTrack:a,videoTrack:s,id3Track:o,textTrack:l};return r&&this.extractRemainingSamples(A),A},S.flush=function(){var t=this.remainderData;return this.remainderData=null,t=t?this.demux(t,-1,!1,!0):{videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t},S.extractRemainingSamples=function(t){var e,i=t.audioTrack,r=t.videoTrack,n=t.id3Track,t=t.textTrack,s=r.pesData,a=i.pesData,o=n.pesData;if(s&&(e=x(s))?(this.parseAVCPES(r,t,e,!0),r.pesData=null):r.pesData=s,a&&(e=x(a))){switch(i.segmentCodec){case"aac":this.parseAACPES(i,e);break;case"mp3":this.parseMPEGPES(i,e)}i.pesData=null}else null!=a&&a.size&&w.logger.log("last AAC PES packet truncated,might overlap between fragments"),i.pesData=a;o&&(e=x(o))?(this.parseID3PES(n,e),n.pesData=null):n.pesData=o},S.demuxSampleAes=function(t,e,i){t=this.demux(t,i,!0,!this.config.progressive),i=this.sampleAes=new $(this.observer,this.config,e);return this.decrypt(t,i)},S.decrypt=function(r,n){return new Promise(function(t){var e=r.audioTrack,i=r.videoTrack;e.samples&&"aac"===e.segmentCodec?n.decryptAacSamples(e.samples,0,function(){i.samples?n.decryptAvcSamples(i.samples,0,0,function(){t(r)}):t(r)}):i.samples&&n.decryptAvcSamples(i.samples,0,0,function(){t(r)})})},S.destroy=function(){this._duration=0},S.parseAVCPES=function(a,o,l,t){var h,u=this,e=this.parseAVCNALu(a,l.data),d=this.avcSample,c=!1;l.data=null,d&&e.length&&!a.audFound&&(E(d,a),d=this.avcSample=y(!1,l.pts,l.dts,"")),e.forEach(function(t){switch(t.type){case 1:h=!0,(d=d||(u.avcSample=y(!0,l.pts,l.dts,""))).frame=!0;var e=t.data;c&&4<e.length&&(2!==(e=new Q(e).readSliceType())&&4!==e&&7!==e&&9!==e||(d.key=!0));break;case 5:h=!0,(d=d||(u.avcSample=y(!0,l.pts,l.dts,""))).key=!0,d.frame=!0;break;case 6:h=!0,(0,C.parseSEIMessageFromNALu)(t.data,1,l.pts,o.samples);break;case 7:if(c=h=!0,!a.sps){e=new Q(t.data).readSPS();a.width=e.width,a.height=e.height,a.pixelRatio=e.pixelRatio,a.sps=[t.data],a.duration=u._duration;for(var i=t.data.subarray(1,4),r="avc1.",n=0;n<3;n++){var s=i[n].toString(16);r+=s=s.length<2?"0"+s:s}a.codec=r}break;case 8:h=!0,a.pps||(a.pps=[t.data]);break;case 9:h=!1,a.audFound=!0,d&&E(d,a),d=u.avcSample=y(!1,l.pts,l.dts,"");break;case 12:h=!0;break;default:h=!1,d&&(d.debug+="unknown NAL "+t.type+" ")}d&&h&&d.units.push(t)}),t&&d&&(E(d,a),this.avcSample=null)},S.getLastNalUnit=function(t){var e,i=this.avcSample;return e=null!=(t=i=i&&0!==i.units.length?i:t[t.length-1])&&t.units?(t=i.units)[t.length-1]:e},S.parseAVCNALu=function(t,e){var i,r,n,s,a,o,l=e.byteLength,h=t.naluState||0,u=h,d=[],c=0,f=-1,g=0;for(-1===h&&(g=31&e[f=0],h=0,c=1);c<l;)i=e[c++],h=h?1!==h?i?1===i?(0<=f?(n={data:e.subarray(f,c-h-1),type:g},d.push(n)):(n=this.getLastNalUnit(t.samples))&&(u&&c<=4-u&&n.state&&(n.data=n.data.subarray(0,n.data.byteLength-u)),0<(r=c-h-1))&&((s=new Uint8Array(n.data.byteLength+r)).set(n.data,0),s.set(e.subarray(0,r),n.data.byteLength),n.data=s,n.state=0),c<l?(g=31&e[f=c],0):-1):0:3:i?0:2:i?0:1;return 0<=f&&0<=h&&(a={data:e.subarray(f,l),type:g,state:h},d.push(a)),0===d.length&&(a=this.getLastNalUnit(t.samples))&&((o=new Uint8Array(a.data.byteLength+e.byteLength)).set(a.data,0),o.set(e,a.data.byteLength),a.data=o),t.naluState=h,d},S.parseAACPES=function(t,e){var i,r,n,s,a,o=0,l=this.aacOverFlow,h=e.data;for(l&&(this.aacOverFlow=null,u=l.missing,s=l.sample.unit.byteLength,-1===u?((a=new Uint8Array(s+h.byteLength)).set(l.sample.unit,0),a.set(h,s),h=a):(a=s-u,l.sample.unit.set(h.subarray(0,u),a),t.samples.push(l.sample),o=l.missing)),i=o,r=h.length;i<r-1&&!g(h,i);i++);if(i===o||(s=i<r-1?(n="AAC PES did not start with ADTS header,offset:"+i,!1):(n="no ADTS header found in AAC PES",!0),w.logger.warn("parsing error:"+n),this.observer.emit(_.Events.ERROR,_.Events.ERROR,{type:I.ErrorTypes.MEDIA_ERROR,details:I.ErrorDetails.FRAG_PARSING_ERROR,fatal:s,reason:n}),!s)){if(v(t,this.observer,h,i,this.audioCodec),void 0!==e.pts)d=e.pts;else{if(!l)return void w.logger.warn("[tsdemuxer]: AAC PES unknown PTS");var u=B(t.samplerate),d=l.sample.pts+u}for(var c,f=0;i<r;){if(i+=(c=G(t,h,i,d,f)).length,c.missing){this.aacOverFlow=c;break}for(f++;i<r-1&&!g(h,i);i++);}}},S.parseMPEGPES=function(t,e){var i=e.data,r=i.length,n=0,s=0,a=e.pts;if(void 0!==a)for(;s<r;)if(Z(i,s)){var o=X(t,i,s,a,n);if(!o)break;s+=o.length,n++}else s++;else w.logger.warn("[tsdemuxer]: MPEG PES unknown PTS")},S.parseID3PES=function(t,e){void 0!==e.pts?(e=et({},e,{type:this._avcTrack?c.MetadataSchema.emsg:c.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY}),t.samples.push(e)):w.logger.warn("[tsdemuxer]: ID3 PES unknown PTS")};var S=P;function P(t,e,i){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=t,this.config=e,this.typeSupported=i}function it(t,e){return(it=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}t=b=t,(k=L).prototype=Object.create(t.prototype),it(k.prototype.constructor=k,t),(k=L.prototype).resetInitSegment=function(t,e,i,r){b.prototype.resetInitSegment.call(this,t,e,i,r),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:e,duration:r,inputTimeScale:9e4,dropped:0}},L.probe=function(t){if(t)for(var e=(u.getID3Data(t,0)||[]).length,i=t.length;e<i;e++)if(function(t,e){var i;if(e+1<t.length&&T(t,e))return i=4,(e=e+(i=null!=(e=z(t,e))&&e.frameLength?e.frameLength:i))===t.length||Z(t,e)}(t,e))return w.logger.log("MPEG Audio sync word found !"),!0;return!1},k.canParse=function(t,e){return T(t,e)&&4<=t.length-e},k.appendFrame=function(t,e,i){if(null!==this.basePTS)return X(t,e,i,this.basePTS,this.frameIndex)};var b,t=L;function L(){return b.apply(this,arguments)||this}var k,D,R=e(524),A=e(923);function rt(t,e){t=null==t?void 0:t.codec;return t&&4<t.length?t:"hvc1"===t||"hev1"===t?"hvc1.1.c.L120.90":"av01"===t?"av01.0.04M.08":"avc1"===t||e===A.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}(k=st.prototype).destroy=function(){},k.resetTimeStamp=function(t){this.initPTS=t,this.lastEndTime=null},k.resetNextTimestamp=function(){this.lastEndTime=null},k.resetInitSegment=function(t,e,i){this.audioCodec=e,this.videoCodec=i,this.generateInitSegment(t),this.emitInitSegment=!0},k.generateInitSegment=function(t){var e,i,r=this.audioCodec,n=this.videoCodec;t&&t.byteLength?(e=this.initData=(0,C.parseInitSegment)(t),r=r||rt(e.audio,A.ElementaryStreamTypes.AUDIO),n=n||rt(e.video,A.ElementaryStreamTypes.VIDEO),i={},e.audio&&e.video?i.audiovideo={container:"video/mp4",codec:r+","+n,initSegment:t,id:"main"}:e.audio?i.audio={container:"audio/mp4",codec:r,initSegment:t,id:"audio"}:e.video?i.video={container:"video/mp4",codec:n,initSegment:t,id:"main"}:w.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=i):(this.initTracks=void 0,this.initData=void 0)},k.remux=function(t,e,i,r,n){var s,a,o,l=this.initPTS,h=this.lastEndTime,u={audio:void 0,video:void 0,text:r,id3:i,initSegment:void 0},e=((0,d.isFiniteNumber)(h)||(h=this.lastEndTime=n||0),e.samples);return e&&e.length&&(s={initPTS:void 0,timescale:1},(o=this.initData)&&o.length||(this.generateInitSegment(e),o=this.initData),o&&o.length?(this.emitInitSegment&&(s.tracks=this.initTracks,this.emitInitSegment=!1),a=(0,C.getStartDTS)(o,e),(0,d.isFiniteNumber)(l)||(this.initPTS=s.initPTS=l=a-n),h=(t=t?a-l:h)+(a=(0,C.getDuration)(e,o)),(0,C.offsetStartDTS)(o,e,l),0<a?this.lastEndTime=h:(w.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp()),l="",(a=!!o.audio)&&(l+="audio"),(o=!!o.video)&&(l+="video"),u.audio="audio"===(e={data1:e,startPTS:t,startDTS:t,endPTS:h,endDTS:h,type:l,hasAudio:a,hasVideo:o,nb:1,dropped:0}).type?e:void 0,u.video="audio"!==e.type?e:void 0,u.initSegment=s,h=null!=(t=this.initPTS)?t:0,u.id3=(0,R.flushTextTrackMetadataCueSamples)(i,n,h,h),r.samples.length&&(u.text=(0,R.flushTextTrackUserdataCueSamples)(r,n,h))):w.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment.")),u};const nt=st;function st(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndTime=null}try{D=self.performance.now.bind(self.performance)}catch(M){w.logger.debug("Unable to use Performance API on this environment"),D=self.Date.now}var F=[{demux:S,remux:R.default},{demux:K,remux:nt},{demux:a,remux:R.default},{demux:t,remux:R.default}],at=((e=lt.prototype).configure=function(t){this.transmuxConfig=t,this.decrypter&&this.decrypter.reset()},e.push=function(t,e,i,r){var n=this,s=i.transmuxing,t=(s.executeStart=D(),new Uint8Array(t)),a=this.config,o=this.currentTransmuxState,l=this.transmuxConfig,r=(r&&(this.currentTransmuxState=r),r||o),o=r.contiguous,h=r.discontinuity,u=r.trackSwitch,d=r.accurateTimeOffset,c=r.timeOffset,r=r.initSegmentChange,f=l.audioCodec,g=l.videoCodec,v=l.defaultInitPts,p=l.duration,m=l.initSegmentData,f=((h||u||r)&&this.resetInitSegment(m,f,g,p),(h||r)&&this.resetInitialTimestamp(v),o||this.resetContiguity(),m=null,m=0<t.byteLength&&null!=e&&null!=e.key&&null!==e.iv&&null!=e.method?e:m);if(f&&"AES-128"===f.method){g=this.getDecrypter();if(!a.enableSoftwareAES)return this.decryptionPromise=g.webCryptoDecrypt(t,f.key.buffer,f.iv.buffer).then(function(t){t=n.push(t,null,i);return n.decryptionPromise=null,t}),this.decryptionPromise;p=g.softwareDecrypt(t,f.key.buffer,f.iv.buffer);if(!p)return s.executeEnd=D(),ot(i);t=new Uint8Array(p)}this.needsProbing(t,h,u)&&this.configureTransmuxer(t,l);r=this.transmux(t,f,c,d,i),v=this.currentTransmuxState;return v.contiguous=!0,v.discontinuity=!1,v.trackSwitch=!1,s.executeEnd=D(),r},e.flush=function(e){var i,r=this,t=e.transmuxing,n=(t.executeStart=D(),this.decrypter),s=this.currentTransmuxState,a=this.decryptionPromise;return a?a.then(function(){return r.flush(e)}):(i=[],a=s.timeOffset,n&&(s=n.flush())&&i.push(this.push(s,null,e)),n=this.demuxer,s=this.remuxer,n&&s?ht(s=n.flush(a))?s.then(function(t){return r.flushRemux(i,t,e),i}):(this.flushRemux(i,s,e),i):(this.observer.emit(_.Events.ERROR,_.Events.ERROR,{type:I.ErrorTypes.MEDIA_ERROR,details:I.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),t.executeEnd=D(),[ot(e)]))},e.flushRemux=function(t,e,i){var r=e.audioTrack,n=e.videoTrack,s=e.id3Track,e=e.textTrack,a=this.currentTransmuxState,o=a.accurateTimeOffset,a=a.timeOffset,r=(w.logger.log("[transmuxer.ts]: Flushed fragment "+i.sn+(-1<i.part?" p: "+i.part:"")+" of level "+i.level),this.remuxer.remux(r,n,s,e,a,o,!0,this.id));t.push({remuxResult:r,chunkMeta:i}),i.transmuxing.executeEnd=D()},e.resetInitialTimestamp=function(t){var e=this.demuxer,i=this.remuxer;e&&i&&(e.resetTimeStamp(t),i.resetTimeStamp(t))},e.resetContiguity=function(){var t=this.demuxer,e=this.remuxer;t&&e&&(t.resetContiguity(),e.resetNextTimestamp())},e.resetInitSegment=function(t,e,i,r){var n=this.demuxer,s=this.remuxer;n&&s&&(n.resetInitSegment(t,e,i,r),s.resetInitSegment(t,e,i))},e.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},e.transmux=function(t,e,i,r,n){return e&&"SAMPLE-AES"===e.method?this.transmuxSampleAes(t,e,i,r,n):this.transmuxUnencrypted(t,i,r,n)},e.transmuxUnencrypted=function(t,e,i,r){var t=this.demuxer.demux(t,e,!1,!this.config.progressive),n=t.audioTrack,s=t.videoTrack,a=t.id3Track,t=t.textTrack;return{remuxResult:this.remuxer.remux(n,s,a,t,e,i,!1,this.id),chunkMeta:r}},e.transmuxSampleAes=function(t,e,i,r,n){var s=this;return this.demuxer.demuxSampleAes(t,e,i).then(function(t){return{remuxResult:s.remuxer.remux(t.audioTrack,t.videoTrack,t.id3Track,t.textTrack,i,r,!1,s.id),chunkMeta:n}})},e.configureTransmuxer=function(t,e){for(var i,r=this.config,n=this.observer,s=this.typeSupported,a=this.vendor,o=e.audioCodec,l=e.defaultInitPts,h=e.duration,u=e.initSegmentData,e=e.videoCodec,d=0,c=F.length;d<c;d++)if(F[d].demux.probe(t)){i=F[d];break}i||(w.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),i={demux:K,remux:nt});var f=this.demuxer,g=this.remuxer,v=i.remux,p=i.demux;g&&g instanceof v||(this.remuxer=new v(n,r,s,a)),f&&f instanceof p||(this.demuxer=new p(n,r,s),this.probe=p.probe),this.resetInitSegment(u,o,e,h),this.resetInitialTimestamp(l)},e.needsProbing=function(t,e,i){return!this.demuxer||!this.remuxer||e||i},e.getDecrypter=function(){return this.decrypter||(this.decrypter=new r.default(this.observer,this.config))},lt),ot=function(t){return{remuxResult:{},chunkMeta:t}};function lt(t,e,i,r,n){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=t,this.typeSupported=e,this.config=i,this.vendor=r,this.id=n}function ht(t){return"then"in t&&t.then instanceof Function}var ut=function(t,e,i,r,n){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=t,this.videoCodec=e,this.initSegmentData=i,this.duration=r,this.defaultInitPts=n},dt=function(t,e,i,r,n,s){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=t,this.contiguous=e,this.accurateTimeOffset=i,this.trackSwitch=r,this.timeOffset=n,this.initSegmentChange=s}},973:(t,e,i)=>{"use strict";var r,n;i.r(e),i.d(e,{ErrorDetails:()=>n,ErrorTypes:()=>r}),(i=r=r||{}).NETWORK_ERROR="networkError",i.MEDIA_ERROR="mediaError",i.KEY_SYSTEM_ERROR="keySystemError",i.MUX_ERROR="muxError",i.OTHER_ERROR="otherError",(e=n=n||{}).KEY_SYSTEM_NO_KEYS="keySystemNoKeys",e.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",e.KEY_SYSTEM_NO_SESSION="keySystemNoSession",e.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",e.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",e.MANIFEST_LOAD_ERROR="manifestLoadError",e.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",e.MANIFEST_PARSING_ERROR="manifestParsingError",e.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",e.LEVEL_EMPTY_ERROR="levelEmptyError",e.LEVEL_LOAD_ERROR="levelLoadError",e.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",e.LEVEL_SWITCH_ERROR="levelSwitchError",e.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",e.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",e.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",e.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",e.FRAG_LOAD_ERROR="fragLoadError",e.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",e.FRAG_DECRYPT_ERROR="fragDecryptError",e.FRAG_PARSING_ERROR="fragParsingError",e.REMUX_ALLOC_ERROR="remuxAllocError",e.KEY_LOAD_ERROR="keyLoadError",e.KEY_LOAD_TIMEOUT="keyLoadTimeOut",e.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",e.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",e.BUFFER_APPEND_ERROR="bufferAppendError",e.BUFFER_APPENDING_ERROR="bufferAppendingError",e.BUFFER_STALLED_ERROR="bufferStalledError",e.BUFFER_FULL_ERROR="bufferFullError",e.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",e.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",e.INTERNAL_EXCEPTION="internalException",e.INTERNAL_ABORTED="aborted",e.UNKNOWN="unknown"},851:(t,e,i)=>{"use strict";var r;i.r(e),i.d(e,{Events:()=>r}),(i=r=r||{}).MEDIA_ATTACHING="hlsMediaAttaching",i.MEDIA_ATTACHED="hlsMediaAttached",i.MEDIA_DETACHING="hlsMediaDetaching",i.MEDIA_DETACHED="hlsMediaDetached",i.BUFFER_RESET="hlsBufferReset",i.BUFFER_CODECS="hlsBufferCodecs",i.BUFFER_CREATED="hlsBufferCreated",i.BUFFER_APPENDING="hlsBufferAppending",i.BUFFER_APPENDED="hlsBufferAppended",i.BUFFER_EOS="hlsBufferEos",i.BUFFER_FLUSHING="hlsBufferFlushing",i.BUFFER_FLUSHED="hlsBufferFlushed",i.MANIFEST_LOADING="hlsManifestLoading",i.MANIFEST_LOADED="hlsManifestLoaded",i.MANIFEST_PARSED="hlsManifestParsed",i.LEVEL_SWITCHING="hlsLevelSwitching",i.LEVEL_SWITCHED="hlsLevelSwitched",i.LEVEL_LOADING="hlsLevelLoading",i.LEVEL_LOADED="hlsLevelLoaded",i.LEVEL_UPDATED="hlsLevelUpdated",i.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",i.LEVELS_UPDATED="hlsLevelsUpdated",i.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",i.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",i.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",i.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",i.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",i.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",i.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",i.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",i.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",i.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",i.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",i.CUES_PARSED="hlsCuesParsed",i.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",i.INIT_PTS_FOUND="hlsInitPtsFound",i.FRAG_LOADING="hlsFragLoading",i.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",i.FRAG_LOADED="hlsFragLoaded",i.FRAG_DECRYPTED="hlsFragDecrypted",i.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",i.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",i.FRAG_PARSING_METADATA="hlsFragParsingMetadata",i.FRAG_PARSED="hlsFragParsed",i.FRAG_BUFFERED="hlsFragBuffered",i.FRAG_CHANGED="hlsFragChanged",i.FPS_DROP="hlsFpsDrop",i.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",i.ERROR="hlsError",i.DESTROYING="hlsDestroying",i.KEY_LOADING="hlsKeyLoading",i.KEY_LOADED="hlsKeyLoaded",i.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",i.BACK_BUFFER_REACHED="hlsBackBufferReached"},817:(O,t,f)=>{"use strict";f.r(t),f.d(t,{default:()=>Nr});var E,G=f(945),K=f(965),y=f(851),v=f(973),V=f(93),x=f(63),P=/^(\d+)x(\d+)$/,F=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,U=((t=M.prototype).decimalInteger=function(t){t=parseInt(this[t],10);return t>Number.MAX_SAFE_INTEGER?1/0:t},t.hexadecimalInteger=function(t){if(this[t]){for(var e=(1&(e=(this[t]||"0x").slice(2)).length?"0":"")+e,i=new Uint8Array(e.length/2),r=0;r<e.length/2;r++)i[r]=parseInt(e.slice(2*r,2*r+2),16);return i}return null},t.hexadecimalIntegerAsNumber=function(t){t=parseInt(this[t],16);return t>Number.MAX_SAFE_INTEGER?1/0:t},t.decimalFloatingPoint=function(t){return parseFloat(this[t])},t.optionalFloat=function(t,e){t=this[t];return t?parseFloat(t):e},t.enumeratedString=function(t){return this[t]},t.bool=function(t){return"YES"===this[t]},t.decimalResolution=function(t){t=P.exec(this[t]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}},M.parseAttrList=function(t){var e,i={};for(F.lastIndex=0;null!==(e=F.exec(t));){var r=e[2];0===r.indexOf('"')&&r.lastIndexOf('"')===r.length-1&&(r=r.slice(1,-1)),i[e[1]]=r}return i},M);function M(t){for(var e in t="string"==typeof t?M.parseAttrList(t):t)t.hasOwnProperty(e)&&(this[e]=t[e])}function N(){return(N=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i,r=arguments[e];for(i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t}).apply(this,arguments)}(t=E=E||{}).ID="ID",t.CLASS="CLASS",t.START_DATE="START-DATE",t.DURATION="DURATION",t.END_DATE="END-DATE",t.END_ON_NEXT="END-ON-NEXT",t.PLANNED_DURATION="PLANNED-DURATION",t.SCTE35_OUT="SCTE35-OUT",t.SCTE35_IN="SCTE35-IN";var W=function(){function t(t,e){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,e){var i,r=e.attr;for(i in r)if(Object.prototype.hasOwnProperty.call(t,i)&&t[i]!==r[i]){V.logger.warn('DATERANGE tag attribute: "'+i+'" does not match for tags with ID: "'+t.ID+'"'),this._badValueForSameId=i;break}t=N(new U({}),r,t)}this.attr=t,this._startDate=new Date(t[E.START_DATE]),E.END_DATE in this.attr&&(e=new Date(this.attr[E.END_DATE]),(0,K.isFiniteNumber)(e.getTime()))&&(this._endDate=e)}for(var e=t,i=e.prototype,r=[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){var t;return this._endDate||(null!==(t=this.duration)?new Date(this._startDate.getTime()+1e3*t):null)}},{key:"duration",get:function(){if(E.DURATION in this.attr){var t=this.attr.decimalFloatingPoint(E.DURATION);if((0,K.isFiniteNumber)(t))return t}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return E.PLANNED_DURATION in this.attr?this.attr.decimalFloatingPoint(E.PLANNED_DURATION):null}},{key:"endOnNext",get:function(){return this.attr.bool(E.END_ON_NEXT)}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&(0,K.isFiniteNumber)(this.startDate.getTime())&&(null===this.duration||0<=this.duration)&&(!this.endOnNext||!!this.class)}}],n=0;n<r.length;n++){var s=r[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(i,s.key,s)}return Object.defineProperty(e,"prototype",{writable:!1}),t}(),B=f(923),j=function(){function t(t){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.dateRanges={},this.url=t}t.prototype.reloaded=function(t){var e,i;t?(e=this.lastPartSn-t.lastPartSn,i=this.lastPartIndex-t.lastPartIndex,this.updated=this.endSN!==t.endSN||!!i||!!e,this.advanced=this.endSN>t.endSN||0<e||0==e&&0<i,this.updated||this.advanced?this.misses=Math.floor(.6*t.misses):this.misses=t.misses+1,this.availabilityDelay=t.availabilityDelay):(this.advanced=!0,this.updated=!0)};for(var e,i=(e=t).prototype,r=[{key:"hasProgramDateTime",get:function(){return!!this.fragments.length&&(0,K.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime)}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||10}},{key:"drift",get:function(){var t=this.driftEndTime-this.driftStartTime;return 0<t?1e3*(this.driftEnd-this.driftStart)/t:1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var t;return null!=(t=this.partList)&&t.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var t;return null!=(t=this.fragments)&&t.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var t;return null!=(t=this.partList)&&t.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var t;return null!=(t=this.partList)&&t.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}],n=0;n<r.length;n++){var s=r[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(i,s.key,s)}return Object.defineProperty(e,"prototype",{writable:!1}),t}(),H=f(960),Y={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dva1:!0,dvav:!0,dvh1:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function q(t,e){return MediaSource.isTypeSupported((e||"video")+'/mp4;codecs="'+t+'"')}var X=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,z=/#EXT-X-MEDIA:(.*)/g,Z=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),Q=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),$=/\.(mp4|m4s|m4v|m4a)$/i,J=(u.findGroup=function(t,e){for(var i=0;i<t.length;i++){var r=t[i];if(r.id===e)return r}},u.convertAVC1ToAVCOTI=function(t){var e,i=t.split(".");return 2<i.length?(e=i.shift()+".",(e+=parseInt(i.shift()).toString(16))+("000"+parseInt(i.shift()).toString(16)).slice(-4)):t},u.resolve=function(t,e){return G.buildAbsoluteURL(e,t,{alwaysNormalize:!0})},u.parseMasterPlaylist=function(t,e){var i,r,n,s,a=[],o=[],l={},h=!1;for(X.lastIndex=0;null!=(i=X.exec(t));)i[1]?(r={attrs:s=new U(i[1]),bitrate:s.decimalInteger("AVERAGE-BANDWIDTH")||s.decimalInteger("BANDWIDTH"),name:s.NAME,url:u.resolve(i[2],e)},(n=s.decimalResolution("RESOLUTION"))&&(r.width=n.width,r.height=n.height),function(r,n){["video","audio","text"].forEach(function(i){var t,e=r.filter(function(t){return t=t,!!(e=Y[i])&&!0===e[t.slice(0,4)];var e});e.length&&(t=e.filter(function(t){return 0===t.lastIndexOf("avc1",0)||0===t.lastIndexOf("mp4a",0)}),n[i+"Codec"]=(0<t.length?t:e)[0],r=r.filter(function(t){return-1===e.indexOf(t)}))}),n.unknownCodecs=r}((s.CODECS||"").split(/[ ,]+/).filter(function(t){return t}),r),r.videoCodec&&-1!==r.videoCodec.indexOf("avc1")&&(r.videoCodec=u.convertAVC1ToAVCOTI(r.videoCodec)),null!=(n=r.unknownCodecs)&&n.length||o.push(r),a.push(r)):i[3]&&(s=new U(i[3]))["DATA-ID"]&&(h=!0,l[s["DATA-ID"]]=s);return{levels:0<o.length&&o.length<a.length?o:a,sessionData:h?l:null}},u.parseMasterPlaylistMedia=function(t,e,i,r){void 0===r&&(r=[]);var n=[],s=0;for(z.lastIndex=0;null!==(o=z.exec(t));){var a,o=new U(o[1]);o.TYPE===i&&(o={attrs:o,bitrate:0,id:s++,groupId:o["GROUP-ID"],instreamId:o["INSTREAM-ID"],name:o.NAME||o.LANGUAGE||"",type:i,default:o.bool("DEFAULT"),autoselect:o.bool("AUTOSELECT"),forced:o.bool("FORCED"),lang:o.LANGUAGE,url:o.URI?u.resolve(o.URI,e):""},r.length&&(tt(o,a=u.findGroup(r,o.groupId)||r[0],"audioCodec"),tt(o,a,"textCodec")),n.push(o))}return n},u.parseLevelPlaylist=function(t,e,i,r,M){var n,s,a,o=new j(e),l=o.fragments,h=null,u=0,d=0,c=0,f=0,g=null,v=new B.Fragment(r,e),p=-1,m=!1;for(Z.lastIndex=0,o.m3u8=t;null!==(n=Z.exec(t));){m&&(m=!1,(v=new B.Fragment(r,e)).start=c,v.sn=u,v.cc=f,v.level=i,h)&&(v.initSegment=h,v.rawProgramDateTime=h.rawProgramDateTime,h.rawProgramDateTime=null);var T=n[1];if(T){v.duration=parseFloat(T);var y=(" "+n[2]).slice(1);v.title=y||null,v.tagList.push(y?["INF",T,y]:["INF",T])}else if(n[3])(0,K.isFiniteNumber)(v.duration)&&(v.start=c,a&&(v.levelkey=a),v.sn=u,v.level=i,v.cc=f,v.urlId=M,l.push(v),v.relurl=(" "+n[3]).slice(1),et(v,g),c+=(g=v).duration,u++,m=!(d=0));else if(n[4]){y=(" "+n[4]).slice(1);g?v.setByteRange(y,g):v.setByteRange(y)}else if(n[5])v.rawProgramDateTime=(" "+n[5]).slice(1),v.tagList.push(["PROGRAM-DATE-TIME",v.rawProgramDateTime]),-1===p&&(p=l.length);else if(n=n[0].match(Q)){for(s=1;s<n.length&&void 0===n[s];s++);var E=(" "+n[s]).slice(1),S=(" "+n[s+1]).slice(1),b=n[s+2]?(" "+n[s+2]).slice(1):"";switch(E){case"PLAYLIST-TYPE":o.type=S.toUpperCase();break;case"MEDIA-SEQUENCE":u=o.startSN=parseInt(S);break;case"SKIP":var L=new U(S),k=L.decimalInteger("SKIPPED-SEGMENTS");if((0,K.isFiniteNumber)(k)){for(var N=o.skippedSegments=k;N--;)l.unshift(null);u+=k}k=L.enumeratedString("RECENTLY-REMOVED-DATERANGES");k&&(o.recentlyRemovedDateranges=k.split("\t"));break;case"TARGETDURATION":o.targetduration=parseFloat(S);break;case"VERSION":o.version=parseInt(S);break;case"EXTM3U":break;case"ENDLIST":o.live=!1;break;case"#":(S||b)&&v.tagList.push(b?[S,b]:[S]);break;case"DISCONTINUITY":f++,v.tagList.push(["DIS"]);break;case"GAP":v.tagList.push([E]);break;case"BITRATE":v.tagList.push([E,S]);break;case"DATERANGE":L=new U(S),k=new W(L,o.dateRanges[L.ID]);k.isValid||o.skippedSegments?o.dateRanges[k.id]=k:V.logger.warn('Ignoring invalid DATERANGE tag: "'+S+'"'),v.tagList.push(["EXT-X-DATERANGE",S]);break;case"DISCONTINUITY-SEQUENCE":f=parseInt(S);break;case"KEY":var D=new U(S),R=D.enumeratedString("METHOD"),A=D.URI,_=D.hexadecimalInteger("IV"),I=D.enumeratedString("KEYFORMATVERSIONS"),C=D.enumeratedString("KEYID"),D=null!=(D=D.enumeratedString("KEYFORMAT"))?D:"identity";-1<["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"].indexOf(D)?V.logger.warn("Keyformat "+D+" is not supported from the manifest"):"identity"===D&&R&&(a=H.LevelKey.fromURL(e,A),A)&&0<=["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(R)&&(a.method=R,a.keyFormat=D,C&&(a.keyID=C),I&&(a.keyFormatVersions=I),a.iv=_);break;case"START":A=new U(S).decimalFloatingPoint("TIME-OFFSET");(0,K.isFiniteNumber)(A)&&(o.startTimeOffset=A);break;case"MAP":R=new U(S);v.duration?(it(D=new B.Fragment(r,e),R,i,a),(v.initSegment=h=D).rawProgramDateTime&&!v.rawProgramDateTime&&(v.rawProgramDateTime=h.rawProgramDateTime)):(it(v,R,i,a),h=v,m=!0);break;case"SERVER-CONTROL":C=new U(S);o.canBlockReload=C.bool("CAN-BLOCK-RELOAD"),o.canSkipUntil=C.optionalFloat("CAN-SKIP-UNTIL",0),o.canSkipDateRanges=0<o.canSkipUntil&&C.bool("CAN-SKIP-DATERANGES"),o.partHoldBack=C.optionalFloat("PART-HOLD-BACK",0),o.holdBack=C.optionalFloat("HOLD-BACK",0);break;case"PART-INF":I=new U(S);o.partTarget=I.decimalFloatingPoint("PART-TARGET");break;case"PART":var _=(_=o.partList)||(o.partList=[]),w=0<d?_[_.length-1]:void 0,O=d++,O=new B.Part(new U(S),v,e,O,w);_.push(O),v.duration+=O.duration;break;case"PRELOAD-HINT":w=new U(S);o.preloadHint=w;break;case"RENDITION-REPORT":O=new U(S);o.renditionReports=o.renditionReports||[],o.renditionReports.push(O);break;default:V.logger.warn("line parsed but not handled: "+n)}}else V.logger.warn("No matches on slow regex match for level playlist!")}g&&!g.relurl?(l.pop(),c-=g.duration,o.partList&&(o.fragmentHint=g)):o.partList&&(et(v,g),v.cc=f,o.fragmentHint=v);var x=l.length,P=l[0],F=l[x-1];return 0<(c+=o.skippedSegments*o.targetduration)&&x&&F?(o.averagetargetduration=c/x,x=F.sn,o.endSN="initSegment"!==x?x:0,P&&(o.startCC=P.cc,P.initSegment||o.fragments.every(function(t){return t.relurl&&(t=t.relurl,$.test(null!=(t=null==(t=G.parseURL(t))?void 0:t.path)?t:""))})&&(V.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(v=new B.Fragment(r,e)).relurl=F.relurl,v.level=i,v.sn="initSegment",P.initSegment=v,o.needSidxRanges=!0))):(o.endSN=0,o.startCC=0),o.fragmentHint&&(c+=o.fragmentHint.duration),o.totalduration=c,o.endCC=f,0<p&&function(t,e){for(var i=t[e],r=e;r--;){var n=t[r];if(!n)return;n.programDateTime=i.programDateTime-1e3*n.duration,i=n}}(l,p),o},u);function u(){}function tt(t,e,i){e=e[i];e&&(t[i]=e)}function et(t,e){t.rawProgramDateTime?t.programDateTime=Date.parse(t.rawProgramDateTime):null!=e&&e.programDateTime&&(t.programDateTime=e.endProgramDateTime),(0,K.isFiniteNumber)(t.programDateTime)||(t.programDateTime=null,t.rawProgramDateTime=null)}function it(t,e,i,r){t.relurl=e.URI,e.BYTERANGE&&t.setByteRange(e.BYTERANGE),t.level=i,t.sn="initSegment",r&&(t.levelkey=r),t.initSegment=null}var c=f(308);function rt(t,e){t=t.url;return t=void 0!==t&&0!==t.indexOf("data:")?t:e.url}(t=st.prototype).startLoad=function(t){},t.stopLoad=function(){this.destroyInternalLoaders()},t.registerListeners=function(){var t=this.hls;t.on(y.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(y.Events.LEVEL_LOADING,this.onLevelLoading,this),t.on(y.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.on(y.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},t.unregisterListeners=function(){var t=this.hls;t.off(y.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(y.Events.LEVEL_LOADING,this.onLevelLoading,this),t.off(y.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.off(y.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},t.createInternalLoader=function(t){var e=this.hls.config,i=e.pLoader,r=e.loader,i=new(i||r)(e);return t.loader=i,this.loaders[t.type]=i},t.getInternalLoader=function(t){return this.loaders[t.type]},t.resetInternalLoader=function(t){this.loaders[t]&&delete this.loaders[t]},t.destroyInternalLoaders=function(){for(var t in this.loaders){var e=this.loaders[t];e&&e.destroy(),this.resetInternalLoader(t)}},t.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},t.onManifestLoading=function(t,e){e=e.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:c.PlaylistContextType.MANIFEST,url:e,deliveryDirectives:null})},t.onLevelLoading=function(t,e){var i=e.id,r=e.level,n=e.url,e=e.deliveryDirectives;this.load({id:i,groupId:null,level:r,responseType:"text",type:c.PlaylistContextType.LEVEL,url:n,deliveryDirectives:e})},t.onAudioTrackLoading=function(t,e){var i=e.id,r=e.groupId,n=e.url,e=e.deliveryDirectives;this.load({id:i,groupId:r,level:null,responseType:"text",type:c.PlaylistContextType.AUDIO_TRACK,url:n,deliveryDirectives:e})},t.onSubtitleTrackLoading=function(t,e){var i=e.id,r=e.groupId,n=e.url,e=e.deliveryDirectives;this.load({id:i,groupId:r,level:null,responseType:"text",type:c.PlaylistContextType.SUBTITLE_TRACK,url:n,deliveryDirectives:e})},t.load=function(t){var e,i,r,n,s=this.hls.config;if(o=this.getInternalLoader(t)){var a=o.context;if(a&&a.url===t.url)return void V.logger.trace("[playlist-loader]: playlist request ongoing");V.logger.log("[playlist-loader]: aborting previous loader for type: "+t.type),o.abort()}switch(t.type){case c.PlaylistContextType.MANIFEST:e=s.manifestLoadingMaxRetry,i=s.manifestLoadingTimeOut,r=s.manifestLoadingRetryDelay,n=s.manifestLoadingMaxRetryTimeout;break;case c.PlaylistContextType.LEVEL:case c.PlaylistContextType.AUDIO_TRACK:case c.PlaylistContextType.SUBTITLE_TRACK:e=0,i=s.levelLoadingTimeOut;break;default:e=s.levelLoadingMaxRetry,i=s.levelLoadingTimeOut,r=s.levelLoadingRetryDelay,n=s.levelLoadingMaxRetryTimeout}var o=this.createInternalLoader(t),a=(null!=(a=t.deliveryDirectives)&&a.part&&(t.type===c.PlaylistContextType.LEVEL&&null!==t.level?l=this.hls.levels[t.level].details:t.type===c.PlaylistContextType.AUDIO_TRACK&&null!==t.id?l=this.hls.audioTracks[t.id].details:t.type===c.PlaylistContextType.SUBTITLE_TRACK&&null!==t.id&&(l=this.hls.subtitleTracks[t.id].details),l)&&(a=l.partTarget,l=l.targetduration,a&&l&&(i=Math.min(1e3*Math.max(3*a,.8*l),i))),{timeout:i,maxRetry:e,retryDelay:r,maxRetryDelay:n,highWaterMark:0}),l={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};o.load(t,a,l)},t.loadsuccess=function(t,e,i,r){var n;void 0===r&&(r=null),i.isSidxRequest?(this.handleSidxRequest(t,i),this.handlePlaylistLoaded(t,e,i,r)):(this.resetInternalLoader(i.type),0===(n=t.data).indexOf("#EXTM3U")?(e.parsing.start=performance.now(),0<n.indexOf("#EXTINF:")||0<n.indexOf("#EXT-X-TARGETDURATION:")?this.handleTrackOrLevelPlaylist(t,e,i,r):this.handleMasterPlaylist(t,e,i,r)):this.handleManifestParsingError(t,i,"no EXTM3U delimiter",r))},t.loaderror=function(t,e,i){this.handleNetworkError(e,i=void 0===i?null:i,!1,t)},t.loadtimeout=function(t,e,i){this.handleNetworkError(e,i=void 0===i?null:i,!0)},t.handleMasterPlaylist=function(t,e,i,r){var n,s,a=this.hls,o=t.data,l=rt(t,i),h=J.parseMasterPlaylist(o,l),u=h.levels,h=h.sessionData;u.length?(n=u.map(function(t){return{id:t.attrs.AUDIO,audioCodec:t.audioCodec}}),s=u.map(function(t){return{id:t.attrs.SUBTITLES,textCodec:t.textCodec}}),n=J.parseMasterPlaylistMedia(o,l,"AUDIO",n),s=J.parseMasterPlaylistMedia(o,l,"SUBTITLES",s),o=J.parseMasterPlaylistMedia(o,l,"CLOSED-CAPTIONS"),n.length&&!n.some(function(t){return!t.url})&&u[0].audioCodec&&!u[0].attrs.AUDIO&&(V.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),n.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new U({}),bitrate:0,url:""})),a.trigger(y.Events.MANIFEST_LOADED,{levels:u,audioTracks:n,subtitles:s,captions:o,url:l,stats:e,networkDetails:r,sessionData:h})):this.handleManifestParsingError(t,i,"no level found in manifest",r)},t.handleTrackOrLevelPlaylist=function(t,e,i,r){var n=this.hls,s=i.id,a=i.level,o=i.type,l=rt(t,i),h=(0,K.isFiniteNumber)(s)?s:0,u=(0,K.isFiniteNumber)(a)?a:h,d=function(){switch(i.type){case c.PlaylistContextType.AUDIO_TRACK:return c.PlaylistLevelType.AUDIO;case c.PlaylistContextType.SUBTITLE_TRACK:return c.PlaylistLevelType.SUBTITLE;default:return c.PlaylistLevelType.MAIN}}(),u=J.parseLevelPlaylist(t.data,l,u,d,h);u.fragments.length?(o===c.PlaylistContextType.MANIFEST&&(d={attrs:new U({}),bitrate:0,details:u,name:"",url:l},n.trigger(y.Events.MANIFEST_LOADED,{levels:[d],audioTracks:[],url:l,stats:e,networkDetails:r,sessionData:null})),e.parsing.end=performance.now(),u.needSidxRanges?(d=null==(h=u.fragments[0].initSegment)?void 0:h.url,this.load({url:d,isSidxRequest:!0,type:o,level:a,levelDetails:u,id:s,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null})):(i.levelDetails=u,this.handlePlaylistLoaded(t,e,i,r))):n.trigger(y.Events.ERROR,{type:v.ErrorTypes.NETWORK_ERROR,details:v.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:l,reason:"no fragments found in level",level:"number"==typeof i.level?i.level:void 0})},t.handleSidxRequest=function(t,e){var i,r=new Uint8Array(t.data),t=(0,x.findBox)(r,["sidx"])[0];t&&(t=(0,x.parseSegmentIndex)(t))&&(t=t.references,i=e.levelDetails,t.forEach(function(t,e){var t=t.info,e=i.fragments[e];0===e.byteRange.length&&e.setByteRange(String(1+t.end-t.start)+"@"+String(t.start)),e.initSegment&&(t=(t=(0,x.findBox)(r,["moov"])[0])?t.length:null,e.initSegment.setByteRange(String(t)+"@0"))}))},t.handleManifestParsingError=function(t,e,i,r){this.hls.trigger(y.Events.ERROR,{type:v.ErrorTypes.NETWORK_ERROR,details:v.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:e.type===c.PlaylistContextType.MANIFEST,url:t.url,reason:i,response:t,context:e,networkDetails:r})},t.handleNetworkError=function(t,e,i,r){V.logger.warn("[playlist-loader]: A network "+((i=void 0===i?!1:i)?"timeout":"error")+" occurred while loading "+t.type+" level: "+t.level+" id: "+t.id+' group-id: "'+t.groupId+'"');var n=v.ErrorDetails.UNKNOWN,s=!1,a=this.getInternalLoader(t);switch(t.type){case c.PlaylistContextType.MANIFEST:n=i?v.ErrorDetails.MANIFEST_LOAD_TIMEOUT:v.ErrorDetails.MANIFEST_LOAD_ERROR,s=!0;break;case c.PlaylistContextType.LEVEL:n=i?v.ErrorDetails.LEVEL_LOAD_TIMEOUT:v.ErrorDetails.LEVEL_LOAD_ERROR,s=!1;break;case c.PlaylistContextType.AUDIO_TRACK:n=i?v.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:v.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,s=!1;break;case c.PlaylistContextType.SUBTITLE_TRACK:n=i?v.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:v.ErrorDetails.SUBTITLE_LOAD_ERROR,s=!1}a&&this.resetInternalLoader(t.type);a={type:v.ErrorTypes.NETWORK_ERROR,details:n,fatal:s,url:t.url,loader:a,context:t,networkDetails:e};r&&(a.response=r),this.hls.trigger(y.Events.ERROR,a)},t.handlePlaylistLoaded=function(t,e,i,r){var n=i.type,s=i.level,a=i.id,o=i.groupId,l=i.loader,h=i.levelDetails,u=i.deliveryDirectives;if(null!=h&&h.targetduration){if(l)switch(h.live&&(l.getCacheAge&&(h.ageHeader=l.getCacheAge()||0),l.getCacheAge&&!isNaN(h.ageHeader)||(h.ageHeader=0)),n){case c.PlaylistContextType.MANIFEST:case c.PlaylistContextType.LEVEL:this.hls.trigger(y.Events.LEVEL_LOADED,{details:h,level:s||0,id:a||0,stats:e,networkDetails:r,deliveryDirectives:u});break;case c.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(y.Events.AUDIO_TRACK_LOADED,{details:h,id:a||0,groupId:o||"",stats:e,networkDetails:r,deliveryDirectives:u});break;case c.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(y.Events.SUBTITLE_TRACK_LOADED,{details:h,id:a||0,groupId:o||"",stats:e,networkDetails:r,deliveryDirectives:u})}}else this.handleManifestParsingError(t,i,"invalid target duration",r)};const nt=st;function st(t){this.hls=void 0,this.loaders=Object.create(null),this.hls=t,this.registerListeners()}(t=ot.prototype).startLoad=function(t){},t.stopLoad=function(){this.destroyInternalLoaders()},t.registerListeners=function(){this.hls.on(y.Events.KEY_LOADING,this.onKeyLoading,this)},t.unregisterListeners=function(){this.hls.off(y.Events.KEY_LOADING,this.onKeyLoading)},t.destroyInternalLoaders=function(){for(var t in this.loaders){t=this.loaders[t];t&&t.destroy()}this.loaders={}},t.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},t.onKeyLoading=function(t,e){var i,r,e=e.frag,n=e.type,s=this.loaders[n];e.decryptdata?(i=e.decryptdata.uri)!==this.decrypturl||null===this.decryptkey?(r=this.hls.config,s&&(V.logger.warn("abort previous key loader for type:"+n),s.abort()),i?(s=r.loader,n=e.loader=this.loaders[n]=new s(r),this.decrypturl=i,this.decryptkey=null,s={url:i,frag:e,responseType:"arraybuffer"},i={timeout:r.fragLoadingTimeOut,maxRetry:0,retryDelay:r.fragLoadingRetryDelay,maxRetryDelay:r.fragLoadingMaxRetryTimeout,highWaterMark:0},r={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},n.load(s,i,r)):V.logger.warn("key uri is falsy")):this.decryptkey&&(e.decryptdata.key=this.decryptkey,this.hls.trigger(y.Events.KEY_LOADED,{frag:e})):V.logger.warn("Missing decryption data on fragment in onKeyLoading")},t.loadsuccess=function(t,e,i){i=i.frag;i.decryptdata?(this.decryptkey=i.decryptdata.key=new Uint8Array(t.data),i.loader=null,delete this.loaders[i.type],this.hls.trigger(y.Events.KEY_LOADED,{frag:i})):V.logger.error("after key load, decryptdata unset")},t.loaderror=function(t,e){var e=e.frag,i=e.loader;i&&i.abort(),delete this.loaders[e.type],this.hls.trigger(y.Events.ERROR,{type:v.ErrorTypes.NETWORK_ERROR,details:v.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:e,response:t})},t.loadtimeout=function(t,e){var e=e.frag,i=e.loader;i&&i.abort(),delete this.loaders[e.type],this.hls.trigger(y.Events.ERROR,{type:v.ErrorTypes.NETWORK_ERROR,details:v.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:e})};var at=ot;function ot(t){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=t,this.registerListeners()}function lt(t,e){var i;try{i=new Event("addtrack")}catch(t){(i=document.createEvent("Event")).initEvent("addtrack",!1,!1)}i.track=t,e.dispatchEvent(i)}function ht(t,e){var i=t.mode;if("disabled"===i&&(t.mode="hidden"),t.cues&&!t.cues.getCueById(e.id))try{if(t.addCue(e),!t.cues.getCueById(e.id))throw new Error("addCue is failed for: "+e)}catch(i){V.logger.debug("[texttrack-utils]: "+i);var r=new self.TextTrackCue(e.startTime,e.endTime,e.text);r.id=e.id,t.addCue(r)}"disabled"===i&&(t.mode=i)}function ut(t){var e=t.mode;if("disabled"===e&&(t.mode="hidden"),t.cues)for(var i=t.cues.length;i--;)t.removeCue(t.cues[i]);"disabled"===e&&(t.mode=e)}function dt(t,e,i,r){var n=t.mode;if("disabled"===n&&(t.mode="hidden"),t.cues&&0<t.cues.length)for(var s=function(t,e,i){var r=[],n=function(t,e){if(e<t[0].startTime)return 0;var i=t.length-1;if(e>t[i].endTime)return-1;for(var r=0,n=i;r<=n;){var s=Math.floor((n+r)/2);if(e<t[s].startTime)n=s-1;else{if(!(e>t[s].startTime&&r<i))return s;r=s+1}}return t[r].startTime-e<e-t[n].startTime?r:n}(t,e);if(-1<n)for(var s=n,a=t.length;s<a;s++){var o=t[s];if(o.startTime>=e&&o.endTime<=i)r.push(o);else if(o.startTime>i)return r}return r}(t.cues,e,i),a=0;a<s.length;a++)r&&!r(s[a])||t.removeCue(s[a]);"disabled"===n&&(t.mode=n)}var ct=f(181),ft=f(856);function gt(){return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}var vt=function(){var t=gt();try{new t(0,Number.POSITIVE_INFINITY,"")}catch(t){return Number.MAX_VALUE}return Number.POSITIVE_INFINITY}();function pt(t,e){return t.getTime()/1e3-e}(t=Tt.prototype).destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null},t._registerListeners=function(){var t=this.hls;t.on(y.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(y.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(y.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(y.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),t.on(y.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(y.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},t._unregisterListeners=function(){var t=this.hls;t.off(y.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(y.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(y.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(y.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),t.off(y.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(y.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},t.onMediaAttached=function(t,e){this.media=e.media},t.onMediaDetaching=function(){this.id3Track&&(ut(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})},t.onManifestLoading=function(){this.dateRangeCuesAppended={}},t.createTrack=function(t){t=this.getID3Track(t.textTracks);return t.mode="hidden",t},t.getID3Track=function(t){if(this.media){for(var e=0;e<t.length;e++){var i=t[e];if("metadata"===i.kind&&"id3"===i.label)return lt(i,this.media),i}return this.media.addTextTrack("metadata","id3")}},t.onFragParsingMetadata=function(t,e){if(this.media){var i=this.hls.config,r=i.enableEmsgMetadataCues,n=i.enableID3MetadataCues;if(r||n){e.frag;var s=e.samples;e.details,this.id3Track||(this.id3Track=this.createTrack(this.media));for(var a=gt(),o=0;o<s.length;o++){var l=s[o].type;if((l!==ft.MetadataSchema.emsg||r)&&n){var h=ct.getID3Frames(s[o].data);if(h){var u=s[o].pts,d=u+s[o].duration;(d=vt<d?vt:d)-u<=0&&(d=u+.25);for(var c=0;c<h.length;c++){var f,g=h[c];ct.isTimeStampFrame(g)||(this.updateId3CueEnds(u),(f=new a(u,d,"")).value=g,l&&(f.type=l),this.id3Track.addCue(f))}}}}}}},t.updateId3CueEnds=function(t){var e,i=null==(e=this.id3Track)?void 0:e.cues;if(i)for(var r=i.length;r--;){var n=i[r];n.startTime<t&&n.endTime===vt&&(n.endTime=t)}},t.onBufferFlushing=function(t,e){var i,r,n=e.startOffset,s=e.endOffset,e=e.type,a=this.id3Track,o=this.hls;o&&(o=o.config,i=o.enableEmsgMetadataCues,r=o.enableID3MetadataCues,a)&&(i||r)&&dt(a,n,s,"audio"===e?function(t){return t.type===ft.MetadataSchema.audioId3&&r}:"video"===e?function(t){return t.type===ft.MetadataSchema.emsg&&i}:function(t){return t.type===ft.MetadataSchema.audioId3&&r||t.type===ft.MetadataSchema.emsg&&i})},t.onLevelUpdated=function(t,e){var g=this,e=e.details;if(this.media&&e.hasProgramDateTime&&this.hls.config.enableDateRangeMetadataCues){var v=this.dateRangeCuesAppended,i=this.id3Track,p=e.dateRanges,m=Object.keys(p);if(i)for(var r=Object.keys(v).filter(function(t){return!m.includes(t)}),n=r.length;n--;)!function(t){var e=r[t];Object.keys(v[e].cues).forEach(function(t){i.removeCue(v[e].cues[t])}),delete v[e]}(n);e=e.fragments[e.fragments.length-1];if(0!==m.length&&(0,K.isFiniteNumber)(null==e?void 0:e.programDateTime)){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var T=e.programDateTime/1e3-e.start,y=gt(),s=0;s<m.length;s++)!function(t){var t=m[t],r=p[t],e=v[t],i=(null==e?void 0:e.cues)||{},n=(null==e?void 0:e.durationKnown)||!1,s=pt(r.startDate,T),a=vt,o=r.endDate;o?(a=pt(o,T),n=!0):r.endOnNext&&!n&&(o=m.reduce(function(t,e){var i=p[e];return i.class===r.class&&i.id!==e&&i.startDate>r.startDate&&t.push(i),t},[]).sort(function(t,e){return t.startDate.getTime()-e.startDate.getTime()})[0])&&(a=pt(o.startDate,T),n=!0);for(var l,h=Object.keys(r.attr),u=0;u<h.length;u++){var d,c,f=h[u];f!==E.ID&&f!==E.CLASS&&f!==E.START_DATE&&f!==E.DURATION&&f!==E.END_DATE&&f!==E.END_ON_NEXT&&((c=i[f])?n&&!e.durationKnown&&(c.endTime=a):(d=r.attr[f],c=new y(s,a,""),f!==E.SCTE35_OUT&&f!==E.SCTE35_IN||(l=d,d=Uint8Array.from(l.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer),c.value={key:f,data:d},c.type=ft.MetadataSchema.dateRange,g.id3Track.addCue(c),i[f]=c))}v[t]={cues:i,dateRange:r,durationKnown:n}}(s)}}};const mt=Tt;function Tt(t){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=t,this._registerListeners()}var l,yt=function(){function t(t){var e=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return e.timeupdate()},this.hls=t,this.config=t.config,this.registerListeners()}for(var e=t.prototype,i=(e.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},e.registerListeners=function(){this.hls.on(y.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(y.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(y.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(y.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(y.Events.ERROR,this.onError,this)},e.unregisterListeners=function(){this.hls.off(y.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(y.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(y.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(y.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(y.Events.ERROR,this.onError)},e.onMediaAttached=function(t,e){this.media=e.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},e.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},e.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},e.onLevelUpdated=function(t,e){e=e.details;(this.levelDetails=e).advanced&&this.timeupdate(),!e.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},e.onError=function(t,e){e.details===v.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,V.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},e.timeupdate=function(){var t,e,i,r=this.media,n=this.levelDetails;r&&n&&(this.currentTime=r.currentTime,null!==(e=this.computeLatency()))&&(this._latency=e,i=(t=this.config).lowLatencyMode,t=t.maxLiveSyncPlaybackRate,i)&&1!==t&&null!==(i=this.targetLatency)&&(i=(e=e-i)<Math.min(this.maxLatency,i+n.targetduration),n.live&&i&&.05<e&&1<this.forwardBufferLength?(n=Math.min(2,Math.max(1,t)),i=Math.round(2/(1+Math.exp(-.75*e-this.edgeStalled))*20)/20,r.playbackRate=Math.min(n,Math.max(1,i))):1!==r.playbackRate&&0!==r.playbackRate&&(r.playbackRate=1))},e.estimateLiveEdge=function(){var t=this.levelDetails;return null===t?null:t.edge+t.age},e.computeLatency=function(){var t=this.estimateLiveEdge();return null===t?null:t-this.currentTime},(e=t).prototype),r=[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var t=this.config,e=this.levelDetails;return void 0!==t.liveMaxLatencyDuration?t.liveMaxLatencyDuration:e?t.liveMaxLatencyDurationCount*e.targetduration:0}},{key:"targetLatency",get:function(){var t,e,i,r,n,s=this.levelDetails;return null===s?null:(t=s.holdBack,r=s.partHoldBack,s=s.targetduration,e=(n=this.config).liveSyncDuration,i=n.liveSyncDurationCount,n=n.lowLatencyMode&&r||t,(n=(r=this.hls.userConfig).liveSyncDuration||r.liveSyncDurationCount||0===n?void 0!==e?e:i*s:n)+Math.min(+this.stallCount,s))}},{key:"liveSyncPosition",get:function(){var t,e=this.estimateLiveEdge(),i=this.targetLatency,r=this.levelDetails;return null===e||null===i||null===r?null:(t=r.edge,e=e-i-this.edgeStalled,i=t-r.totalduration,t=t-(this.config.lowLatencyMode&&r.partTarget||r.targetduration),Math.min(Math.max(i,e),t))}},{key:"drift",get:function(){var t=this.levelDetails;return null===t?1:t.drift}},{key:"edgeStalled",get:function(){var t,e=this.levelDetails;return null===e?0:(t=3*(this.config.lowLatencyMode&&e.partTarget||e.targetduration),Math.max(e.age-t,0))}},{key:"forwardBufferLength",get:function(){var t,e=this.media,i=this.levelDetails;return e&&i?((t=e.buffered.length)?e.buffered.end(t-1):i.edge)-this.currentTime:0}}],n=0;n<r.length;n++){var s=r[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(i,s.key,s)}return Object.defineProperty(e,"prototype",{writable:!1}),t}(),Et=((t=l=l||{}).No="",t.Yes="YES",t.v2="v2",bt.prototype.addDirectives=function(t){t=new self.URL(t);return void 0!==this.msn&&t.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.toString()},bt),St=function(){function t(t){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[t.url],this.attrs=t.attrs,this.bitrate=t.bitrate,t.details&&(this.details=t.details),this.id=t.id||0,this.name=t.name,this.width=t.width||0,this.height=t.height||0,this.audioCodec=t.audioCodec,this.videoCodec=t.videoCodec,this.unknownCodecs=t.unknownCodecs,this.codecSet=[t.videoCodec,t.audioCodec].filter(function(t){return t}).join(",").replace(/\.[^.,]+/g,"")}for(var e=t,i=e.prototype,r=[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(t){t%=this.url.length;this._urlId!==t&&(this.details=void 0,this._urlId=t)}}],n=0;n<r.length;n++){var s=r[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(i,s.key,s)}return Object.defineProperty(e,"prototype",{writable:!1}),t}();function bt(t,e,i){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=t,this.part=e,this.skip=i}function Lt(){return(Lt=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i,r=arguments[e];for(i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t}).apply(this,arguments)}function kt(t,e,i){switch(e){case"audio":t.audioGroupIds||(t.audioGroupIds=[]),t.audioGroupIds.push(i);break;case"text":t.textGroupIds||(t.textGroupIds=[]),t.textGroupIds.push(i)}}function Dt(t){var i={};t.forEach(function(t){var e=t.groupId||"";t.id=i[e]=i[e]||0,i[e]++})}function Rt(t,e){var i,r=e.startPTS;(0,K.isFiniteNumber)(r)?(i=0,(r=e.sn>t.sn?(i=r-t.start,t):(i=t.start-r,e)).duration!==i&&(r.duration=i)):e.sn>t.sn?t.cc===e.cc&&t.minEndPTS?e.start=t.start+(t.minEndPTS-t.start):e.start=t.start+t.duration:e.start=Math.max(t.start-e.duration,0)}function At(t,e,i,r,n,s){r-i<=0&&(V.logger.warn("Fragment should have a positive duration",e),r=i+e.duration,s=n+e.duration);var a=i,o=r,l=e.startPTS,h=e.endPTS,u=((0,K.isFiniteNumber)(l)&&(u=Math.abs(l-i),(0,K.isFiniteNumber)(e.deltaPTS)?e.deltaPTS=Math.max(u,e.deltaPTS):e.deltaPTS=u,a=Math.max(i,l),i=Math.min(i,l),n=Math.min(n,e.startDTS),o=Math.min(r,h),r=Math.max(r,h),s=Math.max(s,e.endDTS)),e.duration=r-i,i-e.start);e.appendedPTS=r,e.start=e.startPTS=i,e.maxStartPTS=a,e.startDTS=n,e.endPTS=r,e.minEndPTS=o,e.endDTS=s;var d,l=e.sn;if(!t||l<t.startSN||l>t.endSN)return 0;var h=l-t.startSN,c=t.fragments;for(c[h]=e,d=h;0<d;d--)Rt(c[d],c[d-1]);for(d=h;d<c.length-1;d++)Rt(c[d],c[d+1]);return t.fragmentHint&&Rt(c[c.length-1],t.fragmentHint),t.PTSKnown=t.alignedSliding=!0,u}function _t(t,e){var i=e.startSN+e.skippedSegments-t.startSN,t=t.fragments;i<0||i>=t.length||It(e,t[i].start)}function It(t,e){if(e){for(var i=t.fragments,r=t.skippedSegments;r<i.length;r++)i[r].start+=e;t.fragmentHint&&(t.fragmentHint.start+=e)}}(t=Ct.prototype).destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},t.onError=function(t,e){e.fatal&&e.type===v.ErrorTypes.NETWORK_ERROR&&this.clearTimer()},t.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},t.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},t.stopLoad=function(){this.canLoad=!1,this.clearTimer()},t.switchParams=function(t,e){var i=null==e?void 0:e.renditionReports;if(i)for(var r=0;r<i.length;r++){var n=i[r],s=""+n.URI;if(s===t.slice(-s.length)){var a,s=parseInt(n["LAST-MSN"]),n=parseInt(n["LAST-PART"]);if(e&&this.hls.config.lowLatencyMode&&(a=Math.min(e.age-e.partTarget,e.targetduration),void 0!==n)&&a>e.partTarget&&(n+=1),(0,K.isFiniteNumber)(s))return new Et(s,(0,K.isFiniteNumber)(n)?n:void 0,l.No)}}},t.loadPlaylist=function(t){},t.shouldLoadTrack=function(t){return this.canLoad&&t&&!!t.url&&(!t.details||t.details.live)},t.playlistLoaded=function(t,e,i){var r,M=this,n=e.details,s=e.stats,a=s.loading.end?Math.max(0,self.performance.now()-s.loading.end):0;if(n.advancedDateTime=Date.now()-a,n.live||null!=i&&i.live){if(n.reloaded(i),i&&this.log("live playlist "+t+" "+(n.advanced?"REFRESHED "+n.lastPartSn+"-"+n.lastPartIndex:"MISSED")),i&&0<n.fragments.length){var a=i;var o=n;for(var l=null,h=a.fragments,u=h.length-1;0<=u;u--){var d=h[u].initSegment;if(d){l=d;break}}a.fragmentHint&&delete a.fragmentHint.endPTS;for(var c,f,g,v=0,p=a,m=o,T=m.skippedSegments,y=Math.max(p.startSN,m.startSN)-m.startSN,N=(p.fragmentHint?1:0)+(T?m.endSN:Math.min(p.endSN,m.endSN))-m.startSN,U=m.startSN-p.startSN,B=m.fragmentHint?m.fragments.concat(m.fragmentHint):m.fragments,G=p.fragmentHint?p.fragments.concat(p.fragmentHint):p.fragments,E=y;E<=N;E++){var S=G[U+E],b=B[E];T&&!b&&E<T&&(b=m.fragments[E]=S),S&&b&&(b=b,(S=S).relurl&&(v=S.cc-b.cc),(0,K.isFiniteNumber)(S.startPTS)&&(0,K.isFiniteNumber)(S.endPTS)&&(b.start=b.startPTS=S.startPTS,b.startDTS=S.startDTS,b.appendedPTS=S.appendedPTS,b.maxStartPTS=S.maxStartPTS,b.endPTS=S.endPTS,b.endDTS=S.endDTS,b.minEndPTS=S.minEndPTS,b.duration=S.endPTS-S.startPTS,b.duration&&(c=b),o.PTSKnown=o.alignedSliding=!0),b.elementaryStreams=S.elementaryStreams,b.loader=S.loader,b.stats=S.stats,b.urlId=S.urlId,S.initSegment)&&(b.initSegment=S.initSegment,l=S.initSegment)}if(l&&(o.fragmentHint?o.fragments.concat(o.fragmentHint):o.fragments).forEach(function(t){var e;t.initSegment&&t.initSegment.relurl!==(null==(e=l)?void 0:e.relurl)||(t.initSegment=l)}),o.skippedSegments)if(o.deltaUpdateFailed=o.fragments.some(function(t){return!t}),o.deltaUpdateFailed){V.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var j=o.skippedSegments;j--;)o.fragments.shift();o.startSN=o.fragments[0].sn,o.startCC=o.fragments[0].cc}else o.canSkipDateRanges&&(o.dateRanges=(p=a.dateRanges,f=o.dateRanges,y=o.recentlyRemovedDateranges,g=Lt({},p),y&&y.forEach(function(t){delete g[t]}),Object.keys(f).forEach(function(t){var e=new W(f[t].attr,g[t]);e.isValid?g[t]=e:V.logger.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+JSON.stringify(f[t].attr)+'"')}),g));var L=o.fragments;if(v){V.logger.warn("discontinuity sliding from playlist, take drift into account");for(var k=0;k<L.length;k++)L[k].cc+=v}o.skippedSegments&&(o.startCC=o.fragments[0].cc);var D=a.partList,R=o.partList;if(D&&R)for(var A=0,_=0,H=D.length;_<=H;_++){var I=D[_],C=R[_+A];I&&C&&I.index===C.index&&I.fragment.sn===C.fragment.sn?(C.elementaryStreams=(I=I).elementaryStreams,C.stats=I.stats):A--}c?At(o,c,c.startPTS,c.endPTS,c.startDTS,c.endDTS):_t(a,o),L.length&&(o.totalduration=o.edge-L[0].start),o.driftStartTime=a.driftStartTime,o.driftStart=a.driftStart;p=o.advancedDateTime;o.advanced&&p?(y=o.edge,o.driftStart||(o.driftStartTime=p,o.driftStart=y),o.driftEndTime=p,o.driftEnd=y):(o.driftEndTime=a.driftEndTime,o.driftEnd=a.driftEnd,o.advancedDateTime=a.advancedDateTime)}if(this.canLoad&&n.live){var w,p=void 0,y=void 0;if(n.canBlockReload&&n.endSN&&n.advanced){var a=this.hls.config.lowLatencyMode,O=n.lastPartSn,x=n.endSN,P=n.lastPartIndex,F=O===x,O=(-1!==P?(p=F?x+1:O,y=F?a?0:P:P+1):p=x+1,n.age),P=O+n.ageHeader,x=Math.min(P-n.partTarget,1.5*n.targetduration);if(0<x&&(i&&x>i.tuneInGoal?(this.warn("CDN Tune-in goal increased from: "+i.tuneInGoal+" to: "+x+" with playlist age: "+n.age),x=0):(p+=P=Math.floor(x/n.targetduration),void 0!==y&&(y+=Math.round(x%n.targetduration/n.partTarget)),this.log("CDN Tune-in age: "+n.ageHeader+"s last advanced "+O.toFixed(2)+"s goal: "+x+" skip sn "+P+" to part "+y)),n.tuneInGoal=x),w=this.getDeliveryDirectives(n,e.deliveryDirectives,p,y),a||!F)return void this.loadPlaylist(w)}else w=this.getDeliveryDirectives(n,e.deliveryDirectives,p,y);O=1e3*(i=n).levelTargetDuration,P=O/2,x=i.age,a=0<x&&x<3*O,F=s.loading.end-s.loading.start,e=i.availabilityDelay,!1===i.updated?a?(r=333*i.misses,r=Math.max(Math.min(P,2*F),r),i.availabilityDelay=(i.availabilityDelay||0)+r):r=P:r=a?(e=Math.min(e||O/2,x),(i.availabilityDelay=e)+O-x):O-F;s=Math.round(r);void 0!==p&&n.canBlockReload&&(s-=n.partTarget||1),this.log("reload live playlist "+t+" in "+Math.round(s)+" ms"),this.timer=self.setTimeout(function(){return M.loadPlaylist(w)},s)}}else this.clearTimer()},t.getDeliveryDirectives=function(t,e,i,r){o=i,n=t.canSkipUntil,s=t.canSkipDateRanges,a=t.endSN;var n,s,a,o=n&&(void 0!==o?o-a:0)<n?s?l.v2:l.Yes:l.No;return null!=e&&e.skip&&t.deltaUpdateFailed&&(i=e.msn,r=e.part,o=l.No),new Et(i,r,o)},t.retryLoadingOrFail=function(t){var e,i=this,r=this.hls.config,n=this.retryCount<r.levelLoadingMaxRetry;return n?(this.retryCount++,-1<t.details.indexOf("LoadTimeOut")&&null!=(e=t.context)&&e.deliveryDirectives?(this.warn("retry playlist loading #"+this.retryCount+' after "'+t.details+'"'),this.loadPlaylist()):(e=Math.min(Math.pow(2,this.retryCount)*r.levelLoadingRetryDelay,r.levelLoadingMaxRetryTimeout),this.timer=self.setTimeout(function(){return i.loadPlaylist()},e),this.warn("retry playlist loading #"+this.retryCount+" in "+e+' ms after "'+t.details+'"'))):(this.warn('cannot recover from error "'+t.details+'"'),this.clearTimer(),t.fatal=!0),n};t=Ct;function Ct(t,e){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=V.logger.log.bind(V.logger,e+":"),this.warn=V.logger.warn.bind(V.logger,e+":"),this.hls=t}function wt(){return(wt=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i,r=arguments[e];for(i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t}).apply(this,arguments)}function Ot(t,e){return(Ot=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}var h,xt=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),Pt=function(l){function t(t){return(t=l.call(this,t,"[level-controller]")||this)._levels=[],t._firstLevel=-1,t._startLevel=void 0,t.currentLevelIndex=-1,t.manualLevelIndex=-1,t.onParsedComplete=void 0,t._registerListeners(),t}e=l,(i=t).prototype=Object.create(e.prototype),Ot(i.prototype.constructor=i,e);for(var e,i=t.prototype,r=(i._registerListeners=function(){var t=this.hls;t.on(y.Events.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(y.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.on(y.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.on(y.Events.FRAG_LOADED,this.onFragLoaded,this),t.on(y.Events.ERROR,this.onError,this)},i._unregisterListeners=function(){var t=this.hls;t.off(y.Events.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(y.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.off(y.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.off(y.Events.FRAG_LOADED,this.onFragLoaded,this),t.off(y.Events.ERROR,this.onError,this)},i.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,l.prototype.destroy.call(this)},i.startLoad=function(){this._levels.forEach(function(t){t.loadError=0}),l.prototype.startLoad.call(this)},i.onManifestLoaded=function(t,e){var i,r,n=[],s=[],a=[],o={},l=!1,h=!1,u=!1;if(e.levels.forEach(function(t){var e=t.attrs,i=(l=l||!(!t.width||!t.height),h=h||!!t.videoCodec,u=u||!!t.audioCodec,xt&&t.audioCodec&&-1!==t.audioCodec.indexOf("mp4a.40.34")&&(t.audioCodec=void 0),t.bitrate+"-"+t.attrs.RESOLUTION+"-"+t.attrs.CODECS);(r=o[i])?r.url.push(t.url):(r=new St(t),o[i]=r,n.push(r)),e&&(e.AUDIO&&kt(r,"audio",e.AUDIO),e.SUBTITLES)&&kt(r,"text",e.SUBTITLES)}),n=(n=(l||h)&&u?n.filter(function(t){var e=t.videoCodec,i=t.width,t=t.height;return!!e||!(!i||!t)}):n).filter(function(t){var e=t.audioCodec,t=t.videoCodec;return(!e||q(e,"audio"))&&(!t||q(t,"video"))}),e.audioTracks&&Dt(s=e.audioTracks.filter(function(t){return!t.audioCodec||q(t.audioCodec,"audio")})),e.subtitles&&Dt(a=e.subtitles),0<n.length){i=n[0].bitrate,n.sort(function(t,e){return t.bitrate-e.bitrate}),this._levels=n;for(var d=0;d<n.length;d++)if(n[d].bitrate===i){this._firstLevel=d,this.log("manifest loaded, "+n.length+" level(s) found, first bitrate: "+i);break}var c=u&&!h,a={levels:n,audioTracks:s,subtitleTracks:a,firstLevel:this._firstLevel,stats:e.stats,audio:u,video:h,altAudio:!c&&s.some(function(t){return!!t.url})};this.hls.trigger(y.Events.MANIFEST_PARSED,a),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(y.Events.ERROR,{type:v.ErrorTypes.MEDIA_ERROR,details:v.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:e.url,reason:"no level with compatible codecs found in manifest"})},i.onError=function(t,e){if(l.prototype.onError.call(this,t,e),!e.fatal){var i=e.context,t=this._levels[this.currentLevelIndex];if(i&&(i.type===c.PlaylistContextType.AUDIO_TRACK&&t.audioGroupIds&&i.groupId===t.audioGroupIds[t.urlId]||i.type===c.PlaylistContextType.SUBTITLE_TRACK&&t.textGroupIds&&i.groupId===t.textGroupIds[t.urlId]))this.redundantFailover(this.currentLevelIndex);else{var r,n,s,a=!1,o=!0;switch(e.details){case v.ErrorDetails.FRAG_LOAD_ERROR:case v.ErrorDetails.FRAG_LOAD_TIMEOUT:case v.ErrorDetails.KEY_LOAD_ERROR:case v.ErrorDetails.KEY_LOAD_TIMEOUT:e.frag&&(n=e.frag.type===c.PlaylistLevelType.MAIN?e.frag.level:this.currentLevelIndex,!(s=this._levels[n])||(s.fragmentError++,s.fragmentError>this.hls.config.fragLoadingMaxRetry))&&(r=n);break;case v.ErrorDetails.LEVEL_LOAD_ERROR:case v.ErrorDetails.LEVEL_LOAD_TIMEOUT:i&&(i.deliveryDirectives&&(o=!1),r=i.level),a=!0;break;case v.ErrorDetails.REMUX_ALLOC_ERROR:r=null!=(s=e.level)?s:this.currentLevelIndex,a=!0}void 0!==r&&this.recoverLevel(e,r,a,o)}}},i.recoverLevel=function(t,e,i,r){var n=t.details,s=this._levels[e];if(s.loadError++,i){if(!this.retryLoadingOrFail(t))return void(this.currentLevelIndex=-1);t.levelRetry=!0}if(r){i=s.url.length;if(1<i&&s.loadError<i)t.levelRetry=!0,this.redundantFailover(e);else if(-1===this.manualLevelIndex){for(var a=-1,o=this._levels,l=o.length;l--;){var h=(l+this.currentLevelIndex)%o.length;if(h!==this.currentLevelIndex&&0===o[h].loadError){a=h;break}}-1<a&&this.currentLevelIndex!==a&&(this.warn(n+": switch to "+a),t.levelRetry=!0,this.hls.nextAutoLevel=a)}}},i.redundantFailover=function(t){var e,i=this._levels[t],r=i.url.length;1<r&&(e=(i.urlId+1)%r,this.warn("Switching to redundant URL-id "+e),this._levels.forEach(function(t){t.urlId=e}),this.level=t)},i.onFragLoaded=function(t,e){var e=e.frag;void 0!==e&&e.type===c.PlaylistLevelType.MAIN&&void 0!==(e=this._levels[e.level])&&(e.fragmentError=0,e.loadError=0)},i.onLevelLoaded=function(t,e){var i=e.level,r=e.details,n=this._levels[i];n?i===this.currentLevelIndex?(0===n.fragmentError&&(n.loadError=0,this.retryCount=0),this.playlistLoaded(i,e,n.details)):null!=(n=e.deliveryDirectives)&&n.skip&&(r.deltaUpdateFailed=!0):(this.warn("Invalid level index "+i),null!=(n=e.deliveryDirectives)&&n.skip&&(r.deltaUpdateFailed=!0))},i.onAudioTrackSwitched=function(t,e){var i=this.hls.levels[this.currentLevelIndex];if(i&&i.audioGroupIds){for(var r=-1,n=this.hls.audioTracks[e.id].groupId,s=0;s<i.audioGroupIds.length;s++)if(i.audioGroupIds[s]===n){r=s;break}r!==i.urlId&&(i.urlId=r,this.startLoad())}},i.loadPlaylist=function(t){var e=this.currentLevelIndex,i=this._levels[e];if(this.canLoad&&i&&0<i.url.length){var r=i.urlId,i=i.url[r];if(t)try{i=t.addDirectives(i)}catch(t){this.warn("Could not construct new URL with HLS Delivery Directives: "+t)}this.log("Attempt loading level index "+e+(t?" at sn "+t.msn+" part "+t.part:"")+" with URL-id "+r+" "+i),this.clearTimer(),this.hls.trigger(y.Events.LEVEL_LOADING,{url:i,level:e,id:r,deliveryDirectives:t||null})}},i.removeLevel=function(i,r){function n(t,e){return e!==r}var t=this._levels.filter(function(t,e){return e!==i||1<t.url.length&&void 0!==r&&(t.url=t.url.filter(n),t.audioGroupIds&&(t.audioGroupIds=t.audioGroupIds.filter(n)),t.textGroupIds&&(t.textGroupIds=t.textGroupIds.filter(n)),!(t.urlId=0))}).map(function(t,e){var i=t.details;return null!=i&&i.fragments&&i.fragments.forEach(function(t){t.level=e}),t});this._levels=t,this.hls.trigger(y.Events.LEVELS_UPDATED,{levels:t})},(e=t).prototype),n=[{key:"levels",get:function(){return 0===this._levels.length?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(t){var e=this._levels;if(0!==e.length&&(this.currentLevelIndex!==t||null==(i=e[t])||!i.details)){if(t<0||t>=e.length){var i=t<0;if(this.hls.trigger(y.Events.ERROR,{type:v.ErrorTypes.OTHER_ERROR,details:v.ErrorDetails.LEVEL_SWITCH_ERROR,level:t,fatal:i,reason:"invalid level idx"}),i)return;t=Math.min(t,e.length-1)}this.clearTimer();var i=this.currentLevelIndex,r=e[i],e=e[t],i=(this.log("switching to level "+t+" from "+i),wt({},e,{level:this.currentLevelIndex=t,maxBitrate:e.maxBitrate,uri:e.uri,urlId:e.urlId})),t=(delete i._urlId,this.hls.trigger(y.Events.LEVEL_SWITCHING,i),e.details);t&&!t.live||(i=this.switchParams(e.uri,null==r?void 0:r.details),this.loadPlaylist(i))}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(t){this.manualLevelIndex=t,void 0===this._startLevel&&(this._startLevel=t),-1!==t&&(this.level=t)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(t){this._firstLevel=t}},{key:"startLevel",get:function(){var t;return void 0===this._startLevel?void 0!==(t=this.hls.config.startLevel)?t:this._firstLevel:this._startLevel},set:function(t){this._startLevel=t}},{key:"nextLoadLevel",get:function(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(t){this.level=t,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=t)}}],s=0;s<n.length;s++){var a=n[s];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(r,a.key,a)}return Object.defineProperty(e,"prototype",{writable:!1}),t}(t),Ft=((e=h=h||{}).NOT_LOADED="NOT_LOADED",e.APPENDING="APPENDING",e.PARTIAL="PARTIAL",e.OK="OK",(e=Mt.prototype)._registerListeners=function(){var t=this.hls;t.on(y.Events.BUFFER_APPENDED,this.onBufferAppended,this),t.on(y.Events.FRAG_BUFFERED,this.onFragBuffered,this),t.on(y.Events.FRAG_LOADED,this.onFragLoaded,this)},e._unregisterListeners=function(){var t=this.hls;t.off(y.Events.BUFFER_APPENDED,this.onBufferAppended,this),t.off(y.Events.FRAG_BUFFERED,this.onFragBuffered,this),t.off(y.Events.FRAG_LOADED,this.onFragLoaded,this)},e.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},e.getAppendedFrag=function(t,e){if(e===c.PlaylistLevelType.MAIN){var i=this.activeFragment,r=this.activeParts;if(!i)return null;if(r)for(var n=r.length;n--;){var s=r[n],a=s?s.end:i.appendedPTS;if(s.start<=t&&void 0!==a&&t<=a)return 9<n&&(this.activeParts=r.slice(n-9)),s}else if(i.start<=t&&void 0!==i.appendedPTS&&t<=i.appendedPTS)return i}return this.getBufferedFrag(t,e)},e.getBufferedFrag=function(t,e){for(var i=this.fragments,r=Object.keys(i),n=r.length;n--;){var s=i[r[n]];if((null==s?void 0:s.body.type)===e&&s.buffered){s=s.body;if(s.start<=t&&t<=s.end)return s}}return null},e.detectEvictedFragments=function(i,r,n){var s=this;Object.keys(this.fragments).forEach(function(t){var e=s.fragments[t];e&&(e.buffered?(t=e.range[i])&&t.time.some(function(t){t=!s.isTimeBuffered(t.startPTS,t.endPTS,r);return t&&s.removeFragment(e.body),t}):e.body.type===n&&s.removeFragment(e.body))})},e.detectPartialFragments=function(t){var r,n=this,s=this.timeRanges,a=t.frag,o=t.part;s&&"initSegment"!==a.sn&&(t=Ut(a),r=this.fragments[t])&&(Object.keys(s).forEach(function(t){var e,i=a.elementaryStreams[t];i&&(e=s[t],i=null!==o||!0===i.partial,r.range[t]=n.getBufferedTimes(a,o,i,e))}),r.loaded=null,Object.keys(r.range).length?r.buffered=!0:this.removeFragment(r.body))},e.fragBuffered=function(t){t=Ut(t),t=this.fragments[t];t&&(t.loaded=null,t.buffered=!0)},e.getBufferedTimes=function(t,e,i,r){for(var n={time:[],partial:i},s=(e||t).start,a=(e||t).end,o=t.minEndPTS||a,l=t.maxStartPTS||s,h=0;h<r.length;h++){var u=r.start(h)-this.bufferPadding,d=r.end(h)+this.bufferPadding;if(u<=l&&o<=d){n.time.push({startPTS:Math.max(s,r.start(h)),endPTS:Math.min(a,r.end(h))});break}if(s<d&&u<a)n.partial=!0,n.time.push({startPTS:Math.max(s,r.start(h)),endPTS:Math.min(a,r.end(h))});else if(a<=u)break}return n},e.getPartialFragment=function(e){var i,r,n=null,s=0,a=this.bufferPadding,o=this.fragments;return Object.keys(o).forEach(function(t){t=o[t];t&&Nt(t)&&(i=t.body.start-a,r=t.body.end+a,i<=e)&&e<=r&&(i=Math.min(e-i,r-e),s<=i)&&(n=t.body,s=i)}),n},e.getState=function(t){t=Ut(t),t=this.fragments[t];return t?t.buffered?Nt(t)?h.PARTIAL:h.OK:h.APPENDING:h.NOT_LOADED},e.isTimeBuffered=function(t,e,i){for(var r,n,s=0;s<i.length;s++){if(r=i.start(s)-this.bufferPadding,n=i.end(s)+this.bufferPadding,r<=t&&e<=n)return!0;if(e<=r)return!1}return!1},e.onFragLoaded=function(t,e){var i=e.frag,r=e.part;"initSegment"===i.sn||i.bitrateTest||r||(r=Ut(i),this.fragments[r]={body:i,loaded:e,buffered:!1,range:Object.create(null)})},e.onBufferAppended=function(t,e){var r=this,n=e.frag,s=e.part,a=e.timeRanges;n.type===c.PlaylistLevelType.MAIN&&(this.activeFragment=n,s?((e=this.activeParts)||(this.activeParts=e=[]),e.push(s)):this.activeParts=null),this.timeRanges=a,Object.keys(a).forEach(function(t){var e=a[t];if(r.detectEvictedFragments(t,e),!s)for(var i=0;i<e.length;i++)n.appendedPTS=Math.max(e.end(i),n.appendedPTS||0)})},e.onFragBuffered=function(t,e){this.detectPartialFragments(e)},e.hasFragment=function(t){t=Ut(t);return!!this.fragments[t]},e.removeFragmentsInRange=function(e,i,r){var n=this;Object.keys(this.fragments).forEach(function(t){var t=n.fragments[t];t&&t.buffered&&(t=t.body).type===r&&t.start<i&&t.end>e&&n.removeFragment(t)})},e.removeFragment=function(t){var e=Ut(t);t.stats.loaded=0,t.clearElementaryStreamInfo(),delete this.fragments[e]},e.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},Mt);function Mt(t){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=t,this._registerListeners()}function Nt(t){var e;return t.buffered&&(null!=(e=t.range.video)&&e.partial||null!=(e=t.range.audio)&&e.partial)}function Ut(t){return t.type+"_"+t.level+"_"+t.urlId+"_"+t.sn}function Bt(t,e,i,r,n,s){void 0===r&&(r=0),void 0===n&&(n=-1),void 0===s&&(s=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=t,this.sn=e,this.id=i,this.size=r,this.part=n,this.partial=s}(e=jt.prototype).destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},e.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},e.onHandlerDestroyed=function(){},e.hasInterval=function(){return!!this._tickInterval},e.hasNextTick=function(){return!!this._tickTimer},e.setInterval=function(t){return!this._tickInterval&&(this._tickInterval=self.setInterval(this._boundTick,t),!0)},e.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),!(this._tickInterval=null))},e.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),!(this._tickTimer=null))},e.tick=function(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),1<this._tickCallCount&&this.tickImmediate(),this._tickCallCount=0)},e.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},e.doTick=function(){};var e=jt,Gt={length:0,start:function(){return 0},end:function(){return 0}},p=(a.isBuffered=function(t,e){try{if(t)for(var i=a.getBuffered(t),r=0;r<i.length;r++)if(e>=i.start(r)&&e<=i.end(r))return!0}catch(t){}return!1},a.bufferInfo=function(t,e,i){try{if(t){for(var r=a.getBuffered(t),n=[],s=0;s<r.length;s++)n.push({start:r.start(s),end:r.end(s)});return this.bufferedInfo(n,e,i)}}catch(t){}return{len:0,start:e,end:e,nextStart:void 0}},a.bufferedInfo=function(t,e,i){e=Math.max(0,e),t.sort(function(t,e){return t.start-e.start||e.end-t.end});var r=[];if(i)for(var n=0;n<t.length;n++){var s,a=r.length;a&&(s=r[a-1].end,t[n].start-s<i)?t[n].end>s&&(r[a-1].end=t[n].end):r.push(t[n])}else r=t;for(var o,l=0,h=e,u=e,d=0;d<r.length;d++){var c=r[d].start,f=r[d].end;if(c<=e+i&&e<f)h=c,l=(u=f)-e;else if(e+i<c){o=c;break}}return{len:l,start:h||0,end:u||0,nextStart:o}},a.getBuffered=function(t){try{return t.buffered}catch(t){return V.logger.log("failed to get media.buffered",t),Gt}},a);function a(){}function jt(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}function Ht(t,e){for(var i=null,r=0,n=t.length;r<n;r++){var s=t[r];if(s&&s.cc===e){i=s;break}}return i}function Kt(t,e){t&&(e=t.start+e,t.start=t.startPTS=e,t.endPTS=e+t.duration)}function Vt(t,e){for(var i=e.fragments,r=0,n=i.length;r<n;r++)Kt(i[r],t);e.fragmentHint&&Kt(e.fragmentHint,t),e.alignedSliding=!0}function Wt(t,e){var i,r,n;t.hasProgramDateTime&&e.hasProgramDateTime&&(i=t.fragments,e=e.fragments,i.length)&&e.length&&(i=Ht(i,(e=e[Math.round(e.length/2)-1]).cc)||i[Math.round(i.length/2)-1],r=e.programDateTime,n=i.programDateTime,null!==r)&&null!==n&&Vt((n-r)/1e3-(i.start-e.start),t)}const Yt=function(t,e){for(var i,r,n=0,s=t.length-1;n<=s;){var a=e(r=t[i=(n+s)/2|0]);if(0<a)n=1+i;else{if(!(a<0))return r;s=i-1}}return null};function qt(t,e,i,r){void 0===i&&(i=0),void 0===r&&(r=0);var n=null;return t?n=e[t.sn-e[0].sn+1]||null:0===i&&0===e[0].start&&(n=e[0]),(!n||0!==Xt(i,r,n))&&Yt(e,Xt.bind(null,i,r))||n}function Xt(t,e,i){void 0===t&&(t=0),void 0===e&&(e=0);e=Math.min(e,i.duration+(i.deltaPTS||0));return i.start+i.duration-e<=t?1:i.start-e>t&&i.start?-1:0}function zt(t){var i="function"==typeof Map?new Map:void 0;return(zt=function(t){if(null===t||-1===Function.toString.call(t).indexOf("[native code]"))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==i){if(i.has(t))return i.get(t);i.set(t,e)}function e(){return Zt(t,arguments,$t(this).constructor)}return e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Qt(e,t)})(t)}function Zt(t,e,i){return(Zt=function(){if("undefined"==typeof Reflect||!Reflect.construct)return;if(Reflect.construct.sham)return;if("function"==typeof Proxy)return 1;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),1}catch(t){}}()?Reflect.construct.bind():function(t,e,i){var r=[null],e=(r.push.apply(r,e),new(Function.bind.apply(t,r)));return i&&Qt(e,i.prototype),e}).apply(null,arguments)}function Qt(t,e){return(Qt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function $t(t){return($t=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Jt=Math.pow(2,17),te=((r=ee.prototype).destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},r.abort=function(){this.loader&&this.loader.abort()},r.load=function(a,o){var l=this,t=a.url;if(!t)return Promise.reject(new g({type:v.ErrorTypes.NETWORK_ERROR,details:v.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:a,networkDetails:null},"Fragment does not have a "+(t?"part list":"url")));this.abort();var i=this.config,h=i.fLoader,u=i.loader;return new Promise(function(n,r){l.loader&&l.loader.destroy();var s=l.loader=a.loader=new(h||u)(i),t=ie(a),e={timeout:i.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:i.fragLoadingMaxRetryTimeout,highWaterMark:"initSegment"===a.sn?1/0:Jt};a.stats=s.stats,s.load(t,e,{onSuccess:function(t,e,i,r){l.resetLoader(a,s),n({frag:a,part:null,payload:t.data,networkDetails:r})},onError:function(t,e,i){l.resetLoader(a,s),r(new g({type:v.ErrorTypes.NETWORK_ERROR,details:v.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:a,response:t,networkDetails:i}))},onAbort:function(t,e,i){l.resetLoader(a,s),r(new g({type:v.ErrorTypes.NETWORK_ERROR,details:v.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:a,networkDetails:i}))},onTimeout:function(t,e,i){l.resetLoader(a,s),r(new g({type:v.ErrorTypes.NETWORK_ERROR,details:v.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:a,networkDetails:i}))},onProgress:function(t,e,i,r){o&&o({frag:a,part:null,payload:i,networkDetails:r})}})})},r.loadPart=function(a,o,l){var h=this,i=(this.abort(),this.config),u=i.fLoader,d=i.loader;return new Promise(function(n,r){h.loader&&h.loader.destroy();var s=h.loader=a.loader=new(u||d)(i),t=ie(a,o),e={timeout:i.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:i.fragLoadingMaxRetryTimeout,highWaterMark:Jt};o.stats=s.stats,s.load(t,e,{onSuccess:function(t,e,i,r){h.resetLoader(a,s),h.updateStatsFromPart(a,o);t={frag:a,part:o,payload:t.data,networkDetails:r};l(t),n(t)},onError:function(t,e,i){h.resetLoader(a,s),r(new g({type:v.ErrorTypes.NETWORK_ERROR,details:v.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:a,part:o,response:t,networkDetails:i}))},onAbort:function(t,e,i){a.stats.aborted=o.stats.aborted,h.resetLoader(a,s),r(new g({type:v.ErrorTypes.NETWORK_ERROR,details:v.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:a,part:o,networkDetails:i}))},onTimeout:function(t,e,i){h.resetLoader(a,s),r(new g({type:v.ErrorTypes.NETWORK_ERROR,details:v.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:a,part:o,networkDetails:i}))}})})},r.updateStatsFromPart=function(t,e){var i=t.stats,r=e.stats,n=r.total,t=(i.loaded+=r.loaded,n?(n=((t=Math.round(t.duration/e.duration))-(e=Math.min(Math.round(i.loaded/n),t)))*Math.round(i.loaded/e),i.total=i.loaded+n):i.total=Math.max(i.loaded,i.total),i.loading),e=r.loading;t.start?t.first+=e.first-e.start:(t.start=e.start,t.first=e.first),t.end=e.end},r.resetLoader=function(t,e){t.loader=null,this.loader===e&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),e.destroy()},ee);function ee(t){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=t}function ie(t,e){var i=(e=void 0===e?null:e)||t,t={frag:t,part:e,responseType:"arraybuffer",url:i.url,headers:{},rangeStart:0,rangeEnd:0},e=i.byteRangeStartOffset,i=i.byteRangeEndOffset;return(0,K.isFiniteNumber)(e)&&(0,K.isFiniteNumber)(i)&&(t.rangeStart=e,t.rangeEnd=i),t}re=zt(Error),r=re,(i=se).prototype=Object.create(r.prototype),Qt(i.prototype.constructor=i,r);var re,g=se,ne=f(21);function se(t){for(var e,i=arguments.length,r=new Array(1<i?i-1:0),n=1;n<i;n++)r[n-1]=arguments[n];return(e=re.call.apply(re,[this].concat(r))||this).data=void 0,e.data=t,e}function ae(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function oe(t,e){return(oe=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}var d="STOPPED",m="IDLE",le="KEY_LOADING",he="FRAG_LOADING",ue="FRAG_LOADING_WAITING_RETRY",de="WAITING_TRACK",T="PARSING",ce="PARSED",fe="ENDED",S="ERROR",ge="WAITING_INIT_PTS",ve="WAITING_LEVEL",i=function(n){function t(t,e,i){var r;return(r=n.call(this)||this).hls=void 0,r.fragPrevious=null,r.fragCurrent=null,r.fragmentTracker=void 0,r.transmuxer=null,r._state=d,r.media=null,r.mediaBuffer=null,r.config=void 0,r.bitrateTest=!1,r.lastCurrentTime=0,r.nextLoadPosition=0,r.startPosition=0,r.loadedmetadata=!1,r.fragLoadError=0,r.retryDate=0,r.levels=null,r.fragmentLoader=void 0,r.levelLastLoaded=null,r.startFragRequested=!1,r.decrypter=void 0,r.initPTS=[],r.onvseeking=null,r.onvended=null,r.logPrefix="",r.log=void 0,r.warn=void 0,r.logPrefix=i,r.log=V.logger.log.bind(V.logger,i+":"),r.warn=V.logger.warn.bind(V.logger,i+":"),r.hls=t,r.fragmentLoader=new te(t.config),r.fragmentTracker=e,r.config=t.config,r.decrypter=new ne.default(t,t.config),t.on(y.Events.KEY_LOADED,r.onKeyLoaded,ae(r)),t.on(y.Events.LEVEL_SWITCHING,r.onLevelSwitching,ae(r)),r}e=n,(i=t).prototype=Object.create(e.prototype),oe(i.prototype.constructor=i,e);for(var e,i=t.prototype,r=(i.doTick=function(){this.onTickEnd()},i.onTickEnd=function(){},i.startLoad=function(t){},i.stopLoad=function(){this.fragmentLoader.abort();var t=this.fragCurrent;t&&this.fragmentTracker.removeFragment(t),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=d},i._streamEnded=function(t,e){var i=this.fragCurrent,r=this.fragmentTracker;return!(!(!e.live&&i&&this.media&&i.sn>=e.endSN)||t.nextStart)&&(null!=(t=e.partList)&&t.length?(e=t[t.length-1],p.isBuffered(this.media,e.start+e.duration/2)):(t=r.getState(i))===h.PARTIAL||t===h.OK)},i.onMediaAttached=function(t,e){e=this.media=this.mediaBuffer=e.media,this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),e.addEventListener("seeking",this.onvseeking),e.addEventListener("ended",this.onvended),e=this.config;this.levels&&e.autoStartLoad&&this.state===d&&this.startLoad(e.startPosition)},i.onMediaDetaching=function(){var t=this.media;null!=t&&t.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),t&&this.onvseeking&&this.onvended&&(t.removeEventListener("seeking",this.onvseeking),t.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},i.onMediaSeeking=function(){var t=this.config,e=this.fragCurrent,i=this.media,r=this.mediaBuffer,n=this.state,s=i?i.currentTime:0,r=p.bufferInfo(r||i,s,t.maxBufferHole);this.log("media seeking to "+((0,K.isFiniteNumber)(s)?s.toFixed(3):s)+", state: "+n),n===fe?this.resetLoadingState():e&&(n=t.maxFragLookUpTolerance,t=e.start-n,n=e.start+e.duration+n,!r.len||n<r.start||t>r.end)&&(n=n<s,s<t||n)&&(n&&e.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),e.loader.abort()),this.resetLoadingState()),i&&(this.lastCurrentTime=s),this.loadedmetadata||r.len||(this.nextLoadPosition=this.startPosition=s),this.tickImmediate()},i.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},i.onKeyLoaded=function(t,e){var i;this.state===le&&e.frag===this.fragCurrent&&this.levels&&(this.state=m,i=this.levels[e.frag.level].details)&&this.loadFragment(e.frag,i,e.frag.start)},i.onLevelSwitching=function(t,e){this.fragLoadError=0},i.onHandlerDestroying=function(){this.stopLoad(),n.prototype.onHandlerDestroying.call(this)},i.onHandlerDestroyed=function(){this.state=d,this.hls.off(y.Events.KEY_LOADED,this.onKeyLoaded,this),this.hls.off(y.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,n.prototype.onHandlerDestroyed.call(this)},i.loadKey=function(t,e){this.log("Loading key for "+t.sn+" of ["+e.startSN+"-"+e.endSN+"], "+("[stream-controller]"===this.logPrefix?"level":"track")+" "+t.level),this.state=le,this.fragCurrent=t,this.hls.trigger(y.Events.KEY_LOADING,{frag:t})},i.loadFragment=function(t,e,i){this._loadFragForPlayback(t,e,i)},i._loadFragForPlayback=function(i,t,e){var r=this;this._doFragLoad(i,t,e,function(t){r.fragContextChanged(i)?(r.warn("Fragment "+i.sn+(t.part?" p: "+t.part.index:"")+" of level "+i.level+" was dropped during download."),r.fragmentTracker.removeFragment(i)):(i.stats.chunkCount++,r._handleFragmentLoadProgress(t))}).then(function(t){var e;t&&(r.fragLoadError=0,e=r.state,r.fragContextChanged(i)?e!==he&&(r.fragCurrent||e!==T)||(r.fragmentTracker.removeFragment(i),r.state=m):("payload"in t&&(r.log("Loaded fragment "+i.sn+" of level "+i.level),r.hls.trigger(y.Events.FRAG_LOADED,t)),r._handleFragmentLoadComplete(t)))}).catch(function(t){r.state!==d&&r.state!==S&&(r.warn(t),r.resetFragmentLoading(i))})},i.flushMainBuffer=function(t,e,i){void 0===i&&(i=null),t-e&&(t={startOffset:t,endOffset:e,type:i},this.fragLoadError=0,this.hls.trigger(y.Events.BUFFER_FLUSHING,t))},i._loadInitSegment=function(s){var a=this;this._doFragLoad(s).then(function(t){if(t&&!a.fragContextChanged(s)&&a.levels)return t;throw new Error("init load aborted")}).then(function(i){var r,n=a.hls,t=i.payload,e=s.decryptdata;return t&&0<t.byteLength&&e&&e.key&&e.iv&&"AES-128"===e.method?(r=self.performance.now(),a.decrypter.webCryptoDecrypt(new Uint8Array(t),e.key.buffer,e.iv.buffer).then(function(t){var e=self.performance.now();return n.trigger(y.Events.FRAG_DECRYPTED,{frag:s,payload:t,stats:{tstart:r,tdecrypt:e}}),i.payload=t,i})):i}).then(function(t){var e=a.fragCurrent,i=a.hls,r=a.levels;if(!r)throw new Error("init load aborted, missing levels");r[s.level].details;r=s.stats;a.state=m,a.fragLoadError=0,s.data=new Uint8Array(t.payload),r.parsing.start=r.buffering.start=self.performance.now(),r.parsing.end=r.buffering.end=self.performance.now(),t.frag===e&&i.trigger(y.Events.FRAG_BUFFERED,{stats:r,frag:e,part:null,id:s.type}),a.tick()}).catch(function(t){a.state!==d&&a.state!==S&&(a.warn(t),a.resetFragmentLoading(s))})},i.fragContextChanged=function(t){var e=this.fragCurrent;return!t||!e||t.level!==e.level||t.sn!==e.sn||t.urlId!==e.urlId},i.fragBufferedComplete=function(t,e){var i=this.mediaBuffer||this.media;this.log("Buffered "+t.type+" sn: "+t.sn+(e?" part: "+e.index:"")+" of "+("[stream-controller]"===this.logPrefix?"level":"track")+" "+t.level+" "+(i?function(t){for(var e="",i=t.length,r=0;r<i;r++)e+="["+t.start(r).toFixed(3)+","+t.end(r).toFixed(3)+"]";return e}(p.getBuffered(i)):"(detached)")),this.state=m,i&&(!this.loadedmetadata&&t.type==c.PlaylistLevelType.MAIN&&i.buffered.length&&(null==(e=this.fragCurrent)?void 0:e.sn)===(null==(t=this.fragPrevious)?void 0:t.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())},i.seekToStartPos=function(){},i._handleFragmentLoadComplete=function(t){var e,i,r=this.transmuxer;r&&(i=t.frag,e=t.part,t=!(t=t.partsLoaded)||0===t.length||t.some(function(t){return!t}),i=new Bt(i.level,i.sn,i.stats.chunkCount+1,0,e?e.index:-1,!t),r.flush(i))},i._handleFragmentLoadProgress=function(t){},i._doFragLoad=function(t,e,i,r){var n=this;if(void 0===i&&(i=null),!this.levels)throw new Error("frag load aborted, missing levels");if(i=Math.max(t.start,i||0),this.config.lowLatencyMode&&e){var s=e.partList;if(s&&r){i>t.end&&e.fragmentHint&&(t=e.fragmentHint);var a,o=this.getNextPart(s,t,i);if(-1<o)return a=s[o],this.log("Loading part sn: "+t.sn+" p: "+a.index+" cc: "+t.cc+" of playlist ["+e.startSN+"-"+e.endSN+"] parts [0-"+o+"-"+(s.length-1)+"] "+("[stream-controller]"===this.logPrefix?"level":"track")+": "+t.level+", target: "+parseFloat(i.toFixed(3))),this.nextLoadPosition=a.start+a.duration,this.state=he,this.hls.trigger(y.Events.FRAG_LOADING,{frag:t,part:s[o],targetBufferTime:i}),this.doFragPartsLoad(t,s,o,r).catch(function(t){return n.handleFragLoadError(t)});if(!t.url||this.loadedEndOfParts(s,i))return Promise.resolve(null)}}return this.log("Loading fragment "+t.sn+" cc: "+t.cc+" "+(e?"of ["+e.startSN+"-"+e.endSN+"] ":"")+("[stream-controller]"===this.logPrefix?"level":"track")+": "+t.level+", target: "+parseFloat(i.toFixed(3))),(0,K.isFiniteNumber)(t.sn)&&!this.bitrateTest&&(this.nextLoadPosition=t.start+t.duration),this.state=he,this.hls.trigger(y.Events.FRAG_LOADING,{frag:t,targetBufferTime:i}),this.fragmentLoader.load(t,r).catch(function(t){return n.handleFragLoadError(t)})},i.doFragPartsLoad=function(o,l,e,h){var u=this;return new Promise(function(s,t){var a=[];!function i(r){var n=l[r];u.fragmentLoader.loadPart(o,n,h).then(function(t){var e=(a[n.index]=t).part,t=(u.hls.trigger(y.Events.FRAG_LOADED,t),l[r+1]);if(!t||t.fragment!==o)return s({frag:o,part:e,partsLoaded:a});i(r+1)}).catch(t)}(e)})},i.handleFragLoadError=function(t){t=t.data;return t&&t.details===v.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):this.hls.trigger(y.Events.ERROR,t),null},i._handleTransmuxerFlush=function(t){var e,i,r,n=this.getCurrentContext(t);n&&this.state===T?(e=n.frag,i=n.part,n=n.level,r=self.performance.now(),e.stats.parsing.end=r,i&&(i.stats.parsing.end=r),this.updateLevelTiming(e,i,n,t.partial)):this.fragCurrent||(this.state=m)},i.getCurrentContext=function(t){var e,i,r,n=this.levels,s=t.level,a=t.sn,t=t.part;return n&&n[s]?(n=n[s],(r=(t=-1<t?function(t,e,i){if(t&&t.details){var r=t.details.partList;if(r)for(var n=r.length;n--;){var s=r[n];if(s.index===i&&s.fragment.sn===e)return s}}return null}(n,a,t):null)?t.fragment:(e=this.fragCurrent,n&&n.details?(i=n.details).fragments[a-i.startSN]||((r=i.fragmentHint)&&r.sn===a?r:a<i.startSN&&e&&e.sn===a?e:null):null))?{frag:r,part:t,level:n}:null):(this.warn("Levels object was unset while buffering fragment "+a+" of level "+s+". The current chunk will not be buffered."),null)},i.bufferFragmentData=function(t,e,i,r){var n,s,a;t&&this.state===T&&(a=t.data1,n=t.data2,s=(s=a)&&n?(0,x.appendUint8Array)(a,n):s)&&s.length&&(a={type:t.type,frag:e,part:i,chunkMeta:r,parent:e.type,data:s},this.hls.trigger(y.Events.BUFFER_APPENDING,a),t.dropped)&&t.independent&&!i&&this.flushBufferGap(e)},i.flushBufferGap=function(t){var e,i,r=this.media;r&&(p.isBuffered(r,r.currentTime)?(e=r.currentTime,r=p.bufferInfo(r,e,0),i=t.duration,i=Math.min(2*this.config.maxFragLookUpTolerance,.25*i),r=Math.max(Math.min(t.start-i,r.end-i),e+i),t.start-r>i&&this.flushMainBuffer(r,t.start)):this.flushMainBuffer(0,t.start))},i.getFwdBufferInfo=function(t,e){var i=this.config,r=this.getLoadPosition();if(!(0,K.isFiniteNumber)(r))return null;var n=p.bufferInfo(t,r,i.maxBufferHole);if(0===n.len&&void 0!==n.nextStart){e=this.fragmentTracker.getBufferedFrag(r,e);if(e&&n.nextStart<e.end)return p.bufferInfo(t,r,Math.max(n.nextStart,i.maxBufferHole))}return n},i.getMaxBufferLength=function(t){var e=this.config,t=t?Math.max(8*e.maxBufferSize/t,e.maxBufferLength):e.maxBufferLength;return Math.min(t,e.maxMaxBufferLength)},i.reduceMaxBufferLength=function(t){var e=this.config,t=t||e.maxBufferLength;return e.maxMaxBufferLength>=t&&(e.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+e.maxMaxBufferLength+"s"),!0)},i.getNextFragment=function(t,e){var i=e.fragments,r=i.length;if(!r)return null;var n,s=this.config,a=i[0].start;if(e.live){var o=s.initialLiveManifestSize;if(r<o)return this.warn("Not enough fragments to start playback (have: "+r+", need: "+o+")"),null;e.PTSKnown||this.startFragRequested||-1!==this.startPosition||(n=this.getInitialLiveFragment(e,i),this.startPosition=n?this.hls.liveSyncPosition||n.start:t)}else t<=a&&(n=i[0]);return n||(r=s.lowLatencyMode?e.partEnd:e.fragmentEnd,n=this.getFragmentAtPosition(t,r,e)),this.mapToInitFragWhenRequired(n)},i.mapToInitFragWhenRequired=function(t){return null==t||!t.initSegment||null!=t&&t.initSegment.data||this.bitrateTest?t:t.initSegment},i.getNextPart=function(t,e,i){for(var r=-1,n=!1,s=!0,a=0,o=t.length;a<o;a++){var l=t[a],s=s&&!l.independent;if(-1<r&&i<l.start)break;var h=l.loaded;!h&&(n||l.independent||s)&&l.fragment===e&&(r=a),n=h}return r},i.loadedEndOfParts=function(t,e){t=t[t.length-1];return t&&e>t.start&&t.loaded},i.getInitialLiveFragment=function(t,e){var i,r,n=this.fragPrevious,s=null;return n?(t.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+n.programDateTime),s=function(t,e,i){if(null!==e&&Array.isArray(t)&&t.length&&(0,K.isFiniteNumber)(e)&&!(e<(t[0].programDateTime||0)||e>=(t[t.length-1].endProgramDateTime||0))){i=i||0;for(var r,n,s,a=0;a<t.length;++a){var o=t[a];if(r=e,n=i,s=o,n=1e3*Math.min(i,s.duration+(s.deltaPTS||0)),(s.endProgramDateTime||0)-n>r)return o}}return null}(e,n.endProgramDateTime,this.config.maxFragLookUpTolerance)),s||((i=n.sn+1)>=t.startSN&&i<=t.endSN&&(i=e[i-t.startSN],n.cc===i.cc)&&this.log("Live playlist, switching playlist, load frag with next SN: "+(s=i).sn),!s&&(i=e,r=n.cc,s=Yt(i,function(t){return t.cc<r?1:t.cc>r?-1:0}))&&this.log("Live playlist, switching playlist, load frag with same CC: "+s.sn))):null!==(e=this.hls.liveSyncPosition)&&(s=this.getFragmentAtPosition(e,this.bitrateTest?t.fragmentEnd:t.edge,t)),s},i.getFragmentAtPosition=function(t,e,i){var r=this.config,n=this.fragPrevious,s=i.fragments,a=i.endSN,o=i.fragmentHint,l=r.maxFragLookUpTolerance,r=!!(r.lowLatencyMode&&i.partList&&o);return r&&o&&!this.bitrateTest&&(s=s.concat(o),a=o.sn),(o=t<e?qt(n,s,t,e-l<t?0:l):s[s.length-1])&&(e=o.sn-i.startSN,n=this.fragmentTracker.getState(o)===h.OK?o:n)&&o.sn===n.sn&&!r&&n&&o.level===n.level&&(t=s[1+e],o=o.sn<a&&this.fragmentTracker.getState(t)!==h.OK?(this.log("SN "+o.sn+" just loaded, load next one: "+t.sn),t):null),o},i.synchronizeToLiveEdge=function(t){var e,i,r,n,s=this.config,a=this.media;a&&(e=this.hls.liveSyncPosition,i=a.currentTime,n=t.fragments[0].start,r=t.edge,n=i>=n-s.maxFragLookUpTolerance&&i<=r,null!==e)&&a.duration>e&&(i<e||!n)&&(s=void 0!==s.liveMaxLatencyDuration?s.liveMaxLatencyDuration:s.liveMaxLatencyDurationCount*t.targetduration,!n&&a.readyState<4||i<r-s)&&(this.loadedmetadata||(this.nextLoadPosition=e),a.readyState)&&(this.warn("Playback: "+i.toFixed(3)+" is located too far from the end of live sliding playlist: "+r+", reset currentTime to : "+e.toFixed(3)),a.currentTime=e)},i.alignPlaylists=function(t,e){var i,r,n,s,a,o,l,h,u=this.levels,d=this.levelLastLoaded,c=this.fragPrevious,u=null!==d?u[d]:null,d=t.fragments.length;return d?(i=t.fragments[0].start,n=!e,r=t.alignedSliding&&(0,K.isFiniteNumber)(i),n||!r&&!i?(n=t,(r=u)&&(u=c,l=n,(h=r).details&&(l.endCC>l.startCC||u&&u.cc<l.startCC)&&(u=function(){var t=h.details.fragments,e=l.fragments;if(e.length&&t.length){t=Ht(t,e[0].cc);if(t&&(!t||t.startPTS))return t;V.logger.log("No frag in previous level to align on")}else V.logger.log("No fragments to align")}())&&(0,K.isFiniteNumber)(u.start)&&(V.logger.log("Adjusting PTS using last level due to CC increase within current level "+l.url),Vt(u.start,l)),!n.alignedSliding&&r.details&&(u=n,(s=r.details).fragments.length&&u.hasProgramDateTime&&s.hasProgramDateTime&&(a=s.fragments[0].programDateTime,s=((o=u.fragments[0].programDateTime)-a)/1e3+s.fragments[0].start)&&(0,K.isFiniteNumber)(s)&&(V.logger.log("Adjusting PTS using programDateTime delta "+(o-a)+"ms, sliding:"+s.toFixed(3)+" "+u.url+" "),Vt(s,u))),n.alignedSliding||!r.details||n.skippedSegments||_t(r.details,n)),o=t.fragments[0].start,this.log("Live playlist sliding: "+o.toFixed(2)+" start-sn: "+(e?e.startSN:"na")+"->"+t.startSN+" prev-sn: "+(c?c.sn:"na")+" fragments: "+d),o):i):(this.warn("No fragments in live playlist"),0)},i.waitForCdnTuneIn=function(t){return t.live&&t.canBlockReload&&t.partTarget&&t.tuneInGoal>Math.max(t.partHoldBack,3*t.partTarget)},i.setStartPosition=function(t,e){var i,r=this.startPosition;-1!==(r=r<e?-1:r)&&-1!==this.lastCurrentTime||(i=t.startTimeOffset,(0,K.isFiniteNumber)(i)?(r=e+i,i<0&&(r+=t.totalduration),r=Math.min(Math.max(e,r),e+t.totalduration),this.log("Start time offset "+i+" found in playlist, adjust startPosition to "+r),this.startPosition=r):t.live?r=this.hls.liveSyncPosition||e:this.startPosition=r=0,this.lastCurrentTime=r),this.nextLoadPosition=r},i.getLoadPosition=function(){var t=this.media,e=0;return this.loadedmetadata&&t?e=t.currentTime:this.nextLoadPosition&&(e=this.nextLoadPosition),e},i.handleFragLoadAborted=function(t,e){this.transmuxer&&"initSegment"!==t.sn&&t.stats.aborted&&(this.warn("Fragment "+t.sn+(e?" part"+e.index:"")+" of level "+t.level+" was aborted"),this.resetFragmentLoading(t))},i.resetFragmentLoading=function(t){this.fragCurrent&&(this.fragContextChanged(t)||this.state===ue)||(this.state=m)},i.onFragmentOrKeyLoadError=function(t,e){var i,r;e.fatal||(i=e.frag)&&i.type===t&&(this.fragCurrent,r=this.config,this.fragLoadError+1<=r.fragLoadingMaxRetry?(this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),r=Math.min(Math.pow(2,this.fragLoadError)*r.fragLoadingRetryDelay,r.fragLoadingMaxRetryTimeout),this.warn("Fragment "+i.sn+" of "+t+" "+i.level+" failed to load, retrying in "+r+"ms"),this.retryDate=self.performance.now()+r,this.fragLoadError++,this.state=ue):e.levelRetry?(t===c.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=m):(V.logger.error(e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.hls.stopLoad(),this.state=S))},i.afterBufferFlushed=function(t,e,i){t&&(t=p.getBuffered(t),this.fragmentTracker.detectEvictedFragments(e,t,i),this.state===fe)&&this.resetLoadingState()},i.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=m},i.resetStartWhenNotLoaded=function(t){this.loadedmetadata||(this.startFragRequested=!1,null!=(t=this.levels?this.levels[t].details:null)&&t.live?(this.startPosition=-1,this.setStartPosition(t,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition)},i.updateLevelTiming=function(n,t,s,a){var o=this,l=s.details;Object.keys(n.elementaryStreams).reduce(function(t,e){var i,r=n.elementaryStreams[e];return r?(i=r.endPTS-r.startPTS)<=0?(o.warn("Could not parse fragment "+n.sn+" "+e+" duration reliably ("+i+")"),t||!1):(i=a?0:At(l,n,r.startPTS,r.endPTS,r.startDTS,r.endDTS),o.hls.trigger(y.Events.LEVEL_PTS_UPDATED,{details:l,level:s,drift:i,type:e,frag:n,start:r.startPTS,end:r.endPTS}),!0):t},!1)||(this.warn("Found no media in fragment "+n.sn+" of level "+s.id+" resetting transmuxer to fallback to playlist timing"),this.resetTransmuxer()),this.state=ce,this.hls.trigger(y.Events.FRAG_PARSED,{frag:n,part:t})},i.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},(e=t).prototype),s=[{key:"state",get:function(){return this._state},set:function(t){var e=this._state;e!==t&&(this._state=t,this.log(e+"->"+t))}}],a=0;a<s.length;a++){var o=s[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(r,o.key,o)}return Object.defineProperty(e,"prototype",{writable:!1}),t}(e);function pe(){return self.MediaSource||self.WebKitMediaSource}function me(){return self.SourceBuffer||self.WebKitSourceBuffer}var Te=function(){function r(t){var e=n[t];return void 0!==e||(e=n[t]={exports:{}},i[t].call(e.exports,e,e.exports,r)),e.exports}var i=ENTRY_MODULE,n={},t=(r.m=i,r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,{a:e}),e},r.d=function(t,e){for(var i in e)r.o(e,i)&&!r.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r(ENTRY_MODULE));return t.default||t}.toString().split("ENTRY_MODULE"),ye="\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)";function Ee(t){return(t+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function Se(t,e,i,r){t=t[r].map(function(t){return'"'+t+'": '+e[r][t].toString().replace(/^"[^"]+"/,"function")}).join(",");return Te[0]+"{"+t+"}"+Te[1]+'"'+i+'"'+Te[2]}var be=f(544),Le=f(729),ke=pe()||{isTypeSupported:function(){return!1}},De=((r=_e.prototype).destroy=function(){var t=this.worker,t=(t?(t.removeEventListener("message",this.onwmsg),t.terminate(),this.worker=null,this.onwmsg=void 0):(t=this.transmuxer)&&(t.destroy(),this.transmuxer=null),this.observer);t&&t.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null},r.push=function(t,e,i,r,n,s,a,o,l,h){var u=this,d=(l.transmuxing.start=self.performance.now(),this.transmuxer),c=this.worker,f=(s||n).start,g=n.decryptdata,v=this.frag,p=!(v&&n.cc===v.cc),m=!(v&&l.level===v.level),T=v?l.sn-v.sn:-1,y=this.part?l.part-this.part.index:-1,E=0==T&&1<l.id&&l.id===(null==v?void 0:v.stats.chunkCount),E=!m&&(1==T||0==T&&(1==y||E&&y<=0)),S=self.performance.now(),S=((m||T||0===n.stats.parsing.start)&&(n.stats.parsing.start=S),!s||!y&&E||(s.stats.parsing.start=S),!(v&&(null==(T=n.initSegment)?void 0:T.url)===(null==(y=v.initSegment)?void 0:y.url))),T=new be.TransmuxState(p,E,o,m,f,S);E&&!p&&!S||(V.logger.log("[transmuxer-interface, "+n.type+"]: Starting new transmux session for sn: "+l.sn+" p: "+l.part+" level: "+l.level+" id: "+l.id+"\n        discontinuity: "+p+"\n        trackSwitch: "+m+"\n        contiguous: "+E+"\n        accurateTimeOffset: "+o+"\n        timeOffset: "+f+"\n        initSegmentChange: "+S),v=new be.TransmuxConfig(i,r,e,a,h),this.configureTransmuxer(v)),this.frag=n,this.part=s,c?c.postMessage({cmd:"demux",data:t,decryptdata:g,chunkMeta:l,state:T},t instanceof ArrayBuffer?[t]:[]):d&&(y=d.push(t,g,l,T),(0,be.isPromise)(y)?y.then(function(t){u.handleTransmuxComplete(t)}):this.handleTransmuxComplete(y))},r.flush=function(e){var i=this,t=(e.transmuxing.start=self.performance.now(),this.transmuxer),r=this.worker;r?r.postMessage({cmd:"flush",chunkMeta:e}):t&&(r=t.flush(e),(0,be.isPromise)(r)?r.then(function(t){i.handleFlushResult(t,e)}):this.handleFlushResult(r,e))},r.handleFlushResult=function(t,e){var i=this;t.forEach(function(t){i.handleTransmuxComplete(t)}),this.onFlush(e)},r.onWorkerMessage=function(t){var e=t.data,i=this.hls;switch(e.event){case"init":self.URL.revokeObjectURL(this.worker.objectURL);break;case"transmuxComplete":this.handleTransmuxComplete(e.data);break;case"flush":this.onFlush(e.data);break;case"workerLog":V.logger[e.data.logType]&&V.logger[e.data.logType](e.data.message);break;default:e.data=e.data||{},e.data.frag=this.frag,e.data.id=this.id,i.trigger(e.event,e.data)}},r.configureTransmuxer=function(t){var e=this.worker,i=this.transmuxer;e?e.postMessage({cmd:"configure",config:t}):i&&i.configure(t)},r.handleTransmuxComplete=function(t){t.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(t)},_e),Re=((e=Ae.prototype).destroy=function(){this.media=null,this.hls=this.fragmentTracker=null},e.poll=function(t,e){var i=this.config,r=this.media,n=this.stalled;if(null!==r){var s=r.currentTime,a=r.seeking,o=this.seeking&&!a,l=!this.seeking&&a;if(this.seeking=a,s===t){if((l||o)&&(this.stalled=null),!(r.paused&&!a||r.ended||0===r.playbackRate)&&p.getBuffered(r).length){t=p.bufferInfo(r,s,0),l=0<t.len,o=t.nextStart||0;if(l||o){if(a){l=2<t.len,e=!o||e&&e.start<=s||2<o-s&&!this.fragmentTracker.getPartialFragment(s);if(l||e)return;this.moved=!1}if(!this.moved&&null!==this.stalled){l=Math.max(o,t.start||0)-s,e=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,o=null!=e&&null!=(o=e.details)&&o.live?2*e.details.targetduration:2;if(0<l&&l<=o)return void this._trySkipBufferHole(null)}e=self.performance.now();null!==n?(l=e-n,!a&&250<=l&&(this._reportStall(t),!this.media)||(o=p.bufferInfo(r,s,i.maxBufferHole),this._tryFixBufferStall(o,l))):this.stalled=e}}}else this.moved=!0,null!==n&&(this.stallReported&&(a=self.performance.now()-n,V.logger.warn("playback not stuck anymore @"+s+", after "+Math.round(a)+"ms"),this.stallReported=!1),this.stalled=null,this.nudgeRetry=0)}},e._tryFixBufferStall=function(t,e){var i=this.config,r=this.fragmentTracker,n=this.media;null!==n&&(n=n.currentTime,!(r=r.getPartialFragment(n))||!this._trySkipBufferHole(r)&&this.media)&&t.len>i.maxBufferHole&&e>1e3*i.highBufferWatchdogPeriod&&(V.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())},e._reportStall=function(t){var e=this.hls,i=this.media;!this.stallReported&&i&&(this.stallReported=!0,V.logger.warn("Playback stalling at @"+i.currentTime+" due to low buffer ("+JSON.stringify(t)+")"),e.trigger(y.Events.ERROR,{type:v.ErrorTypes.MEDIA_ERROR,details:v.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:t.len}))},e._trySkipBufferHole=function(t){var e=this.config,i=this.hls,r=this.media;if(null!==r)for(var n=r.currentTime,s=0,a=p.getBuffered(r),o=0;o<a.length;o++){var l=a.start(o);if(n+e.maxBufferHole>=s&&n<l)return l=Math.max(l+.05,r.currentTime+.1),V.logger.warn("skipping hole, adjusting currentTime from "+n+" to "+l),this.moved=!0,this.stalled=null,r.currentTime=l,t&&i.trigger(y.Events.ERROR,{type:v.ErrorTypes.MEDIA_ERROR,details:v.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+n+" to "+l,frag:t}),l;s=a.end(o)}return 0},e._tryNudgeBuffer=function(){var t,e=this.config,i=this.hls,r=this.media,n=this.nudgeRetry;null!==r&&(t=r.currentTime,this.nudgeRetry++,n<e.nudgeMaxRetry?(n=t+(n+1)*e.nudgeOffset,V.logger.warn("Nudging 'currentTime' from "+t+" to "+n),r.currentTime=n,i.trigger(y.Events.ERROR,{type:v.ErrorTypes.MEDIA_ERROR,details:v.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})):(V.logger.error("Playhead still not moving while enough data buffered @"+t+" after "+e.nudgeMaxRetry+" nudges"),i.trigger(y.Events.ERROR,{type:v.ErrorTypes.MEDIA_ERROR,details:v.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})))},Ae);function Ae(t,e,i,r){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=t,this.media=e,this.fragmentTracker=i,this.hls=r}function _e(t,e,i,r){function n(t,e){(e=e||{}).frag=d.frag,e.id=d.id,d.hls.trigger(t,e)}var s,a,o,l,h,u,d=this,c=(this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,t.config),i=(this.hls=t,this.id=e,this.useWorker=!!c.enableWorker,this.onTransmuxComplete=i,this.onFlush=r,this.observer=new Le.EventEmitter,this.observer.on(y.Events.FRAG_DECRYPTED,n),this.observer.on(y.Events.ERROR,n),{mp4:ke.isTypeSupported("video/mp4"),mpeg:ke.isTypeSupported("audio/mpeg"),mp3:ke.isTypeSupported('audio/mp4; codecs="mp3"')}),r=navigator.vendor;if(this.useWorker&&"undefined"!=typeof Worker){V.logger.log("demuxing in webworker");try{s=this.worker=(a={main:f.m},o={}.all?{main:Object.keys(a.main)}:function(t){for(var e={main:[182]},i={main:[]},r={main:{}};function(i){return Object.keys(i).reduce(function(t,e){return t||0<i[e].length},!1)}(e);)for(var n=Object.keys(e),s=0;s<n.length;s++){var a=n[s],o=e[a].pop();if(r[a]=r[a]||{},!r[a][o]&&t[a][o]){r[a][o]=!0,i[a]=i[a]||[],i[a].push(o);for(var l=function(t,e,i){var r={},n=(r[i]=[],e.toString().replace(/^"[^"]+"/,"function"));if(e=n.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/)||n.match(/^\(\w+,\s*\w+,\s*(\w+)\)\s?\=\s?\>/)){for(var s,e=e[1],a=new RegExp("(\\\\n|\\W)"+Ee(e)+ye,"g");s=a.exec(n);)"dll-reference"!==s[3]&&r[i].push(s[3]);for(a=new RegExp("\\("+Ee(e)+'\\("(dll-reference\\s([\\.|\\-|\\+|\\w|/|@]+))"\\)\\)'+ye,"g");s=a.exec(n);)t[s[2]]||(r[i].push(s[1]),t[s[2]]=f(s[1]).m),r[s[2]]=r[s[2]]||[],r[s[2]].push(s[4]);for(var o,l=Object.keys(r),h=0;h<l.length;h++)for(var u=0;u<r[l[h]].length;u++)o=r[l[h]][u],isNaN(+o)||(r[l[h]][u]=+r[l[h]][u])}return r}(t,t[a][o],a),h=Object.keys(l),u=0;u<h.length;u++)e[h[u]]=e[h[u]]||[],e[h[u]]=e[h[u]].concat(l[h[u]])}}return i}(a),l="",Object.keys(o).filter(function(t){return"main"!==t}).forEach(function(t){for(var e=0;o[t][e];)e++;o[t].push(e),a[t][e]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",l=l+"var "+t+" = ("+Se(o,a,e,modules)+")();\n"}),l=l+"new (("+Se(o,a,182,"main")+")())(self);",h=new window.Blob([l],{type:"text/javascript"}),h=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(h),(u=new window.Worker(h)).objectURL=h,u),this.onwmsg=this.onWorkerMessage.bind(this),s.addEventListener("message",this.onwmsg),s.onerror=function(t){d.useWorker=!1,V.logger.warn("Exception in webworker, fallback to inline"),d.hls.trigger(y.Events.ERROR,{type:v.ErrorTypes.OTHER_ERROR,details:v.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:new Error(t.message+"  ("+t.filename+":"+t.lineno+")")})},s.postMessage({cmd:"init",typeSupported:i,vendor:r,id:e,config:JSON.stringify(c)})}catch(t){V.logger.warn("Error in worker:",t),V.logger.error("Error while initializing DemuxerWorker, fallback to inline"),s&&self.URL.revokeObjectURL(s.objectURL),this.transmuxer=new be.default(this.observer,i,c,r,e),this.worker=null}}else this.transmuxer=new be.default(this.observer,i,c,r,e)}function Ie(t,e){return(Ie=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}var Ce=function(n){function t(t,e){return(t=n.call(this,t,e,"[stream-controller]")||this).audioCodecSwap=!1,t.gapController=null,t.level=-1,t._forceStartLoad=!1,t.altAudio=!1,t.audioOnly=!1,t.fragPlaying=null,t.onvplaying=null,t.onvseeked=null,t.fragLastKbps=0,t.couldBacktrack=!1,t.backtrackFragment=null,t.audioCodecSwitch=!1,t.videoBuffer=null,t._registerListeners(),t}e=n,(i=t).prototype=Object.create(e.prototype),Ie(i.prototype.constructor=i,e);for(var e,i=t.prototype,r=(i._registerListeners=function(){var t=this.hls;t.on(y.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(y.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(y.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(y.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(y.Events.LEVEL_LOADING,this.onLevelLoading,this),t.on(y.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.on(y.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.on(y.Events.ERROR,this.onError,this),t.on(y.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(y.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.on(y.Events.BUFFER_CREATED,this.onBufferCreated,this),t.on(y.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(y.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(y.Events.FRAG_BUFFERED,this.onFragBuffered,this)},i._unregisterListeners=function(){var t=this.hls;t.off(y.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(y.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(y.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(y.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.off(y.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.off(y.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.off(y.Events.ERROR,this.onError,this),t.off(y.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(y.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.off(y.Events.BUFFER_CREATED,this.onBufferCreated,this),t.off(y.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(y.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(y.Events.FRAG_BUFFERED,this.onFragBuffered,this)},i.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},i.startLoad=function(t){var e,i,r;this.levels?(e=this.lastCurrentTime,i=this.hls,this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,this.startFragRequested||(-1===(r=i.startLevel)&&(i.config.testBandwidth&&1<this.levels.length?this.bitrateTest=!(r=0):r=i.nextAutoLevel),this.level=i.nextLoadLevel=r,this.loadedmetadata=!1),0<e&&-1===t&&(this.log("Override startPosition with lastCurrentTime @"+e.toFixed(3)),t=e),this.state=m,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()):(this._forceStartLoad=!0,this.state=d)},i.stopLoad=function(){this._forceStartLoad=!1,n.prototype.stopLoad.call(this)},i.doTick=function(){switch(this.state){case m:this.doTickIdle();break;case ve:var t=this.levels,e=this.level,e=null==t||null==(t=t[e])?void 0:t.details;if(e&&(!e.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(e))break;this.state=m}break;case ue:t=self.performance.now(),e=this.retryDate;(!e||e<=t||null!=(e=this.media)&&e.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.level),this.state=m)}this.onTickEnd()},i.onTickEnd=function(){n.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},i.doTickIdle=function(){var t=this.hls,e=this.levelLastLoaded,i=this.levels,r=this.media,n=t.config,s=t.nextLoadLevel;null===e||!(r||!this.startFragRequested&&n.startFragPrefetch)||this.altAudio&&this.audioOnly||!i||!i[s]||(e=i[s],this.level=t.nextLoadLevel=s,!(n=e.details)||this.state===ve||n.live&&this.levelLastLoaded!==s?this.state=ve:null===(i=this.getMainFwdBufferInfo())||i.len>=this.getMaxBufferLength(e.maxBitrate)||(this._streamEnded(i,n)?(t={},this.altAudio&&(t.type="video"),this.hls.trigger(y.Events.BUFFER_EOS,t),this.state=fe):(this.backtrackFragment&&this.backtrackFragment.start>i.end&&(this.backtrackFragment=null),s=this.backtrackFragment?this.backtrackFragment.start:i.end,e=this.getNextFragment(s,n),this.couldBacktrack&&!this.fragPrevious&&e&&"initSegment"!==e.sn&&this.fragmentTracker.getState(e)!==h.OK?(t=(null!=(t=this.backtrackFragment)?t:e).sn-n.startSN,(t=n.fragments[t-1])&&e.cc===t.cc&&this.fragmentTracker.removeFragment(e=t)):this.backtrackFragment&&i.len&&(this.backtrackFragment=null),e&&this.fragmentTracker.getState(e)===h.OK&&this.nextLoadPosition>s&&(t=this.audioOnly&&!this.altAudio?B.ElementaryStreamTypes.AUDIO:B.ElementaryStreamTypes.VIDEO,r&&this.afterBufferFlushed(r,t,c.PlaylistLevelType.MAIN),e=this.getNextFragment(this.nextLoadPosition,n)),e&&("identity"!==(null==(i=(e=!e.initSegment||e.initSegment.data||this.bitrateTest?e:e.initSegment).decryptdata)?void 0:i.keyFormat)||null!=(r=e.decryptdata)&&r.key?this.loadFragment(e,n,s):this.loadKey(e,n)))))},i.loadFragment=function(t,e,i){var r=this.fragmentTracker.getState(t);this.fragCurrent=t,r===h.NOT_LOADED?"initSegment"===t.sn?this._loadInitSegment(t):this.bitrateTest?(this.log("Fragment "+t.sn+" of level "+t.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(t)):(this.startFragRequested=!0,n.prototype.loadFragment.call(this,t,e,i)):r===h.APPENDING?this.reduceMaxBufferLength(t.duration)&&this.fragmentTracker.removeFragment(t):0===(null==(e=this.media)?void 0:e.buffered.length)&&this.fragmentTracker.removeAllFragments()},i.getAppendedFrag=function(t){t=this.fragmentTracker.getAppendedFrag(t,c.PlaylistLevelType.MAIN);return t&&"fragment"in t?t.fragment:t},i.getBufferedFrag=function(t){return this.fragmentTracker.getBufferedFrag(t,c.PlaylistLevelType.MAIN)},i.followingBufferedFrag=function(t){return t?this.getBufferedFrag(t.end+.5):null},i.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},i.nextLevelSwitch=function(){var t,e=this.levels,i=this.media;null!=i&&i.readyState&&((t=this.getAppendedFrag(i.currentTime))&&1<t.start&&this.flushMainBuffer(0,t.start-1),t=!i.paused&&e&&(t=e[this.hls.nextLoadLevel],e=this.fragLastKbps)&&this.fragCurrent?this.fragCurrent.duration*t.maxBitrate/(1e3*e)+1:0,e=this.getBufferedFrag(i.currentTime+t))&&(i=this.followingBufferedFrag(e))&&(this.abortCurrentFrag(),t=i.maxStartPTS||i.start,i=i.duration,e=Math.max(e.end,t+Math.min(Math.max(i-this.config.maxFragLookUpTolerance,.5*i),.75*i)),this.flushMainBuffer(e,Number.POSITIVE_INFINITY))},i.abortCurrentFrag=function(){var t=this.fragCurrent;switch(this.fragCurrent=null,(this.backtrackFragment=null)!=t&&t.loader&&t.loader.abort(),this.state){case le:case he:case ue:case T:case ce:this.state=m}this.nextLoadPosition=this.getLoadPosition()},i.flushMainBuffer=function(t,e){n.prototype.flushMainBuffer.call(this,t,e,this.altAudio?"video":null)},i.onMediaAttached=function(t,e){n.prototype.onMediaAttached.call(this,t,e);t=e.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),t.addEventListener("playing",this.onvplaying),t.addEventListener("seeked",this.onvseeked),this.gapController=new Re(this.config,t,this.fragmentTracker,this.hls)},i.onMediaDetaching=function(){var t=this.media;t&&this.onvplaying&&this.onvseeked&&(t.removeEventListener("playing",this.onvplaying),t.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),n.prototype.onMediaDetaching.call(this)},i.onMediaPlaying=function(){this.tick()},i.onMediaSeeked=function(){var t=this.media,t=t?t.currentTime:null;(0,K.isFiniteNumber)(t)&&this.log("Media seeked to "+t.toFixed(3)),this.tick()},i.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(y.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null,this.backtrackFragment=null},i.onManifestParsed=function(t,e){var i,r,n=!1,s=!1;e.levels.forEach(function(t){(i=t.audioCodec)&&(-1!==i.indexOf("mp4a.40.2")&&(n=!0),-1!==i.indexOf("mp4a.40.5"))&&(s=!0)}),this.audioCodecSwitch=n&&s&&!("function"==typeof(null==(r=me())||null==(r=r.prototype)?void 0:r.changeType)),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=e.levels,this.startFragRequested=!1},i.onLevelLoading=function(t,e){var i=this.levels;i&&this.state===m&&(!(i=i[e.level]).details||i.details.live&&this.levelLastLoaded!==e.level||this.waitForCdnTuneIn(i.details))&&(this.state=ve)},i.onLevelLoaded=function(t,e){var i=this.levels,r=e.level,n=e.details,s=n.totalduration;if(i){this.log("Level "+r+" loaded ["+n.startSN+","+n.endSN+"], cc ["+n.startCC+", "+n.endCC+"] duration:"+s);s=this.fragCurrent,e=(!s||this.state!==he&&this.state!==ue||s.level!==e.level&&s.loader&&(this.state=m,this.backtrackFragment=null,s.loader.abort()),i[r]),s=0;if(n.live||null!=(i=e.details)&&i.live){if(n.fragments[0]||(n.deltaUpdateFailed=!0),n.deltaUpdateFailed)return;s=this.alignPlaylists(n,e.details)}if(e.details=n,this.levelLastLoaded=r,this.hls.trigger(y.Events.LEVEL_UPDATED,{details:n,level:r}),this.state===ve){if(this.waitForCdnTuneIn(n))return;this.state=m}this.startFragRequested?n.live&&this.synchronizeToLiveEdge(n):this.setStartPosition(n,s),this.tick()}else this.warn("Levels were reset while loading level "+r)},i._handleFragmentLoadProgress=function(t){var e,i,r,n,s,a,o,l=t.frag,h=t.part,t=t.payload,u=this.levels;u?(e=(u=u[l.level]).details)?(i=u.videoCodec,r=e.PTSKnown||!e.live,n=null==(n=l.initSegment)?void 0:n.data,u=this._getAudioCodec(u),s=this.transmuxer=this.transmuxer||new De(this.hls,c.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),a=h?h.index:-1,a=new Bt(l.level,l.sn,l.stats.chunkCount,t.byteLength,a,-1!==a),o=this.initPTS[l.cc],s.push(t,n,u,i,l,h,e.totalduration,r,a,o)):this.warn("Dropping fragment "+l.sn+" of level "+l.level+" after level details were reset"):this.warn("Levels were reset while fragment load was in progress. Fragment "+l.sn+" of level "+l.level+" will not be buffered")},i.onAudioTrackSwitching=function(t,e){var i=this.altAudio,r=!!e.url,e=e.id;r||(this.mediaBuffer!==this.media?(this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media,null!=(r=this.fragCurrent)&&r.loader&&(this.log("Switching to main audio track, cancel main fragment load"),r.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()):this.audioOnly&&this.resetTransmuxer(),r=this.hls,i&&r.trigger(y.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),r.trigger(y.Events.AUDIO_TRACK_SWITCHED,{id:e}))},i.onAudioTrackSwitched=function(t,e){var i,e=e.id,e=!!this.hls.audioTracks[e].url;e&&(i=this.videoBuffer)&&this.mediaBuffer!==i&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=i),this.altAudio=e,this.tick()},i.onBufferCreated=function(t,e){var i,r=e.tracks,n=!1;for(i in r){var s,a,o=r[i];"main"===o.id?(a=o,"video"===(s=i)&&(o=r[i])&&(this.videoBuffer=o.buffer)):n=!0}n&&a?(this.log("Alternate track found, use "+s+".buffered to schedule main fragment loading"),this.mediaBuffer=a.buffer):this.mediaBuffer=this.media},i.onFragBuffered=function(t,e){var i,r=e.frag,e=e.part;r&&r.type!==c.PlaylistLevelType.MAIN||(this.fragContextChanged(r)?(this.warn("Fragment "+r.sn+(e?" p: "+e.index:"")+" of level "+r.level+" finished buffering, but was aborted. state: "+this.state),this.state===ce&&(this.state=m)):(i=(e||r).stats,this.fragLastKbps=Math.round(8*i.total/(i.buffering.end-i.loading.first)),"initSegment"!==r.sn&&(this.fragPrevious=r),this.fragBufferedComplete(r,e)))},i.onError=function(t,e){switch(e.details){case v.ErrorDetails.FRAG_LOAD_ERROR:case v.ErrorDetails.FRAG_LOAD_TIMEOUT:case v.ErrorDetails.KEY_LOAD_ERROR:case v.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(c.PlaylistLevelType.MAIN,e);break;case v.ErrorDetails.LEVEL_LOAD_ERROR:case v.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==S&&(e.fatal?(this.warn(""+e.details),this.state=S):e.levelRetry||this.state!==ve||(this.state=m));break;case v.ErrorDetails.BUFFER_FULL_ERROR:var i,r;"main"!==e.parent||this.state!==T&&this.state!==ce||(i=!0,(i=(r=this.getFwdBufferInfo(this.media,c.PlaylistLevelType.MAIN))&&.5<r.len?!this.reduceMaxBufferLength(r.len):i)&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState())}},i.checkBuffer=function(){var t,e=this.media,i=this.gapController;e&&i&&e.readyState&&(!this.loadedmetadata&&p.getBuffered(e).length||(t=this.state!==m?this.fragCurrent:null,i.poll(this.lastCurrentTime,t)),this.lastCurrentTime=e.currentTime)},i.onFragLoadEmergencyAborted=function(){this.state=m,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},i.onBufferFlushed=function(t,e){var i,e=e.type;(e!==B.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio)&&(i=(e===B.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media,this.afterBufferFlushed(i,e,c.PlaylistLevelType.MAIN))},i.onLevelsUpdated=function(t,e){this.levels=e.levels},i.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},i.seekToStartPos=function(){var t,e,i,r=this.media;r&&(t=r.currentTime,0<=(e=this.startPosition))&&t<e&&(r.seeking?this.log("could not seek to "+e+", already seeking at "+t):(0<(i=((i=p.getBuffered(r)).length?i.start(0):0)-e)&&(i<this.config.maxBufferHole||i<this.config.maxFragLookUpTolerance)&&(this.log("adjusting start position by "+i+" to match buffer start"),this.startPosition=e+=i),this.log("seek to target start position "+e+" from current time "+t),r.currentTime=e))},i._getAudioCodec=function(t){t=this.config.defaultAudioCodec||t.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t=-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),t},i._loadBitrateTestFrag=function(r){var n=this;r.bitrateTest=!0,this._doFragLoad(r).then(function(t){var e,i=n.hls;!t||i.nextLoadLevel||n.fragContextChanged(r)||(n.fragLoadError=0,n.state=m,n.startFragRequested=!1,n.bitrateTest=!1,(e=r.stats).parsing.start=e.parsing.end=e.buffering.start=e.buffering.end=self.performance.now(),i.trigger(y.Events.FRAG_LOADED,t),r.bitrateTest=!1)})},i._handleTransmuxComplete=function(t){var e="main",i=this.hls,r=t.remuxResult,t=t.chunkMeta,n=this.getCurrentContext(t);if(n){var s=n.frag,a=n.part,n=n.level,o=r.video,l=r.text,h=r.id3,u=r.initSegment,d=n.details,c=this.altAudio?void 0:r.audio;if(!this.fragContextChanged(s)){if(this.state=T,u&&(u.tracks&&(this._bufferInitSegment(n,u.tracks,s,t),i.trigger(y.Events.FRAG_PARSING_INIT_SEGMENT,{frag:s,id:e,tracks:u.tracks})),n=u.initPTS,u=u.timescale,(0,K.isFiniteNumber)(n))&&(this.initPTS[s.cc]=n,i.trigger(y.Events.INIT_PTS_FOUND,{frag:s,id:e,initPTS:n,timescale:u})),o&&!1!==r.independent){if(d){var n=o.startPTS,u=o.endPTS,f=o.startDTS,g=o.endDTS;if(a)a.elementaryStreams[o.type]={startPTS:n,endPTS:u,startDTS:f,endDTS:g};else if(o.firstKeyFrame&&o.independent&&(this.couldBacktrack=!0),o.dropped&&o.independent){var v=this.getMainFwdBufferInfo();if((v?v.end:this.getLoadPosition())+this.config.maxBufferHole<(o.firstKeyFramePTS||n)-this.config.maxBufferHole)return void this.backtrack(s);s.setElementaryStreamInfo(o.type,s.start,u,s.start,g,!0)}s.setElementaryStreamInfo(o.type,n,u,f,g),this.backtrackFragment&&(this.backtrackFragment=s),this.bufferFragmentData(o,s,a,t)}}else if(!1===r.independent)return void this.backtrack(s);c&&(v=c.startPTS,n=c.endPTS,u=c.startDTS,f=c.endDTS,a&&(a.elementaryStreams[B.ElementaryStreamTypes.AUDIO]={startPTS:v,endPTS:n,startDTS:u,endDTS:f}),s.setElementaryStreamInfo(B.ElementaryStreamTypes.AUDIO,v,n,u,f),this.bufferFragmentData(c,s,a,t)),d&&null!=h&&null!=(g=h.samples)&&g.length&&(o={id:e,frag:s,details:d,samples:h.samples},i.trigger(y.Events.FRAG_PARSING_METADATA,o)),d&&l&&(r={id:e,frag:s,details:d,samples:l.samples},i.trigger(y.Events.FRAG_PARSING_USERDATA,r))}}else this.warn("The loading context changed while buffering fragment "+t.sn+" of level "+t.level+". This chunk will not be buffered."),this.resetStartWhenNotLoaded(t.level)},i._bufferInitSegment=function(t,i,r,n){var e,s,a,o,l,h=this;this.state===T&&(this.audioOnly=!!i.audio&&!i.video,this.altAudio&&!this.audioOnly&&delete i.audio,e=i.audio,s=i.video,a=i.audiovideo,e&&(o=t.audioCodec,l=navigator.userAgent.toLowerCase(),this.audioCodecSwitch&&(o=o&&(-1!==o.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),1!==e.metadata.channelCount)&&-1===l.indexOf("firefox")&&(o="mp4a.40.5"),-1!==l.indexOf("android")&&"audio/mpeg"!==e.container&&this.log("Android: force audio codec to "+(o="mp4a.40.2")),t.audioCodec&&t.audioCodec!==o&&this.log('Swapping manifest audio codec "'+t.audioCodec+'" for "'+o+'"'),e.levelCodec=o,e.id="main",this.log("Init audio buffer, container:"+e.container+", codecs[selected/level/parsed]=["+(o||"")+"/"+(t.audioCodec||"")+"/"+e.codec+"]")),s&&(s.levelCodec=t.videoCodec,s.id="main",this.log("Init video buffer, container:"+s.container+", codecs[level/parsed]=["+(t.videoCodec||"")+"/"+s.codec+"]")),a&&this.log("Init audiovideo buffer, container:"+a.container+", codecs[level/parsed]=["+(t.attrs.CODECS||"")+"/"+a.codec+"]"),this.hls.trigger(y.Events.BUFFER_CODECS,i),Object.keys(i).forEach(function(t){var e=i[t].initSegment;null!=e&&e.byteLength&&h.hls.trigger(y.Events.BUFFER_APPENDING,{type:t,data:e,frag:r,part:null,chunkMeta:n,parent:r.type})}),this.tick())},i.getMainFwdBufferInfo=function(){return this.getFwdBufferInfo(this.mediaBuffer||this.media,c.PlaylistLevelType.MAIN)},i.backtrack=function(t){this.couldBacktrack=!0,this.backtrackFragment=t,this.resetTransmuxer(),this.flushBufferGap(t),this.fragmentTracker.removeFragment(t),this.fragPrevious=null,this.nextLoadPosition=t.start,this.state=m},i.checkFragmentChanged=function(){var t,e=this.media,i=null;e&&1<e.readyState&&!1===e.seeking&&(t=e.currentTime,p.isBuffered(e,t)?i=this.getAppendedFrag(t):p.isBuffered(e,t+.1)&&(i=this.getAppendedFrag(t+.1)),i)&&(this.backtrackFragment=null,e=this.fragPlaying,t=i.level,e&&i.sn===e.sn&&e.level===t&&i.urlId===e.urlId||(this.hls.trigger(y.Events.FRAG_CHANGED,{frag:i}),e&&e.level===t||this.hls.trigger(y.Events.LEVEL_SWITCHED,{level:t}),this.fragPlaying=i))},(e=t).prototype),s=[{key:"nextLevel",get:function(){var t=this.nextBufferedFrag;return t?t.level:-1}},{key:"currentFrag",get:function(){var t=this.media;return t?this.fragPlaying||this.getAppendedFrag(t.currentTime):null}},{key:"currentProgramDateTime",get:function(){var t=this.media;if(t){var t=t.currentTime,e=this.currentFrag;if(e&&(0,K.isFiniteNumber)(t)&&(0,K.isFiniteNumber)(e.programDateTime))return t=e.programDateTime+1e3*(t-e.start),new Date(t)}return null}},{key:"currentLevel",get:function(){var t=this.currentFrag;return t?t.level:-1}},{key:"nextBufferedFrag",get:function(){var t=this.currentFrag;return t?this.followingBufferedFrag(t):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}],a=0;a<s.length;a++){var o=s[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(r,o.key,o)}return Object.defineProperty(e,"prototype",{writable:!1}),t}(i);(r=Fe.prototype).sample=function(t,e){var i=Math.pow(this.alpha_,t);this.estimate_=e*(1-i)+i*this.estimate_,this.totalWeight_+=t},r.getTotalWeight=function(){return this.totalWeight_},r.getEstimate=function(){if(this.alpha_){var t=1-Math.pow(this.alpha_,this.totalWeight_);if(t)return this.estimate_/t}return this.estimate_};const we=Fe,Oe=((e=Pe.prototype).update=function(t,e){var i=this.slow_,r=this.fast_;this.slow_.halfLife!==t&&(this.slow_=new we(t,i.getEstimate(),i.getTotalWeight())),this.fast_.halfLife!==e&&(this.fast_=new we(e,r.getEstimate(),r.getTotalWeight()))},e.sample=function(t,e){t=(t=Math.max(t,this.minDelayMs_))/1e3,e=8*e/t;this.fast_.sample(t,e),this.slow_.sample(t,e)},e.canEstimate=function(){var t=this.fast_;return t&&t.getTotalWeight()>=this.minWeight_},e.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},e.destroy=function(){},Pe),xe=function(){function t(t){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0;t=(this.hls=t).config;this.bwEstimator=new Oe(t.abrEwmaSlowVoD,t.abrEwmaFastVoD,t.abrEwmaDefaultEstimate),this.registerListeners()}for(var e=t.prototype,i=(e.registerListeners=function(){var t=this.hls;t.on(y.Events.FRAG_LOADING,this.onFragLoading,this),t.on(y.Events.FRAG_LOADED,this.onFragLoaded,this),t.on(y.Events.FRAG_BUFFERED,this.onFragBuffered,this),t.on(y.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.on(y.Events.ERROR,this.onError,this)},e.unregisterListeners=function(){var t=this.hls;t.off(y.Events.FRAG_LOADING,this.onFragLoading,this),t.off(y.Events.FRAG_LOADED,this.onFragLoaded,this),t.off(y.Events.FRAG_BUFFERED,this.onFragBuffered,this),t.off(y.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.off(y.Events.ERROR,this.onError,this)},e.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},e.onFragLoading=function(t,e){var i=e.frag;i.type!==c.PlaylistLevelType.MAIN||this.timer||(this.fragCurrent=i,this.partCurrent=null!=(i=e.part)?i:null,this.timer=self.setInterval(this.onCheck,100))},e.onLevelLoaded=function(t,e){var i=this.hls.config;e.details.live?this.bwEstimator.update(i.abrEwmaSlowLive,i.abrEwmaFastLive):this.bwEstimator.update(i.abrEwmaSlowVoD,i.abrEwmaFastVoD)},e._abandonRulesCheck=function(){var t=this.fragCurrent,e=this.partCurrent,i=this.hls,r=i.autoLevelEnabled,n=(i.config,i.media);if(t&&n){var s=(e||t).stats,a=(e||t).duration;if(s.aborted||s.loaded&&s.loaded===s.total||0===t.level)this.clearTimer(),this._nextAutoLevel=-1;else if(r&&!n.paused&&n.playbackRate&&n.readyState){r=i.mainForwardBufferInfo;if(null!==r){var o=performance.now()-s.loading.start,n=Math.abs(n.playbackRate);if(!(o<=500*a/n)){var l=s.loaded&&s.loading.first,h=this.bwEstimator.getEstimate(),u=i.levels,d=i.minAutoLevel,c=u[t.level],c=s.total||Math.max(s.loaded,Math.round(a*c.maxBitrate/8)),f=l?1e3*s.loaded/o:0,c=f?(c-s.loaded)/f:8*c/h,g=r.len/n;if(!(c<=g)){for(var v=Number.POSITIVE_INFINITY,p=t.level-1;d<p;p--){var m=u[p].maxBitrate;if((v=f?a*m/(6.4*f):a*m/h)<g)break}c<=v||(V.logger.warn("Fragment "+t.sn+(e?" part "+e.index:"")+" of level "+t.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+p+"\n      Current BW estimate: "+((0,K.isFiniteNumber)(h)?(h/1024).toFixed(3):"Unknown")+" Kb/s\n      Estimated load time for current fragment: "+c.toFixed(3)+" s\n      Estimated load time for the next fragment: "+v.toFixed(3)+" s\n      Time to underbuffer: "+g.toFixed(3)+" s"),i.nextLoadLevel=p,l&&this.bwEstimator.sample(o,s.loaded),this.clearTimer(),t.loader&&(this.fragCurrent=this.partCurrent=null,t.loader.abort()),i.trigger(y.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:t,part:e,stats:s}))}}}}}},e.onFragLoaded=function(t,e){var i,r,n,s,a=e.frag,e=e.part;a.type===c.PlaylistLevelType.MAIN&&(0,K.isFiniteNumber)(a.sn)&&(i=(e||a).stats,n=(e||a).duration,this.clearTimer(),this.lastLoadedFragLevel=a.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate&&(r=((s=this.hls.levels[a.level]).loaded?s.loaded.bytes:0)+i.loaded,n=(s.loaded?s.loaded.duration:0)+n,s.loaded={bytes:r,duration:n},s.realBitrate=Math.round(8*r/n)),a.bitrateTest)&&(s={stats:i,frag:a,part:e,id:a.type},this.onFragBuffered(y.Events.FRAG_BUFFERED,s))},e.onFragBuffered=function(t,e){var i,r=e.frag,e=e.part,e=(e||r).stats;e.aborted||r.type!==c.PlaylistLevelType.MAIN||"initSegment"===r.sn||(i=e.parsing.end-e.loading.start,this.bwEstimator.sample(i,e.loaded),e.bwEstimate=this.bwEstimator.getEstimate(),r.bitrateTest?this.bitrateTestDelay=i/1e3:this.bitrateTestDelay=0)},e.onError=function(t,e){switch(e.details){case v.ErrorDetails.FRAG_LOAD_ERROR:case v.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}},e.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},e.getNextABRAutoLevel=function(){var t=this.fragCurrent,e=this.partCurrent,i=this.hls,r=i.maxAutoLevel,n=i.config,s=i.minAutoLevel,a=i.media,e=e?e.duration:t?t.duration:0,t=(a&&a.currentTime,a&&0!==a.playbackRate?Math.abs(a.playbackRate):1),a=this.bwEstimator?this.bwEstimator.getEstimate():n.abrEwmaDefaultEstimate,i=i.mainForwardBufferInfo,i=(i?i.len:0)/t,t=this.findBestLevel(a,s,r,i,n.abrBandWidthFactor,n.abrBandWidthUpFactor);if(0<=t)return t;V.logger.trace((i?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var o,l=e?Math.min(e,n.maxStarvationDelay):n.maxStarvationDelay,h=n.abrBandWidthFactor,u=n.abrBandWidthUpFactor;return i||(o=this.bitrateTestDelay)&&(l=(e?Math.min(e,n.maxLoadingDelay):n.maxLoadingDelay)-o,V.logger.trace("bitrate test took "+Math.round(1e3*o)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*l)+" ms"),h=u=1),t=this.findBestLevel(a,s,r,i+l,h,u),Math.max(t,0)},e.findBestLevel=function(t,e,i,r,n,s){for(var a,o=this.fragCurrent,l=this.partCurrent,h=this.lastLoadedFragLevel,u=this.hls.levels,d=u[h],c=!(null==d||null==(a=d.details)||!a.live),f=null==d?void 0:d.codecSet,g=l?l.duration:o?o.duration:0,v=i;e<=v;v--){var p=u[v];if(p&&(!f||p.codecSet===f)){var p=p.details,p=(l?null==p?void 0:p.partTarget:null==p?void 0:p.averagetargetduration)||g,m=v<=h?n*t:s*t,T=u[v].maxBitrate,y=T*p/m;if(V.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+v+"/"+Math.round(m)+"/"+T+"/"+p+"/"+r+"/"+y),T<m&&(0==y||!(0,K.isFiniteNumber)(y)||c&&!this.bitrateTestDelay||y<r))return v}}return-1},(e=t).prototype),r=[{key:"nextAutoLevel",get:function(){var t=this._nextAutoLevel,e=this.bwEstimator;return-1!==t&&!e.canEstimate()||(e=this.getNextABRAutoLevel(),-1!==t&&this.hls.levels[e].loadError)?t:-1!==t?Math.min(t,e):e},set:function(t){this._nextAutoLevel=t}}],n=0;n<r.length;n++){var s=r[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(i,s.key,s)}return Object.defineProperty(e,"prototype",{writable:!1}),t}();function Pe(t,e,i){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=i,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new we(t),this.fast_=new we(e)}function Fe(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=t,this.alpha_=t?Math.exp(Math.log(.5)/t):0,this.estimate_=e,this.totalWeight_=i}(r=Ne.prototype).push=function(t){this.chunks.push(t),this.dataLength+=t.length},r.flush=function(){var t=this.chunks,s=this.dataLength;return t.length?(t=1===t.length?t[0]:function(t){for(var e=new Uint8Array(s),i=0,r=0;r<t.length;r++){var n=t[r];e.set(n,i),i+=n.length}return e}(t),this.reset(),t):new Uint8Array(0)},r.reset=function(){this.chunks.length=0,this.dataLength=0};var n,Me=Ne;function Ne(){this.chunks=[],this.dataLength=0}function Ue(){return(Ue=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i,r=arguments[e];for(i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t}).apply(this,arguments)}function Be(t,e){return(Be=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function Ge(t,e){return(t=n.call(this,t,e,"[audio-stream-controller]")||this).videoBuffer=null,t.videoTrackCC=-1,t.waitingVideoCC=-1,t.audioSwitch=!1,t.trackId=-1,t.waitingData=null,t.mainDetails=null,t.bufferFlushed=!1,t.cachedTrackLoadedData=null,t._registerListeners(),t}e=n=i,(r=Ge).prototype=Object.create(e.prototype),Be(r.prototype.constructor=r,e),(r=Ge.prototype).onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},r._registerListeners=function(){var t=this.hls;t.on(y.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(y.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(y.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(y.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.on(y.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.on(y.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(y.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(y.Events.ERROR,this.onError,this),t.on(y.Events.BUFFER_RESET,this.onBufferReset,this),t.on(y.Events.BUFFER_CREATED,this.onBufferCreated,this),t.on(y.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(y.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(y.Events.FRAG_BUFFERED,this.onFragBuffered,this)},r._unregisterListeners=function(){var t=this.hls;t.off(y.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(y.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(y.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(y.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.off(y.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.off(y.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(y.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.off(y.Events.ERROR,this.onError,this),t.off(y.Events.BUFFER_RESET,this.onBufferReset,this),t.off(y.Events.BUFFER_CREATED,this.onBufferCreated,this),t.off(y.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(y.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(y.Events.FRAG_BUFFERED,this.onFragBuffered,this)},r.onInitPtsFound=function(t,e){var i=e.frag,r=e.id,e=e.initPTS;"main"===r&&(r=i.cc,this.initPTS[i.cc]=e,this.log("InitPTS for cc: "+r+" found from main: "+e),this.videoTrackCC=r,this.state===ge)&&this.tick()},r.startLoad=function(t){var e;this.levels?(e=this.lastCurrentTime,this.stopLoad(),this.setInterval(100),(this.fragLoadError=0)<e&&-1===t?(this.log("Override startPosition with lastCurrentTime @"+e.toFixed(3)),t=e,this.state=m):(this.loadedmetadata=!1,this.state=de),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()):(this.startPosition=t,this.state=d)},r.doTick=function(){switch(this.state){case m:this.doTickIdle();break;case de:var t=this.levels,e=this.trackId,e=null==t||null==(t=t[e])?void 0:t.details;if(e){if(this.waitForCdnTuneIn(e))break;this.state=ge}break;case ue:t=performance.now(),e=this.retryDate;(!e||e<=t||null!=(e=this.media)&&e.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.trackId),this.state=m);break;case ge:var i,r,t=this.waitingData;t?(e=t.frag,i=t.part,r=t.cache,t=t.complete,void 0!==this.initPTS[e.cc]?(this.waitingData=null,this.waitingVideoCC=-1,this.state=he,i={frag:e,part:i,payload:r.flush(),networkDetails:null},this._handleFragmentLoadProgress(i),t&&n.prototype._handleFragmentLoadComplete.call(this,i)):this.videoTrackCC!==this.waitingVideoCC?(this.log("Waiting fragment cc ("+e.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment()):(r=this.getLoadPosition(),Xt((t=p.bufferInfo(this.mediaBuffer,r,this.config.maxBufferHole)).end,this.config.maxFragLookUpTolerance,e)<0&&(this.log("Waiting fragment cc ("+e.cc+") @ "+e.start+" cancelled because another fragment at "+t.end+" is needed"),this.clearWaitingFragment()))):this.state=m}this.onTickEnd()},r.clearWaitingFragment=function(){var t=this.waitingData;t&&(this.fragmentTracker.removeFragment(t.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=m)},r.resetLoadingState=function(){this.clearWaitingFragment(),n.prototype.resetLoadingState.call(this)},r.onTickEnd=function(){var t=this.media;t&&t.readyState&&(this.lastCurrentTime=t.currentTime)},r.doTickIdle=function(){var t,e,i,r=this.hls,n=this.levels,s=this.media,a=this.trackId,o=r.config;n&&n[a]&&(s||!this.startFragRequested&&o.startFragPrefetch)&&(!(o=n[a].details)||o.live&&this.levelLastLoaded!==a||this.waitForCdnTuneIn(o)?this.state=de:(n=this.mediaBuffer||this.media,this.bufferFlushed&&n&&(this.bufferFlushed=!1,this.afterBufferFlushed(n,B.ElementaryStreamTypes.AUDIO,c.PlaylistLevelType.AUDIO)),null!==(a=this.getFwdBufferInfo(n,c.PlaylistLevelType.AUDIO))&&(n=this.getFwdBufferInfo(this.videoBuffer||this.media,c.PlaylistLevelType.MAIN),e=a.len,t=this.getMaxBufferLength(null==n?void 0:n.len),i=this.audioSwitch,t<=e&&!i||(!i&&this._streamEnded(a,o)?(r.trigger(y.Events.BUFFER_EOS,{type:"audio"}),this.state=fe):(t=o.fragments[0].start,e=a.end,i&&s&&(e=r=this.getLoadPosition(),o.PTSKnown)&&r<t&&(a.end>t||a.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),s.currentTime=t+.05),n&&e>n.end+o.targetduration||!(n&&n.len||!a.len)||((i=this.getNextFragment(e,o))?"identity"!==(null==(r=i.decryptdata)?void 0:r.keyFormat)||null!=(s=i.decryptdata)&&s.key?this.loadFragment(i,o,e):this.loadKey(i,o):this.bufferFlushed=!0))))))},r.getMaxBufferLength=function(t){var e=n.prototype.getMaxBufferLength.call(this);return t?Math.max(e,t):e},r.onMediaDetaching=function(){this.videoBuffer=null,n.prototype.onMediaDetaching.call(this)},r.onAudioTracksUpdated=function(t,e){e=e.audioTracks;this.resetTransmuxer(),this.levels=e.map(function(t){return new St(t)})},r.onAudioTrackSwitching=function(t,e){var i=!!e.url,e=(this.trackId=e.id,this.fragCurrent);null!=e&&e.loader&&e.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),i?this.setInterval(100):this.resetTransmuxer(),i?(this.audioSwitch=!0,this.state=m):this.state=d,this.tick()},r.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},r.onLevelLoaded=function(t,e){this.mainDetails=e.details,null!==this.cachedTrackLoadedData&&(this.hls.trigger(y.Events.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)},r.onAudioTrackLoaded=function(t,e){if(null!=this.mainDetails){var i=this.levels,r=e.details,n=e.id;if(i){this.log("Track "+n+" loaded ["+r.startSN+","+r.endSN+"],duration:"+r.totalduration);var i=i[n],s=0;if(r.live||null!=(a=i.details)&&a.live){var a=this.mainDetails;if(r.fragments[0]||(r.deltaUpdateFailed=!0),r.deltaUpdateFailed||!a)return;s=!i.details&&r.hasProgramDateTime&&a.hasProgramDateTime?(Wt(r,a),r.fragments[0].start):this.alignPlaylists(r,i.details)}i.details=r,this.levelLastLoaded=n,this.startFragRequested||!this.mainDetails&&r.live||this.setStartPosition(i.details,s),this.state!==de||this.waitForCdnTuneIn(r)||(this.state=m),this.tick()}else this.warn("Audio tracks were reset while loading level "+n)}else this.cachedTrackLoadedData=e},r._handleFragmentLoadProgress=function(t){var e,i,r,n,s=t.frag,a=t.part,t=t.payload,o=this.config,l=this.trackId,h=this.levels;h?(e=(h=h[l]).details,o=o.defaultAudioCodec||h.audioCodec||"mp4a.40.2",h=(h=this.transmuxer)||(this.transmuxer=new De(this.hls,c.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this))),i=this.initPTS[s.cc],r=null==(r=s.initSegment)?void 0:r.data,void 0!==i?(n=a?a.index:-1,n=new Bt(s.level,s.sn,s.stats.chunkCount,t.byteLength,n,-1!==n),h.push(t,r,o,"",s,a,e.totalduration,!1,n,i)):(this.log("Unknown video PTS for cc "+s.cc+", waiting for video PTS before demuxing audio frag "+s.sn+" of ["+e.startSN+" ,"+e.endSN+"],track "+l),(this.waitingData=this.waitingData||{frag:s,part:a,cache:new Me,complete:!1}).cache.push(new Uint8Array(t)),this.waitingVideoCC=this.videoTrackCC,this.state=ge)):this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+s.sn+" of level "+s.level+" will not be buffered")},r._handleFragmentLoadComplete=function(t){this.waitingData?this.waitingData.complete=!0:n.prototype._handleFragmentLoadComplete.call(this,t)},r.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},r.onBufferCreated=function(t,e){var i=e.tracks.audio;i&&(this.mediaBuffer=i.buffer||null),e.tracks.video&&(this.videoBuffer=e.tracks.video.buffer||null)},r.onFragBuffered=function(t,e){var i=e.frag,e=e.part;i.type===c.PlaylistLevelType.AUDIO?this.fragContextChanged(i)?this.warn("Fragment "+i.sn+(e?" p: "+e.index:"")+" of level "+i.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch):("initSegment"!==i.sn&&(this.fragPrevious=i,this.audioSwitch)&&(this.audioSwitch=!1,this.hls.trigger(y.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId})),this.fragBufferedComplete(i,e)):this.loadedmetadata||i.type!==c.PlaylistLevelType.MAIN||null!=(e=this.videoBuffer||this.media)&&e.buffered.length&&(this.loadedmetadata=!0)},r.onError=function(t,e){switch(e.details){case v.ErrorDetails.FRAG_LOAD_ERROR:case v.ErrorDetails.FRAG_LOAD_TIMEOUT:case v.ErrorDetails.KEY_LOAD_ERROR:case v.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(c.PlaylistLevelType.AUDIO,e);break;case v.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case v.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==S&&this.state!==d&&(this.state=e.fatal?S:m,this.warn(e.details+" while loading frag, switching to "+this.state+" state"));break;case v.ErrorDetails.BUFFER_FULL_ERROR:var i,r;"audio"!==e.parent||this.state!==T&&this.state!==ce||(i=!0,(i=(r=this.getFwdBufferInfo(this.mediaBuffer,c.PlaylistLevelType.AUDIO))&&.5<r.len?!this.reduceMaxBufferLength(r.len):i)&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,n.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState())}},r.onBufferFlushed=function(t,e){e.type===B.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0)},r._handleTransmuxComplete=function(t){var e,i,r,n,s,a,o,l,h=this.hls,u=t.remuxResult,t=t.chunkMeta,d=this.getCurrentContext(t);d?(e=d.frag,i=d.part,d=d.level.details,r=u.audio,n=u.text,s=u.id3,u=u.initSegment,!this.fragContextChanged(e)&&d&&(this.state=T,this.audioSwitch&&r&&this.completeAudioSwitch(),null!=u&&u.tracks&&(this._bufferInitSegment(u.tracks,e,t),h.trigger(y.Events.FRAG_PARSING_INIT_SEGMENT,{frag:e,id:"audio",tracks:u.tracks})),r&&(u=r.startPTS,o=r.endPTS,l=r.startDTS,a=r.endDTS,i&&(i.elementaryStreams[B.ElementaryStreamTypes.AUDIO]={startPTS:u,endPTS:o,startDTS:l,endDTS:a}),e.setElementaryStreamInfo(B.ElementaryStreamTypes.AUDIO,u,o,l,a),this.bufferFragmentData(r,e,i,t)),null!=s&&null!=(u=s.samples)&&u.length&&(o=Ue({id:"audio",frag:e,details:d},s),h.trigger(y.Events.FRAG_PARSING_METADATA,o)),n)&&(l=Ue({id:"audio",frag:e,details:d},n),h.trigger(y.Events.FRAG_PARSING_USERDATA,l))):(this.warn("The loading context changed while buffering fragment "+t.sn+" of level "+t.level+". This chunk will not be buffered."),this.resetStartWhenNotLoaded(t.level))},r._bufferInitSegment=function(t,e,i){var r;this.state===T&&(t.video&&delete t.video,r=t.audio)&&(r.levelCodec=r.codec,r.id="audio",this.log("Init audio buffer, container:"+r.container+", codecs[parsed]=["+r.codec+"]"),this.hls.trigger(y.Events.BUFFER_CODECS,t),null!=(t=r.initSegment)&&t.byteLength&&(r={type:"audio",frag:e,part:null,chunkMeta:i,parent:e.type,data:t},this.hls.trigger(y.Events.BUFFER_APPENDING,r)),this.tick())},r.loadFragment=function(t,e,i){var r=this.fragmentTracker.getState(t);this.fragCurrent=t,!this.audioSwitch&&r!==h.NOT_LOADED&&r!==h.PARTIAL||("initSegment"===t.sn?this._loadInitSegment(t):e.live&&!(0,K.isFiniteNumber)(this.initPTS[t.cc])?(this.log("Waiting for video PTS in continuity counter "+t.cc+" of live stream before loading audio fragment "+t.sn+" of level "+this.trackId),this.state=ge):(this.startFragRequested=!0,n.prototype.loadFragment.call(this,t,e,i)))},r.completeAudioSwitch=function(){var t=this.hls,e=this.media,i=this.trackId;e&&(this.log("Switching audio track : flushing all audio"),n.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,t.trigger(y.Events.AUDIO_TRACK_SWITCHED,{id:i})};e=Ge;function je(t,e){return(je=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}var r=function(i){function t(t){return(t=i.call(this,t,"[audio-track-controller]")||this).tracks=[],t.groupId=null,t.tracksInGroup=[],t.trackId=-1,t.trackName="",t.selectDefaultTrack=!0,t.registerListeners(),t}e=i,(r=t).prototype=Object.create(e.prototype),je(r.prototype.constructor=r,e);for(var e,r=t.prototype,n=(r.registerListeners=function(){var t=this.hls;t.on(y.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(y.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(y.Events.LEVEL_LOADING,this.onLevelLoading,this),t.on(y.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(y.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(y.Events.ERROR,this.onError,this)},r.unregisterListeners=function(){var t=this.hls;t.off(y.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(y.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.off(y.Events.LEVEL_LOADING,this.onLevelLoading,this),t.off(y.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(y.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.off(y.Events.ERROR,this.onError,this)},r.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,i.prototype.destroy.call(this)},r.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},r.onManifestParsed=function(t,e){this.tracks=e.audioTracks||[]},r.onAudioTrackLoaded=function(t,e){var i,r=e.id,n=e.details,s=this.tracksInGroup[r];s?(i=s.details,s.details=e.details,this.log("audioTrack "+r+" loaded ["+n.startSN+"-"+n.endSN+"]"),r===this.trackId&&(this.retryCount=0,this.playlistLoaded(r,e,i))):this.warn("Invalid audio track id "+r)},r.onLevelLoading=function(t,e){this.switchLevel(e.level)},r.onLevelSwitching=function(t,e){this.switchLevel(e.level)},r.switchLevel=function(t){var e,i,t=this.hls.levels[t];null!=t&&t.audioGroupIds&&(e=t.audioGroupIds[t.urlId],this.groupId!==e)&&(this.groupId=e,t=this.tracks.filter(function(t){return!e||t.groupId===e}),this.selectDefaultTrack&&!t.some(function(t){return t.default})&&(this.selectDefaultTrack=!1),i={audioTracks:this.tracksInGroup=t},this.log("Updating audio tracks, "+t.length+' track(s) found in "'+e+'" group-id'),this.hls.trigger(y.Events.AUDIO_TRACKS_UPDATED,i),this.selectInitialTrack())},r.onError=function(t,e){i.prototype.onError.call(this,t,e),!e.fatal&&e.context&&e.context.type===c.PlaylistContextType.AUDIO_TRACK&&e.context.id===this.trackId&&e.context.groupId===this.groupId&&this.retryLoadingOrFail(e)},r.setAudioTrack=function(t){var e,i,r,n,s,a,o=this.tracksInGroup;t<0||t>=o.length?this.warn("Invalid id passed to audio-track controller"):(this.clearTimer(),e=o[this.trackId],this.log("Now switching to audio-track index "+t),i=(o=o[t]).id,r=void 0===(r=o.groupId)?"":r,n=o.name,s=o.type,a=o.url,this.trackId=t,this.trackName=n,this.selectDefaultTrack=!1,this.hls.trigger(y.Events.AUDIO_TRACK_SWITCHING,{id:i,groupId:r,name:n,type:s,url:a}),o.details&&!o.details.live||(t=this.switchParams(o.url,null==e?void 0:e.details),this.loadPlaylist(t)))},r.selectInitialTrack=function(){this.tracksInGroup;var t=this.trackName,t=this.findTrackId(t)||this.findTrackId();-1!==t?this.setAudioTrack(t):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(y.Events.ERROR,{type:v.ErrorTypes.MEDIA_ERROR,details:v.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},r.findTrackId=function(t){for(var e=this.tracksInGroup,i=0;i<e.length;i++){var r=e[i];if((!this.selectDefaultTrack||r.default)&&(!t||t===r.name))return r.id}return-1},r.loadPlaylist=function(t){var e=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(e)){var i=e.id,r=e.groupId,e=e.url;if(t)try{e=t.addDirectives(e)}catch(t){this.warn("Could not construct new URL with HLS Delivery Directives: "+t)}this.log("loading audio-track playlist for id: "+i),this.clearTimer(),this.hls.trigger(y.Events.AUDIO_TRACK_LOADING,{url:e,id:i,groupId:r,deliveryDirectives:t||null})}},(e=t).prototype),s=[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(t){this.selectDefaultTrack=!1,this.setAudioTrack(t)}}],a=0;a<s.length;a++){var o=s[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(n,o.key,o)}return Object.defineProperty(e,"prototype",{writable:!1}),t}(t);function He(t,e){return(He=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}var i=function(r){function t(t,e){return(t=r.call(this,t,e,"[subtitle-stream-controller]")||this).levels=[],t.currentTrackId=-1,t.tracksBuffered=[],t.mainDetails=null,t._registerListeners(),t}e=r,(i=t).prototype=Object.create(e.prototype),He(i.prototype.constructor=i,e);for(var e,i=t.prototype,n=(i.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},i._registerListeners=function(){var t=this.hls;t.on(y.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(y.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(y.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(y.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.on(y.Events.ERROR,this.onError,this),t.on(y.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.on(y.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.on(y.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(y.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),t.on(y.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(y.Events.FRAG_BUFFERED,this.onFragBuffered,this)},i._unregisterListeners=function(){var t=this.hls;t.off(y.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(y.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(y.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(y.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.off(y.Events.ERROR,this.onError,this),t.off(y.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.off(y.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.off(y.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(y.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),t.off(y.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(y.Events.FRAG_BUFFERED,this.onFragBuffered,this)},i.startLoad=function(t){this.stopLoad(),this.state=m,this.setInterval(500),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()},i.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},i.onLevelLoaded=function(t,e){this.mainDetails=e.details},i.onSubtitleFragProcessed=function(t,e){var i=e.frag,e=e.success;if(this.fragPrevious=i,this.state=m,e){var r=this.tracksBuffered[this.currentTrackId];if(r){for(var n,s=i.start,a=0;a<r.length;a++)if(s>=r[a].start&&s<=r[a].end){n=r[a];break}e=i.start+i.duration;n?n.end=e:r.push(n={start:s,end:e}),this.fragmentTracker.fragBuffered(i)}}},i.onBufferFlushing=function(t,e){var i,r,n,s=e.startOffset,a=e.endOffset;0===s&&a!==Number.POSITIVE_INFINITY&&(i=this.currentTrackId,(r=this.levels).length)&&r[i]&&r[i].details&&((n=a-r[i].details.targetduration)<=0||(e.endOffsetSubtitles=Math.max(0,n),this.tracksBuffered.forEach(function(t){for(var e=0;e<t.length;)if(t[e].end<=n)t.shift();else{if(!(t[e].start<n))break;t[e].start=n,e++}}),this.fragmentTracker.removeFragmentsInRange(s,n,c.PlaylistLevelType.SUBTITLE)))},i.onFragBuffered=function(t,e){this.loadedmetadata||e.frag.type!==c.PlaylistLevelType.MAIN||null!=(e=this.media)&&e.buffered.length&&(this.loadedmetadata=!0)},i.onError=function(t,e){var e=e.frag;e&&e.type===c.PlaylistLevelType.SUBTITLE&&(null!=(e=this.fragCurrent)&&e.loader&&this.fragCurrent.loader.abort(),this.state=m)},i.onSubtitleTracksUpdated=function(t,e){var i=this,e=e.subtitleTracks;this.tracksBuffered=[],this.levels=e.map(function(t){return new St(t)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(t){i.tracksBuffered[t.id]=[]}),this.mediaBuffer=null},i.onSubtitleTrackSwitch=function(t,e){this.currentTrackId=e.id,this.levels.length&&-1!==this.currentTrackId?(null!=(e=this.levels[this.currentTrackId])&&e.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,e&&this.setInterval(500)):this.clearInterval()},i.onSubtitleTrackLoaded=function(t,e){var i=e.details,e=e.id,r=this.currentTrackId,n=this.levels;if(n.length){var s=n[r];if(!(e>=n.length||e!==r)&&s){this.mediaBuffer=this.mediaBufferTimeRanges;n=0;if(i.live||null!=(r=s.details)&&r.live){r=this.mainDetails;if(i.deltaUpdateFailed||!r)return;var a=r.fragments[0];s.details?0===(n=this.alignPlaylists(i,s.details))&&a&&It(i,n=a.start):i.hasProgramDateTime&&r.hasProgramDateTime?(Wt(i,r),n=i.fragments[0].start):a&&It(i,n=a.start)}s.details=i,this.levelLastLoaded=e,this.startFragRequested||!this.mainDetails&&i.live||this.setStartPosition(s.details,n),this.tick(),!i.live||this.fragCurrent||!this.media||this.state!==m||qt(null,i.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),s.details=void 0)}}},i._handleFragmentLoadComplete=function(t){var i,r=t.frag,t=t.payload,e=r.decryptdata,n=this.hls;!this.fragContextChanged(r)&&t&&0<t.byteLength&&e&&e.key&&e.iv&&"AES-128"===e.method&&(i=performance.now(),this.decrypter.webCryptoDecrypt(new Uint8Array(t),e.key.buffer,e.iv.buffer).then(function(t){var e=performance.now();n.trigger(y.Events.FRAG_DECRYPTED,{frag:r,payload:t,stats:{tstart:i,tdecrypt:e}})}))},i.doTick=function(){var t,e,i,r,n,s,a,o;this.media?this.state===m&&(o=this.currentTrackId,(t=this.levels).length)&&t[o]&&t[o].details&&(o=(t=t[o].details).targetduration,e=this.config,n=this.getLoadPosition(),i=(n=p.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],n-o,e.maxBufferHole)).end,n=n.len,s=this.getFwdBufferInfo(this.media,c.PlaylistLevelType.MAIN),n>this.getMaxBufferLength(null==s?void 0:s.len)+o||(s=(n=t.fragments).length,o=t.edge,a=this.fragPrevious,i<o?(o=e.maxFragLookUpTolerance,!(r=qt(a,n,Math.max(n[0].start,i),o))&&a&&a.start<n[0].start&&(r=n[0])):r=n[s-1],(r=this.mapToInitFragWhenRequired(r))&&this.fragmentTracker.getState(r)===h.NOT_LOADED&&(r.encrypted?this.loadKey(r,t):this.loadFragment(r,t,i)))):this.state=m},i.getMaxBufferLength=function(t){var e=r.prototype.getMaxBufferLength.call(this);return t?Math.max(e,t):e},i.loadFragment=function(t,e,i){"initSegment"===(this.fragCurrent=t).sn?this._loadInitSegment(t):(this.startFragRequested=!0,r.prototype.loadFragment.call(this,t,e,i))},(e=t).prototype),s=[{key:"mediaBufferTimeRanges",get:function(){return new Ke(this.tracksBuffered[this.currentTrackId]||[])}}],a=0;a<s.length;a++){var o=s[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(n,o.key,o)}return Object.defineProperty(e,"prototype",{writable:!1}),t}(i),Ke=function(r){this.buffered=void 0;function e(t,e,i){if((e>>>=0)>i-1)throw new DOMException("Failed to execute '"+t+"' on 'TimeRanges': The index provided ("+e+") is greater than the maximum bound ("+i+")");return r[e][t]}this.buffered={get length(){return r.length},end:function(t){return e("end",t,r.length)},start:function(t){return e("start",t,r.length)}}};function Ve(t,e){return(Ve=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function We(t){for(var e=[],i=0;i<t.length;i++){var r=t[i];"subtitles"===r.kind&&r.label&&e.push(t[i])}return e}function Ye(t){var e=t;return Ze.hasOwnProperty(t)&&(e=Ze[t]),String.fromCharCode(e)}var b,t=function(i){function t(t){var e;return(e=i.call(this,t,"[subtitle-track-controller]")||this).media=null,e.tracks=[],e.groupId=null,e.tracksInGroup=[],e.trackId=-1,e.selectDefaultTrack=!0,e.queuedDefaultTrack=-1,e.trackChangeListener=function(){return e.onTextTracksChanged()},e.asyncPollTrackChange=function(){return e.pollTrackChange(0)},e.useTextTrackPolling=!1,e.subtitlePollingInterval=-1,e._subtitleDisplay=!0,e.registerListeners(),e}e=i,(r=t).prototype=Object.create(e.prototype),Ve(r.prototype.constructor=r,e);for(var e,r=t.prototype,n=(r.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,i.prototype.destroy.call(this)},r.registerListeners=function(){var t=this.hls;t.on(y.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(y.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(y.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(y.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(y.Events.LEVEL_LOADING,this.onLevelLoading,this),t.on(y.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(y.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(y.Events.ERROR,this.onError,this)},r.unregisterListeners=function(){var t=this.hls;t.off(y.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(y.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(y.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(y.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.off(y.Events.LEVEL_LOADING,this.onLevelLoading,this),t.off(y.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(y.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(y.Events.ERROR,this.onError,this)},r.onMediaAttached=function(t,e){this.media=e.media,this.media&&(-1<this.queuedDefaultTrack&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},r.pollTrackChange=function(t){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,t)},r.onMediaDetaching=function(){this.media&&(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),-1<this.trackId&&(this.queuedDefaultTrack=this.trackId),We(this.media.textTracks).forEach(function(t){ut(t)}),this.subtitleTrack=-1,this.media=null)},r.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},r.onManifestParsed=function(t,e){this.tracks=e.subtitleTracks},r.onSubtitleTrackLoaded=function(t,e){var i,r=e.id,n=e.details,s=this.trackId,s=this.tracksInGroup[s];s?(i=s.details,s.details=e.details,this.log("subtitle track "+r+" loaded ["+n.startSN+"-"+n.endSN+"]"),r===this.trackId&&(this.retryCount=0,this.playlistLoaded(r,e,i))):this.warn("Invalid subtitle track id "+r)},r.onLevelLoading=function(t,e){this.switchLevel(e.level)},r.onLevelSwitching=function(t,e){this.switchLevel(e.level)},r.switchLevel=function(t){var e,i,r,n,t=this.hls.levels[t];null!=t&&t.textGroupIds&&(e=t.textGroupIds[t.urlId],this.groupId!==e)&&(t=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,i=this.tracks.filter(function(t){return!e||t.groupId===e}),this.tracksInGroup=i,r=this.findTrackId(null==t?void 0:t.name)||this.findTrackId(),this.groupId=e,n={subtitleTracks:i},this.log("Updating subtitle tracks, "+i.length+' track(s) found in "'+e+'" group-id'),this.hls.trigger(y.Events.SUBTITLE_TRACKS_UPDATED,n),-1!==r)&&this.setSubtitleTrack(r,t)},r.findTrackId=function(t){for(var e=this.tracksInGroup,i=0;i<e.length;i++){var r=e[i];if((!this.selectDefaultTrack||r.default)&&(!t||t===r.name))return r.id}return-1},r.onError=function(t,e){i.prototype.onError.call(this,t,e),!e.fatal&&e.context&&e.context.type===c.PlaylistContextType.SUBTITLE_TRACK&&e.context.id===this.trackId&&e.context.groupId===this.groupId&&this.retryLoadingOrFail(e)},r.loadPlaylist=function(t){var e=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(e)){var i=e.id,r=e.groupId,e=e.url;if(t)try{e=t.addDirectives(e)}catch(t){this.warn("Could not construct new URL with HLS Delivery Directives: "+t)}this.log("Loading subtitle playlist for id "+i),this.hls.trigger(y.Events.SUBTITLE_TRACK_LOADING,{url:e,id:i,groupId:r,deliveryDirectives:t||null})}},r.toggleTrackModes=function(t){var e,i=this,r=this.media,n=this.trackId;r&&(e=(r=We(r.textTracks)).filter(function(t){return t.groupId===i.groupId}),-1===t?[].slice.call(r).forEach(function(t){t.mode="disabled"}):(r=e[n])&&(r.mode="disabled"),n=e[t])&&(n.mode=this.subtitleDisplay?"showing":"hidden")},r.setSubtitleTrack=function(t,e){var i,r,n,s,a,o=this.tracksInGroup;this.media?(this.trackId!==t&&this.toggleTrackModes(t),this.trackId===t&&(-1===t||null!=(i=o[t])&&i.details)||t<-1||t>=o.length||(this.clearTimer(),i=o[t],this.log("Switching to subtitle track "+t),this.trackId=t,i?(o=i.id,r=i.groupId,n=i.name,s=i.type,a=i.url,this.hls.trigger(y.Events.SUBTITLE_TRACK_SWITCH,{id:o,groupId:void 0===r?"":r,name:n,type:s,url:a}),o=this.switchParams(i.url,null==e?void 0:e.details),this.loadPlaylist(o)):this.hls.trigger(y.Events.SUBTITLE_TRACK_SWITCH,{id:t}))):this.queuedDefaultTrack=t},r.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),this.media&&this.hls.config.renderTextTracksNatively){for(var t=-1,e=We(this.media.textTracks),i=0;i<e.length;i++)if("hidden"===e[i].mode)t=i;else if("showing"===e[i].mode){t=i;break}this.subtitleTrack!==t&&(this.subtitleTrack=t)}},(e=t).prototype),s=[{key:"subtitleDisplay",get:function(){return this._subtitleDisplay},set:function(t){this._subtitleDisplay=t,-1<this.trackId&&this.toggleTrackModes(this.trackId)}},{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(t){this.selectDefaultTrack=!1;var e=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(t,e)}}],a=0;a<s.length;a++){var o=s[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(n,o.key,o)}return Object.defineProperty(e,"prototype",{writable:!1}),t}(t),qe=((s=ri.prototype).append=function(t,e){var i=this.queues[e];i.push(t),1===i.length&&this.buffers[e]&&this.executeNext(e)},s.insertAbort=function(t,e){this.queues[e].unshift(t),this.executeNext(e)},s.appendBlocker=function(t){var e,i=new Promise(function(t){e=t}),r={execute:e,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(r,t),i},s.executeNext=function(t){var e=this.buffers,i=this.queues,r=e[t],i=i[t];if(i.length){var n=i[0];try{n.execute()}catch(e){V.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),n.onError(e),r&&r.updating||(i.shift(),this.executeNext(t))}}},s.shiftAndExecuteNext=function(t){this.queues[t].shift(),this.executeNext(t)},s.current=function(t){return this.queues[t][0]},ri),Xe=pe(),ze=/([ha]vc.)(?:\.[^.,]+)+/,s=((s=ii.prototype).hasSourceTypes=function(){return 0<this.getSourceBufferTypes().length||0<Object.keys(this.pendingTracks).length},s.destroy=function(){this.unregisterListeners(),this.details=null},s.registerListeners=function(){var t=this.hls;t.on(y.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(y.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(y.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(y.Events.BUFFER_RESET,this.onBufferReset,this),t.on(y.Events.BUFFER_APPENDING,this.onBufferAppending,this),t.on(y.Events.BUFFER_CODECS,this.onBufferCodecs,this),t.on(y.Events.BUFFER_EOS,this.onBufferEos,this),t.on(y.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(y.Events.LEVEL_UPDATED,this.onLevelUpdated,this),t.on(y.Events.FRAG_PARSED,this.onFragParsed,this),t.on(y.Events.FRAG_CHANGED,this.onFragChanged,this)},s.unregisterListeners=function(){var t=this.hls;t.off(y.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(y.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(y.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.off(y.Events.BUFFER_RESET,this.onBufferReset,this),t.off(y.Events.BUFFER_APPENDING,this.onBufferAppending,this),t.off(y.Events.BUFFER_CODECS,this.onBufferCodecs,this),t.off(y.Events.BUFFER_EOS,this.onBufferEos,this),t.off(y.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(y.Events.LEVEL_UPDATED,this.onLevelUpdated,this),t.off(y.Events.FRAG_PARSED,this.onFragParsed,this),t.off(y.Events.FRAG_CHANGED,this.onFragChanged,this)},s._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new qe(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},s.onManifestParsed=function(t,e){var i=2;(!e.audio||e.video)&&e.altAudio||(i=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=i,this.details=null,V.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},s.onMediaAttaching=function(t,e){var i,e=this.media=e.media;e&&Xe&&((i=this.mediaSource=new Xe).addEventListener("sourceopen",this._onMediaSourceOpen),i.addEventListener("sourceended",this._onMediaSourceEnded),i.addEventListener("sourceclose",this._onMediaSourceClose),e.src=self.URL.createObjectURL(i),this._objectUrl=e.src)},s.onMediaDetaching=function(){var t=this.media,e=this.mediaSource,i=this._objectUrl;if(e){if(V.logger.log("[buffer-controller]: media source detaching"),"open"===e.readyState)try{e.endOfStream()}catch(t){V.logger.warn("[buffer-controller]: onMediaDetaching: "+t.message+" while calling endOfStream")}this.onBufferReset(),e.removeEventListener("sourceopen",this._onMediaSourceOpen),e.removeEventListener("sourceended",this._onMediaSourceEnded),e.removeEventListener("sourceclose",this._onMediaSourceClose),t&&(i&&self.URL.revokeObjectURL(i),t.src===i?(t.removeAttribute("src"),t.load()):V.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(y.Events.MEDIA_DETACHED,void 0)},s.onBufferReset=function(){var i=this;this.getSourceBufferTypes().forEach(function(e){var t=i.sourceBuffer[e];try{t&&(i.removeBufferListeners(e),i.mediaSource&&i.mediaSource.removeSourceBuffer(t),i.sourceBuffer[e]=void 0)}catch(t){V.logger.warn("[buffer-controller]: Failed to reset the "+e+" buffer",t)}}),this._initSourceBuffer()},s.onBufferCodecs=function(t,h){var u=this,d=this.getSourceBufferTypes().length;Object.keys(h).forEach(function(t){var e,i,r,n,s,a,o,l;d?(e=u.tracks[t])&&"function"==typeof e.buffer.changeType&&(i=(a=h[t]).id,r=a.codec,n=a.levelCodec,s=a.container,a=a.metadata,(o=(e.levelCodec||e.codec).replace(ze,"$1"))!==(l=(n||r).replace(ze,"$1")))&&(u.appendChangeType(t,s+";codecs="+(n||r)),V.logger.log("[buffer-controller]: switching codec "+o+" to "+l),u.tracks[t]={buffer:e.buffer,codec:r,container:s,levelCodec:n,metadata:a,id:i}):u.pendingTracks[t]=h[t]}),d||(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks())},s.appendChangeType=function(e,i){var r=this,n=this.operationQueue;n.append({execute:function(){var t=r.sourceBuffer[e];t&&(V.logger.log("[buffer-controller]: changing "+e+" sourceBuffer type to "+i),t.changeType(i)),n.shiftAndExecuteNext(e)},onStart:function(){},onComplete:function(){},onError:function(t){V.logger.warn("[buffer-controller]: Failed to change "+e+" SourceBuffer type",t)}},e)},s.onBufferAppending=function(t,e){var n=this,i=this.hls,r=this.operationQueue,s=this.tracks,a=e.data,o=e.type,l=e.frag,h=e.part,u=e.chunkMeta,d=u.buffering[o],e=self.performance.now(),c=(d.start=e,l.stats.buffering),f=h?h.stats.buffering:null,e=(0===c.start&&(c.start=e),f&&0===f.start&&(f.start=e),s.audio),g="audio"===o&&1===u.id&&"audio/mpeg"===(null==e?void 0:e.container);r.append({execute:function(){var t,e;d.executeStart=self.performance.now(),g&&(t=n.sourceBuffer[o])&&(e=l.start-t.timestampOffset,.1<=Math.abs(e))&&(V.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+l.start+" (delta: "+e+") sn: "+l.sn+")"),t.timestampOffset=l.start),n.appendExecutor(a,o)},onStart:function(){},onComplete:function(){var t,e=self.performance.now(),i=(d.executeEnd=d.end=e,0===c.first&&(c.first=e),f&&0===f.first&&(f.first=e),n.sourceBuffer),r={};for(t in i)r[t]=p.getBuffered(i[t]);n.appendError=0,n.hls.trigger(y.Events.BUFFER_APPENDED,{type:o,frag:l,part:h,chunkMeta:u,parent:l.type,timeRanges:r})},onError:function(t){V.logger.error("[buffer-controller]: Error encountered while trying to append to the "+o+" SourceBuffer",t);var e={type:v.ErrorTypes.MEDIA_ERROR,parent:l.type,details:v.ErrorDetails.BUFFER_APPEND_ERROR,err:t,fatal:!1};t.code===DOMException.QUOTA_EXCEEDED_ERR?e.details=v.ErrorDetails.BUFFER_FULL_ERROR:(n.appendError++,e.details=v.ErrorDetails.BUFFER_APPEND_ERROR,n.appendError>i.config.appendErrorMaxRetry&&(V.logger.error("[buffer-controller]: Failed "+i.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),e.fatal=!0,i.stopLoad())),i.trigger(y.Events.ERROR,e)}},o)},s.onBufferFlushing=function(t,i){function e(e){return{execute:r.removeExecutor.bind(r,e,i.startOffset,i.endOffset),onStart:function(){},onComplete:function(){r.hls.trigger(y.Events.BUFFER_FLUSHED,{type:e})},onError:function(t){V.logger.warn("[buffer-controller]: Failed to remove from "+e+" SourceBuffer",t)}}}var r=this,n=this.operationQueue;i.type?n.append(e(i.type),i.type):this.getSourceBufferTypes().forEach(function(t){n.append(e(t),t)})},s.onFragParsed=function(t,e){var i=this,r=e.frag,n=e.part,e=[],s=(n||r).elementaryStreams;s[B.ElementaryStreamTypes.AUDIOVIDEO]?e.push("audiovideo"):(s[B.ElementaryStreamTypes.AUDIO]&&e.push("audio"),s[B.ElementaryStreamTypes.VIDEO]&&e.push("video")),0===e.length&&V.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+r.type+" level: "+r.level+" sn: "+r.sn),this.blockBuffers(function(){var t=self.performance.now(),t=(r.stats.buffering.end=t,n&&(n.stats.buffering.end=t),(n||r).stats);i.hls.trigger(y.Events.FRAG_BUFFERED,{frag:r,part:n,stats:t,id:r.type})},e)},s.onFragChanged=function(t,e){this.flushBackBuffer()},s.onBufferEos=function(t,r){var n=this;this.getSourceBufferTypes().reduce(function(t,e){var i=n.sourceBuffer[e];return r.type&&r.type!==e||i&&!i.ended&&(i.ended=!0,V.logger.log("[buffer-controller]: "+e+" sourceBuffer now EOS")),t&&!(i&&!i.ended)},!0)&&this.blockBuffers(function(){var t=n.mediaSource;t&&"open"===t.readyState&&t.endOfStream()})},s.onLevelUpdated=function(t,e){e=e.details;e.fragments.length&&(this.details=e,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},s.flushBackBuffer=function(){var t,e,i,r,n=this.hls,s=this.details,a=this.media,o=this.sourceBuffer;a&&null!==s&&(t=this.getSourceBufferTypes()).length&&(i=s.live&&null!==n.config.liveBackBufferLength?n.config.liveBackBufferLength:n.config.backBufferLength,!(0,K.isFiniteNumber)(i)||i<0||(a=a.currentTime,e=s.levelTargetDuration,i=Math.max(i,e),r=Math.floor(a/e)*e-i,t.forEach(function(t){var e=o[t];e&&0<(e=p.getBuffered(e)).length&&r>e.start(0)&&(n.trigger(y.Events.BACK_BUFFER_REACHED,{bufferEnd:r}),s.live&&n.trigger(y.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:r}),n.trigger(y.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:r,type:t}))})))},s.updateMediaElementDuration=function(){var t,e,i,r,n,s;this.details&&this.media&&this.mediaSource&&"open"===this.mediaSource.readyState&&(t=this.details,e=this.hls,n=this.media,i=this.mediaSource,r=t.fragments[0].start+t.totalduration,n=n.duration,s=(0,K.isFiniteNumber)(i.duration)?i.duration:0,t.live&&e.config.liveDurationInfinity?(V.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),i.duration=1/0,this.updateSeekableRange(t)):(s<r&&n<r||!(0,K.isFiniteNumber)(n))&&(V.logger.log("[buffer-controller]: Updating Media Source duration to "+r.toFixed(3)),i.duration=r))},s.updateSeekableRange=function(t){var e=this.mediaSource,i=t.fragments;i.length&&t.live&&null!=e&&e.setLiveSeekableRange&&(i=Math.max(0,i[0].start),t=Math.max(i,i+t.totalduration),e.setLiveSeekableRange(i,t))},s.checkPendingTracks=function(){var t=this.bufferCodecEventsExpected,e=this.operationQueue,i=this.pendingTracks,r=Object.keys(i).length;(r&&!t||2===r)&&(this.createSourceBuffers(i),this.pendingTracks={},0===(t=this.getSourceBufferTypes()).length?this.hls.trigger(y.Events.ERROR,{type:v.ErrorTypes.MEDIA_ERROR,details:v.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"}):t.forEach(function(t){e.executeNext(t)}))},s.createSourceBuffers=function(t){var e=this.sourceBuffer,i=this.mediaSource;if(!i)throw Error("createSourceBuffers called when mediaSource was null");var r,n=0;for(r in t)if(!e[r]){var s=t[r];if(!s)throw Error("source buffer exists for track "+r+", however track does not");var a=s.levelCodec||s.codec,o=s.container+";codecs="+a;V.logger.log("[buffer-controller]: creating sourceBuffer("+o+")");try{var l=e[r]=i.addSourceBuffer(o),h=r;this.addBufferListener(h,"updatestart",this._onSBUpdateStart),this.addBufferListener(h,"updateend",this._onSBUpdateEnd),this.addBufferListener(h,"error",this._onSBUpdateError),this.tracks[r]={buffer:l,codec:a,container:s.container,levelCodec:s.levelCodec,metadata:s.metadata,id:s.id},n++}catch(t){V.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+t.message),this.hls.trigger(y.Events.ERROR,{type:v.ErrorTypes.MEDIA_ERROR,details:v.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:t,mimeType:o})}}n&&this.hls.trigger(y.Events.BUFFER_CREATED,{tracks:this.tracks})},s._onSBUpdateStart=function(t){this.operationQueue.current(t).onStart()},s._onSBUpdateEnd=function(t){var e=this.operationQueue;e.current(t).onComplete(),e.shiftAndExecuteNext(t)},s._onSBUpdateError=function(t,e){V.logger.error("[buffer-controller]: "+t+" SourceBuffer error",e),this.hls.trigger(y.Events.ERROR,{type:v.ErrorTypes.MEDIA_ERROR,details:v.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});t=this.operationQueue.current(t);t&&t.onError(e)},s.removeExecutor=function(t,e,i){var r=this.media,n=this.mediaSource,s=this.operationQueue,a=this.sourceBuffer[t];r&&n&&a?(r=(0,K.isFiniteNumber)(r.duration)?r.duration:1/0,n=(0,K.isFiniteNumber)(n.duration)?n.duration:1/0,(e=Math.max(0,e))<(i=Math.min(i,r,n))?(V.logger.log("[buffer-controller]: Removing ["+e+","+i+"] from the "+t+" SourceBuffer"),a.remove(e,i)):s.shiftAndExecuteNext(t)):(V.logger.warn("[buffer-controller]: Attempting to remove from the "+t+" SourceBuffer, but it does not exist"),s.shiftAndExecuteNext(t))},s.appendExecutor=function(t,e){var i=this.operationQueue,r=this.sourceBuffer[e];r?(r.ended=!1,r.appendBuffer(t)):(V.logger.warn("[buffer-controller]: Attempting to append to the "+e+" SourceBuffer, but it does not exist"),i.shiftAndExecuteNext(e))},s.blockBuffers=function(t,e){var i,r,n=this;(e=void 0===e?this.getSourceBufferTypes():e).length?(i=this.operationQueue,r=e.map(function(t){return i.appendBlocker(t)}),Promise.all(r).then(function(){t(),e.forEach(function(t){var e=n.sourceBuffer[t];e&&e.updating||i.shiftAndExecuteNext(t)})})):(V.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(t))},s.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},s.addBufferListener=function(t,e,i){var r=this.sourceBuffer[t];r&&(i=i.bind(this,t),this.listeners[t].push({event:e,listener:i}),r.addEventListener(e,i))},s.removeBufferListeners=function(t){var e=this.sourceBuffer[t];e&&this.listeners[t].forEach(function(t){e.removeEventListener(t.event,t.listener)})},ii),Ze={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},L=15,o=100,Qe={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},$e={17:2,18:4,21:6,22:8,23:10,19:13,20:15},Je={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},ti={25:2,26:4,29:6,30:8,31:10,27:13,28:15},ei=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];function ii(t){var r=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var t=r.hls,e=r.media,i=r.mediaSource;V.logger.log("[buffer-controller]: Media source opened"),e&&(r.updateMediaElementDuration(),t.trigger(y.Events.MEDIA_ATTACHED,{media:e})),i&&i.removeEventListener("sourceopen",r._onMediaSourceOpen),r.checkPendingTracks()},this._onMediaSourceClose=function(){V.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){V.logger.log("[buffer-controller]: Media source ended")},this.hls=t,this._initSourceBuffer(),this.registerListeners()}function ri(t){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=t}(D=b=b||{})[D.ERROR=0]="ERROR",D[D.TEXT=1]="TEXT",D[D.WARNING=2]="WARNING",D[D.INFO=2]="INFO",D[D.DEBUG=3]="DEBUG",D[D.DATA=3]="DATA";function ni(t){for(var e=[],i=0;i<t.length;i++)e.push(t[i].toString(16));return e}mi.prototype.log=function(t,e){this.verboseLevel>=t&&V.logger.log(this.time+" ["+t+"] "+e)};var si=mi,ai=((D=pi.prototype).reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},D.setStyles=function(t){for(var e=["foreground","underline","italics","background","flash"],i=0;i<e.length;i++){var r=e[i];t.hasOwnProperty(r)&&(this[r]=t[r])}},D.isDefault=function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},D.equals=function(t){return this.foreground===t.foreground&&this.underline===t.underline&&this.italics===t.italics&&this.background===t.background&&this.flash===t.flash},D.copy=function(t){this.foreground=t.foreground,this.underline=t.underline,this.italics=t.italics,this.background=t.background,this.flash=t.flash},D.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},pi),oi=((D=vi.prototype).reset=function(){this.uchar=" ",this.penState.reset()},D.setChar=function(t,e){this.uchar=t,this.penState.copy(e)},D.setPenState=function(t){this.penState.copy(t)},D.equals=function(t){return this.uchar===t.uchar&&this.penState.equals(t.penState)},D.copy=function(t){this.uchar=t.uchar,this.penState.copy(t.penState)},D.isEmpty=function(){return" "===this.uchar&&this.penState.isDefault()},vi),li=((D=gi.prototype).equals=function(t){for(var e=!0,i=0;i<o;i++)if(!this.chars[i].equals(t.chars[i])){e=!1;break}return e},D.copy=function(t){for(var e=0;e<o;e++)this.chars[e].copy(t.chars[e])},D.isEmpty=function(){for(var t=!0,e=0;e<o;e++)if(!this.chars[e].isEmpty()){t=!1;break}return t},D.setCursor=function(t){this.pos!==t&&(this.pos=t),this.pos<0?(this.logger.log(b.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>o&&(this.logger.log(b.DEBUG,"Too large cursor position "+this.pos),this.pos=o)},D.moveCursor=function(t){var e=this.pos+t;if(1<t)for(var i=this.pos+1;i<e+1;i++)this.chars[i].setPenState(this.currPenState);this.setCursor(e)},D.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},D.insertChar=function(t){144<=t&&this.backSpace();var e=Ye(t);this.pos>=o?this.logger.log(b.ERROR,"Cannot insert "+t.toString(16)+" ("+e+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(e,this.currPenState),this.moveCursor(1))},D.clearFromPos=function(t){for(var e=t;e<o;e++)this.chars[e].reset()},D.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},D.clearToEndOfRow=function(){this.clearFromPos(this.pos)},D.getTextString=function(){for(var t=[],e=!0,i=0;i<o;i++){var r=this.chars[i].uchar;" "!==r&&(e=!1),t.push(r)}return e?"":t.join("")},D.setPenStyles=function(t){this.currPenState.setStyles(t),this.chars[this.pos].setPenState(this.currPenState)},gi),hi=((D=fi.prototype).reset=function(){for(var t=0;t<L;t++)this.rows[t].clear();this.currRow=14},D.equals=function(t){for(var e=!0,i=0;i<L;i++)if(!this.rows[i].equals(t.rows[i])){e=!1;break}return e},D.copy=function(t){for(var e=0;e<L;e++)this.rows[e].copy(t.rows[e])},D.isEmpty=function(){for(var t=!0,e=0;e<L;e++)if(!this.rows[e].isEmpty()){t=!1;break}return t},D.backSpace=function(){this.rows[this.currRow].backSpace()},D.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},D.insertChar=function(t){this.rows[this.currRow].insertChar(t)},D.setPen=function(t){this.rows[this.currRow].setPenStyles(t)},D.moveCursor=function(t){this.rows[this.currRow].moveCursor(t)},D.setCursor=function(t){this.logger.log(b.INFO,"setCursor: "+t),this.rows[this.currRow].setCursor(t)},D.setPAC=function(t){this.logger.log(b.INFO,"pacData = "+JSON.stringify(t));var e=t.row-1;if(this.nrRollUpRows&&e<this.nrRollUpRows-1&&(e=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==e){for(var i=0;i<L;i++)this.rows[i].clear();var r=this.currRow+1-this.nrRollUpRows,n=this.lastOutputScreen;if(n){var s=n.rows[r].cueStartTime,a=this.logger.time;if(s&&null!==a&&s<a)for(var o=0;o<this.nrRollUpRows;o++)this.rows[e-this.nrRollUpRows+o+1].copy(n.rows[r+o])}}this.currRow=e;s=this.rows[this.currRow],null!==t.indent&&(a=t.indent,a=Math.max(a-1,0),s.setCursor(t.indent),t.color=s.chars[a].penState.foreground),s={foreground:t.color,underline:t.underline,italics:t.italics,background:"black",flash:!1};this.setPen(s)},D.setBkgData=function(t){this.logger.log(b.INFO,"bkgData = "+JSON.stringify(t)),this.backSpace(),this.setPen(t),this.insertChar(32)},D.setRollUpRows=function(t){this.nrRollUpRows=t},D.rollUp=function(){var t;null!==this.nrRollUpRows?(this.logger.log(b.TEXT,this.getDisplayText()),t=this.currRow+1-this.nrRollUpRows,(t=this.rows.splice(t,1)[0]).clear(),this.rows.splice(this.currRow,0,t),this.logger.log(b.INFO,"Rolling up")):this.logger.log(b.DEBUG,"roll_up but nrRollUpRows not set yet")},D.getDisplayText=function(t){t=t||!1;for(var e=[],i="",r=0;r<L;r++){var n=this.rows[r].getTextString();n&&e.push(t?"Row "+(r+1)+": '"+n+"'":n.trim())}return i=0<e.length?t?"["+e.join(" | ")+"]":e.join("\n"):i},D.getTextAndFormat=function(){return this.rows},fi),ui=((D=ci.prototype).reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},D.getHandler=function(){return this.outputFilter},D.setHandler=function(t){this.outputFilter=t},D.setPAC=function(t){this.writeScreen.setPAC(t)},D.setBkgData=function(t){this.writeScreen.setBkgData(t)},D.setMode=function(t){t!==this.mode&&(this.mode=t,this.logger.log(b.INFO,"MODE="+t),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=t)},D.insertChars=function(t){for(var e=0;e<t.length;e++)this.writeScreen.insertChar(t[e]);var i=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(b.INFO,i+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(this.logger.log(b.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},D.ccRCL=function(){this.logger.log(b.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},D.ccBS=function(){this.logger.log(b.INFO,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory)&&this.outputDataUpdate()},D.ccAOF=function(){},D.ccAON=function(){},D.ccDER=function(){this.logger.log(b.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},D.ccRU=function(t){this.logger.log(b.INFO,"RU("+t+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(t)},D.ccFON=function(){this.logger.log(b.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},D.ccRDC=function(){this.logger.log(b.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},D.ccTR=function(){this.logger.log(b.INFO,"TR"),this.setMode("MODE_TEXT")},D.ccRTD=function(){this.logger.log(b.INFO,"RTD"),this.setMode("MODE_TEXT")},D.ccEDM=function(){this.logger.log(b.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},D.ccCR=function(){this.logger.log(b.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},D.ccENM=function(){this.logger.log(b.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},D.ccEOC=function(){var t;this.logger.log(b.INFO,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode&&(t=this.displayedMemory,this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=t,this.writeScreen=this.nonDisplayedMemory,this.logger.log(b.TEXT,"DISP: "+this.displayedMemory.getDisplayText())),this.outputDataUpdate(!0)},D.ccTO=function(t){this.logger.log(b.INFO,"TO("+t+") - Tab Offset"),this.writeScreen.moveCursor(t)},D.ccMIDROW=function(t){var e={flash:!1};e.underline=t%2==1,e.italics=46<=t,e.italics?e.foreground="white":(t=Math.floor(t/2)-16,e.foreground=["white","green","blue","cyan","red","yellow","magenta"][t]),this.logger.log(b.INFO,"MIDROW: "+JSON.stringify(e)),this.writeScreen.setPen(e)},D.outputDataUpdate=function(t){void 0===t&&(t=!1);var e=this.logger.time;null!==e&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,e,this.lastOutputScreen),t&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:e):this.cueStartTime=e,this.lastOutputScreen.copy(this.displayedMemory))},D.cueSplitAtTime=function(t){!this.outputFilter||this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,t,this.displayedMemory),this.cueStartTime=t)},ci);function di(t,e,i){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var r=new si;this.channels=[null,new ui(t,e,r),new ui(t+1,i,r)],this.cmdHistory={a:null,b:null},this.logger=r}function ci(t,e,i){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=t,this.outputFilter=e,this.mode=null,this.verbose=0,this.displayedMemory=new hi(i),this.nonDisplayedMemory=new hi(i),this.lastOutputScreen=new hi(i),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=i}function fi(t){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var e=0;e<L;e++)this.rows.push(new li(t));this.logger=t,this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}function gi(t){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var e=0;e<o;e++)this.chars.push(new oi);this.logger=t,this.pos=0,this.currPenState=new ai}function vi(t,e,i,r,n,s){this.uchar=void 0,this.penState=void 0,this.uchar=t||" ",this.penState=new ai(e,i,r,n,s)}function pi(t,e,i,r,n){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=t||"white",this.underline=e||!1,this.italics=i||!1,this.background=r||"black",this.flash=n||!1}function mi(){this.time=null,this.verboseLevel=b.ERROR}function Ti(t,e,i){i.a=t,i.b=e}function yi(t,e,i){return i.a===t&&i.b===e}(D=di.prototype).getHandler=function(t){return this.channels[t].getHandler()},D.setHandler=function(t,e){this.channels[t].setHandler(e)},D.addData=function(t,e){var i,r=!1;this.logger.time=t;for(var n=0;n<e.length;n+=2){var s,a=127&e[n],o=127&e[n+1];0==a&&0==o||(this.logger.log(b.DATA,"["+ni([e[n],e[n+1]])+"] -> ("+ni([a,o])+")"),!(i=(i=(i=(i=this.parseCmd(a,o))||this.parseMidrow(a,o))||this.parsePAC(a,o))||this.parseBackgroundAttributes(a,o))&&(r=this.parseChars(a,o))&&((s=this.currentChannel)&&0<s?this.channels[s].insertChars(r):this.logger.log(b.WARNING,"No channel found yet. TEXT-MODE?")),i)||r||this.logger.log(b.WARNING,"Couldn't parse cleaned data "+ni([a,o])+" orig: "+ni([e[n],e[n+1]]))}},D.parseCmd=function(t,e){var i,r,n=this.cmdHistory;return((20===t||28===t||21===t||29===t)&&32<=e&&e<=47||(23===t||31===t)&&33<=e&&e<=35)&&(yi(t,e,n)?(Ti(null,null,n),this.logger.log(b.DEBUG,"Repeated command ("+ni([t,e])+") is dropped")):(r=this.channels[i=20===t||21===t||23===t?1:2],20===t||21===t||28===t||29===t?32===e?r.ccRCL():33===e?r.ccBS():34===e?r.ccAOF():35===e?r.ccAON():36===e?r.ccDER():37===e?r.ccRU(2):38===e?r.ccRU(3):39===e?r.ccRU(4):40===e?r.ccFON():41===e?r.ccRDC():42===e?r.ccTR():43===e?r.ccRTD():44===e?r.ccEDM():45===e?r.ccCR():46===e?r.ccENM():47===e&&r.ccEOC():r.ccTO(e-32),Ti(t,e,n),this.currentChannel=i),!0)},D.parseMidrow=function(t,e){var i;return(17===t||25===t)&&32<=e&&e<=47&&((i=17===t?1:2)!==this.currentChannel?(this.logger.log(b.ERROR,"Mismatch channel in midrow parsing"),!1):!!(i=this.channels[i])&&(i.ccMIDROW(e),this.logger.log(b.DEBUG,"MIDROW ("+ni([t,e])+")"),!0))},D.parsePAC=function(t,e){var i,r,n=this.cmdHistory;return((17<=t&&t<=23||25<=t&&t<=31)&&64<=e&&e<=127||(16===t||24===t)&&64<=e&&e<=95)&&(yi(t,e,n)?(Ti(null,null,n),!0):!!(r=this.channels[i=t<=23?1:2])&&(r.setPAC(this.interpretPAC((64<=e&&e<=95?1==i?Qe:Je:1==i?$e:ti)[t],e)),Ti(t,e,n),this.currentChannel=i,!0))},D.interpretPAC=function(t,e){t={color:null,italics:!1,indent:null,underline:!1,row:t},e=95<e?e-96:e-64;return t.underline=1==(1&e),e<=13?t.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(e/2)]:e<=15?(t.italics=!0,t.color="white"):t.indent=4*Math.floor((e-16)/2),t},D.parseChars=function(t,e){var i,r=null,n=null;return 17<=(n=25<=t?(i=2,t-8):(i=1,t))&&n<=19?(this.logger.log(b.INFO,"Special char '"+Ye(n=17===n?e+80:18===n?e+112:e+144)+"' in channel "+i),r=[n]):32<=t&&t<=127&&(r=0===e?[t]:[t,e]),r&&(i=ni(r),this.logger.log(b.DEBUG,"Char codes =  "+i.join(",")),Ti(t,e,this.cmdHistory)),r},D.parseBackgroundAttributes=function(t,e){var i,r;return((16===t||24===t)&&32<=e&&e<=47||(23===t||31===t)&&45<=e&&e<=47)&&(r={},16===t||24===t?(i=Math.floor((e-32)/2),r.background=ei[i],e%2==1&&(r.background=r.background+"_semi")):45===e?r.background="transparent":(r.foreground="black",47===e&&(r.underline=!0)),this.channels[t<=23?1:2].setBkgData(r),Ti(t,e,this.cmdHistory),!0)},D.reset=function(){for(var t=0;t<Object.keys(this.channels).length;t++){var e=this.channels[t];e&&e.reset()}this.cmdHistory={a:null,b:null}},D.cueSplitAtTime=function(t){for(var e=0;e<this.channels.length;e++){var i=this.channels[e];i&&i.cueSplitAtTime(t)}};const Ei=di;(D=ki.prototype).dispatchCue=function(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},D.newCue=function(t,e,i){(null===this.startTime||this.startTime>t)&&(this.startTime=t),this.endTime=e,this.screen=i,this.timelineController.createCaptionsTrack(this.trackName)},D.reset=function(){this.cueRanges=[],this.startTime=null};var Si,bi,Li=ki;function ki(t,e){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=t,this.trackName=e}const Di="undefined"!=typeof self&&self.VTTCue?self.VTTCue:(Si=["","lr","rl"],bi=["start","middle","end","left","right"],_i.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},_i);function Ri(t,e){return"string"==typeof e&&!!Array.isArray(t)&&(e=e.toLowerCase(),!!~t.indexOf(e))&&e}function Ai(t){return Ri(bi,t)}function k(t){for(var e=arguments.length,i=new Array(1<e?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];for(var n=1;n<arguments.length;n++){var s,a=arguments[n];for(s in a)t[s]=a[s]}return t}function _i(t,e,i){var r=this,n={enumerable:!0},s=(r.hasBeenReset=!1,""),a=!1,o=t,l=e,h=i,u=null,d="",c=!0,f="auto",g="start",v=50,p="middle",m=50,T="middle";Object.defineProperty(r,"id",k({},n,{get:function(){return s},set:function(t){s=""+t}})),Object.defineProperty(r,"pauseOnExit",k({},n,{get:function(){return a},set:function(t){a=!!t}})),Object.defineProperty(r,"startTime",k({},n,{get:function(){return o},set:function(t){if("number"!=typeof t)throw new TypeError("Start time must be set to a number.");o=t,this.hasBeenReset=!0}})),Object.defineProperty(r,"endTime",k({},n,{get:function(){return l},set:function(t){if("number"!=typeof t)throw new TypeError("End time must be set to a number.");l=t,this.hasBeenReset=!0}})),Object.defineProperty(r,"text",k({},n,{get:function(){return h},set:function(t){h=""+t,this.hasBeenReset=!0}})),Object.defineProperty(r,"region",k({},n,{get:function(){return u},set:function(t){u=t,this.hasBeenReset=!0}})),Object.defineProperty(r,"vertical",k({},n,{get:function(){return d},set:function(t){t=Ri(Si,t);if(!1===t)throw new SyntaxError("An invalid or illegal string was specified.");d=t,this.hasBeenReset=!0}})),Object.defineProperty(r,"snapToLines",k({},n,{get:function(){return c},set:function(t){c=!!t,this.hasBeenReset=!0}})),Object.defineProperty(r,"line",k({},n,{get:function(){return f},set:function(t){if("number"!=typeof t&&"auto"!==t)throw new SyntaxError("An invalid number or illegal string was specified.");f=t,this.hasBeenReset=!0}})),Object.defineProperty(r,"lineAlign",k({},n,{get:function(){return g},set:function(t){t=Ai(t);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");g=t,this.hasBeenReset=!0}})),Object.defineProperty(r,"position",k({},n,{get:function(){return v},set:function(t){if(t<0||100<t)throw new Error("Position must be between 0 and 100.");v=t,this.hasBeenReset=!0}})),Object.defineProperty(r,"positionAlign",k({},n,{get:function(){return p},set:function(t){t=Ai(t);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");p=t,this.hasBeenReset=!0}})),Object.defineProperty(r,"size",k({},n,{get:function(){return m},set:function(t){if(t<0||100<t)throw new Error("Size must be between 0 and 100.");m=t,this.hasBeenReset=!0}})),Object.defineProperty(r,"align",k({},n,{get:function(){return T},set:function(t){t=Ai(t);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");T=t,this.hasBeenReset=!0}})),r.displayState=void 0}Ci.prototype.decode=function(t,e){if(!t)return"";if("string"!=typeof t)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(t))};var Ii=Ci;function Ci(){}function wi(t){function e(t,e,i,r){return 3600*(0|t)+60*(0|e)+(0|i)+parseFloat(r||0)}t=t.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?59<parseFloat(t[2])?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}(D=xi.prototype).set=function(t,e){this.get(t)||""===e||(this.values[t]=e)},D.get=function(t,e,i){return i?this.has(t)?this.values[t]:e[i]:this.has(t)?this.values[t]:e},D.has=function(t){return t in this.values},D.alt=function(t,e,i){for(var r=0;r<i.length;++r)if(e===i[r]){this.set(t,e);break}},D.integer=function(t,e){/^-?\d+$/.test(e)&&this.set(t,parseInt(e,10))},D.percent=function(t,e){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(e)){e=parseFloat(e);if(0<=e&&e<=100)return this.set(t,e),!0}return!1};var Oi=xi;function xi(){this.values=Object.create(null)}function Pi(t,e,i,r){var n,s,a=r?t.split(r):[t];for(n in a)"string"==typeof a[n]&&2===(s=a[n].split(i)).length&&e(s[0],s[1])}var Fi=new Di(0,0,""),Mi="middle"===Fi.align?"middle":"center";function Ni(t){return t.replace(/<br(?: \/)?>/gi,"\n")}function Ui(t,e,i){return t.slice(i=void 0===i?0:i,i+e.length)===e}(D=Vi.prototype).parse=function(t){var r=this;function e(){for(var t=0,e=Ni(e=r.buffer);t<e.length&&"\r"!==e[t]&&"\n"!==e[t];)++t;var i=e.slice(0,t);return"\r"===e[t]&&++t,"\n"===e[t]&&++t,r.buffer=e.slice(t),i}t&&(r.buffer+=r.decoder.decode(t,{stream:!0}));try{var i="";if("INITIAL"===r.state){if(!/\r\n|\n/.test(r.buffer))return this;var n=(i=e()).match(/^()?WEBVTT([ \t].*)?$/);if(!n||!n[0])throw new Error("Malformed WebVTT signature.");r.state="HEADER"}for(var s=!1;r.buffer;){if(!/\r\n|\n/.test(r.buffer))return this;switch(s?s=!1:i=e(),r.state){case"HEADER":/:/.test(i)?Pi(i,function(t,e){},/:/):i||(r.state="ID");continue;case"NOTE":i||(r.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(i)){r.state="NOTE";break}if(!i)continue;if(r.cue=new Di(0,0,""),r.state="CUE",-1===i.indexOf("--\x3e")){r.cue.id=i;continue}case"CUE":if(!r.cue){r.state="BADCUE";continue}try{!function(e,t,n){var i,s,r=e;function a(){var t=wi(e);if(null===t)throw new Error("Malformed timestamp: "+r);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function o(){e=e.replace(/^\s+/,"")}if(o(),t.startTime=a(),o(),"--\x3e"!==e.slice(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+r);e=e.slice(3),o(),t.endTime=a(),o(),i=e,t=t,s=new Oi,Pi(i,function(t,e){var i;switch(t){case"region":for(var r=n.length-1;0<=r;r--)if(n[r].id===e){s.set(t,n[r].region);break}break;case"vertical":s.alt(t,e,["rl","lr"]);break;case"line":i=e.split(","),s.integer(t,i[0]),s.percent(t,i[0])&&s.set("snapToLines",!1),s.alt(t,i[0],["auto"]),2===i.length&&s.alt("lineAlign",i[1],["start",Mi,"end"]);break;case"position":i=e.split(","),s.percent(t,i[0]),2===i.length&&s.alt("positionAlign",i[1],["start",Mi,"end","line-left","line-right","auto"]);break;case"size":s.percent(t,e);break;case"align":s.alt(t,e,["start",Mi,"end","left","right"])}},/:/,/\s/),t.region=s.get("region",null),t.vertical=s.get("vertical",""),"auto"===(i=s.get("line","auto"))&&-1===Fi.line&&(i=-1),t.line=i,t.lineAlign=s.get("lineAlign","start"),t.snapToLines=s.get("snapToLines",!0),t.size=s.get("size",100),t.align=s.get("align",Mi),"auto"===(i=s.get("position","auto"))&&50===Fi.position&&(i="start"===t.align||"left"===t.align?0:"end"===t.align||"right"===t.align?100:50),t.position=i}(i,r.cue,r.regionList)}catch(t){r.cue=null,r.state="BADCUE";continue}r.state="CUETEXT";continue;case"CUETEXT":var a=-1!==i.indexOf("--\x3e");if(!i||a&&(s=!0)){r.oncue&&r.cue&&r.oncue(r.cue),r.cue=null,r.state="ID";continue}if(null===r.cue)continue;r.cue.text&&(r.cue.text+="\n"),r.cue.text+=i;continue;case"BADCUE":i||(r.state="ID")}}}catch(t){"CUETEXT"===r.state&&r.cue&&r.oncue&&r.oncue(r.cue),r.cue=null,r.state="INITIAL"===r.state?"BADWEBVTT":"BADCUE"}return this},D.flush=function(){var e=this;try{if(!e.cue&&"HEADER"!==e.state||(e.buffer+="\n\n",e.parse()),"INITIAL"===e.state||"BADWEBVTT"===e.state)throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this};var Bi=Vi,Gi=f(673),ji=f(524),Hi=/\r\n|\n\r|\n|\r/g,Ki=function(t){for(var e=5381,i=t.length;i;)e=33*e^t.charCodeAt(--i);return(e>>>0).toString()};function Vi(){this.state="INITIAL",this.buffer="",this.decoder=new Ii,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}function Wi(t,e,i){return Ki(t.toString())+Ki(e.toString())+Ki(i)}function Yi(){return(Yi=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i,r=arguments[e];for(i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t}).apply(this,arguments)}var qi="stpp.ttml.im1t",Xi=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,zi=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,Zi={left:"start",center:"center",right:"end",start:"start",end:"end"};function Qi(t,e,i,r,n){var s=(0,x.findBox)(new Uint8Array(t),["mdat"]);if(0!==s.length){var s=s.map(function(t){return(0,ct.utf8ArrayToStr)(t)}),a=(0,Gi.toTimescaleFromScale)(e,1,i);try{s.forEach(function(t){return r(function(t,h){var i,u,d,c,f,r=(new DOMParser).parseFromString(t,"text/xml").getElementsByTagName("tt")[0];if(r)return i={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},u=Object.keys(i).reduce(function(t,e){return t[e]=r.getAttribute("ttp:"+e)||i[e],t},{}),d="preserve"!==r.getAttribute("xml:space"),c=Ji($i(r,"styling","style")),f=Ji($i(r,"layout","region")),t=$i(r,"body","[begin]"),[].map.call(t,function(t){var e=function r(t,n){return[].slice.call(t.childNodes).reduce(function(t,e,i){return"br"===e.nodeName&&i?t+"\n":null!=(i=e.childNodes)&&i.length?r(e,n):n?t+e.textContent.trim().replace(/\s+/g," "):t+e.textContent},"")}(t,d);if(!e||!t.hasAttribute("begin"))return null;var i=ir(t.getAttribute("begin"),u),r=ir(t.getAttribute("dur"),u),n=ir(t.getAttribute("end"),u);if(null===i)throw er(t);if(null===n){if(null===r)throw er(t);n=i+r}var s,a,o,l,r=new Di(i-h,n-h,e),i=(r.id=Wi(r.startTime,r.endTime,r.text),f[t.getAttribute("region")]),n=c[t.getAttribute("style")],n=(r.position=10,r.size=80,a=n,e=c,o="http://www.w3.org/ns/ttml#styling",(t=(l=null)!=(s=i)&&s.hasAttribute("style")?s.getAttribute("style"):null)&&e.hasOwnProperty(t)&&(l=e[t]),["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"].reduce(function(t,e){var i=tr(a,o,e)||tr(s,o,e)||tr(l,o,e);return i&&(t[e]=i),t},{})),i=n.textAlign;return i&&((e=Zi[i])&&(r.lineAlign=e),r.align=i),Yi(r,n),r}).filter(function(t){return null!==t});throw new Error("Invalid ttml")}(t,a))})}catch(t){n(t)}}else n(new Error("Could not parse IMSC1 mdat"))}function $i(t,e,i){t=t.getElementsByTagName(e)[0];return t?[].slice.call(t.querySelectorAll(i)):[]}function Ji(t){return t.reduce(function(t,e){var i=e.getAttribute("xml:id");return i&&(t[i]=e),t},{})}function tr(t,e,i){return t&&t.hasAttributeNS(e,i)?t.getAttributeNS(e,i):null}function er(t){return new Error("Could not parse ttml timestamp "+t)}function ir(r,t){var e,i,n,s;return r?(null===(e=wi(r))&&(Xi.test(r)?(i=t,n=Xi.exec(r),s=(0|n[4])+(0|n[5])/i.subFrameRate,e=3600*(0|n[1])+60*(0|n[2])+(0|n[3])+s/i.frameRate):zi.test(r)&&(e=function(t){var e=zi.exec(r),i=Number(e[1]);switch(e[2]){case"h":return 3600*i;case"m":return 60*i;case"ms":return 1e3*i;case"f":return i/t.frameRate;case"t":return i/t.tickRate}return i}(t))),e):null}(D=rr.prototype).destroy=function(){var t=this.hls;t.off(y.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(y.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(y.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(y.Events.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(y.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.off(y.Events.FRAG_LOADING,this.onFragLoading,this),t.off(y.Events.FRAG_LOADED,this.onFragLoaded,this),t.off(y.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.off(y.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),t.off(y.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(y.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.off(y.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},D.addCues=function(t,e,i,r,n){for(var s,a,o,l=!1,h=n.length;h--;){var u=n[h],d=(s=u[0],d=u[1],a=e,Math.min(d,i)-Math.max(s,a));if(0<=d&&(u[0]=Math.min(u[0],e),u[1]=Math.max(u[1],i),l=!0,.5<d/(i-e)))return}l||n.push([e,i]),this.config.renderTextTracksNatively?(o=this.captionsTracks[t],this.Cues.newCue(o,e,i,r)):(o=this.Cues.newCue(null,e,i,r),this.hls.trigger(y.Events.CUES_PARSED,{type:"captions",cues:o,track:t}))},D.onInitPtsFound=function(t,e){var i=this,r=e.frag,n=e.id,s=e.initPTS,e=e.timescale,a=this.unparsedVttFrags;"main"===n&&(this.initPTS[r.cc]=s,this.timescale[r.cc]=e),a.length&&(this.unparsedVttFrags=[],a.forEach(function(t){i.onFragLoaded(y.Events.FRAG_LOADED,t)}))},D.getExistingTrack=function(t){var e=this.media;if(e)for(var i=0;i<e.textTracks.length;i++){var r=e.textTracks[i];if(r[t])return r}return null},D.createCaptionsTrack=function(t){this.config.renderTextTracksNatively?this.createNativeTrack(t):this.createNonNativeTrack(t)},D.createNativeTrack=function(t){var e,i,r,n,s;this.captionsTracks[t]||(n=this.captionsProperties,e=this.captionsTracks,i=this.media,r=(n=n[t]).label,n=n.languageCode,(s=this.getExistingTrack(t))?(e[t]=s,ut(e[t]),lt(e[t],i)):(s=this.createTextTrack("captions",r,n))&&(s[t]=!0,e[t]=s))},D.createNonNativeTrack=function(t){var e;this.nonNativeCaptionsTracks[t]||(e=this.captionsProperties[t])&&(e={_id:t,label:e.label,kind:"captions",default:!!e.media&&!!e.media.default,closedCaptions:e.media},this.nonNativeCaptionsTracks[t]=e,this.hls.trigger(y.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[e]}))},D.createTextTrack=function(t,e,i){var r=this.media;if(r)return r.addTextTrack(t,e,i)},D.onMediaAttaching=function(t,e){this.media=e.media,this._cleanTracks()},D.onMediaDetaching=function(){var e=this.captionsTracks;Object.keys(e).forEach(function(t){ut(e[t]),delete e[t]}),this.nonNativeCaptionsTracks={}},D.onManifestLoading=function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},D._cleanTracks=function(){var t=this.media;if(t){var e=t.textTracks;if(e)for(var i=0;i<e.length;i++)ut(e[i])}},D.onSubtitleTracksUpdated=function(t,e){var o,l=this,e=(this.textTracks=[],e.subtitleTracks||[]),i=e.some(function(t){return t.textCodec===qi});(this.config.enableWebVTT||i&&this.config.enableIMSC1)&&(i=this.tracks&&e&&this.tracks.length===e.length,this.tracks=e||[],this.config.renderTextTracksNatively?(o=this.media?this.media.textTracks:[],this.tracks.forEach(function(t,e){var i,r,n;if(e<o.length){for(var s=null,a=0;a<o.length;a++)if(r=o[a],n=t,r&&r.label===n.name&&!r.textTrack1&&!r.textTrack2){s=o[a];break}s&&(i=s)}i?ut(i):(e=l._captionsOrSubtitlesFromCharacteristics(t),(i=l.createTextTrack(e,t.name,t.lang))&&(i.mode="disabled")),i&&(i.groupId=t.groupId,l.textTracks.push(i))})):!i&&this.tracks&&this.tracks.length&&(e=this.tracks.map(function(t){return{label:t.name,kind:t.type.toLowerCase(),default:t.default,subtitleTrack:t}}),this.hls.trigger(y.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:e})))},D._captionsOrSubtitlesFromCharacteristics=function(t){if(null!=(e=t.attrs)&&e.CHARACTERISTICS){var e=/transcribes-spoken-dialog/gi.test(t.attrs.CHARACTERISTICS),t=/describes-music-and-sound/gi.test(t.attrs.CHARACTERISTICS);if(e&&t)return"captions"}return"subtitles"},D.onManifestLoaded=function(t,e){var i=this;this.config.enableCEA708Captions&&e.captions&&e.captions.forEach(function(t){var e=/(?:CC|SERVICE)([1-4])/.exec(t.instreamId);e&&(e="textTrack"+e[1],e=i.captionsProperties[e])&&(e.label=t.name,t.lang&&(e.languageCode=t.lang),e.media=t)})},D.closedCaptionsForLevel=function(t){t=this.hls.levels[t.level];return null==t?void 0:t.attrs["CLOSED-CAPTIONS"]},D.onFragLoading=function(t,e){var i,r=this.cea608Parser1,n=this.cea608Parser2,s=this.lastSn,a=this.lastPartIndex;this.enabled&&r&&n&&e.frag.type===c.PlaylistLevelType.MAIN&&(i=e.frag.sn,e=null!=(e=null==e||null==(e=e.part)?void 0:e.index)?e:-1,i===s+1||i===s&&e===a+1||(r.reset(),n.reset()),this.lastSn=i,this.lastPartIndex=e)},D.onFragLoaded=function(t,e){var i,r,n=e.frag,s=e.payload,a=this.initPTS,o=this.unparsedVttFrags;n.type===c.PlaylistLevelType.SUBTITLE&&(s.byteLength?(0,K.isFiniteNumber)(a[n.cc])?(i=n.decryptdata,r="stats"in e,null!=i&&null!=i.key&&"AES-128"===i.method&&!r||(i=this.tracks[n.level],(r=this.vttCCs)[n.cc]||(r[n.cc]={start:n.start,prevCC:this.prevCC,new:!0},this.prevCC=n.cc),i&&i.textCodec===qi?this._parseIMSC1(n,s):this._parseVTTs(n,s,r))):(o.push(e),a.length&&this.hls.trigger(y.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:new Error("Missing initial subtitle PTS")})):this.hls.trigger(y.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:new Error("Empty subtitle payload")}))},D._parseIMSC1=function(e,t){var i=this,r=this.hls;Qi(t,this.initPTS[e.cc],this.timescale[e.cc],function(t){i._appendCues(t,e.level),r.trigger(y.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},function(t){V.logger.log("Failed to parse IMSC1: "+t),r.trigger(y.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:t})})},D._parseVTTs=function(e,i,t){var r,n,s,a,o,l,h,u,d,c,f,g,v,p,m=this,T=this.hls;r=null!=(r=e.initSegment)&&r.data?(0,x.appendUint8Array)(e.initSegment.data,new Uint8Array(i)):i,n=this.initPTS[e.cc],s=this.timescale[e.cc],a=t,o=e.cc,l=e.start,u=new Bi,r=(0,ct.utf8ArrayToStr)(new Uint8Array(r)).trim().replace(Hi,"\n").split("\n"),d=[],c=(0,Gi.toMpegTsClockFromTimescale)(n,s),f="00:00.000",p=!(v=g=0),u.oncue=function(t){var e=a[o],i=a.ccOffset,r=(g-c)/9e4,e=(null!=e&&e.new&&(void 0!==v?i=a.ccOffset=e.start:function(t,e){var i,r=t[o],n=t[r.prevCC];if(!n||!n.new&&r.new)return t.ccOffset=t.presentationOffset=r.start,r.new=!1;for(;null!=(i=n)&&i.new;)t.ccOffset+=r.start-n.start,r.new=!1,n=t[(r=n).prevCC];t.presentationOffset=e}(a,r)),r&&(i=r-a.presentationOffset),t.endTime-t.startTime),r=(0,ji.normalizePts)(9e4*(t.startTime+i-v),9e4*l)/9e4,i=(t.startTime=Math.max(r,0),t.endTime=Math.max(r+e,0),t.text.trim());t.text=decodeURIComponent(encodeURIComponent(i)),t.id||(t.id=Wi(t.startTime,t.endTime,i)),0<t.endTime&&d.push(t)},u.onparsingerror=function(t){h=t},u.onflush=function(){var t;h?(t=h,m._fallbackToIMSC1(e,i),V.logger.log("Failed to parse VTT cue: "+t),T.trigger(y.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:t})):(m._appendCues(d,e.level),T.trigger(y.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e}))},r.forEach(function(t){if(p){if(Ui(t,"X-TIMESTAMP-MAP=")){p=!1,t.slice(16).split(",").forEach(function(t){Ui(t,"LOCAL:")?f=t.slice(6):Ui(t,"MPEGTS:")&&(g=parseInt(t.slice(7)))});try{v=function(t){var e=parseInt(t.slice(-3)),i=parseInt(t.slice(-6,-4)),r=parseInt(t.slice(-9,-7)),n=9<t.length?parseInt(t.substring(0,t.indexOf(":"))):0;if((0,K.isFiniteNumber)(e)&&(0,K.isFiniteNumber)(i)&&(0,K.isFiniteNumber)(r)&&(0,K.isFiniteNumber)(n))return e+1e3*i+6e4*r+36e5*n;throw Error("Malformed X-TIMESTAMP-MAP: Local:"+t)}(f)/1e3}catch(t){h=t}return}""===t&&(p=!1)}u.parse(t+"\n")}),u.flush()},D._fallbackToIMSC1=function(t,e){var i=this,r=this.tracks[t.level];r.textCodec||Qi(e,this.initPTS[t.cc],this.timescale[t.cc],function(){r.textCodec=qi,i._parseIMSC1(t,e)},function(){r.textCodec="wvtt"})},D._appendCues=function(t,e){var i,r,n=this.hls;this.config.renderTextTracksNatively?(i=this.textTracks[e])&&"disabled"!==i.mode&&t.forEach(function(t){return ht(i,t)}):(r=this.tracks[e])&&(r=r.default?"default":"subtitles"+e,n.trigger(y.Events.CUES_PARSED,{type:"subtitles",cues:t,track:r}))},D.onFragDecrypted=function(t,e){var i=e.frag;i.type===c.PlaylistLevelType.SUBTITLE&&((0,K.isFiniteNumber)(this.initPTS[i.cc])?this.onFragLoaded(y.Events.FRAG_LOADED,e):this.unparsedVttFrags.push(e))},D.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},D.onFragParsingUserdata=function(t,e){var i=this.cea608Parser1,r=this.cea608Parser2;if(this.enabled&&i&&r){var n=e.frag,s=e.samples;if(n.type!==c.PlaylistLevelType.MAIN||"NONE"!==this.closedCaptionsForLevel(n))for(var a=0;a<s.length;a++){var o=s[a].bytes;o&&(o=this.extractCea608Data(o),i.addData(s[a].pts,o[0]),r.addData(s[a].pts,o[1]))}}},D.onBufferFlushing=function(t,e){var i,r,n=e.startOffset,s=e.endOffset,a=e.endOffsetSubtitles,e=e.type,o=this.media;!o||o.currentTime<s||(e&&"video"!==e||(i=this.captionsTracks,Object.keys(i).forEach(function(t){return dt(i[t],n,s)})),this.config.renderTextTracksNatively&&0===n&&void 0!==a&&(r=this.textTracks,Object.keys(r).forEach(function(t){return dt(r[t],n,a)})))},D.extractCea608Data=function(t){for(var e=[[],[]],i=31&t[0],r=2,n=0;n<i;n++){var s=t[r++],a=127&t[r++],o=127&t[r++];0==a&&0==o||0==(4&s)||0!=(s=3&s)&&1!=s||(e[s].push(a),e[s].push(o))}return e};var D=rr;function rr(t){var e,i,r,n;this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this.captionsProperties=void 0,this.hls=t,this.config=t.config,this.Cues=t.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions&&(e=new Li(this,"textTrack1"),i=new Li(this,"textTrack2"),r=new Li(this,"textTrack3"),n=new Li(this,"textTrack4"),this.cea608Parser1=new Ei(1,e,i),this.cea608Parser2=new Ei(3,r,n)),t.on(y.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(y.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(y.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(y.Events.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(y.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.on(y.Events.FRAG_LOADING,this.onFragLoading,this),t.on(y.Events.FRAG_LOADED,this.onFragLoaded,this),t.on(y.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.on(y.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),t.on(y.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(y.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.on(y.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var nr,sr=function(){function n(t){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=t,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}for(var t=n.prototype,e=(t.setStreamController=function(t){this.streamController=t},t.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},t.registerListeners=function(){var t=this.hls;t.on(y.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),t.on(y.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(y.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(y.Events.BUFFER_CODECS,this.onBufferCodecs,this),t.on(y.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},t.unregisterListener=function(){var t=this.hls;t.off(y.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),t.off(y.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(y.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.off(y.Events.BUFFER_CODECS,this.onBufferCodecs,this),t.off(y.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},t.onFpsDropLevelCapping=function(t,e){n.isLevelAllowed(e.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(e.droppedLevel)},t.onMediaAttaching=function(t,e){this.media=e.media instanceof HTMLVideoElement?e.media:null},t.onManifestParsed=function(t,e){var i=this.hls;this.restrictedLevels=[],this.firstLevel=e.firstLevel,i.config.capLevelToPlayerSize&&e.video&&this.startCapping()},t.onBufferCodecs=function(t,e){this.hls.config.capLevelToPlayerSize&&e.video&&this.startCapping()},t.onMediaDetaching=function(){this.stopCapping()},t.detectPlayerSize=function(){var t,e;this.media&&0<this.mediaHeight&&0<this.mediaWidth&&(t=this.hls.levels).length&&((e=this.hls).autoLevelCapping=this.getMaxLevel(t.length-1),e.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=e.autoLevelCapping)},t.getMaxLevel=function(i){var r=this,t=this.hls.levels;return t.length?(t=t.filter(function(t,e){return n.isLevelAllowed(e,r.restrictedLevels)&&e<=i}),this.clientRect=null,n.getMaxLevelByMediaSize(t,this.mediaWidth,this.mediaHeight)):-1},t.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},t.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},t.getDimensions=function(){var t,e,i;return this.clientRect||(e={width:0,height:0},(t=this.media)&&(i=t.getBoundingClientRect(),e.width=i.width,e.height=i.height,e.width||e.height||(e.width=i.right-i.left||t.width||0,e.height=i.bottom-i.top||t.height||0)),this.clientRect=e)},n.isLevelAllowed=function(t,e){return-1===(e=void 0===e?[]:e).indexOf(t)},n.getMaxLevelByMediaSize=function(t,e,i){if(!t||!t.length)return-1;for(var r,n=t.length-1,s=0;s<t.length;s+=1){var a=t[s];if((a.width>=e||a.height>=i)&&(!(r=t[s+1])||a.width!==r.width||a.height!==r.height)){n=s;break}}return n},(t=n).prototype),i=[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var t=1;if(!this.hls.config.ignoreDevicePixelRatio)try{t=self.devicePixelRatio}catch(t){}return t}}],r=0;r<i.length;r++){var s=i[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}return Object.defineProperty(t,"prototype",{writable:!1}),n}(),R=((R=ar.prototype).setStreamController=function(t){this.streamController=t},R.registerListeners=function(){this.hls.on(y.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},R.unregisterListeners=function(){this.hls.off(y.Events.MEDIA_ATTACHING,this.onMediaAttaching)},R.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},R.onMediaAttaching=function(t,e){var i=this.hls.config;i.capLevelOnFPSDrop&&(e=e.media instanceof self.HTMLVideoElement?e.media:null,(this.media=e)&&"function"==typeof e.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),i.fpsDroppedMonitoringPeriod))},R.checkFPS=function(t,e,i){var r,n,s,a,o=performance.now();e&&(this.lastTime&&(a=o-this.lastTime,r=i-this.lastDroppedFrames,n=e-this.lastDecodedFrames,a=1e3*r/a,(s=this.hls).trigger(y.Events.FPS_DROP,{currentDropped:r,currentDecoded:n,totalDroppedFrames:i}),0<a)&&r>s.config.fpsDroppedMonitoringThreshold*n&&(a=s.currentLevel,V.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+a),0<a)&&(-1===s.autoLevelCapping||s.autoLevelCapping>=a)&&(s.trigger(y.Events.FPS_DROP_LEVEL_CAPPING,{level:--a,droppedLevel:s.currentLevel}),s.autoLevelCapping=a,this.streamController.nextLevelSwitch()),this.lastTime=o,this.lastDroppedFrames=i,this.lastDecodedFrames=e)},R.checkFPSInterval=function(){var t,e=this.media;e&&(this.isVideoPlaybackQualityAvailable?(t=e.getVideoPlaybackQuality(),this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)):this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount))},ar);function ar(t){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=t,this.registerListeners()}(lr=nr=nr||{}).WIDEVINE="com.widevine.alpha",lr.PLAYREADY="com.microsoft.playready";var A,or,lr="undefined"!=typeof self&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null,hr=function(){function t(t){this.hls=void 0,this._widevineLicenseUrl=void 0,this._licenseXhrSetup=void 0,this._licenseResponseCallback=void 0,this._emeEnabled=void 0,this._requestMediaKeySystemAccess=void 0,this._drmSystemOptions=void 0,this._config=void 0,this._mediaKeysList=[],this._media=null,this._hasSetMediaKeys=!1,this._requestLicenseFailureCount=0,this.mediaKeysPromise=null,this._onMediaEncrypted=this.onMediaEncrypted.bind(this),this.hls=t,this._config=t.config,this._widevineLicenseUrl=this._config.widevineLicenseUrl,this._licenseXhrSetup=this._config.licenseXhrSetup,this._licenseResponseCallback=this._config.licenseResponseCallback,this._emeEnabled=this._config.emeEnabled,this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc,this._drmSystemOptions=this._config.drmSystemOptions,this._registerListeners()}for(var e=t.prototype,i=(e.destroy=function(){this._unregisterListeners(),this.hls=this._onMediaEncrypted=null,this._requestMediaKeySystemAccess=null},e._registerListeners=function(){this.hls.on(y.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(y.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(y.Events.MANIFEST_PARSED,this.onManifestParsed,this)},e._unregisterListeners=function(){this.hls.off(y.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(y.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(y.Events.MANIFEST_PARSED,this.onManifestParsed,this)},e.getLicenseServerUrl=function(t){if(t===nr.WIDEVINE)if(this._widevineLicenseUrl)return this._widevineLicenseUrl;throw new Error('no license server URL configured for key-system "'+t+'"')},e._attemptKeySystemAccess=function(e,t,a){var i=this,t=function(t,e,i){if(t===nr.WIDEVINE)return r=a,n=i,s={audioCapabilities:[],videoCapabilities:[]},e.forEach(function(t){s.audioCapabilities.push({contentType:'audio/mp4; codecs="'+t+'"',robustness:n.audioRobustness||""})}),r.forEach(function(t){s.videoCapabilities.push({contentType:'video/mp4; codecs="'+t+'"',robustness:n.videoRobustness||""})}),[s];var r,n,s;throw new Error("Unknown key-system: "+t)}(e,t,this._drmSystemOptions),t=(V.logger.log("Requesting encrypted media key-system access"),this.requestMediaKeySystemAccess(e,t));this.mediaKeysPromise=t.then(function(t){return i._onMediaKeySystemAccessObtained(e,t)}),t.catch(function(t){V.logger.error('Failed to obtain key-system "'+e+'" access:',t)})},e._onMediaKeySystemAccessObtained=function(e,t){var i=this,r=(V.logger.log('Access for key-system "'+e+'" obtained'),{mediaKeysSessionInitialized:!1,mediaKeySystemAccess:t,mediaKeySystemDomain:e}),n=(this._mediaKeysList.push(r),Promise.resolve().then(function(){return t.createMediaKeys()}).then(function(t){return r.mediaKeys=t,V.logger.log('Media-keys created for key-system "'+e+'"'),i._onMediaKeysCreated(),t}));return n.catch(function(t){V.logger.error("Failed to create media-keys:",t)}),n},e._onMediaKeysCreated=function(){var e=this;this._mediaKeysList.forEach(function(t){t.mediaKeysSession||(t.mediaKeysSession=t.mediaKeys.createSession(),e._onNewMediaKeySession(t.mediaKeysSession))})},e._onNewMediaKeySession=function(e){var i=this;V.logger.log("New key-system session "+e.sessionId),e.addEventListener("message",function(t){i._onKeySessionMessage(e,t.message)},!1)},e._onKeySessionMessage=function(e,t){V.logger.log("Got EME message event, creating license request"),this._requestLicense(t,function(t){V.logger.log("Received license data (length: "+(t&&t.byteLength)+"), updating key-session"),e.update(t).catch(function(t){V.logger.warn("Updating key-session failed: "+t)})})},e.onMediaEncrypted=function(e){var t,i=this;V.logger.log('Media is encrypted using "'+e.initDataType+'" init data type'),this.mediaKeysPromise?this.mediaKeysPromise.then(t=function(t){i._media&&(i._attemptSetMediaKeys(t),i._generateRequestWithPreferredKeySession(e.initDataType,e.initData))}).catch(t):(V.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),this.hls.trigger(y.Events.ERROR,{type:v.ErrorTypes.KEY_SYSTEM_ERROR,details:v.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0}))},e._attemptSetMediaKeys=function(t){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");var e;this._hasSetMediaKeys||((e=this._mediaKeysList[0])&&e.mediaKeys?(V.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(e.mediaKeys),this._hasSetMediaKeys=!0):(V.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),this.hls.trigger(y.Events.ERROR,{type:v.ErrorTypes.KEY_SYSTEM_ERROR,details:v.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0})))},e._generateRequestWithPreferredKeySession=function(t,e){var i,r=this,n=this._mediaKeysList[0];n?n.mediaKeysSessionInitialized?V.logger.warn("Key-Session already initialized but requested again"):(i=n.mediaKeysSession)?e?(V.logger.log('Generating key-session request for "'+t+'" init data type'),n.mediaKeysSessionInitialized=!0,i.generateRequest(t,e).then(function(){V.logger.debug("Key-session generation succeeded")}).catch(function(t){V.logger.error("Error generating key-session request:",t),r.hls.trigger(y.Events.ERROR,{type:v.ErrorTypes.KEY_SYSTEM_ERROR,details:v.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})):(V.logger.warn("Fatal: initData required for generating a key session is null"),this.hls.trigger(y.Events.ERROR,{type:v.ErrorTypes.KEY_SYSTEM_ERROR,details:v.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0})):(V.logger.error("Fatal: Media is encrypted but no key-session existing"),this.hls.trigger(y.Events.ERROR,{type:v.ErrorTypes.KEY_SYSTEM_ERROR,details:v.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0})):(V.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),this.hls.trigger(y.Events.ERROR,{type:v.ErrorTypes.KEY_SYSTEM_ERROR,details:v.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0}))},e._createLicenseXhr=function(t,e,i){var r=new XMLHttpRequest,e=(r.responseType="arraybuffer",r.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,r,t,e,i),this._licenseXhrSetup);if(e)try{e.call(this.hls,r,t),e=void 0}catch(t){V.logger.error(t)}try{r.readyState||r.open("POST",t,!0),e&&e.call(this.hls,r,t)}catch(t){throw new Error("issue setting up KeySystem license XHR "+t)}return r},e._onLicenseRequestReadyStageChange=function(t,e,i,r){if(4===t.readyState)if(200===t.status){this._requestLicenseFailureCount=0,V.logger.log("License request succeeded");var n=t.response,s=this._licenseResponseCallback;if(s)try{n=s.call(this.hls,t,e)}catch(t){V.logger.error(t)}r(n)}else(V.logger.error("License Request XHR failed ("+e+"). Status: "+t.status+" ("+t.statusText+")"),this._requestLicenseFailureCount++,3<this._requestLicenseFailureCount)?this.hls.trigger(y.Events.ERROR,{type:v.ErrorTypes.KEY_SYSTEM_ERROR,details:v.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0}):(s=3-this._requestLicenseFailureCount+1,V.logger.warn("Retrying license request, "+s+" attempts left"),this._requestLicense(i,r))},e._generateLicenseRequestChallenge=function(t,e){if(t.mediaKeySystemDomain===nr.WIDEVINE)return e;throw new Error("unsupported key-system: "+t.mediaKeySystemDomain)},e._requestLicense=function(t,e){V.logger.log("Requesting content license for key-system");var i=this._mediaKeysList[0];if(i)try{var r=this.getLicenseServerUrl(i.mediaKeySystemDomain),n=this._createLicenseXhr(r,t,e),s=(V.logger.log("Sending license request to URL: "+r),this._generateLicenseRequestChallenge(i,t));n.send(s)}catch(t){V.logger.error("Failure requesting DRM license: "+t),this.hls.trigger(y.Events.ERROR,{type:v.ErrorTypes.KEY_SYSTEM_ERROR,details:v.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}else V.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),this.hls.trigger(y.Events.ERROR,{type:v.ErrorTypes.KEY_SYSTEM_ERROR,details:v.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0})},e.onMediaAttached=function(t,e){this._emeEnabled&&(e=e.media,(this._media=e).addEventListener("encrypted",this._onMediaEncrypted))},e.onMediaDetached=function(){var t=this._media,e=this._mediaKeysList;t&&(t.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(e.map(function(t){if(t.mediaKeysSession)return t.mediaKeysSession.close().catch(function(){})})).then(function(){return t.setMediaKeys(null)}).catch(function(){}))},e.onManifestParsed=function(t,e){var i;this._emeEnabled&&(i=e.levels.map(function(t){return t.audioCodec}).filter(function(t){return!!t}),e=e.levels.map(function(t){return t.videoCodec}).filter(function(t){return!!t}),this._attemptKeySystemAccess(nr.WIDEVINE,i,e))},(e=t).prototype),r=[{key:"requestMediaKeySystemAccess",get:function(){if(this._requestMediaKeySystemAccess)return this._requestMediaKeySystemAccess;throw new Error("No requestMediaKeySystemAccess function configured")}}],n=0;n<r.length;n++){var s=r[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(i,s.key,s)}return Object.defineProperty(e,"prototype",{writable:!1}),t}();function ur(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function dr(t,e,i){e&&ur(t.prototype,e),i&&ur(t,i),Object.defineProperty(t,"prototype",{writable:!1})}function cr(t,e){var i,r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(r)return(r=r.call(t)).next.bind(r);if(Array.isArray(t)||(r=function(t){var e;if(t)return"string"==typeof t?fr(t,void 0):"Map"===(e="Object"===(e=Object.prototype.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:e)||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?fr(t,void 0):void 0}(t))||e&&t&&"number"==typeof t.length)return r&&(t=r),i=0,function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function fr(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,r=new Array(e);i<e;i++)r[i]=t[i];return r}function gr(){return(gr=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i,r=arguments[e];for(i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t}).apply(this,arguments)}(_=A=A||{}).MANIFEST="m",_.AUDIO="a",_.VIDEO="v",_.MUXED="av",_.INIT="i",_.CAPTION="c",_.TIMED_TEXT="tt",_.KEY="k",_.OTHER="o",(_=or=or||{}).DASH="d",_.HLS="h",_.SMOOTH="s",_.OTHER="o";(_=I.prototype).registerListeners=function(){var t=this.hls;t.on(y.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(y.Events.MEDIA_DETACHED,this.onMediaDetached,this),t.on(y.Events.BUFFER_CREATED,this.onBufferCreated,this)},_.unregisterListeners=function(){var t=this.hls;t.off(y.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(y.Events.MEDIA_DETACHED,this.onMediaDetached,this),t.off(y.Events.BUFFER_CREATED,this.onBufferCreated,this),this.onMediaDetached()},_.destroy=function(){this.unregisterListeners(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},_.onMediaAttached=function(t,e){this.media=e.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},_.onMediaDetached=function(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},_.onBufferCreated=function(t,e){var i;this.audioBuffer=null==(i=e.tracks.audio)?void 0:i.buffer,this.videoBuffer=null==(i=e.tracks.video)?void 0:i.buffer},_.createData=function(){var t;return{v:1,sf:or.HLS,sid:this.sid,cid:this.cid,pr:null==(t=this.media)?void 0:t.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},_.apply=function(t,e){gr(e=void 0===e?{}:e,this.createData());var i=e.ot===A.INIT||e.ot===A.VIDEO||e.ot===A.MUXED;this.starved&&i&&(e.bs=!0,e.su=!0,this.starved=!1),null==e.su&&(e.su=this.buffering),this.useHeaders?(i=I.toHeaders(e),Object.keys(i).length&&(t.headers||(t.headers={}),gr(t.headers,i))):(i=I.toQuery(e))&&(t.url=I.appendQueryToUri(t.url,i))},_.getObjectType=function(t){var e=t.type;return"subtitle"===e?A.TIMED_TEXT:"initSegment"===t.sn?A.INIT:"audio"===e?A.AUDIO:"main"===e?this.hls.audioTracks.length?A.VIDEO:A.MUXED:void 0},_.getTopBandwidth=function(t){for(var e=0,i=this.hls,r=cr(t===A.AUDIO?i.audioTracks:(t=-1<(t=i.maxAutoLevel)?t+1:i.levels.length,i.levels.slice(0,t)));!(n=r()).done;){var n=n.value;n.bitrate>e&&(e=n.bitrate)}return 0<e?e:NaN},_.getBufferLength=function(t){var e=this.hls.media,t=t===A.AUDIO?this.audioBuffer:this.videoBuffer;return t&&e?1e3*p.bufferInfo(t,e.currentTime,this.config.maxBufferHole).len:NaN},_.createPlaylistLoader=function(){var t=this.config.pLoader,r=this.applyPlaylistData,e=t||this.config.loader;return(t=i.prototype).destroy=function(){this.loader.destroy()},t.abort=function(){this.loader.abort()},t.load=function(t,e,i){r(t),this.loader.load(t,e,i)},dr(i,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),i;function i(t){this.loader=void 0,this.loader=new e(t)}},_.createFragmentLoader=function(){var t=this.config.fLoader,r=this.applyFragmentData,e=t||this.config.loader;return(t=i.prototype).destroy=function(){this.loader.destroy()},t.abort=function(){this.loader.abort()},t.load=function(t,e,i){r(t),this.loader.load(t,e,i)},dr(i,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),i;function i(t){this.loader=void 0,this.loader=new e(t)}},I.uuid=function(){var t=URL.createObjectURL(new Blob),e=t.toString();return URL.revokeObjectURL(t),e.slice(e.lastIndexOf("/")+1)},I.serialize=function(t){for(var e=[],i=function(t){return Math.round(t)},r=function(t){return 100*i(t/100)},n={br:i,d:i,bl:r,dl:r,mtp:r,nor:function(t){return encodeURIComponent(t)},rtp:r,tb:i},s=cr(Object.keys(t||{}).sort());!(o=s()).done;){var a,o=o.value,l=t[o];a=l,Number.isNaN(a)||null==a||""===a||!1===a||"v"===o&&1===l||"pr"==o&&1===l||(a=typeof(l=(a=n[o])?a(l):l),a="ot"===o||"sf"===o||"st"===o?o+"="+l:"boolean"==a?o:"number"==a?o+"="+l:o+"="+JSON.stringify(l),e.push(a))}return e.join(",")},I.toHeaders=function(t){for(var e={},i=["Object","Request","Session","Status"],r=[{},{},{},{}],n={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},s=0,a=Object.keys(t);s<a.length;s++){var o=a[s];r[null!=n[o]?n[o]:1][o]=t[o]}for(var l=0;l<r.length;l++){var h=I.serialize(r[l]);h&&(e["CMCD-"+i[l]]=h)}return e},I.toQuery=function(t){return"CMCD="+encodeURIComponent(I.serialize(t))},I.appendQueryToUri=function(t,e){var i;return e?(i=t.includes("?")?"&":"?",t+i+e):t};var _=I,vr=f(408),pr=/^age:\s*[\d.]+\s*$/m;function I(t){var s=this,t=(this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){s.initialized&&(s.starved=!0),s.buffering=!0},this.onPlaying=function(){s.initialized||(s.initialized=!0),s.buffering=!1},this.applyPlaylistData=function(t){try{s.apply(t,{ot:A.MANIFEST,su:!s.initialized})}catch(t){V.logger.warn("Could not generate manifest CMCD data.",t)}},this.applyFragmentData=function(t){try{var e=t.frag,i=s.hls.levels[e.level],r=s.getObjectType(e),n={d:1e3*e.duration,ot:r};r!==A.VIDEO&&r!==A.AUDIO&&r!=A.MUXED||(n.br=i.bitrate/1e3,n.tb=s.getTopBandwidth(r)/1e3,n.bl=s.getBufferLength(r)),s.apply(t,n)}catch(t){V.logger.warn("Could not generate segment CMCD data.",t)}},this.hls=t,this.config=t.config),e=t.cmcd;null!=e&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=e.sessionId||I.uuid(),this.cid=e.contentId,this.useHeaders=!0===e.useHeaders,this.registerListeners())}(C=Tr.prototype).destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},C.abortInternal=function(){var t=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),t&&(t.onreadystatechange=null,t.onprogress=null,4!==t.readyState)&&(this.stats.aborted=!0,t.abort())},C.abort=function(){var t;this.abortInternal(),null!=(t=this.callbacks)&&t.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},C.load=function(t,e,i){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=t,this.config=e,this.callbacks=i,this.retryDelay=e.retryDelay,this.loadInternal()},C.loadInternal=function(){var t=this.config,e=this.context;if(t){var i=this.loader=new self.XMLHttpRequest,r=this.stats,r=(r.loading.first=0,r.loaded=0,this.xhrSetup);try{if(r)try{r(i,e.url)}catch(t){i.open("GET",e.url,!0),r(i,e.url)}i.readyState||i.open("GET",e.url,!0);var n=this.context.headers;if(n)for(var s in n)i.setRequestHeader(s,n[s])}catch(t){return void this.callbacks.onError({code:i.status,text:t.message},e,i)}e.rangeEnd&&i.setRequestHeader("Range","bytes="+e.rangeStart+"-"+(e.rangeEnd-1)),i.onreadystatechange=this.readystatechange.bind(this),i.onprogress=this.loadprogress.bind(this),i.responseType=e.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),t.timeout),i.send()}},C.readystatechange=function(){var t,e,i,r,n=this.context,s=this.loader,a=this.stats;n&&s&&(e=s.readyState,t=this.config,!a.aborted)&&2<=e&&(self.clearTimeout(this.requestTimeout),0===a.loading.first&&(a.loading.first=Math.max(self.performance.now(),a.loading.start)),4===e?(s.onreadystatechange=null,s.onprogress=null,e=s.status,r="arraybuffer"===s.responseType,200<=e&&e<300&&(r&&s.response||null!==s.responseText)?(a.loading.end=Math.max(self.performance.now(),a.loading.first),r=r?(i=s.response).byteLength:(i=s.responseText).length,a.loaded=a.total=r,this.callbacks&&((r=this.callbacks.onProgress)&&r(a,n,i,s),this.callbacks)&&(r={url:s.responseURL,data:i},this.callbacks.onSuccess(r,a,n,s))):a.retry>=t.maxRetry||400<=e&&e<499?(V.logger.error(e+" while loading "+n.url),this.callbacks.onError({code:e,text:s.statusText},n,s)):(V.logger.warn(e+" while loading "+n.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,t.maxRetryDelay),a.retry++)):(self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),t.timeout)))},C.loadtimeout=function(){V.logger.warn("timeout while loading "+this.context.url);var t=this.callbacks;t&&(this.abortInternal(),t.onTimeout(this.stats,this.context,this.loader))},C.loadprogress=function(t){var e=this.stats;e.loaded=t.loaded,t.lengthComputable&&(e.total=t.total)},C.getCacheAge=function(){var t,e=null;return e=this.loader&&pr.test(this.loader.getAllResponseHeaders())?(t=this.loader.getResponseHeader("age"))?parseFloat(t):null:e};const mr=Tr;function Tr(t){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=t?t.xhrSetup:null,this.stats=new vr.LoadStats,this.retryDelay=0}function yr(t){var i="function"==typeof Map?new Map:void 0;return(yr=function(t){if(null===t||-1===Function.toString.call(t).indexOf("[native code]"))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==i){if(i.has(t))return i.get(t);i.set(t,e)}function e(){return Er(t,arguments,br(this).constructor)}return e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Sr(e,t)})(t)}function Er(t,e,i){return(Er=function(){if("undefined"==typeof Reflect||!Reflect.construct)return;if(Reflect.construct.sham)return;if("function"==typeof Proxy)return 1;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),1}catch(t){}}()?Reflect.construct.bind():function(t,e,i){var r=[null],e=(r.push.apply(r,e),new(Function.bind.apply(t,r)));return i&&Sr(e,i.prototype),e}).apply(null,arguments)}function Sr(t,e){return(Sr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function br(t){return(br=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Lr(){return(Lr=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i,r=arguments[e];for(i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t}).apply(this,arguments)}(C=kr.prototype).destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},C.abortInternal=function(){var t=this.response;t&&t.ok||(this.stats.aborted=!0,this.controller.abort())},C.abort=function(){var t;this.abortInternal(),null!=(t=this.callbacks)&&t.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},C.load=function(r,n,s){var a=this,o=this.stats;if(o.loading.start)throw new Error("Loader can only be used once.");o.loading.start=self.performance.now();var t=function(t,e){e={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(Lr({},t.headers))};return t.rangeEnd&&e.headers.set("Range","bytes="+t.rangeStart+"-"+String(t.rangeEnd-1)),e}(r,this.controller.signal),l=s.onProgress,h="arraybuffer"===r.responseType,u=h?"byteLength":"length";this.context=r,this.config=n,this.callbacks=s,this.request=this.fetchSetup(r,t),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){a.abortInternal(),s.onTimeout(o,r,a.response)},n.timeout),self.fetch(this.request).then(function(t){var e,i;if((a.response=a.loader=t).ok)return o.loading.first=Math.max(self.performance.now(),o.loading.start),o.total=parseInt(t.headers.get("Content-Length")||"0"),l&&(0,K.isFiniteNumber)(n.highWaterMark)?a.loadProgressively(t,o,r,n.highWaterMark,l):h?t.arrayBuffer():t.text();throw e=t.status,i=t.statusText,new Ar(i||"fetch, bad network response",e,t)}).then(function(t){var e=a.response,i=(self.clearTimeout(a.requestTimeout),o.loading.end=Math.max(self.performance.now(),o.loading.first),t[u]),i=(i&&(o.loaded=o.total=i),{url:e.url,data:t});l&&!(0,K.isFiniteNumber)(n.highWaterMark)&&l(o,r,t,e),s.onSuccess(i,o,r,e)}).catch(function(t){var e,i;self.clearTimeout(a.requestTimeout),o.aborted||(e=t&&t.code||0,i=t?t.message:null,s.onError({code:e,text:i},r,t?t.details:null))})},C.getCacheAge=function(){var t,e=null;return e=this.response?(t=this.response.headers.get("age"))?parseFloat(t):null:e},C.loadProgressively=function(r,n,s,a,o){void 0===a&&(a=0);var l=new Me,t=r.body.getReader();return function i(){return t.read().then(function(t){var e;return t.done?(l.dataLength&&o(n,s,l.flush(),r),Promise.resolve(new ArrayBuffer(0))):(e=(t=t.value).length,n.loaded+=e,e<a||l.dataLength?(l.push(t),l.dataLength>=a&&o(n,s,l.flush(),r)):o(n,s,t,r),i())}).catch(function(){return Promise.reject()})}()};var C=kr;function kr(t){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=t.fetchSetup||Dr,this.controller=new self.AbortController,this.stats=new vr.LoadStats}function Dr(t,e){return new self.Request(t.url,e)}Rr=yr(Error),Mr=Rr,(w=_r).prototype=Object.create(Mr.prototype),Sr(w.prototype.constructor=w,Mr);var Rr,Ar=_r;function _r(t,e,i){return(t=Rr.call(this,t)||this).code=void 0,t.details=void 0,t.code=e,t.details=i,t}const Ir=C;var Cr=/\s/;function wr(){return(wr=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i,r=arguments[e];for(i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t}).apply(this,arguments)}function Or(e,t){var i,r=Object.keys(e);return Object.getOwnPropertySymbols&&(i=Object.getOwnPropertySymbols(e),t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)),r}function xr(r){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Or(Object(n),!0).forEach(function(t){var e,i;e=r,i=n[t=t],t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(n)):Or(Object(n)).forEach(function(t){Object.defineProperty(r,t,Object.getOwnPropertyDescriptor(n,t))})}return r}var Pr=xr(xr({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:mr,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:xe,bufferController:s,capLevelController:sr,fpsController:R,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:lr,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0},{cueHandler:{newCue:function(e,t,i,r){for(var n,s,a,o,l=[],h=self.VTTCue||self.TextTrackCue,u=0;u<r.rows.length;u++)if(s=!0,a=0,o="",!(n=r.rows[u]).isEmpty()){for(var d=0;d<n.chars.length;d++)Cr.test(n.chars[d].uchar)&&s?a++:(o+=n.chars[d].uchar,s=!1);(n.cueStartTime=t)===i&&(i+=1e-4),16<=a?a--:a++;var c=Ni(o.trim()),f=Wi(t,i,c);e&&e.cues&&e.cues.getCueById(f)||((c=new h(t,i,c)).id=f,c.line=u+1,c.align="left",c.position=10+Math.min(80,10*Math.floor(8*a/32)),l.push(c))}return e&&l.length&&(l.sort(function(t,e){return"auto"===t.line||"auto"===e.line?0:8<t.line&&8<e.line?e.line-t.line:t.line-e.line}),l.forEach(function(t){return ht(e,t)})),l}},enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:i,subtitleTrackController:t,timelineController:D,audioStreamController:e,audioTrackController:r,emeController:hr,cmcdController:_});function Fr(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}Ur.isSupported=function(){return!!(e=pe())&&(t=me(),e=e&&"function"==typeof e.isTypeSupported&&e.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),t=!t||t.prototype&&"function"==typeof t.prototype.appendBuffer&&"function"==typeof t.prototype.remove,!!e)&&!!t;var t,e},(w=Ur.prototype).createController=function(t,e,i){return t?(e=e?new t(this,e):new t(this),i&&i.push(e),e):null},w.on=function(t,e,i){this._emitter.on(t,e,i=void 0===i?this:i)},w.once=function(t,e,i){this._emitter.once(t,e,i=void 0===i?this:i)},w.removeAllListeners=function(t){this._emitter.removeAllListeners(t)},w.off=function(t,e,i,r){this._emitter.off(t,e,i=void 0===i?this:i,r)},w.listeners=function(t){return this._emitter.listeners(t)},w.emit=function(t,e,i){return this._emitter.emit(t,e,i)},w.trigger=function(t,e){if(this.config.debug)return this.emit(t,t,e);try{return this.emit(t,t,e)}catch(e){V.logger.error("An internal error happened while handling event "+t+'. Error message: "'+e.message+'". Here is a stacktrace:',e),this.trigger(y.Events.ERROR,{type:v.ErrorTypes.OTHER_ERROR,details:v.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:t,error:e})}return!1},w.listenerCount=function(t){return this._emitter.listenerCount(t)},w.destroy=function(){V.logger.log("destroy"),this.trigger(y.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(t){return t.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(t){return t.destroy()}),this.coreComponents.length=0},w.attachMedia=function(t){V.logger.log("attachMedia"),this._media=t,this.trigger(y.Events.MEDIA_ATTACHING,{media:t})},w.detachMedia=function(){V.logger.log("detachMedia"),this.trigger(y.Events.MEDIA_DETACHING,void 0),this._media=null},w.loadSource=function(t){this.stopLoad();var e=this.media,i=this.url,r=this.url=G.buildAbsoluteURL(self.location.href,t,{alwaysNormalize:!0});V.logger.log("loadSource:"+r),e&&i&&i!==r&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(e)),this.trigger(y.Events.MANIFEST_LOADING,{url:t})},w.startLoad=function(e){void 0===e&&(e=-1),V.logger.log("startLoad("+e+")"),this.networkControllers.forEach(function(t){t.startLoad(e)})},w.stopLoad=function(){V.logger.log("stopLoad"),this.networkControllers.forEach(function(t){t.stopLoad()})},w.swapAudioCodec=function(){V.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},w.recoverMediaError=function(){V.logger.log("recoverMediaError");var t=this._media;this.detachMedia(),t&&this.attachMedia(t)},w.removeLevel=function(t,e){this.levelController.removeLevel(t,e=void 0===e?0:e)},w=[{key:"version",get:function(){return"1.2.9"}},{key:"Events",get:function(){return y.Events}},{key:"ErrorTypes",get:function(){return v.ErrorTypes}},{key:"ErrorDetails",get:function(){return v.ErrorDetails}},{key:"DefaultConfig",get:function(){return Ur.defaultConfig||Pr},set:function(t){Ur.defaultConfig=t}}],Fr((Mr=Ur).prototype,[{key:"levels",get:function(){return this.levelController.levels||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(t){V.logger.log("set currentLevel:"+t),this.loadLevel=t,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(t){V.logger.log("set nextLevel:"+t),this.levelController.manualLevel=t,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(t){V.logger.log("set loadLevel:"+t),this.levelController.manualLevel=t}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(t){this.levelController.nextLoadLevel=t}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(t){V.logger.log("set firstLevel:"+t),this.levelController.firstLevel=t}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(t){V.logger.log("set startLevel:"+t),-1!==t&&(t=Math.max(t,this.minAutoLevel)),this.levelController.startLevel=t}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(t){t=!!t;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(t){this._autoLevelCapping!==t&&(V.logger.log("set autoLevelCapping:"+t),this._autoLevelCapping=t)}},{key:"bandwidthEstimate",get:function(){var t=this.abrController.bwEstimator;return t?t.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var t=this.levels,e=this.config.minAutoBitrate;if(t)for(var i=t.length,r=0;r<i;r++)if(t[r].maxBitrate>=e)return r;return 0}},{key:"maxAutoLevel",get:function(){var t=this.levels,e=this.autoLevelCapping;return-1===e&&t&&t.length?t.length-1:e}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(t){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,t)}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"mainForwardBufferInfo",get:function(){return this.streamController.getMainFwdBufferInfo()}},{key:"audioTracks",get:function(){var t=this.audioTrackController;return t?t.audioTracks:[]}},{key:"audioTrack",get:function(){var t=this.audioTrackController;return t?t.audioTrack:-1},set:function(t){var e=this.audioTrackController;e&&(e.audioTrack=t)}},{key:"subtitleTracks",get:function(){var t=this.subtitleTrackController;return t?t.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var t=this.subtitleTrackController;return t?t.subtitleTrack:-1},set:function(t){var e=this.subtitleTrackController;e&&(e.subtitleTrack=t)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var t=this.subtitleTrackController;return!!t&&t.subtitleDisplay},set:function(t){var e=this.subtitleTrackController;e&&(e.subtitleDisplay=t)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(t){this.config.lowLatencyMode=t}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}]),Fr(Mr,w),Object.defineProperty(Mr,"prototype",{writable:!1});var Mr,w,Nr=Ur;function Ur(t){void 0===t&&(t={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new Le.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var e=this.config=function(t,e){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==e.liveMaxLatencyDurationCount&&(void 0===e.liveSyncDurationCount||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==e.liveMaxLatencyDuration&&(void 0===e.liveSyncDuration||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return wr({},t,e)}(Ur.DefaultConfig,t),i=(this.userConfig=t,(0,V.enableLogs)(e.debug,"Hls instance"),this._autoLevelCapping=-1,e.progressive&&((i=(t=e).loader)!==Ir&&i!==mr?(V.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),t.progressive=!1):function(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),1}catch(t){}}()&&(t.loader=Ir,t.progressive=!0,t.enableSoftwareAES=!0,V.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))),e.abrController),t=e.bufferController,r=e.capLevelController,n=e.fpsController,s=this.abrController=new i(this),t=this.bufferController=new t(this),r=this.capLevelController=new r(this),n=new n(this),a=new nt(this),o=new at(this),l=new mt(this),h=this.levelController=new Pt(this),u=new Ft(this),d=this.streamController=new Ce(this,u),a=(r.setStreamController(d),n.setStreamController(d),[a,o,h,d]),o=(this.networkControllers=a,[s,t,r,n,l,u]);this.audioTrackController=this.createController(e.audioTrackController,null,a),this.createController(e.audioStreamController,u,a),this.subtitleTrackController=this.createController(e.subtitleTrackController,null,a),this.createController(e.subtitleStreamController,u,a),this.createController(e.timelineController,null,o),this.emeController=this.createController(e.emeController,null,o),this.cmcdController=this.createController(e.cmcdController,null,o),this.latencyController=this.createController(yt,null,o),this.coreComponents=o}Nr.defaultConfig=void 0},923:(t,e,i)=>{"use strict";i.r(e),i.d(e,{BaseSegment:()=>v,ElementaryStreamTypes:()=>r,Fragment:()=>p,Part:()=>m});var r,n=i(965),s=i(945),a=i(93),o=i(960),l=i(408);function h(t,e){t.prototype=Object.create(e.prototype),u(t.prototype.constructor=t,e)}function u(t,e){return(u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function d(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function c(t,e,i){e&&d(t.prototype,e),i&&d(t,i),Object.defineProperty(t,"prototype",{writable:!1})}(e=r=r||{}).AUDIO="audio",e.VIDEO="video",e.AUDIOVIDEO="audiovideo";E.prototype.setByteRange=function(t,e){var t=t.split("@",2),i=[];1===t.length?i[0]=e?e.byteRangeEndOffset:0:i[0]=parseInt(t[1]),i[1]=parseInt(t[0])+i[0],this._byteRange=i},c(E,[{key:"byteRange",get:function(){return this._byteRange||[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=(0,s.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(t){this._url=t}}]);var f,g,v=E,p=(h(y,g=v),(i=y.prototype).createInitializationVector=function(t){for(var e=new Uint8Array(16),i=12;i<16;i++)e[i]=t>>8*(15-i)&255;return e},i.setDecryptDataFromLevelKey=function(t,e){var i=t;return"AES-128"===(null==t?void 0:t.method)&&t.uri&&!t.iv&&((i=o.LevelKey.fromURI(t.uri)).method=t.method,i.iv=this.createInitializationVector(e),i.keyFormat="identity"),i},i.setElementaryStreamInfo=function(t,e,i,r,n,s){void 0===s&&(s=!1);var a=this.elementaryStreams,o=a[t];o?(o.startPTS=Math.min(o.startPTS,e),o.endPTS=Math.max(o.endPTS,i),o.startDTS=Math.min(o.startDTS,r),o.endDTS=Math.max(o.endDTS,n)):a[t]={startPTS:e,endPTS:i,startDTS:r,endDTS:n,partial:s}},i.clearElementaryStreamInfo=function(){var t=this.elementaryStreams;t[r.AUDIO]=null,t[r.VIDEO]=null,t[r.AUDIOVIDEO]=null},c(y,[{key:"decryptdata",get:function(){var t;return this.levelkey||this._decryptdata?(!this._decryptdata&&this.levelkey&&("number"!=typeof(t=this.sn)&&(this.levelkey&&"AES-128"===this.levelkey.method&&!this.levelkey.iv&&a.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),t=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,t)),this._decryptdata):null}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){var t;return null!==this.programDateTime&&(0,n.isFiniteNumber)(this.programDateTime)?(t=(0,n.isFiniteNumber)(this.duration)?this.duration:0,this.programDateTime+1e3*t):null}},{key:"encrypted",get:function(){var t;return!(null==(t=this.decryptdata)||!t.keyFormat||!this.decryptdata.uri)}}]),y),m=(h(T,f=v),c(T,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var t=this.elementaryStreams;return!!(t.audio||t.video||t.audiovideo)}}]),T);function T(t,e,i,r,n){(i=f.call(this,i)||this).fragOffset=0,i.duration=0,i.gap=!1,i.independent=!1,i.relurl=void 0,i.fragment=void 0,i.index=void 0,i.stats=new l.LoadStats,i.duration=t.decimalFloatingPoint("DURATION"),i.gap=t.bool("GAP"),i.independent=t.bool("INDEPENDENT"),i.relurl=t.enumeratedString("URI"),i.fragment=e,i.index=r;e=t.enumeratedString("BYTERANGE");return e&&i.setByteRange(e,n),n&&(i.fragOffset=n.fragOffset+n.duration),i}function y(t,e){return(e=g.call(this,e)||this)._decryptdata=null,e.rawProgramDateTime=null,e.programDateTime=null,e.tagList=[],e.duration=0,e.sn=0,e.levelkey=void 0,e.type=void 0,e.loader=null,e.level=-1,e.cc=0,e.startPTS=void 0,e.endPTS=void 0,e.appendedPTS=void 0,e.startDTS=void 0,e.endDTS=void 0,e.start=0,e.deltaPTS=void 0,e.maxStartPTS=void 0,e.minEndPTS=void 0,e.stats=new l.LoadStats,e.urlId=0,e.data=void 0,e.bitrateTest=!1,e.title=null,e.initSegment=null,e.type=t,e}function E(t){var e;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=((e={})[r.AUDIO]=null,e[r.VIDEO]=null,e[r.AUDIOVIDEO]=null,e),this.baseurl=t}},960:(t,e,i)=>{"use strict";i.r(e),i.d(e,{LevelKey:()=>r});var a=i(945),r=function(){function i(t,e){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,this._uri=e?(0,a.buildAbsoluteURL)(t,e,{alwaysNormalize:!0}):t}i.fromURL=function(t,e){return new i(t,e)},i.fromURI=function(t){return new i(t)};for(var t,e=(t=i).prototype,r=[{key:"uri",get:function(){return this._uri}}],n=0;n<r.length;n++){var s=r[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}return Object.defineProperty(t,"prototype",{writable:!1}),i}()},408:(t,e,i)=>{"use strict";i.r(e),i.d(e,{LoadStats:()=>r});var r=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},965:(t,e,i)=>{"use strict";i.r(e),i.d(e,{MAX_SAFE_INTEGER:()=>n,isFiniteNumber:()=>r});var r=Number.isFinite||function(t){return"number"==typeof t&&isFinite(t)},n=Number.MAX_SAFE_INTEGER||9007199254740991},524:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>n,flushTextTrackMetadataCueSamples:()=>L,flushTextTrackUserdataCueSamples:()=>k,normalizePts:()=>at});var c=i(965);r.getSilentFrame=function(t,e){return"mp4a.40.2"===t?1===e?new Uint8Array([0,200,0,128,35,128]):2===e?new Uint8Array([33,0,73,144,2,25,0,35,128]):3===e?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]):4===e?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]):5===e?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]):6===e?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]):void 0:1===e?new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]):2===e||3===e?new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]):void 0};const N=r;function r(){}var s=Math.pow(2,32)-1,e=(d.init=function(){for(var t in d.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]})d.types.hasOwnProperty(t)&&(d.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var e=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),e=(d.HDLR_TYPES={video:e,audio:i},new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1])),i=new Uint8Array([0,0,0,0,0,0,0,0]),i=(d.STTS=d.STSC=d.STCO=i,d.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),d.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),d.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),d.STSD=new Uint8Array([0,0,0,0,0,0,0,1]),new Uint8Array([105,115,111,109])),r=new Uint8Array([97,118,99,49]),n=new Uint8Array([0,0,0,1]);d.FTYP=d.box(d.types.ftyp,i,n,i,r),d.DINF=d.box(d.types.dinf,d.box(d.types.dref,e))},d.box=function(t){for(var e=8,i=arguments.length,r=new Array(1<i?i-1:0),n=1;n<i;n++)r[n-1]=arguments[n];for(var s=r.length,a=s;s--;)e+=r[s].byteLength;var o=new Uint8Array(e);for(o[0]=e>>24&255,o[1]=e>>16&255,o[2]=e>>8&255,o[3]=255&e,o.set(t,4),s=0,e=8;s<a;s++)o.set(r[s],e),e+=r[s].byteLength;return o},d.hdlr=function(t){return d.box(d.types.hdlr,d.HDLR_TYPES[t])},d.mdat=function(t){return d.box(d.types.mdat,t)},d.mdhd=function(t,e){e*=t;var i=Math.floor(e/(1+s)),e=Math.floor(e%(1+s));return d.box(d.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,i>>24,i>>16&255,i>>8&255,255&i,e>>24,e>>16&255,e>>8&255,255&e,85,196,0,0]))},d.mdia=function(t){return d.box(d.types.mdia,d.mdhd(t.timescale,t.duration),d.hdlr(t.type),d.minf(t))},d.mfhd=function(t){return d.box(d.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))},d.minf=function(t){return"audio"===t.type?d.box(d.types.minf,d.box(d.types.smhd,d.SMHD),d.DINF,d.stbl(t)):d.box(d.types.minf,d.box(d.types.vmhd,d.VMHD),d.DINF,d.stbl(t))},d.moof=function(t,e,i){return d.box(d.types.moof,d.mfhd(t),d.traf(i,e))},d.moov=function(t){for(var e=t.length,i=[];e--;)i[e]=d.trak(t[e]);return d.box.apply(null,[d.types.moov,d.mvhd(t[0].timescale,t[0].duration)].concat(i).concat(d.mvex(t)))},d.mvex=function(t){for(var e=t.length,i=[];e--;)i[e]=d.trex(t[e]);return d.box.apply(null,[d.types.mvex].concat(i))},d.mvhd=function(t,e){e*=t;var i=Math.floor(e/(1+s)),e=Math.floor(e%(1+s)),t=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,i>>24,i>>16&255,i>>8&255,255&i,e>>24,e>>16&255,e>>8&255,255&e,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return d.box(d.types.mvhd,t)},d.sdtp=function(t){for(var e,i=t.samples||[],r=new Uint8Array(4+i.length),n=0;n<i.length;n++)e=i[n].flags,r[n+4]=e.dependsOn<<4|e.isDependedOn<<2|e.hasRedundancy;return d.box(d.types.sdtp,r)},d.stbl=function(t){return d.box(d.types.stbl,d.stsd(t),d.box(d.types.stts,d.STTS),d.box(d.types.stsc,d.STSC),d.box(d.types.stsz,d.STSZ),d.box(d.types.stco,d.STCO))},d.avc1=function(t){for(var e,i,r=[],n=[],s=0;s<t.sps.length;s++)i=(e=t.sps[s]).byteLength,r.push(i>>>8&255),r.push(255&i),r=r.concat(Array.prototype.slice.call(e));for(s=0;s<t.pps.length;s++)i=(e=t.pps[s]).byteLength,n.push(i>>>8&255),n.push(255&i),n=n.concat(Array.prototype.slice.call(e));var a=d.box(d.types.avcC,new Uint8Array([1,r[3],r[4],r[5],255,224|t.sps.length].concat(r).concat([t.pps.length]).concat(n))),o=t.width,l=t.height,h=t.pixelRatio[0],u=t.pixelRatio[1];return d.box(d.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,o>>8&255,255&o,l>>8&255,255&l,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),a,d.box(d.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),d.box(d.types.pasp,new Uint8Array([h>>24,h>>16&255,h>>8&255,255&h,u>>24,u>>16&255,u>>8&255,255&u])))},d.esds=function(t){var e=t.config.length;return new Uint8Array([0,0,0,0,3,23+e,0,1,0,4,15+e,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([e]).concat(t.config).concat([6,1,2]))},d.mp4a=function(t){var e=t.samplerate;return d.box(d.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,e>>8&255,255&e,0,0]),d.box(d.types.esds,d.esds(t)))},d.mp3=function(t){var e=t.samplerate;return d.box(d.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,e>>8&255,255&e,0,0]))},d.stsd=function(t){return"audio"===t.type?"mp3"===t.segmentCodec&&"mp3"===t.codec?d.box(d.types.stsd,d.STSD,d.mp3(t)):d.box(d.types.stsd,d.STSD,d.mp4a(t)):d.box(d.types.stsd,d.STSD,d.avc1(t))},d.tkhd=function(t){var e=t.id,i=t.duration*t.timescale,r=t.width,t=t.height,n=Math.floor(i/(1+s)),i=Math.floor(i%(1+s));return d.box(d.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,i>>24,i>>16&255,i>>8&255,255&i,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>8&255,255&r,0,0,t>>8&255,255&t,0,0]))},d.traf=function(t,e){var i=d.sdtp(t),r=t.id,n=Math.floor(e/(1+s)),e=Math.floor(e%(1+s));return d.box(d.types.traf,d.box(d.types.tfhd,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r])),d.box(d.types.tfdt,new Uint8Array([1,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,e>>24,e>>16&255,e>>8&255,255&e])),d.trun(t,i.length+16+20+8+16+8+8),i)},d.trak=function(t){return t.duration=t.duration||4294967295,d.box(d.types.trak,d.tkhd(t),d.mdia(t))},d.trex=function(t){t=t.id;return d.box(d.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},d.trun=function(t,e){var i,r,n,s,a,o=t.samples||[],l=o.length,h=12+16*l,u=new Uint8Array(h);for(u.set(["video"===t.type?1:0,0,15,1,l>>>24&255,l>>>16&255,l>>>8&255,255&l,(e+=8+h)>>>24&255,e>>>16&255,e>>>8&255,255&e],0),i=0;i<l;i++)r=(a=o[i]).duration,n=a.size,s=a.flags,a=a.cts,u.set([r>>>24&255,r>>>16&255,r>>>8&255,255&r,n>>>24&255,n>>>16&255,n>>>8&255,255&n,s.isLeading<<2|s.dependsOn,s.isDependedOn<<6|s.hasRedundancy<<4|s.paddingValue<<1|s.isNonSync,61440&s.degradPrio,15&s.degradPrio,a>>>24&255,a>>>16&255,a>>>8&255,255&a],12+16*i);return d.box(d.types.trun,u)},d.initSegment=function(t){d.types||d.init();var t=d.moov(t),e=new Uint8Array(d.FTYP.byteLength+t.byteLength);return e.set(d.FTYP),e.set(t,d.FTYP.byteLength),e},d);function d(){}e.types=void 0,e.HDLR_TYPES=void 0,e.STTS=void 0,e.STSC=void 0,e.STCO=void 0,e.STSZ=void 0,e.VMHD=void 0,e.SMHD=void 0,e.STSD=void 0,e.FTYP=void 0,e.DINF=void 0;const $=e;var J=i(851),tt=i(973),et=i(93),b=i(308),it=i(673);function rt(){return(rt=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i,r=arguments[e];for(i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t}).apply(this,arguments)}var nt=null,st=null,n=((e=a.prototype).destroy=function(){},e.resetTimeStamp=function(t){et.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=t},e.resetNextTimestamp=function(){et.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},e.resetInitSegment=function(){et.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},e.getVideoStartPts=function(t){var r=!1,t=t.reduce(function(t,e){var i=e.pts-t;return i<-4294967296?(r=!0,at(t,e.pts)):0<i?t:e.pts},t[0].pts);return r&&et.logger.debug("PTS rollover detected"),t},e.remux=function(t,e,i,r,n,s,a,o){var l,h,u,d,c,f,g,v=n,p=n,m=-1<t.pid,T=-1<e.pid,y=e.samples.length,E=0<t.samples.length,S=a&&0<y||1<y;return(m&&!E||T&&!S)&&!this.ISGenerated&&!a||(this.ISGenerated||(u=this.generateIS(t,e,n)),m=this.isVideoContiguous,a=-1,S&&(a=function(t){for(var e=0;e<t.length;e++)if(t[e].key)return e;return-1}(e.samples),!m)&&this.config.forceKeyFrameOnDiscontinuity&&(f=!0,0<a?(et.logger.warn("[mp4-remuxer]: Dropped "+a+" out of "+y+" video samples due to a missing keyframe"),g=this.getVideoStartPts(e.samples),e.samples=e.samples.slice(a),e.dropped+=a,g=p+=(e.samples[0].pts-g)/e.inputTimeScale):-1===a&&(et.logger.warn("[mp4-remuxer]: No keyframe found out of "+y+" video samples"),f=!1)),this.ISGenerated&&(E&&S&&(y=this.getVideoStartPts(e.samples),y=(at(t.samples[0].pts,y)-y)/e.inputTimeScale,v+=Math.max(0,y),p+=Math.max(0,-y)),E?(t.samplerate||(et.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),u=this.generateIS(t,e,n)),h=this.remuxAudio(t,v,this.isAudioContiguous,s,T||S||o===b.PlaylistLevelType.AUDIO?p:void 0),S&&(y=h?h.endPTS-h.startPTS:0,e.inputTimeScale||(et.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),u=this.generateIS(t,e,n)),l=this.remuxVideo(e,p,m,y))):S&&(l=this.remuxVideo(e,p,m,0)),l)&&(l.firstKeyFrame=a,l.independent=-1!==a,l.firstKeyFramePTS=g)),{audio:h,video:l,initSegment:u,independent:f,text:d=this.ISGenerated&&(i.samples.length&&(c=L(i,n,this._initPTS,this._initDTS)),r.samples.length)?k(r,n,this._initPTS):d,id3:c}},e.generateIS=function(t,e,i){var r,n,s,a=t.samples,o=e.samples,l=this.typeSupported,h={},u=!(0,c.isFiniteNumber)(this._initPTS),d="audio/mp4";if(u&&(s=n=1/0),t.config&&a.length&&(t.timescale=t.samplerate,"mp3"===t.segmentCodec&&(l.mpeg?(d="audio/mpeg",t.codec=""):l.mp3&&(t.codec="mp3")),h.audio={id:"audio",container:d,codec:t.codec,initSegment:"mp3"===t.segmentCodec&&l.mpeg?new Uint8Array(0):$.initSegment([t]),metadata:{channelCount:t.channelCount}},u)&&(r=t.inputTimeScale,s=n=a[0].pts-Math.round(r*i)),e.sps&&e.pps&&o.length&&(e.timescale=e.inputTimeScale,h.video={id:"main",container:"video/mp4",codec:e.codec,initSegment:$.initSegment([e]),metadata:{width:e.width,height:e.height}},u)&&(r=e.inputTimeScale,d=this.getVideoStartPts(o),l=Math.round(r*i),n=Math.min(n,at(o[0].dts,d)-l),s=Math.min(s,d-l)),Object.keys(h).length)return this.ISGenerated=!0,u&&(this._initPTS=s,this._initDTS=n),{tracks:h,initPTS:s,timescale:r}},e.remuxVideo=function(t,e,i,r){var n=t.inputTimeScale,s=t.samples,a=[],o=s.length,l=this._initPTS,h=this.nextAvcDts,u=8,d=this.videoSampleDuration,c=Number.POSITIVE_INFINITY,f=Number.NEGATIVE_INFINITY,g=!1;i&&null!==h||(h=e*n-(s[0].pts-at(s[0].dts,s[0].pts)));for(var v=0;v<o;v++){var p=s[v];p.pts=at(p.pts-l,h),p.dts=at(p.dts-l,h),p.dts<s[0<v?v-1:v].dts&&(g=!0)}g&&s.sort(function(t,e){var i=t.dts-e.dts,t=t.pts-e.pts;return i||t}),m=s[0].dts;var m,e=s[s.length-1].dts-m,T=e?Math.round(e/(o-1)):d||t.inputTimeScale/30;i&&(i=(e=m-h)<-1,(D=T<e)||i)&&(D?et.logger.warn("AVC: "+(0,it.toMsFromMpegTsClock)(e,!0)+" ms ("+e+"dts) hole between fragments detected, filling it"):et.logger.warn("AVC: "+(0,it.toMsFromMpegTsClock)(-e,!0)+" ms ("+e+"dts) overlapping between fragments detected"),!i||h>s[0].pts)&&(m=h,D=s[0].pts-e,s[0].dts=m,s[0].pts=D,et.logger.log("Video: First PTS/DTS adjusted: "+(0,it.toMsFromMpegTsClock)(D,!0)+"/"+(0,it.toMsFromMpegTsClock)(m,!0)+", delta: "+(0,it.toMsFromMpegTsClock)(e,!0)+" ms")),m=Math.max(0,m);for(var y=0,M=0,E=0;E<o;E++){for(var S=s[E],N=S.units,U=N.length,b=0,L=0;L<U;L++)b+=N[L].data.length;M+=b,y+=U,S.length=b,S.dts=Math.max(S.dts,m),c=Math.min(S.pts,c),f=Math.max(S.pts,f)}var k,i=s[o-1].dts,D=M+4*y+8;try{k=new Uint8Array(D)}catch(t){return void this.observer.emit(J.Events.ERROR,J.Events.ERROR,{type:tt.ErrorTypes.MUX_ERROR,details:tt.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:D,reason:"fail allocating video mdat "+D})}var B=new DataView(k.buffer);B.setUint32(0,D),k.set($.types.mdat,4);for(var G=!1,j=Number.POSITIVE_INFINITY,H=Number.POSITIVE_INFINITY,R=Number.NEGATIVE_INFINITY,K=Number.NEGATIVE_INFINITY,A=0;A<o;A++){for(var _=s[A],V=_.units,W=0,I=0,Y=V.length;I<Y;I++){var C=V[I],q=C.data,C=C.data.byteLength;B.setUint32(u,C),u+=4,k.set(q,u),u+=C,W+=4+C}var w,O=void 0,x=(A<o-1?(d=s[A+1].dts-_.dts,O=s[A+1].pts-_.pts):(x=this.config,w=0<A?_.dts-s[A-1].dts:T,O=0<A?_.pts-s[A-1].pts:T,x.stretchShortVideoTrack&&null!==this.nextAudioPts&&Math.floor(x.maxBufferHole*n)<(x=(r?c+r*n:this.nextAudioPts)-_.pts)?((d=x-w)<0?d=w:G=!0,et.logger.log("[mp4-remuxer]: It is approximately "+x/90+" ms to the next segment; using duration "+d/90+" ms for the last video frame.")):d=w),Math.round(_.pts-_.dts)),j=Math.min(j,d),R=Math.max(R,d),H=Math.min(H,O),K=Math.max(K,O);a.push(new ot(_.key,d,W,x))}if(a.length)if(nt)nt<70&&((e=a[0].flags).dependsOn=2,e.isNonSync=0);else if(st&&K-H<R-j&&T/R<.025&&0===a[0].cts){et.logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");for(var P=m,F=0,X=a.length;F<X;F++){var z,Z=P+a[F].duration,Q=P+a[F].cts;F<X-1?(z=Z+a[F+1].cts,a[F].duration=z-Q):a[F].duration=F?a[F-1].duration:T,a[F].cts=0,P=Z}}this.nextAvcDts=h=i+(d=G||!d?T:d),this.videoSampleDuration=d,this.isVideoContiguous=!0;D={data1:$.moof(t.sequenceNumber++,m,rt({},t,{samples:a})),data2:k,startPTS:c/n,endPTS:(f+d)/n,startDTS:m/n,endDTS:h/n,type:"video",hasAudio:!1,hasVideo:!0,nb:a.length,dropped:t.dropped};return t.samples=[],t.dropped=0,D},e.remuxAudio=function(t,e,i,r,n){var s=t.inputTimeScale,a=s/(t.samplerate||s),o="aac"===t.segmentCodec?1024:1152,l=o*a,h=this._initPTS,u="mp3"===t.segmentCodec&&this.typeSupported.mpeg,d=[],c=void 0!==n,f=t.samples,g=u?0:8,v=this.nextAudioPts||-1,p=e*s;if(this.isAudioContiguous=i=i||f.length&&0<v&&(r&&Math.abs(p-v)<9e3||Math.abs(at(f[0].pts-h,p)-v)<20*l),f.forEach(function(t){t.pts=at(t.pts-h,p)}),!i||v<0){if(!(f=f.filter(function(t){return 0<=t.pts})).length)return;v=0===n?0:r&&!c?Math.max(0,p):f[0].pts}if("aac"===t.segmentCodec)for(var m=this.config.maxAudioFramesDrift,T=0,y=v;T<f.length;T++){var E=f[T],S=E.pts,b=S-y,L=Math.abs(1e3*b/s);if(b<=-m*l&&c)0===T&&(et.logger.warn("Audio frame @ "+(S/s).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*b/s)+" ms."),this.nextAudioPts=v=y=S);else if(m*l<=b&&L<1e4&&c){var k=Math.round(b/l);(y=S-k*l)<0&&(k--,y+=l),0===T&&(this.nextAudioPts=v=y),et.logger.warn("[mp4-remuxer]: Injecting "+k+" audio frame @ "+(y/s).toFixed(3)+"s due to "+Math.round(1e3*b/s)+" ms gap.");for(var D=0;D<k;D++){var R=Math.max(y,0),A=N.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);A||(et.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),A=E.unit.subarray()),f.splice(T,0,{unit:A,pts:R}),y+=l,T++}}E.pts=y,y+=l}for(var _,I=null,C=null,w=0,O=f.length;O--;)w+=f[O].unit.byteLength;for(var x=0,M=f.length;x<M;x++){var P=f[x],F=P.unit,P=P.pts;if(null!==C)d[x-1].duration=Math.round((P-C)/a);else{if(I=P=i&&"aac"===t.segmentCodec?v:P,!(0<w))return;w+=g;try{_=new Uint8Array(w)}catch(t){return void this.observer.emit(J.Events.ERROR,J.Events.ERROR,{type:tt.ErrorTypes.MUX_ERROR,details:tt.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:w,reason:"fail allocating audio mdat "+w})}u||(new DataView(_.buffer).setUint32(0,w),_.set($.types.mdat,4))}_.set(F,g);F=F.byteLength;g+=F,d.push(new ot(!0,o,F,0)),C=P}e=d.length;if(e)return this.nextAudioPts=v=C+a*d[d.length-1].duration,n={data1:u?new Uint8Array(0):$.moof(t.sequenceNumber++,I/a,rt({},t,{samples:d})),data2:_,startPTS:n=I/s,endPTS:r=v/s,startDTS:n,endDTS:r,type:"audio",hasAudio:!0,hasVideo:!(t.samples=[]),nb:e},this.isAudioContiguous=!0,n},e.remuxEmptyAudio=function(t,e,i,r){var n=t.inputTimeScale,s=n/(t.samplerate||n),a=this.nextAudioPts,o=(null!==a?a:r.startDTS*n)+this._initDTS,a=r.endDTS*n+this._initDTS,l=1024*s,h=Math.ceil((a-o)/l),u=N.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);if(et.logger.warn("[mp4-remuxer]: remux empty Audio"),u){for(var d=[],c=0;c<h;c++){var f=o+c*l;d.push({unit:u,pts:f,dts:f})}return t.samples=d,this.remuxAudio(t,e,i,!1)}et.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec")},a);function a(t,e,i,r){void 0===r&&(r=""),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=t,this.config=e,this.typeSupported=i,this.ISGenerated=!1,null===nt&&(r=(navigator.userAgent||"").match(/Chrome\/(\d+)/i),nt=r?parseInt(r[1]):0),null===st&&(t=navigator.userAgent.match(/Safari\/(\d+)/i),st=t?parseInt(t[1]):0)}function at(t,e){var i;if(null!==e)for(i=e<t?-8589934592:8589934592;4294967296<Math.abs(t-e);)t+=i;return t}function L(t,e,i,r){var n=t.samples.length;if(n){for(var s=t.inputTimeScale,a=0;a<n;a++){var o=t.samples[a];o.pts=at(o.pts-i,e*s)/s,o.dts=at(o.dts-r,e*s)/s}var l=t.samples;return t.samples=[],{samples:l}}}function k(t,e,i){var r=t.samples.length;if(r){for(var n=t.inputTimeScale,s=0;s<r;s++){var a=t.samples[s];a.pts=at(a.pts-i,e*n)/n}t.samples.sort(function(t,e){return t.pts-e.pts});var o=t.samples;return t.samples=[],{samples:o}}}var ot=function(t,e,i,r){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=e,this.size=i,this.cts=r,this.flags=new o(t)},o=function(t){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=t?2:1,this.isNonSync=t?0:1}},856:(t,e,i)=>{"use strict";var r;i.r(e),i.d(e,{MetadataSchema:()=>r}),(i=r=r||{}).audioId3="org.id3",i.dateRange="com.apple.quicktime.HLS",i.emsg="https://aomedia.org/emsg/ID3"},308:(t,e,i)=>{"use strict";var r,n;i.r(e),i.d(e,{PlaylistContextType:()=>r,PlaylistLevelType:()=>n}),(i=r=r||{}).MANIFEST="manifest",i.LEVEL="level",i.AUDIO_TRACK="audioTrack",i.SUBTITLE_TRACK="subtitleTrack",(e=n=n||{}).MAIN="main",e.AUDIO="audio",e.SUBTITLE="subtitle"},93:(t,e,i)=>{"use strict";i.r(e),i.d(e,{enableLogs:()=>function(t,e){if(self.console&&!0===t||"object"==typeof t){!function(i){for(var t=arguments.length,e=new Array(1<t?t-1:0),r=1;r<t;r++)e[r-1]=arguments[r];e.forEach(function(t){var e;s[t]=i[t]?i[t].bind(i):(t=t,(e=self.console[t])?e.bind(self.console,"["+t+"] >"):n)})}(t,"debug","log","info","warn","error");try{s.log('Debug logs enabled for "'+e+'"')}catch(t){s=r}}else s=r},logger:()=>a});function n(){}var r={trace:n,debug:n,log:n,warn:n,info:n,error:n},s=r;var a=r},63:(t,e,i)=>{"use strict";i.r(e),i.d(e,{RemuxerTrackIdConfig:()=>n,appendUint8Array:()=>function(t,e){var i=new Uint8Array(t.length+e.length);return i.set(t),i.set(e,t.length),i},bin2str:()=>d,computeRawDurationFromSamples:()=>S,discardEPB:()=>D,findBox:()=>I,getDuration:()=>function(t,e){for(var i=0,r=0,n=0,s=I(t,["moof","traf"]),a=0;a<s.length;a++){var o=s[a],l=I(o,["tfhd"])[0],h=e[A(l,4)];if(h){var u=h.default,d=A(l,0)|(null==u?void 0:u.flags),c=null==u?void 0:u.duration;8&d&&(c=A(l,2&d?12:8));for(var f=h.timescale||9e4,g=I(o,["trun"]),v=0;v<g.length;v++)!(i=S(g[v]))&&c&&(i=c*A(g[v],4)),h.type===R.ElementaryStreamTypes.VIDEO?r+=i/f:h.type===R.ElementaryStreamTypes.AUDIO&&(n+=i/f)}}if(0!==r||0!==n)return r||n;for(var p=0,m=I(t,["sidx"]),T=0;T<m.length;T++){var y=E(m[T]);null!=y&&y.references&&(p+=y.references.reduce(function(t,e){return t+e.info.duration||0},0))}return p},getStartDTS:()=>function(s,t){return I(t,["moof","traf"]).reduce(function(t,e){var r=I(e,["tfdt"])[0],n=r[0],e=I(e,["tfhd"]).reduce(function(t,e){e=A(e,4),e=s[e];if(e){var i=A(r,4),i=(i=1===n?(i*=Math.pow(2,32))+A(r,8):i)/(e.timescale||9e4);if(isFinite(i)&&(null===t||i<t))return i}return t},null);return null!==e&&isFinite(e)&&(null===t||e<t)?e:t},null)||0},offsetStartDTS:()=>function(i,t,n){I(t,["moof","traf"]).forEach(function(e){I(e,["tfhd"]).forEach(function(t){var r,t=A(t,4),t=i[t];t&&(r=t.timescale||9e4,I(e,["tfdt"]).forEach(function(t){var e=t[0],i=A(t,4);0===e?(i-=n*r,a(t,4,i=Math.max(i,0))):(i=(i=(i*=Math.pow(2,32))+A(t,8))-n*r,i=Math.max(i,0),e=Math.floor(i/(s+1)),i=Math.floor(i%(s+1)),a(t,4,e),a(t,8,i))}))})})},parseEmsg:()=>function(t){var e=t[0],i="",r="",n=0,s=0,a=0,o=0,l=0,h=0;if(0===e){for(;"\0"!==d(t.subarray(h,h+1));)i+=d(t.subarray(h,h+1)),h+=1;for(i+=d(t.subarray(h,h+1)),h+=1;"\0"!==d(t.subarray(h,h+1));)r+=d(t.subarray(h,h+1)),h+=1;r+=d(t.subarray(h,h+1)),h+=1,n=A(t,12),s=A(t,16),o=A(t,20),l=A(t,24),h=28}else if(1===e){n=A(t,h+=4);var e=A(t,h+=4),u=A(t,h+=4);for(h+=4,a=Math.pow(2,32)*e+u,Number.isSafeInteger(a)||(a=Number.MAX_SAFE_INTEGER,console.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),o=A(t,h),l=A(t,h+=4),h+=4;"\0"!==d(t.subarray(h,h+1));)i+=d(t.subarray(h,h+1)),h+=1;for(i+=d(t.subarray(h,h+1)),h+=1;"\0"!==d(t.subarray(h,h+1));)r+=d(t.subarray(h,h+1)),h+=1;r+=d(t.subarray(h,h+1)),h+=1}return{schemeIdUri:i,value:r,timeScale:n,presentationTime:a,presentationTimeDelta:s,eventDuration:o,id:l,payload:t.subarray(h,t.byteLength)}},parseInitSegment:()=>function(t){for(var i=[],e=I(t,["moov","trak"]),r=0;r<e.length;r++){var n,s,a,o=e[r],l=I(o,["tkhd"])[0];l&&(s=l[0],l=A(l,0===s?12:20),n=I(o,["mdia","mdhd"])[0])&&(n=A(n,0===(s=n[0])?12:20),s=I(o,["mdia","hdlr"])[0])&&(s=d(s.subarray(8,12)),s={soun:R.ElementaryStreamTypes.AUDIO,vide:R.ElementaryStreamTypes.VIDEO}[s])&&(o=I(o,["mdia","minf","stbl","stsd"])[0],a=void 0,o&&(a=d(o.subarray(12,16))),i[l]={timescale:n,type:s},i[s]={timescale:n,id:l,codec:a})}return I(t,["moov","mvex","trex"]).forEach(function(t){var e=A(t,4),e=i[e];e&&(e.default={duration:A(t,12),flags:A(t,20)})}),i},parseSEIMessageFromNALu:()=>C,parseSamples:()=>function(E,S){var b=[],L=S.samples,k=S.timescale,s=S.id,D=!1;return I(L,["moof"]).map(function(t){var y=t.byteOffset-8;I(t,["traf"]).map(function(n){var t=I(n,["tfdt"]).map(function(t){var e=t[0],i=A(t,4);return(i=1===e?(i*=Math.pow(2,32))+A(t,8):i)/k})[0];return void 0!==t&&(E=t),I(n,["tfhd"]).map(function(t){var e=A(t,4),i=16777215&A(t,0),m=0,T=0,r=8;e===s&&(0!=(1&i)&&(r+=8),0!=(2&i)&&(r+=4),0!=(8&i)&&(m=A(t,r),r+=4),0!=(16&i)&&(T=A(t,r),r+=4),0!=(32&i)&&(r+=4),"video"===S.type&&(e=S.codec,D=!!e&&("hvc1"===(e=(t=e.indexOf("."))<0?e:e.substring(0,t))||"hev1"===e||"dvh1"===e||"dvhe"===e)),I(n,["trun"]).map(function(t){var e=t[0],i=16777215&A(t,0),r=0,n=0!=(256&i),s=0,a=0!=(512&i),o=0,l=0!=(1024&i),h=0!=(2048&i),u=0,d=A(t,4),c=8;0!=(1&i)&&(r=A(t,c),c+=4),0!=(4&i)&&(c+=4);for(var f=r+y,g=0;g<d;g++){if(n?(s=A(t,c),c+=4):s=m,a?(o=A(t,c),c+=4):o=T,l&&(c+=4),h&&(u=(0===e?A:_)(t,c),c+=4),S.type===R.ElementaryStreamTypes.VIDEO)for(var v=0;v<o;){var p=A(L,f);!function(t,e){if(t)return 39==(t=e>>1&63)||40==t;return 6==(31&e)}(D,L[f+=4])||C(L.subarray(f,f+p),D?2:1,E+u/k,b),f+=p,v+=p+4}E+=s/k}}))})})}),b},parseSegmentIndex:()=>E,readSint32:()=>_,readUint16:()=>k,readUint32:()=>A,segmentValidRange:()=>function(t){var e={valid:null,remainder:null},i=I(t,["moof"]);return i&&(i.length<2?e.remainder=t:(i=i[i.length-1],e.valid=(0,r.sliceUint8)(t,0,i.byteOffset-8),e.remainder=(0,r.sliceUint8)(t,i.byteOffset-8))),e},writeUint32:()=>a});var r=i(145),R=i(923),L=i(181),s=Math.pow(2,32)-1,o=[].push,n={video:1,audio:2,id3:3,text:4};function d(t){return String.fromCharCode.apply(null,t)}function k(t,e){t=t[e]<<8|t[e+1];return t<0?65536+t:t}function A(t,e){t=_(t,e);return t<0?4294967296+t:t}function _(t,e){return t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3]}function a(t,e,i){t[e]=i>>24,t[e+1]=i>>16&255,t[e+2]=i>>8&255,t[e+3]=255&i}function I(t,e){var i=[];if(e.length)for(var r=t.byteLength,n=0;n<r;){var s,a=A(t,n),a=1<a?n+a:r;d(t.subarray(n+4,n+8))===e[0]&&(1===e.length?i.push(t.subarray(n+8,a)):(s=I(t.subarray(n+8,a),e.slice(1))).length&&o.apply(i,s)),n=a}return i}function E(t){var e=[],i=t[0],r=8,n=A(t,r),s=t.length+0,a=k(t,r=(r+=4)+(0===i?8:16)+2);r+=2;for(var o=0;o<a;o++){var l=r,h=A(t,l),u=(l+=4,2147483647&h);if(1==(2147483648&h)>>>31)return console.warn("SIDX has hierarchical references (not supported)"),null;h=A(t,l);l+=4,e.push({referenceSize:u,subsegmentDuration:h,info:{duration:h/n,start:s,end:s+u-1}}),s+=u,r=l+=4}return{earliestPresentationTime:0,timescale:n,version:i,referencesCount:a,references:e}}function S(t){var e=A(t,0),i=8;1&e&&(i+=4),4&e&&(i+=4);for(var r=0,n=A(t,4),s=0;s<n;s++)256&e&&(r+=A(t,i),i+=4),512&e&&(i+=4),1024&e&&(i+=4),2048&e&&(i+=4);return r}function C(t,e,i,r){var n=D(t),s=0;s+=e;for(var a=0,o=0,l=!1,h=0;s<n.length;){for(a=0;!(s>=n.length)&&(a+=h=n[s++],255===h););for(o=0;!(s>=n.length)&&(o+=h=n[s++],255===h););var u=n.length-s;if(!l&&4===a&&s<n.length){if(l=!0,181===n[s++]){var d=k(n,s);if(s+=2,49===d){d=A(n,s);if(s+=4,1195456820===d){d=n[s++];if(3===d){var c=n[s++],f=64&c,g=f?2+3*(31&c):0,v=new Uint8Array(g);if(f){v[0]=c;for(var p=1;p<g;p++)v[p]=n[s++]}r.push({type:d,payloadType:a,pts:i,bytes:v})}}}}}else if(5===a&&o<u){if(l=!0,16<o){for(var m=[],T=0;T<16;T++){var y=n[s++].toString(16);m.push(1==y.length?"0"+y:y),3!==T&&5!==T&&7!==T&&9!==T||m.push("-")}for(var E=o-16,S=new Uint8Array(E),b=0;b<E;b++)S[b]=n[s++];r.push({payloadType:a,pts:i,uuid:m.join(""),userData:(0,L.utf8ArrayToStr)(S),userDataBytes:S})}}else if(o<u)s+=o;else if(u<o)break}}function D(t){for(var e=t.byteLength,i=[],r=1;r<e-2;)0===t[r]&&0===t[r+1]&&3===t[r+2]?(i.push(r+2),r+=2):r++;if(0===i.length)return t;for(var n=e-i.length,s=new Uint8Array(n),a=0,r=0;r<n;a++,r++)a===i[0]&&(a++,i.shift()),s[r]=t[a];return s}},673:(t,e,i)=>{"use strict";function n(t,e,i,r){t=t*e*(i=void 0===i?1:i);return(r=void 0===r?!1:r)?Math.round(t):t}i.r(e),i.d(e,{toMpegTsClockFromTimescale:()=>function(t,e){return n(t,9e4,1/(e=void 0===e?1:e))},toMsFromMpegTsClock:()=>function(t,e){return n(t,1e3,1/9e4,e=void 0===e?!1:e)},toTimescaleFromBase:()=>n,toTimescaleFromScale:()=>function(t,e,i,r){return n(t,e,1/(i=void 0===i?1:i),r=void 0===r?!1:r)}})},145:(t,e,i)=>{"use strict";i.r(e),i.d(e,{sliceUint8:()=>function(t,e,i){return Uint8Array.prototype.slice?t.slice(e,i):new Uint8Array(Array.prototype.slice.call(t,e,i))}})},729:t=>{"use strict";var r=Object.prototype.hasOwnProperty,f="~";function i(){}function s(t,e,i){this.fn=t,this.context=e,this.once=i||!1}function n(t,e,i,r,n){if("function"!=typeof i)throw new TypeError("The listener must be a function");i=new s(i,r||t,n),r=f?f+e:e;return t._events[r]?t._events[r].fn?t._events[r]=[t._events[r],i]:t._events[r].push(i):(t._events[r]=i,t._eventsCount++),t}function l(t,e){0==--t._eventsCount?t._events=new i:delete t._events[e]}function e(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(f=!1)),e.prototype.eventNames=function(){var t,e,i=[];if(0===this._eventsCount)return i;for(e in t=this._events)r.call(t,e)&&i.push(f?e.slice(1):e);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(t)):i},e.prototype.listeners=function(t){var t=f?f+t:t,e=this._events[t];if(!e)return[];if(e.fn)return[e.fn];for(var i=0,r=e.length,n=new Array(r);i<r;i++)n[i]=e[i].fn;return n},e.prototype.listenerCount=function(t){t=f?f+t:t,t=this._events[t];return t?t.fn?1:t.length:0},e.prototype.emit=function(t,e,i,r,n,s){var a=f?f+t:t;if(!this._events[a])return!1;var o,l=this._events[a],h=arguments.length;if(l.fn){switch(l.once&&this.removeListener(t,l.fn,void 0,!0),h){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,e),!0;case 3:return l.fn.call(l.context,e,i),!0;case 4:return l.fn.call(l.context,e,i,r),!0;case 5:return l.fn.call(l.context,e,i,r,n),!0;case 6:return l.fn.call(l.context,e,i,r,n,s),!0}for(c=1,o=new Array(h-1);c<h;c++)o[c-1]=arguments[c];l.fn.apply(l.context,o)}else for(var u,d=l.length,c=0;c<d;c++)switch(l[c].once&&this.removeListener(t,l[c].fn,void 0,!0),h){case 1:l[c].fn.call(l[c].context);break;case 2:l[c].fn.call(l[c].context,e);break;case 3:l[c].fn.call(l[c].context,e,i);break;case 4:l[c].fn.call(l[c].context,e,i,r);break;default:if(!o)for(u=1,o=new Array(h-1);u<h;u++)o[u-1]=arguments[u];l[c].fn.apply(l[c].context,o)}return!0},e.prototype.on=function(t,e,i){return n(this,t,e,i,!1)},e.prototype.once=function(t,e,i){return n(this,t,e,i,!0)},e.prototype.removeListener=function(t,e,i,r){t=f?f+t:t;if(this._events[t])if(e){var n=this._events[t];if(n.fn)n.fn!==e||r&&!n.once||i&&n.context!==i||l(this,t);else{for(var s=0,a=[],o=n.length;s<o;s++)(n[s].fn!==e||r&&!n[s].once||i&&n[s].context!==i)&&a.push(n[s]);a.length?this._events[t]=1===a.length?a[0]:a:l(this,t)}}else l(this,t);return this},e.prototype.removeAllListeners=function(t){return t?(t=f?f+t:t,this._events[t]&&l(this,t)):(this._events=new i,this._eventsCount=0),this},e.prototype.off=e.prototype.removeListener,e.prototype.addListener=e.prototype.on,e.prefixed=f,t.exports=e.EventEmitter=e},945:function(t){var e=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,s=/^(?=([^\/?#]*))\1([^]*)$/,i=/(?:\/|^)\.(?=\/)/g,r=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,a={buildAbsoluteURL:function(t,e,i){if(i=i||{},t=t.trim(),!(e=e.trim())){if(!i.alwaysNormalize)return t;var r=a.parseURL(t);if(r)return r.path=a.normalizePath(r.path),a.buildURLFromParts(r);throw new Error("Error trying to parse base URL.")}r=a.parseURL(e);if(!r)throw new Error("Error trying to parse relative URL.");if(r.scheme)return i.alwaysNormalize?(r.path=a.normalizePath(r.path),a.buildURLFromParts(r)):e;e=a.parseURL(t);if(!e)throw new Error("Error trying to parse base URL.");!e.netLoc&&e.path&&"/"!==e.path[0]&&(t=s.exec(e.path),e.netLoc=t[1],e.path=t[2]),e.netLoc&&!e.path&&(e.path="/");var n,t={scheme:e.scheme,netLoc:r.netLoc,path:null,params:r.params,query:r.query,fragment:r.fragment};return r.netLoc||(t.netLoc=e.netLoc,"/"===r.path[0])||(r.path?(n=(n=e.path).substring(0,n.lastIndexOf("/")+1)+r.path,t.path=a.normalizePath(n)):(t.path=e.path,r.params||(t.params=e.params,r.query)||(t.query=e.query))),null===t.path&&(t.path=i.alwaysNormalize?a.normalizePath(r.path):r.path),a.buildURLFromParts(t)},parseURL:function(t){t=e.exec(t);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(t){for(t=t.split("").reverse().join("").replace(i,"");t.length!==(t=t.replace(r,"")).length;);return t.split("").reverse().join("")},buildURLFromParts:function(t){return t.scheme+t.netLoc+t.path+t.params+t.query+t.fragment}};t.exports=a}},n={},r.m=i,r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var i in e)r.o(e,i)&&!r.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r(817).default;function r(t){var e=n[t];return void 0!==e||(e=n[t]={exports:{}},i[t].call(e.exports,e,e.exports,r)),e.exports}var i,n},"object"==typeof e&&"object"==typeof t?t.exports=i():"function"==typeof define&&define.amd?define([],i):"object"==typeof e?e.Hls=i():this.Hls=i())}}]);